<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>About-é¾™å¤§</title>
  
  <subtitle>ä¸å¿˜åˆå¿ƒï¼Œç»§ç»­å‰è¿›ã€‚</subtitle>
  <link href="/blog/atom.xml" rel="self"/>
  
  <link href="https://duanruilong.github.io/"/>
  <updated>2019-01-03T07:42:59.000Z</updated>
  <id>https://duanruilong.github.io/</id>
  
  <author>
    <name>DRLong</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>styled-componentså¿«é€Ÿå…¥é—¨</title>
    <link href="https://duanruilong.github.io/2019/01/03/styled-components%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"/>
    <id>https://duanruilong.github.io/2019/01/03/styled-componentså¿«é€Ÿå…¥é—¨/</id>
    <published>2019-01-03T07:20:15.000Z</published>
    <updated>2019-01-03T07:42:59.000Z</updated>
    
    <content type="html"><![CDATA[<p>styled-componentsåˆ©ç”¨æ ‡è®°çš„æ¨¡æ¿æ–‡å­—æ¥è®¾ç½®ç»„ä»¶çš„æ ·å¼ã€‚</p><p>å®ƒåˆ é™¤äº†ç»„ä»¶å’Œæ ·å¼ä¹‹é—´çš„æ˜ å°„ã€‚è¿™æ„å‘³ç€å½“æ‚¨å®šä¹‰æ ·å¼æ—¶ï¼Œå®é™…ä¸Šæ˜¯åœ¨åˆ›å»ºä¸€ä¸ªæ­£å¸¸çš„Reactç»„ä»¶ï¼Œå®ƒä¼šå°†æ ·å¼é™„åŠ åˆ°å®ƒä¸Šé¢ã€‚</p><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/styled.png" alt="styled-components"></p><a id="more"></a><h1 id="styled-components"><a href="#styled-components" class="headerlink" title="styled-components"></a>styled-components</h1><p><code>styled-components</code> æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„<code>css in js</code> ç±»åº“ã€‚å’Œæ‰€æœ‰åŒç±»å‹çš„ç±»åº“ä¸€æ ·ï¼Œé€šè¿‡ js èµ‹èƒ½è§£å†³äº†åŸç”Ÿ css æ‰€ä¸å…·å¤‡çš„èƒ½åŠ›ï¼Œæ¯”å¦‚å˜é‡ã€å¾ªç¯ã€å‡½æ•°ç­‰ã€‚</p><h1 id="æ–‡æ¡£"><a href="#æ–‡æ¡£" class="headerlink" title="æ–‡æ¡£"></a>æ–‡æ¡£</h1><p>å®˜æ–¹æ–‡æ¡£<a href="https://www.styled-components.com/" target="_blank" rel="noopener">é“¾æ¥</a></p><h1 id="ä¼˜åŠ¿"><a href="#ä¼˜åŠ¿" class="headerlink" title="ä¼˜åŠ¿"></a>ä¼˜åŠ¿</h1><p>className çš„å†™æ³•ä¼šè®©åŸæœ¬å†™cssçš„å†™æ³•ååˆ†éš¾ä»¥æ¥å—,<code>sass</code> ã€<code>less</code> ç­‰é¢„å¤„ç†å¯ä»¥è§£å†³éƒ¨åˆ† <code>css</code> çš„å±€é™æ€§ï¼Œè¿˜æ˜¯è¦å­¦ä¹ æ–°çš„è¯­æ³•ï¼Œè€Œä¸”éœ€è¦å¯¹å…¶ç¼–è¯‘ï¼Œå¦‚æœé€šè¿‡å¯¼å…¥cssçš„æ–¹å¼ ä¼šå¯¼è‡´å˜é‡æ³„éœ²æˆä¸ºå…¨å±€ éœ€è¦é…ç½®webpackè®©å…¶æ¨¡å—åŒ–,å…¶å¤æ‚çš„ <code>webpack</code> é…ç½®ä¹Ÿæ€»æ˜¯è®©å¼€å‘è€…æŠµè§¦ã€‚</p><p>æœ‰è¿‡<code>sass</code> ã€<code>less</code>å¼€å‘ç»éªŒï¼Œä¹Ÿèƒ½å¾ˆå¿«çš„åˆ‡æ¢åˆ°<code>styled-components</code>ï¼Œå› ä¸ºå¤§éƒ¨åˆ†è¯­æ³•éƒ½ç±»ä¼¼ï¼Œæ¯”å¦‚<code>åµŒå¥—</code>ã€<code>&amp;</code> ã€ <code>ç»§æ‰¿</code>ç­‰ï¼Œ <code>styled-componens</code> å¾ˆå¥½çš„è§£å†³äº†å­¦ä¹ æˆæœ¬ä¸å¼€å‘ç¯å¢ƒé—®é¢˜ï¼Œå¾ˆé€‚åˆ <code>React æŠ€æœ¯æ ˆ</code> ã€<code>React Native</code>çš„é¡¹ç›®å¼€å‘ã€‚</p><h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">npm install --save styled-components</span><br></pre></td></tr></table></figure><blockquote><p>webstorméœ€è¦å®‰è£… styled-component æ’ä»¶ ; vscodeå·²æ”¯æŒæ™ºèƒ½æç¤º</p></blockquote><h1 id="å®æˆ˜"><a href="#å®æˆ˜" class="headerlink" title="å®æˆ˜"></a>å®æˆ˜</h1><h2 id="ç®€å•çš„ç»„ä»¶"><a href="#ç®€å•çš„ç»„ä»¶" class="headerlink" title="ç®€å•çš„ç»„ä»¶"></a>ç®€å•çš„ç»„ä»¶</h2><p>åˆ›å»ºäº†ä¸¤ä¸ªç®€å•çš„ç»„ä»¶ï¼Œä¸€ä¸ªåŒ…è£…å™¨å’Œä¸€ä¸ªæ ‡é¢˜ï¼Œå¹¶é™„åŠ äº†ä¸€äº›æ ·å¼ï¼š</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">import styled from 'styled-components';</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªTitleç»„ä»¶ï¼Œå®ƒå°†ä½¿ç”¨æŸäº›æ ·å¼</span></span><br><span class="line"><span class="keyword">const</span> Title = styled.h1`</span><br><span class="line">  font-size: <span class="number">1.5</span>em;</span><br><span class="line">  text-align: center;</span><br><span class="line">  color: palevioletred;</span><br><span class="line">`;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªåŒ…è£…å™¨ç»„ä»¶ï¼Œå®ƒå°†ä½¿ç”¨æŸäº›æ ·å¼</span></span><br><span class="line"><span class="keyword">const</span> Wrapper = styled.section`</span><br><span class="line">  padding: <span class="number">4</span>em;</span><br><span class="line">  background: papayawhip;</span><br><span class="line">`;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åƒä»»ä½•å…¶ä»–Reactç»„ä»¶ä¸€æ ·ä½¿ç”¨Titleå’ŒWrapper  - é™¤äº†å®ƒä»¬çš„æ ·å¼ï¼</span></span><br><span class="line">render(</span><br><span class="line">  &lt;Wrapper&gt;</span><br><span class="line">    &lt;Title&gt;</span><br><span class="line">      Hello World!</span><br><span class="line">    &lt;/Title&gt;</span><br><span class="line">  &lt;/Wrapper&gt;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æ§åˆ¶å°ä¸­è¾“å‡ºäº†ä¸€ä¸ªéšæœºçš„classNameï¼Œè¿™æ˜¯styled-componentså¸®æˆ‘ä»¬å®Œæˆçš„. æ³¨æ„: ç»„ä»¶åè¦ä»¥å¤§äº›å¼€å¤´ ä¸ç„¶ä¼šè¢«è§£ææˆæ™®é€šæ ‡ç­¾</p><h2 id="ä¼ é€’props"><a href="#ä¼ é€’props" class="headerlink" title="ä¼ é€’props"></a>ä¼ é€’props</h2><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Button = styled.button`</span><br><span class="line">    background: $&#123;props =&gt; props.primary ? 'palevioletred' : 'white'&#125;;</span><br><span class="line">    color: $&#123;props =&gt; props.primary ? 'white' : 'palevioletred'&#125;;</span><br><span class="line">    font-size: <span class="number">1</span>em;</span><br><span class="line">    margin: <span class="number">1</span>em;</span><br><span class="line">    padding: <span class="number">0.25</span>em <span class="number">1</span>em;</span><br><span class="line">    border: <span class="number">2</span>px solid palevioletred;</span><br><span class="line">    border-radius: <span class="number">3</span>px;</span><br><span class="line">`</span><br><span class="line">render(</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;Button&gt;Normal&lt;/Button&gt;</span><br><span class="line">        &lt;Button primary&gt;Primary&lt;/Button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>åœ¨ç»„ä»¶ä¼ é€’çš„propséƒ½å¯ä»¥åœ¨å®šä¹‰ç»„ä»¶æ—¶è·å–åˆ°ï¼Œè¿™æ ·å°±å¾ˆå®¹æ˜“å®ç°å®šåˆ¶æŸäº›é£æ ¼ç»„ä»¶</p><h2 id="propsé«˜çº§ç”¨æ³•"><a href="#propsé«˜çº§ç”¨æ³•" class="headerlink" title="propsé«˜çº§ç”¨æ³•"></a>propsé«˜çº§ç”¨æ³•</h2><p>è®¾ç½®é»˜è®¤å€¼ï¼Œåœ¨æœªè®¾å®šå¿…é¡»ä¼ å€¼çš„æƒ…å†µä¸‹æˆ‘ä»¬ä¼šç»™ä¸€ä¸ªé»˜è®¤å€¼(defaultProps)</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">ALbum</span> <span class="title">extends</span> <span class="title">React</span>.<span class="title">Component</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    constructor (props) &#123;</span><br><span class="line">        super(props)</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;</span><br><span class="line">            <span class="comment">// æ¥æ”¶ä¼ é€’çš„å€¼</span></span><br><span class="line">            imgSrc: props.imgSrc</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    render () &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;imgSrc&#125; = <span class="keyword">this</span>.state</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;Container imgSrc=&#123;imgSrc&#125;&gt;</span><br><span class="line">            &lt;/Container&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨è¿™é‡Œæ˜¯å¯ä»¥æ‹¿åˆ°propsçš„ </span></span><br><span class="line"><span class="keyword">const</span> Container = styled.div`</span><br><span class="line">    background-size: cover;</span><br><span class="line">    background-image: url($&#123;props =&gt;  props.imgSrc&#125;);</span><br><span class="line">    width: <span class="number">100</span>%;    </span><br><span class="line">    height: <span class="number">300</span>px;</span><br><span class="line">`</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“ç„¶æ²¡ä¼ å€¼ä¹Ÿæ²¡å…³ç³»  æˆ‘ä»¬è®¾ç½®é»˜è®¤å€¼</span></span><br><span class="line">Container.defaultProps = &#123;</span><br><span class="line">    imgSrc: Cover</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¡‘é€ ç»„ä»¶"><a href="#å¡‘é€ ç»„ä»¶" class="headerlink" title="å¡‘é€ ç»„ä»¶"></a>å¡‘é€ ç»„ä»¶</h2><p>è¿™ä¸ªéå¸¸æœ‰ç”¨ ä½ å¯èƒ½ä¼šé‡åˆ°ä¸€äº›åŸæœ¬å°±å·²ç»æ˜¯ç»„ä»¶äº† ä½†æ˜¯ä½ è¦ä¸ºä»–æ·»åŠ ä¸€äº›æ ·å¼ï¼Œè¿™æ—¶å€™è¯¥æ€ä¹ˆåŠå‘¢ ?</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¼ é€’className åœ¨react-native ä¸­è¦ä½¿ç”¨ style</span></span><br><span class="line"><span class="keyword">const</span> Link = (&#123;className , children&#125;) =&gt; (</span><br><span class="line">    &lt;a className=&#123;className&#125;&gt;</span><br><span class="line">        &#123;children&#125;</span><br><span class="line">    &lt;/a&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> StyledLink = styled(Link)`</span><br><span class="line">    color: palevioletred;</span><br><span class="line">`</span><br><span class="line">render(</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;Link&gt;æ™®é€šç»„ä»¶&lt;/Link&gt;</span><br><span class="line">        &lt;StyledLink&gt;æœ‰é¢œè‰²å—ï¼Ÿ&lt;/StyledLink&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h2 id="ç»„ä»¶æ ·å¼ç»§æ‰¿"><a href="#ç»„ä»¶æ ·å¼ç»§æ‰¿" class="headerlink" title="ç»„ä»¶æ ·å¼ç»§æ‰¿"></a>ç»„ä»¶æ ·å¼ç»§æ‰¿</h2><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Button = styled.button`</span><br><span class="line">    color: palevioletred;</span><br><span class="line">    font-size: <span class="number">1</span>em;</span><br><span class="line">    margin: <span class="number">1</span>em;</span><br><span class="line">    padding: <span class="number">0.25</span>em <span class="number">1</span>em;</span><br><span class="line">    border: <span class="number">2</span>px solid palevioletred;</span><br><span class="line">    border-radius: <span class="number">3</span>px;</span><br><span class="line">`;</span><br><span class="line"><span class="keyword">const</span> TomatoButton = Button.extend`</span><br><span class="line">    color: tomato;</span><br><span class="line">    border-color: tomato;</span><br><span class="line">`;</span><br><span class="line"><span class="comment">// TomatoButton éƒ¨åˆ†æ ·å¼ç»§æ‰¿è‡ª Button è¿™ç§æƒ…å†µä¸‹ä¸ä¼šç”Ÿæˆä¸¤ä¸ªclass</span></span><br></pre></td></tr></table></figure><h2 id="æ”¹å˜ç»„ä»¶æ ‡ç­¾"><a href="#æ”¹å˜ç»„ä»¶æ ‡ç­¾" class="headerlink" title="æ”¹å˜ç»„ä»¶æ ‡ç­¾"></a>æ”¹å˜ç»„ä»¶æ ‡ç­¾</h2><p>åœ¨é—²çš„è›‹ç–¼çš„æƒ…å†µä¸‹ æˆ‘ä»¬æƒ³è¦æ”¹å˜ç»„ä»¶çš„æ ‡ç­¾ æ¯”å¦‚æŠŠ button å˜æˆ a æ ‡ç­¾</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ©ç”¨ä¸Šé¢å®šä¹‰çš„ Button ç»„ä»¶ è°ƒç”¨ withComponent æ–¹æ³•</span></span><br><span class="line"><span class="keyword">const</span> Link = Button.withComponent(<span class="string">'a'</span>)</span><br></pre></td></tr></table></figure><h2 id="ç»´æŠ¤å…¶ä»–å±æ€§"><a href="#ç»´æŠ¤å…¶ä»–å±æ€§" class="headerlink" title="ç»´æŠ¤å…¶ä»–å±æ€§"></a>ç»´æŠ¤å…¶ä»–å±æ€§</h2><p>åœ¨æŸç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦ç”¨åˆ°ç¬¬ä¸‰æ–¹åº“æ ·å¼ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•è½»æ¾è¾¾åˆ°<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Input = styled.input.attrs(&#123;</span><br><span class="line">    <span class="comment">// å®šä¹‰é™æ€ props</span></span><br><span class="line">    type: 'password',</span><br><span class="line">    <span class="comment">// æ²¡ä¼ é»˜è®¤ä½¿ç”¨ 1em</span></span><br><span class="line">    margin: props =&gt; props.size || '1em',</span><br><span class="line">    padding: props =&gt; props.size || '1em'</span><br><span class="line">&#125;)`</span><br><span class="line">    color: palevioletred;</span><br><span class="line">    font-size: <span class="number">1</span>em;</span><br><span class="line">    border: <span class="number">2</span>px solid palevioletred;</span><br><span class="line">    border-radius: <span class="number">3</span>px;</span><br><span class="line">    <span class="comment">// åŠ¨æ€è®¡ç®—props</span></span><br><span class="line">    margin: $&#123;props =&gt; props.margin&#125;;</span><br><span class="line">    padding: $&#123;props =&gt; props.padding&#125;</span><br><span class="line">`</span><br><span class="line">render ( &lt;Input size='1em'&gt;&lt;/Input&gt;  &lt;Input size='2em'&gt;&lt;/Input&gt; )</span><br></pre></td></tr></table></figure></p><h2 id="åŠ¨ç”»"><a href="#åŠ¨ç”»" class="headerlink" title="åŠ¨ç”»"></a>åŠ¨ç”»</h2><p>åŠ¨ç”»ä¼šç”Ÿæˆä¸€ä¸ªéšæœºç±»å è€Œä¸ä¼šæ±¡æŸ“åˆ°å…¨å±€<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import &#123; keyframes &#125; from 'styled-components'</span><br><span class="line"><span class="comment">// CSS åŠ¨ç”»</span></span><br><span class="line"><span class="keyword">const</span> rotate360 = keyframes`</span><br><span class="line">    from &#123;</span><br><span class="line">        transform: rotate(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    to &#123;</span><br><span class="line">        transform: rotate(<span class="number">360</span>deg);</span><br><span class="line">    &#125;</span><br><span class="line">`</span><br><span class="line"><span class="keyword">const</span> Rotate = Button.extend`</span><br><span class="line">    animation: $&#123;rotate360&#125; <span class="number">2</span>s linear infinite;</span><br><span class="line">`</span><br><span class="line">render ( &lt;Rotate&gt;  ğŸ’…  &lt;/Rotate&gt; )</span><br></pre></td></tr></table></figure></p><h1 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h1><p>styled-componentsè™½ç„¶è§£å†³äº†å¤§éƒ¨åˆ†é—®é¢˜ï¼Œå¢åŠ äº†å¯ç»´æŠ¤æ€§ï¼Œä½†æ˜¯ç ´åäº†åŸç”Ÿä½“éªŒï¼Œæ—¶å¸¸æˆ‘ä»¬éœ€è¦å†™æ›´å¤šçš„ä»£ç æ¥è¾¾åˆ°ä¸šåŠ¡è¦æ±‚ï¼Œå¸Œæœ›æœªæ¥æœ‰æ›´å¥½çš„æ–¹æ¡ˆ.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;styled-componentsåˆ©ç”¨æ ‡è®°çš„æ¨¡æ¿æ–‡å­—æ¥è®¾ç½®ç»„ä»¶çš„æ ·å¼ã€‚&lt;/p&gt;
&lt;p&gt;å®ƒåˆ é™¤äº†ç»„ä»¶å’Œæ ·å¼ä¹‹é—´çš„æ˜ å°„ã€‚è¿™æ„å‘³ç€å½“æ‚¨å®šä¹‰æ ·å¼æ—¶ï¼Œå®é™…ä¸Šæ˜¯åœ¨åˆ›å»ºä¸€ä¸ªæ­£å¸¸çš„Reactç»„ä»¶ï¼Œå®ƒä¼šå°†æ ·å¼é™„åŠ åˆ°å®ƒä¸Šé¢ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/styled.png&quot; alt=&quot;styled-components&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="ç¼–ç¨‹" scheme="https://duanruilong.github.io/categories/%E7%BC%96%E7%A8%8B/"/>
    
    
      <category term="Javascript" scheme="https://duanruilong.github.io/tags/Javascript/"/>
    
      <category term="ç¼–ç¨‹" scheme="https://duanruilong.github.io/tags/%E7%BC%96%E7%A8%8B/"/>
    
      <category term="React" scheme="https://duanruilong.github.io/tags/React/"/>
    
      <category term="CSS" scheme="https://duanruilong.github.io/tags/CSS/"/>
    
  </entry>
  
  <entry>
    <title>SQLite ä¹‹ INSERT OR REPLACEä½¿ç”¨</title>
    <link href="https://duanruilong.github.io/2018/12/28/SQLite-%E4%B9%8B-INSERT-OR-REPLACE%E4%BD%BF%E7%94%A8/"/>
    <id>https://duanruilong.github.io/2018/12/28/SQLite-ä¹‹-INSERT-OR-REPLACEä½¿ç”¨/</id>
    <published>2018-12-28T10:29:31.000Z</published>
    <updated>2018-12-28T11:29:25.000Z</updated>
    
    <content type="html"><![CDATA[<p>SQLiteæ˜¯ä¸€ä¸ªCè¯­è¨€åº“ï¼Œå®ƒå®ç°äº†ä¸€ä¸ª å°å‹ï¼Œ å¿«é€Ÿï¼Œ è‡ªåŒ…å«ï¼Œ é«˜å¯é æ€§ï¼Œ åŠŸèƒ½é½å…¨çš„ SQLæ•°æ®åº“å¼•æ“ã€‚SQLiteæ˜¯ä¸–ç•Œä¸Šä½¿ç”¨æœ€å¤šçš„æ•°æ®åº“å¼•æ“ã€‚å®ƒå†…ç½®äºæ‰€æœ‰ç§»åŠ¨ç”µè¯å’Œå¤§å¤šæ•°è®¡ç®—æœºä¸­ï¼Œå¹¶ä¸”æ†ç»‘åœ¨äººä»¬æ¯å¤©ä½¿ç”¨çš„æ— æ•°å…¶ä»–åº”ç”¨ç¨‹åºä¸­ã€‚ä¸‹é¢æ˜¯ä»‹ç»å¦‚ä½•ä½¿ç”¨<code>INSERT OR REPLACE</code>å‘½ä»¤ã€‚</p><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/sqlite.png" alt="SQLite"></p><a id="more"></a><h1 id="ä¸šåŠ¡éœ€æ±‚"><a href="#ä¸šåŠ¡éœ€æ±‚" class="headerlink" title="ä¸šåŠ¡éœ€æ±‚"></a>ä¸šåŠ¡éœ€æ±‚</h1><p>å…·ä½“ä¸šåŠ¡ä¸­,é‡åˆ°éœ€è¦æ‰¹é‡æ’å…¥å’Œä¿®æ”¹æ•°æ®åº“çš„æƒ…å†µã€‚</p><ul><li>å½“å‰æ•°æ®ä¸å­˜åœ¨ï¼Œè¿›è¡Œæ•°æ®æ’å…¥æ“ä½œ</li><li>å½“å‰æ•°æ®å­˜åœ¨ï¼Œè¿›è¡Œæ•°æ®æ›´æ–°æ“ä½œ</li></ul><p>ä»¥ä¸Šçš„ä¸šåŠ¡æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨SQliteçš„ <code>INSERT OR REPLACE</code>å‘½ä»¤è¿›è¡Œæ“ä½œï¼Œå…·ä½“çš„è¯­æ³•ï¼š<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT OR REPLACE INTO table-name (column-name,...) VALUES (column-value,...)</span><br></pre></td></tr></table></figure></p><h1 id="UNIQUE-çº¦æŸ-æˆ–-PRIMARY-KEYçº¦æŸ"><a href="#UNIQUE-çº¦æŸ-æˆ–-PRIMARY-KEYçº¦æŸ" class="headerlink" title="UNIQUE çº¦æŸ æˆ– PRIMARY KEYçº¦æŸ"></a>UNIQUE çº¦æŸ æˆ– PRIMARY KEYçº¦æŸ</h1><blockquote><p>UNIQUEçº¦æŸ: å”¯ä¸€çº¦æŸ,é˜²æ­¢åœ¨ä¸€ä¸ªç‰¹å®šçš„åˆ—å­˜åœ¨ä¸¤ä¸ªè®°å½•å…·æœ‰ç›¸åŒçš„å€¼</p></blockquote><blockquote><p>PRIMARY KEYçº¦æŸ: çº¦æŸå”¯ä¸€æ ‡è¯†æ•°æ®åº“è¡¨ä¸­çš„æ¯æ¡è®°å½•ã€‚</p></blockquote><h2 id="ç›¸åŒç‚¹"><a href="#ç›¸åŒç‚¹" class="headerlink" title="ç›¸åŒç‚¹"></a>ç›¸åŒç‚¹</h2><p>PRIMARY KEYä¹Ÿæ˜¯UNIQUE,å³ä¸å¯é‡å¤</p><h2 id="ä¸åŒç‚¹"><a href="#ä¸åŒç‚¹" class="headerlink" title="ä¸åŒç‚¹"></a>ä¸åŒç‚¹</h2><ul><li>1.PRIMARY KEYæ˜¯éç©ºçš„,ä½†æ˜¯UNIQUEå¯ä»¥ä¸ºç©º</li><li>2.åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®,ä½†æ˜¯å”¯ä¸€ç´¢å¼•å¯ä»¥æœ‰å¤šä¸ª</li><li>3.å¦‚æœæ²¡æœ‰æŒ‡å®šèšåˆç´¢å¼•,é‚£ä¹ˆä¸»é”®é»˜è®¤ä¸ºèšåˆç´¢å¼•,å”¯ä¸€ç´¢å¼•ä¸å…·å¤‡è¯¥ç‰¹æ€§</li></ul><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT OR REPLACE INTO table-name (column-name,...) VALUES (column-value,...)</span><br></pre></td></tr></table></figure><p>åœ¨å¦‚ä¸Šçš„<code>colunm-name</code>ä¸­,å¦‚æœå·²æ’å…¥çš„<code>column-value</code>å‡æ— å·²å­˜åœ¨çš„å€¼,åˆ™åˆ¤æ–­æ’å…¥çš„è¯¥æ¡æ•°æ®ä¸å­˜åœ¨,åæ­£å­˜åœ¨.</p><p>åˆ›å»ºè¡¨ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE TARD ( ID INT PRIMARY KEY, name TEXT NOT NULL UNIQUE, age INT NOT NULL , date CHAR(50),Dvalue REAL DEFAULT 300.00);</span><br></pre></td></tr></table></figure><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// åœ¨xiaomingä¸å­˜åœ¨çš„æƒ…å†µä¸‹è¿›è¡ŒINSERT</span></span><br><span class="line"></span><br><span class="line">INSERT OR REPLACE INTO TARD (ID, name, age, date) VALUES (1, 'xiaoming', 18, 'æ‰“ç”µè¯')</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»“æœ</span></span><br><span class="line"></span><br><span class="line">IDname    age   date     Dvalue</span><br><span class="line"><span class="number">1</span>xiaoming<span class="number">18</span>   æ‰“ç”µè¯ <span class="number">300</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨xiaomingå·²ç»å­˜åœ¨çš„æƒ…å†µä¸‹è¿›è¡Œupdate</span></span><br><span class="line"></span><br><span class="line">INSERT OR REPLACE INTO TARD (ID, name, age, date) VALUES (1, 'xiaoming', 118, 'å»æ‰“ç”µè¯')</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»“æœ</span></span><br><span class="line"></span><br><span class="line">ID name    age   date       Dvalue</span><br><span class="line"><span class="number">1</span>xiaoming<span class="number">118</span>   å»æ‰“ç”µè¯   <span class="number">300</span></span><br></pre></td></tr></table></figure><p>åˆ›å»ºè¡¨çš„æ—¶å€™<code>ID</code>å’Œ<code>name</code>éƒ½æ˜¯<code>UNIQUE</code>çš„,å‘½ä»¤åªæœ‰åœ¨ä¸¤ä¸ªå€¼éƒ½ä¸å­˜åœ¨æ—¶,æ‰ä¼šè¿›è¡Œæ’å…¥,å¦åˆ™æ›´æ–°å½“å‰æ•°æ®</p><h2 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h2><p>å¦‚æœ<code>INSERT OR REPLACE INTO table-name (column-name,...) VALUES (column-value,...)</code>è¯¥æ•°æ®å·²å­˜åœ¨,åœ¨æ›´æ–°æ—¶,æŸè¡Œæ•°æ®æ²¡å¡«å†™,åˆ™é»˜è®¤ä¸ºç©º,è¦†ç›–ä¹‹å‰çš„æ•°æ®.</p><p>ä¸¾ä¾‹:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT OR REPLACE INTO TARD (ID, name, age, date) VALUES (1, 'xiaoming', 118)</span><br></pre></td></tr></table></figure><p>xiaomingå·²åœ¨æ•°æ®åº“ä¸­,ä¼šè¿›è¡Œæ›´æ–°æ“ä½œ,æ²¡æœ‰å¡«å†™<code>date</code>æ•°å€¼,åˆ™<code>date</code>æ•°å€¼ä¸ä¼šè¢«ä¿ç•™,è€Œä¸”æ›¿æ¢ä¸º<code>NULL</code></p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ID name    age   date       Dvalue</span><br><span class="line"><span class="number">1</span>xiaoming<span class="number">118</span>   <span class="literal">NULL</span>   <span class="number">300</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;SQLiteæ˜¯ä¸€ä¸ªCè¯­è¨€åº“ï¼Œå®ƒå®ç°äº†ä¸€ä¸ª å°å‹ï¼Œ å¿«é€Ÿï¼Œ è‡ªåŒ…å«ï¼Œ é«˜å¯é æ€§ï¼Œ åŠŸèƒ½é½å…¨çš„ SQLæ•°æ®åº“å¼•æ“ã€‚SQLiteæ˜¯ä¸–ç•Œä¸Šä½¿ç”¨æœ€å¤šçš„æ•°æ®åº“å¼•æ“ã€‚å®ƒå†…ç½®äºæ‰€æœ‰ç§»åŠ¨ç”µè¯å’Œå¤§å¤šæ•°è®¡ç®—æœºä¸­ï¼Œå¹¶ä¸”æ†ç»‘åœ¨äººä»¬æ¯å¤©ä½¿ç”¨çš„æ— æ•°å…¶ä»–åº”ç”¨ç¨‹åºä¸­ã€‚ä¸‹é¢æ˜¯ä»‹ç»å¦‚ä½•ä½¿ç”¨&lt;code&gt;INSERT OR REPLACE&lt;/code&gt;å‘½ä»¤ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/sqlite.png&quot; alt=&quot;SQLite&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="ç¼–ç¨‹" scheme="https://duanruilong.github.io/categories/%E7%BC%96%E7%A8%8B/"/>
    
    
      <category term="ç¼–ç¨‹" scheme="https://duanruilong.github.io/tags/%E7%BC%96%E7%A8%8B/"/>
    
      <category term="æ•°æ®åº“" scheme="https://duanruilong.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>AnyProxyç®€ä»‹ç§»åŠ¨ç«¯æŠ“åŒ…å·¥å…·</title>
    <link href="https://duanruilong.github.io/2018/12/26/AnyProxy%E7%AE%80%E4%BB%8B%E7%A7%BB%E5%8A%A8%E7%AB%AF%E6%8A%93%E5%8C%85%E5%B7%A5%E5%85%B7/"/>
    <id>https://duanruilong.github.io/2018/12/26/AnyProxyç®€ä»‹ç§»åŠ¨ç«¯æŠ“åŒ…å·¥å…·/</id>
    <published>2018-12-26T03:29:07.000Z</published>
    <updated>2018-12-27T02:24:23.000Z</updated>
    
    <content type="html"><![CDATA[<p>ç§»åŠ¨ç«¯çš„å¼€å‘ï¼Œéš¾å…éœ€è¦æŠ“åŒ…æŸ¥çœ‹æƒ…å†µï¼Œåœ¨å®é™…å·¥ä½œé‡Œå¼€å‘ç§»åŠ¨ç«¯ä¸šåŠ¡éœ€æ±‚ï¼Œæ‰¾åˆ°äº†AnyProxyæŠ“åŒ…ç¥å™¨ï¼Œå®ƒæ˜¯é˜¿é‡Œå·´å·´åŸºäº Node.js å¼€å‘çš„ä¸€æ¬¾å¼€æºä»£ç†æœåŠ¡å™¨ï¼Œä½¿ç”¨åœºæ™¯å¾ˆå¹¿ï¼Œæ»¡è¶³æ—¥å¸¸éœ€æ±‚å¼€å‘å’Œæµ‹è¯•ã€‚</p><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/AnyProxy.png" alt="AnyProxy"></p><a id="more"></a><h1 id="1-ç®€ä»‹"><a href="#1-ç®€ä»‹" class="headerlink" title="1. ç®€ä»‹"></a>1. ç®€ä»‹</h1><blockquote><p>AnyProxy æ˜¯é˜¿é‡Œå·´å·´åŸºäº Node.js å¼€å‘çš„ä¸€æ¬¾å¼€æºä»£ç†æœåŠ¡å™¨ã€‚<a href="https://github.com/alibaba/anyproxy" target="_blank" rel="noopener">AnyProxyé“¾æ¥</a></p></blockquote><ul><li>ä»£ç†æœåŠ¡å™¨ç«™åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„ä¸­é—´ï¼Œå®ƒå¯ä»¥æ”¶é›†åŒæ–¹é€šä¿¡çš„æ¯ä¸ªæ¯”ç‰¹ã€‚ä¸€ä¸ªå®Œæ•´çš„ä»£ç†è¯·æ±‚è¿‡ç¨‹ä¸ºï¼šå®¢æˆ·ç«¯é¦–å…ˆä¸ä»£ç†æœåŠ¡å™¨åˆ›å»ºè¿æ¥ï¼Œæ¥ç€æ ¹æ®ä»£ç†æœåŠ¡æ‰€ä½¿ç”¨çš„ä»£ç†åè®®ï¼Œè¯·æ±‚å¯¹ç›®æ ‡æœåŠ¡å™¨åˆ›å»ºè¿æ¥æˆ–è€…è·å–ç›®æ ‡æœåŠ¡å™¨çš„æŒ‡å®šèµ„æºã€‚ä¸€äº›ä»£ç†åè®®å…è®¸ä»£ç†æœåŠ¡å™¨æ”¹å˜å®¢æˆ·ç«¯çš„åŸå§‹è¯·æ±‚ã€ç›®æ ‡æœåŠ¡å™¨çš„åŸå§‹å“åº”ã€‚</li><li>AnyProxy æ˜¯å®Œå…¨å¯ä»¥çµæ´»é…ç½®çš„ä»£ç†æœåŠ¡å™¨ã€‚å®ƒæ”¯æŒ httpsæ˜æ–‡ä»£ç† ï¼Œä¸”æä¾›äº† Web ç•Œé¢ä¾¿äºè§‚æµ‹è¯·æ±‚æƒ…å†µï¼ŒåŒæ—¶æ”¯æŒäºŒæ¬¡å¼€å‘ï¼Œå¯ä»¥ç”¨ JavaScript æ¥æ§åˆ¶ä»£ç†çš„å…¨éƒ¨æµç¨‹ï¼Œæ­å»ºå‰ç«¯ä¸ªæ€§åŒ–è°ƒè¯•ç¯å¢ƒã€‚</li></ul><h1 id="2-å®‰è£…"><a href="#2-å®‰è£…" class="headerlink" title="2. å®‰è£…"></a>2. å®‰è£…</h1><h2 id="å®‰è£…-Node-js"><a href="#å®‰è£…-Node-js" class="headerlink" title="å®‰è£… Node.js"></a>å®‰è£… Node.js</h2><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~ brew update</span><br><span class="line">~ brew install node</span><br><span class="line">~ node --version</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…-AnyProxyï¼ˆéœ€è¦node8ï¼‰"><a href="#å®‰è£…-AnyProxyï¼ˆéœ€è¦node8ï¼‰" class="headerlink" title="å®‰è£… AnyProxyï¼ˆéœ€è¦node8ï¼‰"></a>å®‰è£… AnyProxyï¼ˆéœ€è¦node8ï¼‰</h2><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~ å®‰è£…ç¨³å®šæ­£å¼ç‰ˆ</span><br><span class="line">$ npm install -g anyproxy</span><br><span class="line">~ æœ€æ–°æµ‹è¯•ç‰ˆï¼Œéœ€è¦ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬ node è¿›è¡Œå®‰è£…</span><br><span class="line">$ npm install -g anyproxy@beta</span><br><span class="line">~ æœ‰æ—¶éœ€è¦æ·»åŠ  sudo</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨AnyProxy"><a href="#ä½¿ç”¨AnyProxy" class="headerlink" title="ä½¿ç”¨AnyProxy"></a>ä½¿ç”¨AnyProxy</h2><h3 id="1ã€å¯åŠ¨-anyproxy"><a href="#1ã€å¯åŠ¨-anyproxy" class="headerlink" title="1ã€å¯åŠ¨ anyproxy"></a>1ã€å¯åŠ¨ anyproxy</h3><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~ anyproxy</span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨ç»“æœ"><a href="#å¯åŠ¨ç»“æœ" class="headerlink" title="å¯åŠ¨ç»“æœ"></a>å¯åŠ¨ç»“æœ</h3><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> ~ anyproxy</span><br><span class="line">[AnyProxy Log][<span class="number">2018</span><span class="number">-12</span><span class="number">-26</span> <span class="number">11</span>:<span class="number">42</span>:<span class="number">19</span>]: Http proxy started on port <span class="number">8001</span></span><br><span class="line">[AnyProxy Log][<span class="number">2018</span><span class="number">-12</span><span class="number">-26</span> <span class="number">11</span>:<span class="number">42</span>:<span class="number">19</span>]: web interface started on port <span class="number">8002</span></span><br></pre></td></tr></table></figure><h3 id="2ã€å¯åŠ¨æµè§ˆå™¨"><a href="#2ã€å¯åŠ¨æµè§ˆå™¨" class="headerlink" title="2ã€å¯åŠ¨æµè§ˆå™¨"></a>2ã€å¯åŠ¨æµè§ˆå™¨</h3><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//192.168.0.195:8002/   æˆ–   http://127.0.0.1:8002/</span></span><br></pre></td></tr></table></figure><h3 id="3ã€å®¢æˆ·ç«¯é…ç½®ä»£ç†-ip-ç«¯å£å·8001"><a href="#3ã€å®¢æˆ·ç«¯é…ç½®ä»£ç†-ip-ç«¯å£å·8001" class="headerlink" title="3ã€å®¢æˆ·ç«¯é…ç½®ä»£ç† ip ç«¯å£å·8001"></a>3ã€å®¢æˆ·ç«¯é…ç½®ä»£ç† ip ç«¯å£å·8001</h3><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/tool/AnyProxy.png" alt="å®¢æˆ·ç«¯é…ç½®ä»£ç†"></p><p>å¯åŠ¨anyproxy<br><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/tool/AnyProxy1.png" alt="å®¢æˆ·ç«¯é…ç½®ä»£ç†"></p><h2 id="é…ç½®-Https"><a href="#é…ç½®-Https" class="headerlink" title="é…ç½® Https"></a>é…ç½® Https</h2><h3 id="1ã€-ç”Ÿæˆ-rootCA"><a href="#1ã€-ç”Ÿæˆ-rootCA" class="headerlink" title="1ã€ ç”Ÿæˆ rootCA"></a>1ã€ ç”Ÿæˆ rootCA</h3><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  ç¨³å®šç‰ˆæœ¬ç”Ÿæˆæ–¹æ³•</span></span><br><span class="line">~ sudo anyproxy --root</span><br><span class="line"><span class="comment">//  æœ€æ–°ç‰ˆæœ¬ç”Ÿæˆæ–¹æ³•</span></span><br><span class="line">~ anyproxy-ca</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/tool/AnyProxy2.png" alt="ç”ŸæˆrootCA"></p><h2 id="ä»¥æ”¯æŒ-Https-æ–¹å¼é‡æ–°å¯åŠ¨-AnyProxy"><a href="#ä»¥æ”¯æŒ-Https-æ–¹å¼é‡æ–°å¯åŠ¨-AnyProxy" class="headerlink" title="ä»¥æ”¯æŒ Https æ–¹å¼é‡æ–°å¯åŠ¨ AnyProxy"></a>ä»¥æ”¯æŒ Https æ–¹å¼é‡æ–°å¯åŠ¨ AnyProxy</h2><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~ anyproxy --intercept</span><br><span class="line"><span class="comment">//  ç®€å†™</span></span><br><span class="line">~ anyproxy -i</span><br></pre></td></tr></table></figure><p>å¯åŠ¨ç»“æœ<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">~ anyproxy -i</span><br><span class="line"></span><br><span class="line">[AnyProxy WARN][<span class="number">2018</span><span class="number">-12</span><span class="number">-26</span> <span class="number">11</span>:<span class="number">55</span>:<span class="number">54</span>]: ROOT CA NOT INSTALLED YET</span><br><span class="line">? The rootCA is <span class="keyword">not</span> trusted yet, install it to the trust store now? Yes</span><br><span class="line">[AnyProxy Log][<span class="number">2018</span><span class="number">-12</span><span class="number">-26</span> <span class="number">11</span>:<span class="number">56</span>:<span class="number">03</span>]: About to trust the root CA, <span class="keyword">this</span> may requires your password</span><br><span class="line">Password:</span><br><span class="line">[AnyProxy Log][<span class="number">2018</span><span class="number">-12</span><span class="number">-26</span> <span class="number">11</span>:<span class="number">56</span>:<span class="number">07</span>]: Root CA install, you are ready to intercept the https now</span><br><span class="line">[AnyProxy Log][<span class="number">2018</span><span class="number">-12</span><span class="number">-26</span> <span class="number">11</span>:<span class="number">56</span>:<span class="number">07</span>]: The root CA file path is: /Users/xmaczone/.anyproxy/certificates/rootCA.crt</span><br><span class="line">[AnyProxy Log][<span class="number">2018</span><span class="number">-12</span><span class="number">-26</span> <span class="number">11</span>:<span class="number">56</span>:<span class="number">08</span>]: Http proxy started on port <span class="number">8001</span></span><br><span class="line">[AnyProxy Log][<span class="number">2018</span><span class="number">-12</span><span class="number">-26</span> <span class="number">11</span>:<span class="number">56</span>:<span class="number">08</span>]: web interface started on port <span class="number">8002</span></span><br></pre></td></tr></table></figure></p><h2 id="æ‰‹æœºå®‰è£…è¯ä¹¦"><a href="#æ‰‹æœºå®‰è£…è¯ä¹¦" class="headerlink" title="æ‰‹æœºå®‰è£…è¯ä¹¦"></a>æ‰‹æœºå®‰è£…è¯ä¹¦</h2><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/tool/AnyProxy3.png" alt="ç”ŸæˆrootCA"></p><h1 id="æ‹“å±•"><a href="#æ‹“å±•" class="headerlink" title="æ‹“å±•"></a>æ‹“å±•</h1><p><a href="http://aiezu.com/article/windows_anyproxy_install.html" target="_blank" rel="noopener">windowsä¸‹å®‰è£…AnyProxyæŠ“å–ç§»åŠ¨App Httpè¯·æ±‚</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç§»åŠ¨ç«¯çš„å¼€å‘ï¼Œéš¾å…éœ€è¦æŠ“åŒ…æŸ¥çœ‹æƒ…å†µï¼Œåœ¨å®é™…å·¥ä½œé‡Œå¼€å‘ç§»åŠ¨ç«¯ä¸šåŠ¡éœ€æ±‚ï¼Œæ‰¾åˆ°äº†AnyProxyæŠ“åŒ…ç¥å™¨ï¼Œå®ƒæ˜¯é˜¿é‡Œå·´å·´åŸºäº Node.js å¼€å‘çš„ä¸€æ¬¾å¼€æºä»£ç†æœåŠ¡å™¨ï¼Œä½¿ç”¨åœºæ™¯å¾ˆå¹¿ï¼Œæ»¡è¶³æ—¥å¸¸éœ€æ±‚å¼€å‘å’Œæµ‹è¯•ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/AnyProxy.png&quot; alt=&quot;AnyProxy&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="ç¼–ç¨‹" scheme="https://duanruilong.github.io/categories/%E7%BC%96%E7%A8%8B/"/>
    
    
      <category term="Javascript" scheme="https://duanruilong.github.io/tags/Javascript/"/>
    
      <category term="ç¼–ç¨‹" scheme="https://duanruilong.github.io/tags/%E7%BC%96%E7%A8%8B/"/>
    
      <category term="å·¥å…·" scheme="https://duanruilong.github.io/tags/%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>asyncwaitçš„ä½¿ç”¨ä»¥åŠæ³¨æ„äº‹é¡¹</title>
    <link href="https://duanruilong.github.io/2018/12/25/async-await%E7%9A%84%E4%BD%BF%E7%94%A8%E4%BB%A5%E5%8F%8A%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9/"/>
    <id>https://duanruilong.github.io/2018/12/25/async-awaitçš„ä½¿ç”¨ä»¥åŠæ³¨æ„äº‹é¡¹/</id>
    <published>2018-12-25T02:13:24.000Z</published>
    <updated>2018-12-26T03:18:45.000Z</updated>
    
    <content type="html"><![CDATA[<p><code>async</code> / <code>await</code>, æ­é… <code>promise</code>, å¯ä»¥é€šè¿‡ç¼–å†™å½¢ä¼¼åŒæ­¥çš„ä»£ç æ¥å¤„ç†å¼‚æ­¥æµç¨‹, æé«˜ä»£ç çš„ç®€æ´æ€§å’Œå¯è¯»æ€§. è¿™é‡Œä»‹ç» <code>async</code> / <code>await</code>çš„åŸºæœ¬ç”¨æ³•å’Œä¸€äº›æ³¨æ„äº‹é¡¹.</p><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/async_await.png" alt="Javascript"></p><a id="more"></a><h1 id="async"><a href="#async" class="headerlink" title="async"></a>async</h1><p>ä½¿ç”¨ <code>async function</code> å¯ä»¥å®šä¹‰ä¸€ä¸ªå¼‚æ­¥å‡½æ•°,å…¶è¯­æ³•ä¸º:<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">async function <span class="title">name</span><span class="params">([param[, param[, ... param]]])</span> </span>&#123; statements &#125;</span><br></pre></td></tr></table></figure></p><p><code>async</code> å‡½æ•°çš„è¿”å›å€¼å¾ˆç‰¹æ®Š: ä¸ç®¡åœ¨å‡½æ•°ä½“å†… return äº†ä»€ä¹ˆå€¼, async å‡½æ•°çš„å®é™…è¿”å›å€¼æ€»æ˜¯ä¸€ä¸ª Promise å¯¹è±¡. è¯¦ç»†è®²å°±æ˜¯:è‹¥åœ¨ async å‡½æ•°ä¸­ return äº†ä¸€ä¸ªå€¼ a, ä¸ç®¡ a å€¼æ˜¯ä»€ä¹ˆç±»å‹, async å‡½æ•°çš„å®é™…è¿”å›å€¼æ€»æ˜¯ <code>Promise.resolve(a)</code>.</p><p>é‚£ä¹ˆ <code>Promise.resolve(a)</code> æœ€ç»ˆè¿”å›ä¸€ä¸ªä»€ä¹ˆæ ·çš„promiseå‘¢? çœ‹ä¸€ä¸‹MDNçš„ä»‹ç»:</p><blockquote><p>Promise.resolve(value)æ–¹æ³•è¿”å›ä¸€ä¸ªä»¥ç»™å®šå€¼è§£æåçš„Promiseå¯¹è±¡ã€‚ä½†å¦‚æœè¿™ä¸ªå€¼æ˜¯ä¸ªthenableï¼ˆå³å¸¦æœ‰thenæ–¹æ³•ï¼‰ï¼Œè¿”å›çš„promiseä¼šâ€œè·Ÿéšâ€è¿™ä¸ªthenableçš„å¯¹è±¡ï¼Œé‡‡ç”¨å®ƒçš„æœ€ç»ˆçŠ¶æ€ï¼ˆæŒ‡resolved/rejected/pending/settledï¼‰ï¼›å¦åˆ™ä»¥è¯¥å€¼ä¸ºæˆåŠŸçŠ¶æ€è¿”å›promiseå¯¹è±¡ã€‚</p></blockquote><p>æ¥çœ‹ä¸€æ®µä»£ç æœ‰è¿™æ ·ä¸€ä¸ªåœºæ™¯: éœ€è¦å…ˆé€šè¿‡ è¯·æ±‚a æ‹¿åˆ° æ•°æ®a, ç„¶åé€šè¿‡é€šè¿‡ è¯·æ±‚b å¹¶æºå¸¦å‘é€ æ•°æ®a è·å–åˆ° æ•°æ®b, æ‹¿åˆ° æ•°æ®b ä¹‹åå†å±•ç¤ºåˆ°é¡µé¢ä¸Š.</p><p>æ–¹æ¡ˆä¸€:<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">async function <span class="title">getData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å‡è£…è¯·æ±‚æ•°æ®a</span></span><br><span class="line">    var data_a = await <span class="keyword">new</span> Promise((resolve) =&gt; &#123;</span><br><span class="line">        setTimeout(() =&gt; &#123;</span><br><span class="line">            resolve('data_a');</span><br><span class="line">        &#125;, <span class="number">1000</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‡è£…è¯·æ±‚æ•°æ®bä¸”æ­¤è¯·æ±‚ä¾èµ–æ•°æ®a</span></span><br><span class="line">    var data_b = await <span class="keyword">new</span> Promise((resolve) =&gt; &#123;</span><br><span class="line">        setTimeout(() =&gt; &#123;</span><br><span class="line">            resolve('data_b');</span><br><span class="line">        &#125;, <span class="number">1000</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å±•ç¤ºæ•°æ®2</span></span><br><span class="line">    console.<span class="built_in">log</span>(data_b);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">getData();</span><br></pre></td></tr></table></figure></p><p>ä¸Šé¢ä¾æ¬¡è·å–åˆ° æ•°æ®a å’Œ æ•°æ®b, ç„¶åå†å±•ç¤º æ•°æ®b.</p><p>æ—¢ç„¶ <code>async</code>å‡½æ•°æ€»æ˜¯è¿”å›ä¸€ä¸ª<code>promise</code>, é‚£ä¹ˆä¹Ÿå¯ä»¥åœ¨ä¸€ä¸ª async å‡½æ•°è¿”å›è·å– æ•°æ®b çš„<code>promise</code>, è°ƒç”¨å‡½æ•°åå†ä½¿ç”¨ <code>then</code> æ–¹æ³•æ‹¿åˆ°æ•°æ®, ä»£ç å¦‚ä¸‹:</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">async function <span class="title">getData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å‡è£…è¯·æ±‚æ•°æ®a</span></span><br><span class="line">    var data_a = await <span class="keyword">new</span> Promise((resolve) =&gt; &#123;</span><br><span class="line">        setTimeout(() =&gt; &#123;</span><br><span class="line">            resolve('data_a_value');</span><br><span class="line">        &#125;, <span class="number">1000</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‡è£…è¯·æ±‚æ•°æ®bä¸”æ­¤è¯·æ±‚ä¾èµ–æ•°æ®a</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Promise((resolve) =&gt; &#123;</span><br><span class="line">        setTimeout(() =&gt; &#123;</span><br><span class="line">            console.<span class="built_in">log</span>(data_a);  <span class="comment">// ===&gt;data_a_value</span></span><br><span class="line">            resolve('data_b_value'); </span><br><span class="line">        &#125;, <span class="number">1000</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line">getData().then((value) =&gt; &#123;</span><br><span class="line">      console.<span class="built_in">log</span>(value);  <span class="comment">// ===&gt;data_b_value</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»“æœè¿”å›é¡ºåº</span></span><br><span class="line">data_a_value</span><br><span class="line">data_b_value</span><br></pre></td></tr></table></figure><h1 id="await"><a href="#await" class="headerlink" title="await"></a>await</h1><p>å¼•ç”¨MDNçš„ä»‹ç»:</p><blockquote><p>await æ“ä½œç¬¦ç”¨äºç­‰å¾…ä¸€ä¸ª Promise å¯¹è±¡, å®ƒåªèƒ½åœ¨å¼‚æ­¥å‡½æ•° async function å†…éƒ¨ä½¿ç”¨.</p></blockquote><p>await çš„ä½¿ç”¨è¯­æ³•éå¸¸ç®€å•:</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[return_value] = await expression;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ <code>expression</code> æ˜¯ä¸€ä¸ª <code>Promise</code> å¯¹è±¡æˆ–è€…ä»»ä½•è¦ç­‰å¾…çš„å€¼;</p><p>è€Œ <code>await expression</code> çš„æ‰§è¡Œç»“æœæœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µ:</p><ul><li><p>è‹¥ <code>expression</code> æ˜¯ä¸€ä¸ª <code>Promise</code> å¯¹è±¡, å¹¶ä¸”å…¶ä»¥å€¼ x è¢« <code>fulfilled</code>, åˆ™è¿”å›å€¼ä¸º x.</p></li><li><p>è‹¥ <code>expression</code> æ˜¯ä¸€ä¸ª <code>Promise</code> å¯¹è±¡, å¹¶ä¸”å…¶ä»¥å¼‚å¸¸ e è¢« <code>rejected</code>, åˆ™æŠ›å‡ºå¼‚å¸¸ e.</p></li><li><p>è‹¥ <code>expression</code> ä¸æ˜¯ <code>Promise</code> å¯¹è±¡, åˆ™ä¼šå°† expression å¤„ç†æˆä¸€ä¸ªä»¥ expression å€¼è¢« fulfilled çš„ Promise å¯¹è±¡, ç„¶åè¿”å›è¿™ä¸ª Promise å¯¹è±¡çš„æœ€ç»ˆå€¼ (å³ expression å€¼). è¿™ç§ç”¨æ³•æ²¡å¤ªå¤§æ„ä¹‰, å› æ­¤å®é™…ä½¿ç”¨æ—¶è¿˜æ˜¯å°½é‡åœ¨ await åè·Ÿä¸€ä¸ª Promise å¯¹è±¡.</p></li></ul><p>å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯, <code>await</code> åœ¨ç­‰å¾… <code>Promise</code> å¯¹è±¡æ—¶ä¼šå¯¼è‡´ <code>async function</code> æš‚åœæ‰§è¡Œ, ä¸€ç›´åˆ° <code>Promise</code> å¯¹è±¡å†³è®®ä¹‹åæ‰ä¼š <code>async function</code> ç»§ç»­æ‰§è¡Œ.</p><p>é€šè¿‡ä¸€æ®µä»£ç æ¥çœ‹ä¸€ä¸‹:</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">async function <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    var a = await <span class="keyword">new</span> Promise((resolve) =&gt; &#123;</span><br><span class="line">        setTimeout(() =&gt; &#123;</span><br><span class="line">            resolve(<span class="number">1</span>);</span><br><span class="line">        &#125;, <span class="number">2000</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    console.<span class="built_in">log</span>(a); <span class="comment">// ç¬¬2ç§’æ—¶è¾“å‡º: 1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        var b = await <span class="keyword">new</span> Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">            setTimeout(() =&gt; &#123;</span><br><span class="line">                reject(<span class="number">2</span>);</span><br><span class="line">            &#125;, <span class="number">1000</span>);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        console.<span class="built_in">log</span>(e); <span class="comment">// ç¬¬3ç§’æ—¶è¾“å‡º: 2</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‡½æ•°æš‚åœ2ç§’åå†ç»§ç»­æ‰§è¡Œ</span></span><br><span class="line">    var sleep = await <span class="keyword">new</span> Promise((resolve) =&gt; &#123;</span><br><span class="line">        setTimeout(() =&gt; &#123;</span><br><span class="line">            console.log('sleep_value');</span><br><span class="line">            resolve('sleep');</span><br><span class="line">        &#125;, <span class="number">2000</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    var c = await <span class="number">3</span>;</span><br><span class="line">    console.<span class="built_in">log</span>(c); <span class="comment">// ç¬¬5ç§’æ—¶è¾“å‡º: 3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»“æœè¿”å›é¡ºåº</span></span><br><span class="line"></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line">sleep_value</span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;code&gt;async&lt;/code&gt; / &lt;code&gt;await&lt;/code&gt;, æ­é… &lt;code&gt;promise&lt;/code&gt;, å¯ä»¥é€šè¿‡ç¼–å†™å½¢ä¼¼åŒæ­¥çš„ä»£ç æ¥å¤„ç†å¼‚æ­¥æµç¨‹, æé«˜ä»£ç çš„ç®€æ´æ€§å’Œå¯è¯»æ€§. è¿™é‡Œä»‹ç» &lt;code&gt;async&lt;/code&gt; / &lt;code&gt;await&lt;/code&gt;çš„åŸºæœ¬ç”¨æ³•å’Œä¸€äº›æ³¨æ„äº‹é¡¹.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/async_await.png&quot; alt=&quot;Javascript&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="ç¼–ç¨‹" scheme="https://duanruilong.github.io/categories/%E7%BC%96%E7%A8%8B/"/>
    
    
      <category term="Javascript" scheme="https://duanruilong.github.io/tags/Javascript/"/>
    
      <category term="ç¼–ç¨‹" scheme="https://duanruilong.github.io/tags/%E7%BC%96%E7%A8%8B/"/>
    
      <category term="ES6" scheme="https://duanruilong.github.io/tags/ES6/"/>
    
  </entry>
  
  <entry>
    <title>å¥½çš„ä¸œè¥¿æ”¶è—äºæ­¤</title>
    <link href="https://duanruilong.github.io/2018/12/24/%E5%A5%BD%E7%9A%84%E4%B8%9C%E8%A5%BF%E6%94%B6%E8%97%8F%E4%BA%8E%E6%AD%A4/"/>
    <id>https://duanruilong.github.io/2018/12/24/å¥½çš„ä¸œè¥¿æ”¶è—äºæ­¤/</id>
    <published>2018-12-24T03:51:29.000Z</published>
    <updated>2019-01-02T04:14:13.000Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™é‡Œä¼šæ˜¯ä¸€ä¸ªçŸ¥è¯†çš„å®åº“ï¼Œé‡Œé¢ä¼šæœ‰æ•™ç¨‹ã€æ–‡æ¡£ã€æ¡†æ¶ã€æ–¹æ¡ˆã€ç†è®ºï¼Œå¤§å®¶æ…¢æ…¢å»å“å‘³ã€‚</p><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/allweb.png" alt="Javascript"></p><a id="more"></a><h1 id="æ¡†æ¶"><a href="#æ¡†æ¶" class="headerlink" title="æ¡†æ¶"></a>æ¡†æ¶</h1><h2 id="1ã€dva-é¦–å…ˆæ˜¯ä¸€ä¸ªåŸºäº-redux-å’Œ-redux-saga-çš„æ•°æ®æµæ–¹æ¡ˆï¼Œç„¶åä¸ºäº†ç®€åŒ–å¼€å‘ä½“éªŒï¼Œdva-è¿˜é¢å¤–å†…ç½®äº†-react-router-å’Œ-fetchï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªè½»é‡çº§çš„åº”ç”¨æ¡†æ¶ã€‚"><a href="#1ã€dva-é¦–å…ˆæ˜¯ä¸€ä¸ªåŸºäº-redux-å’Œ-redux-saga-çš„æ•°æ®æµæ–¹æ¡ˆï¼Œç„¶åä¸ºäº†ç®€åŒ–å¼€å‘ä½“éªŒï¼Œdva-è¿˜é¢å¤–å†…ç½®äº†-react-router-å’Œ-fetchï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªè½»é‡çº§çš„åº”ç”¨æ¡†æ¶ã€‚" class="headerlink" title="1ã€dva é¦–å…ˆæ˜¯ä¸€ä¸ªåŸºäº redux å’Œ redux-saga çš„æ•°æ®æµæ–¹æ¡ˆï¼Œç„¶åä¸ºäº†ç®€åŒ–å¼€å‘ä½“éªŒï¼Œdva è¿˜é¢å¤–å†…ç½®äº† react-router å’Œ fetchï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªè½»é‡çº§çš„åº”ç”¨æ¡†æ¶ã€‚"></a>1ã€dva é¦–å…ˆæ˜¯ä¸€ä¸ªåŸºäº redux å’Œ redux-saga çš„æ•°æ®æµæ–¹æ¡ˆï¼Œç„¶åä¸ºäº†ç®€åŒ–å¼€å‘ä½“éªŒï¼Œdva è¿˜é¢å¤–å†…ç½®äº† react-router å’Œ fetchï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªè½»é‡çº§çš„åº”ç”¨æ¡†æ¶ã€‚</h2><h3 id="About"><a href="#About" class="headerlink" title="About"></a>About</h3><ul><li>DvaJSæ–‡æ¡£   <a href="https://dvajs.com/guide/" target="_blank" rel="noopener">é“¾æ¥</a></li><li>dva.js çŸ¥è¯†å¯¼å›¾   <a href="https://github.com/dvajs/dva-knowledgemap" target="_blank" rel="noopener">é“¾æ¥</a></li><li>AccountSystem ä¸€ä¸ªå°å‹åº“å­˜ç®¡ç†ç³»ç»Ÿ   <a href="https://github.com/yvanwangl/AccountSystem" target="_blank" rel="noopener">é“¾æ¥</a></li></ul><h3 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h3><ul><li>æ˜“å­¦æ˜“ç”¨ï¼Œä»…æœ‰ 6 ä¸ª apiï¼Œå¯¹ redux ç”¨æˆ·å°¤å…¶å‹å¥½ï¼Œ<a href="https://umijs.org/guide/with-dva.html" target="_blank" rel="noopener">é…åˆ umi</a> ä½¿ç”¨åæ›´æ˜¯é™ä½ä¸º 0 API</li><li>elm æ¦‚å¿µï¼Œé€šè¿‡ reducers, effects å’Œ subscriptions ç»„ç»‡ model</li><li>æ’ä»¶æœºåˆ¶ï¼Œæ¯”å¦‚ <a href="https://github.com/dvajs/dva/tree/master/packages/dva-loading" target="_blank" rel="noopener">dva-loading</a> å¯ä»¥è‡ªåŠ¨å¤„ç† loading çŠ¶æ€ï¼Œä¸ç”¨ä¸€ééåœ°å†™ showLoading å’Œ hideLoading</li><li>æ”¯æŒ HMRï¼ŒåŸºäº <a href="https://github.com/dvajs/babel-plugin-dva-hmr" target="_blank" rel="noopener">babel-plugin-dva-hmr</a> å®ç° componentsã€routes å’Œ models çš„ HMR</li></ul><h3 id="ä»–æ˜¯æ€ä¹ˆæ¥çš„ï¼Ÿ"><a href="#ä»–æ˜¯æ€ä¹ˆæ¥çš„ï¼Ÿ" class="headerlink" title="ä»–æ˜¯æ€ä¹ˆæ¥çš„ï¼Ÿ"></a>ä»–æ˜¯æ€ä¹ˆæ¥çš„ï¼Ÿ</h3><ul><li><a href="https://github.com/dvajs/dva/issues/1" target="_blank" rel="noopener">Why dva and whatâ€™s dva</a></li><li><a href="https://www.github.com/sorrycc/blog/issues/6" target="_blank" rel="noopener">æ”¯ä»˜å®å‰ç«¯åº”ç”¨æ¶æ„çš„å‘å±•å’Œé€‰æ‹©</a></li></ul><hr><h2 id="2ã€AntD-Admin-ä¸€å¥—ä¼˜ç§€çš„ä¸­åå°å‰ç«¯è§£å†³æ–¹æ¡ˆ"><a href="#2ã€AntD-Admin-ä¸€å¥—ä¼˜ç§€çš„ä¸­åå°å‰ç«¯è§£å†³æ–¹æ¡ˆ" class="headerlink" title="2ã€AntD Admin ä¸€å¥—ä¼˜ç§€çš„ä¸­åå°å‰ç«¯è§£å†³æ–¹æ¡ˆ"></a>2ã€AntD Admin ä¸€å¥—ä¼˜ç§€çš„ä¸­åå°å‰ç«¯è§£å†³æ–¹æ¡ˆ</h2><h3 id="About-1"><a href="#About-1" class="headerlink" title="About"></a>About</h3><ul><li>åœ¨çº¿æ¼”ç¤º - <a href="https://antd-admin.zuiidea.com" target="_blank" rel="noopener">https://antd-admin.zuiidea.com</a></li><li>ä½¿ç”¨æ–‡æ¡£ - <a href="https://doc.antd-admin.zuiidea.com/#/zh-cn/" target="_blank" rel="noopener">https://doc.antd-admin.zuiidea.com/#/zh-cn/</a></li><li>å¸¸è§é—®é¢˜ - <a href="https://doc.antd-admin.zuiidea.com/#/zh-cn/faq" target="_blank" rel="noopener">https://doc.antd-admin.zuiidea.com/#/zh-cn/faq</a></li><li>æ›´æ–°æ—¥å¿— - <a href="https://doc.antd-admin.zuiidea.com/#/zh-cn/change-log" target="_blank" rel="noopener">https://doc.antd-admin.zuiidea.com/#/zh-cn/change-log</a></li></ul><h3 id="ç‰¹æ€§-1"><a href="#ç‰¹æ€§-1" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h3><ul><li>å›½é™…åŒ–ï¼Œæºç ä¸­æŠ½ç¦»ç¿»è¯‘å­—æ®µï¼ŒæŒ‰éœ€åŠ è½½è¯­è¨€åŒ…</li><li>åŠ¨æ€æƒé™ï¼Œä¸åŒæƒé™å¯¹åº”ä¸åŒèœå•</li><li>ä¼˜é›…ç¾è§‚ï¼ŒAnt Design è®¾è®¡ä½“ç³»</li><li>Mock æ•°æ®ï¼Œæœ¬åœ°æ•°æ®è°ƒè¯•</li></ul><h2 id="3ã€12-æ­¥-30-åˆ†é’Ÿï¼Œå®Œæˆç”¨æˆ·ç®¡ç†çš„-CURD-åº”ç”¨-react-dva-antd"><a href="#3ã€12-æ­¥-30-åˆ†é’Ÿï¼Œå®Œæˆç”¨æˆ·ç®¡ç†çš„-CURD-åº”ç”¨-react-dva-antd" class="headerlink" title="3ã€12 æ­¥ 30 åˆ†é’Ÿï¼Œå®Œæˆç”¨æˆ·ç®¡ç†çš„ CURD åº”ç”¨ (react+dva+antd)"></a>3ã€12 æ­¥ 30 åˆ†é’Ÿï¼Œå®Œæˆç”¨æˆ·ç®¡ç†çš„ CURD åº”ç”¨ (react+dva+antd)</h2><h2 id="About-2"><a href="#About-2" class="headerlink" title="About"></a>About</h2><ul><li><p>gité“¾æ¥ <a href="https://github.com/dvajs/dva/tree/master/examples/user-dashboard" target="_blank" rel="noopener">https://github.com/dvajs/dva/tree/master/examples/user-dashboard</a></p></li><li><p>å®ç°æ—¥å¿— <a href="https://github.com/sorrycc/blog/issues/18" target="_blank" rel="noopener">https://github.com/sorrycc/blog/issues/18</a></p></li><li><p>Roadhog æ˜¯ä¸€ä¸ªåŒ…å« devã€build å’Œ test çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œä»–åŸºäº react-dev-utilsï¼Œå’Œ create-react-app çš„ä½“éªŒä¿æŒä¸€è‡´ã€‚ä½ å¯ä»¥æƒ³è±¡ä»–ä¸ºå¯é…ç½®ç‰ˆçš„ create-react-appã€‚<a href="https://github.com/sorrycc/roadhog/blob/master/README_zh-cn.md" target="_blank" rel="noopener">é“¾æ¥</a></p></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è¿™é‡Œä¼šæ˜¯ä¸€ä¸ªçŸ¥è¯†çš„å®åº“ï¼Œé‡Œé¢ä¼šæœ‰æ•™ç¨‹ã€æ–‡æ¡£ã€æ¡†æ¶ã€æ–¹æ¡ˆã€ç†è®ºï¼Œå¤§å®¶æ…¢æ…¢å»å“å‘³ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/allweb.png&quot; alt=&quot;Javascript&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="ç¼–ç¨‹" scheme="https://duanruilong.github.io/categories/%E7%BC%96%E7%A8%8B/"/>
    
    
      <category term="Javascript" scheme="https://duanruilong.github.io/tags/Javascript/"/>
    
      <category term="ç¼–ç¨‹" scheme="https://duanruilong.github.io/tags/%E7%BC%96%E7%A8%8B/"/>
    
      <category term="React" scheme="https://duanruilong.github.io/tags/React/"/>
    
  </entry>
  
  <entry>
    <title>é¢å‘å¯¹è±¡åŸåˆ™-é«˜å†…èšã€ä½è€¦åˆ</title>
    <link href="https://duanruilong.github.io/2018/12/19/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E5%8E%9F%E5%88%99-%E9%AB%98%E5%86%85%E8%81%9A%E3%80%81%E4%BD%8E%E8%80%A6%E5%90%88/"/>
    <id>https://duanruilong.github.io/2018/12/19/é¢å‘å¯¹è±¡åŸåˆ™-é«˜å†…èšã€ä½è€¦åˆ/</id>
    <published>2018-12-19T03:21:27.000Z</published>
    <updated>2018-12-24T03:24:25.000Z</updated>
    
    <content type="html"><![CDATA[<p>é¢å‘å¯¹è±¡åŸåˆ™ï¼šé«˜å†…èšã€ä½è€¦åˆ;å¤šèšåˆã€å°‘ç»§æ‰¿ï¼›ä½¿å¾—å„ä¸ªä¸šåŠ¡æ¨¡å—çš„<code>â€œå¯é‡ç”¨æ€§â€</code>ã€<code>â€œç§»æ¤æ€§â€</code>æ˜æ˜¾æå‡ã€‚</p><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/js/mxdxyz.jpg" alt="Javascript"></p><a id="more"></a><h1 id="é«˜å†…èšã€ä½è€¦åˆ"><a href="#é«˜å†…èšã€ä½è€¦åˆ" class="headerlink" title="é«˜å†…èšã€ä½è€¦åˆ"></a>é«˜å†…èšã€ä½è€¦åˆ</h1><ul><li>å†…èšï¼šå°±æ˜¯æ¯ä¸ªæ¨¡å—å°½å¯èƒ½å¯ä»¥ç‹¬ç«‹å®Œæˆè‡ªå·±çš„åŠŸèƒ½ï¼Œä¸ä¾èµ–äºå…¶ä»–å¤–éƒ¨æ¨¡å—çš„ä»£ç ã€‚ </li><li><p>è€¦åˆï¼šå°±æ˜¯æ¨¡å—ä¸æ¨¡å—ä¹‹é—´æ¥å£çš„å¤æ‚ç¨‹åº¦ï¼Œæ¨¡å—ä¹‹é—´çš„è”ç³»å¦‚æœè¶Šå¤æ‚é‚£ä¹ˆä»–ä»¬çš„è€¦åˆåº¦å°±è¶Šé«˜ï¼Œä¼šå‡ºç°ä¿®æ”¹ä¸€å¤„ä»£ç å¼•å‘è´è¶æ•ˆåº”ï¼Œç‰µä¸€å‘è€ŒåŠ¨å…¨èº«ã€‚</p></li><li><p>ç»“æœï¼šä½¿å¾—å„ä¸ªä¸šåŠ¡æ¨¡å—çš„<code>â€œå¯é‡ç”¨æ€§â€</code>ã€<code>â€œç§»æ¤æ€§â€</code>æ˜æ˜¾æå‡ï¼›é€šå¸¸é¡¹ç›®ä»£ç ç»“æ„ä¸­å„æ¨¡å—çš„å†…èšç¨‹åº¦è¶Šé«˜ï¼Œé‚£ä¹ˆæ¨¡å—é—´çš„è€¦åˆç¨‹åº¦å°±è¶Šä½</p></li></ul><h1 id="æ¨¡å—ï¼š"><a href="#æ¨¡å—ï¼š" class="headerlink" title="æ¨¡å—ï¼š"></a>æ¨¡å—ï¼š</h1><h2 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h2><p>  é«˜å†…èšï¼šå°½å¯èƒ½ç±»çš„æ¯ä¸ªæˆå‘˜æ–¹æ³•åªå®Œæˆä¸€ä»¶äº‹ï¼ˆæœ€å¤§é™åº¦çš„èšåˆï¼‰<br>  ä½è€¦åˆï¼šå‡å°‘ç±»å†…éƒ¨ï¼Œä¸€ä¸ªæˆå‘˜æ–¹æ³•è°ƒç”¨å¦ä¸€ä¸ªæˆå‘˜æ–¹æ³• </p><h2 id="ç±»"><a href="#ç±»" class="headerlink" title="ç±»"></a>ç±»</h2><p>   é«˜å†…èšä½è€¦åˆï¼šå‡å°‘ç±»å†…éƒ¨ï¼Œå¯¹å…¶ä»–ç±»çš„è°ƒç”¨ </p><h2 id="åŠŸèƒ½å—"><a href="#åŠŸèƒ½å—" class="headerlink" title="åŠŸèƒ½å—"></a>åŠŸèƒ½å—</h2><p>   é«˜å†…èšä½è€¦åˆï¼šå‡å°‘æ¨¡å—ä¹‹é—´çš„äº¤äº’å¤æ‚åº¦ï¼ˆæ¥å£æ•°é‡ï¼Œå‚æ•°æ•°æ®ï¼‰</p><h1 id="å¤šèšåˆã€å°‘ç»§æ‰¿"><a href="#å¤šèšåˆã€å°‘ç»§æ‰¿" class="headerlink" title="å¤šèšåˆã€å°‘ç»§æ‰¿"></a>å¤šèšåˆã€å°‘ç»§æ‰¿</h1><ul><li>èšåˆï¼šäº‹ç‰©Aç”±è‹¥å¹²ä¸ªäº‹ç‰©Bç»„æˆï¼Œä½“ç°åœ¨ç±»ä¸ç±»ä¹‹é—´çš„å…³ç³»å°±æ˜¯ï¼šâ€œç±»Bçš„å®ä¾‹â€ä½œä¸ºâ€œç±»Aâ€çš„â€œæˆå‘˜å¯¹è±¡â€å‡ºç°ã€‚ </li><li>ç»§æ‰¿ï¼šé¡¾åæ€ä¹‰ï¼Œä½“ç°åœ¨ç±»ä¸ç±»ä¹‹é—´çš„å…³ç³»å°±æ˜¯ï¼šâ€œç±»Bâ€è¢«ç±»Aæ‰€ç»§æ‰¿<br>æ˜¾ç„¶ï¼Œå½“è§‚å¯Ÿç±»Bæ‰€å…·æœ‰çš„è¡Œä¸ºèƒ½åŠ›æ—¶ï¼Œâ€œèšåˆâ€æ–¹å¼æ›´åŠ æ¸…æ™°ã€‚ </li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;é¢å‘å¯¹è±¡åŸåˆ™ï¼šé«˜å†…èšã€ä½è€¦åˆ;å¤šèšåˆã€å°‘ç»§æ‰¿ï¼›ä½¿å¾—å„ä¸ªä¸šåŠ¡æ¨¡å—çš„&lt;code&gt;â€œå¯é‡ç”¨æ€§â€&lt;/code&gt;ã€&lt;code&gt;â€œç§»æ¤æ€§â€&lt;/code&gt;æ˜æ˜¾æå‡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/js/mxdxyz.jpg&quot; alt=&quot;Javascript&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Javascript" scheme="https://duanruilong.github.io/categories/Javascript/"/>
    
    
      <category term="Javascript" scheme="https://duanruilong.github.io/tags/Javascript/"/>
    
      <category term="ç¼–ç¨‹" scheme="https://duanruilong.github.io/tags/%E7%BC%96%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>Gitmentä½¿ç”¨ GitHub Issues æ­å»ºè¯„è®ºç³»ç»Ÿ</title>
    <link href="https://duanruilong.github.io/2018/12/07/Gitment%E4%BD%BF%E7%94%A8-GitHub-Issues-%E6%90%AD%E5%BB%BA%E8%AF%84%E8%AE%BA%E7%B3%BB%E7%BB%9F/"/>
    <id>https://duanruilong.github.io/2018/12/07/Gitmentä½¿ç”¨-GitHub-Issues-æ­å»ºè¯„è®ºç³»ç»Ÿ/</id>
    <published>2018-12-07T07:42:06.000Z</published>
    <updated>2018-12-07T08:13:17.000Z</updated>
    
    <content type="html"><![CDATA[<p>Gitment æ˜¯ä¸€æ¬¾åŸºäº GitHub Issues çš„è¯„è®ºç³»ç»Ÿã€‚æ”¯æŒåœ¨å‰ç«¯ç›´æ¥å¼•å…¥ï¼Œä¸éœ€è¦ä»»ä½•åç«¯ä»£ç ã€‚å¯ä»¥åœ¨é¡µé¢è¿›è¡Œç™»å½•ã€æŸ¥çœ‹ã€è¯„è®ºã€ç‚¹èµç­‰æ“ä½œï¼ŒåŒæ—¶æœ‰å®Œæ•´çš„ Markdown / GFM å’Œä»£ç é«˜äº®æ”¯æŒã€‚å°¤ä¸ºé€‚åˆå„ç§åŸºäº GitHub Pages çš„é™æ€åšå®¢æˆ–é¡¹ç›®é¡µé¢ã€‚</p><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/gitment.png" alt="Gitment"></p><a id="more"></a><h1 id="åŸºç¡€ä½¿ç”¨"><a href="#åŸºç¡€ä½¿ç”¨" class="headerlink" title="åŸºç¡€ä½¿ç”¨"></a>åŸºç¡€ä½¿ç”¨</h1><h2 id="1-æ³¨å†Œ-OAuth-Application"><a href="#1-æ³¨å†Œ-OAuth-Application" class="headerlink" title="1. æ³¨å†Œ OAuth Application"></a>1. æ³¨å†Œ OAuth Application</h2><p><a href="https://github.com/settings/applications/new" target="_blank" rel="noopener">ç‚¹å‡»æ­¤å¤„</a> æ¥æ³¨å†Œä¸€ä¸ªæ–°çš„ OAuth Applicationã€‚å…¶ä»–å†…å®¹å¯ä»¥éšæ„å¡«å†™ï¼Œä½†è¦ç¡®ä¿å¡«å…¥æ­£ç¡®çš„ callback URLï¼ˆä¸€èˆ¬æ˜¯è¯„è®ºé¡µé¢å¯¹åº”çš„åŸŸåï¼Œå¦‚ <a href="https://imsun.netï¼‰ã€‚" target="_blank" rel="noopener">https://imsun.netï¼‰ã€‚</a></p><p>ä½ ä¼šå¾—åˆ°ä¸€ä¸ª client ID å’Œä¸€ä¸ª client secretï¼Œè¿™ä¸ªå°†è¢«ç”¨äºä¹‹åçš„ç”¨æˆ·ç™»å½•ã€‚</p><h2 id="2-å¼•å…¥-Gitment"><a href="#2-å¼•å…¥-Gitment" class="headerlink" title="2. å¼•å…¥ Gitment"></a>2. å¼•å…¥ Gitment</h2><p>å°†ä¸‹é¢çš„ä»£ç æ·»åŠ åˆ°ä½ çš„é¡µé¢ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">"container"</span>&gt;&lt;/div&gt;</span><br><span class="line">&lt;link rel=<span class="string">"stylesheet"</span> href=<span class="string">"https://imsun.github.io/gitment/style/default.css"</span>&gt;</span><br><span class="line">&lt;script src=<span class="string">"https://imsun.github.io/gitment/dist/gitment.browser.js"</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">var gitment = <span class="keyword">new</span> Gitment(&#123;</span><br><span class="line">  id: 'é¡µé¢ ID', // å¯é€‰ã€‚é»˜è®¤ä¸º location.href</span><br><span class="line">  owner: 'ä½ çš„ GitHub ID',</span><br><span class="line">  repo: 'å­˜å‚¨è¯„è®ºçš„ repo',</span><br><span class="line">  oauth: &#123;</span><br><span class="line">    client_id: 'ä½ çš„ client ID',</span><br><span class="line">    client_secret: 'ä½ çš„ client secret',</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line">gitment.render('container')</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œä¸Šè¿°ä»£ç å¼•ç”¨çš„ Gitment å°†ä¼šéšç€å¼€å‘å˜åŠ¨ã€‚å¦‚æœä½ å¸Œæœ›å§‹ç»ˆä½¿ç”¨æœ€æ–°çš„ç•Œé¢ä¸ç‰¹æ€§å³å¯å¼•å…¥ä¸Šè¿°ä»£ç ã€‚</p><p>å¦‚æœä½ å¸Œæœ›å¼•ç”¨ç¡®å®šç‰ˆæœ¬çš„ Gitmentï¼Œåˆ™åº”è¯¥ä½¿ç”¨ npm è¿›è¡Œå®‰è£…ã€‚</p><p><code>$ npm install --save gitment</code><br>å…³äºæ„é€ å‡½æ•°ä¸­çš„æ›´å¤šå¯ç”¨å‚æ•°è¯·æŸ¥çœ‹ Gitment Options</p><h2 id="3-åˆå§‹åŒ–è¯„è®º"><a href="#3-åˆå§‹åŒ–è¯„è®º" class="headerlink" title="3. åˆå§‹åŒ–è¯„è®º"></a>3. åˆå§‹åŒ–è¯„è®º</h2><p>é¡µé¢å‘å¸ƒåï¼Œä½ éœ€è¦è®¿é—®é¡µé¢å¹¶ä½¿ç”¨ä½ çš„ GitHub è´¦å·ç™»å½•ï¼ˆè¯·ç¡®ä¿ä½ çš„è´¦å·æ˜¯ç¬¬äºŒæ­¥æ‰€å¡« repo çš„ ownerï¼‰ï¼Œç‚¹å‡»åˆå§‹åŒ–æŒ‰é’®ã€‚</p><p>ä¹‹åå…¶ä»–ç”¨æˆ·å³å¯åœ¨è¯¥é¡µé¢å‘è¡¨è¯„è®ºã€‚</p><h2 id="è‡ªå®šä¹‰"><a href="#è‡ªå®šä¹‰" class="headerlink" title="è‡ªå®šä¹‰"></a>è‡ªå®šä¹‰</h2><p>Gitment å¾ˆå®¹æ˜“è¿›è¡Œè‡ªå®šä¹‰ï¼Œä½ å¯ä»¥å†™ä¸€ä»½è‡ªå®šä¹‰çš„ CSS æˆ–è€…ä½¿ç”¨ä¸€ä¸ªæ–°çš„ä¸»é¢˜ã€‚ï¼ˆä¸»é¢˜å¯ä»¥æ”¹å˜ DOM ç»“æ„è€Œè‡ªå®šä¹‰ CSS ä¸èƒ½ï¼‰</p><p>æ¯”å¦‚ä½ å¯ä»¥é€šè¿‡è‡ªå®šä¹‰ä¸»é¢˜å°†è¯„è®ºæ¡†æ”¾åœ¨è¯„è®ºåˆ—è¡¨å‰é¢ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> myTheme = &#123;</span><br><span class="line">  render(state, instance) &#123;</span><br><span class="line">    const container = document.createElement('div')</span><br><span class="line">    container.lang = <span class="string">"en-US"</span></span><br><span class="line">    container.className = 'gitment-container gitment-root-container'</span><br><span class="line">    container.appendChild(instance.renderHeader(state, instance))</span><br><span class="line">    container.appendChild(instance.renderEditor(state, instance))</span><br><span class="line">    container.appendChild(instance.renderComments(state, instance))</span><br><span class="line">    container.appendChild(instance.renderFooter(state, instance))</span><br><span class="line">    <span class="keyword">return</span> container</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> gitment = <span class="keyword">new</span> Gitment(&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  theme: myTheme,</span><br><span class="line">&#125;)</span><br><span class="line">gitment.render('container')</span><br></pre></td></tr></table></figure><p>æ›´å¤šè‡ªå®šä¹‰å†…å®¹è¯·æŸ¥çœ‹<a href="https://github.com/imsun/gitment#customize" target="_blank" rel="noopener">æ–‡æ¡£</a>ã€‚</p><h2 id="å…¶ä»–é—®é¢˜"><a href="#å…¶ä»–é—®é¢˜" class="headerlink" title="å…¶ä»–é—®é¢˜"></a>å…¶ä»–é—®é¢˜</h2><p>è¯­è¨€é—®é¢˜<br>è€ƒè™‘åˆ° GitHub æœ¬èº«ä½¿ç”¨è‹±æ–‡ï¼Œè€Œæœ¬é¡¹ç›®é¢å‘ç”¨æˆ·å‡ä¸º GitHub ç”¨æˆ·ï¼Œæ‰€ä»¥ä½œè€…æ²¡æœ‰æä¾›ä¸­æ–‡æ”¯æŒçš„æ‰“ç®—ã€‚å®åœ¨æœ‰éœ€æ±‚çš„å¯ä»¥é€šè¿‡è‡ªå®šä¹‰ä¸»é¢˜æ”¯æŒä¸­æ–‡ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Gitment æ˜¯ä¸€æ¬¾åŸºäº GitHub Issues çš„è¯„è®ºç³»ç»Ÿã€‚æ”¯æŒåœ¨å‰ç«¯ç›´æ¥å¼•å…¥ï¼Œä¸éœ€è¦ä»»ä½•åç«¯ä»£ç ã€‚å¯ä»¥åœ¨é¡µé¢è¿›è¡Œç™»å½•ã€æŸ¥çœ‹ã€è¯„è®ºã€ç‚¹èµç­‰æ“ä½œï¼ŒåŒæ—¶æœ‰å®Œæ•´çš„ Markdown / GFM å’Œä»£ç é«˜äº®æ”¯æŒã€‚å°¤ä¸ºé€‚åˆå„ç§åŸºäº GitHub Pages çš„é™æ€åšå®¢æˆ–é¡¹ç›®é¡µé¢ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/gitment.png&quot; alt=&quot;Gitment&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="è½¯ä»¶" scheme="https://duanruilong.github.io/categories/%E8%BD%AF%E4%BB%B6/"/>
    
    
      <category term="ç¼–ç¨‹" scheme="https://duanruilong.github.io/tags/%E7%BC%96%E7%A8%8B/"/>
    
      <category term="è½¯ä»¶" scheme="https://duanruilong.github.io/tags/%E8%BD%AF%E4%BB%B6/"/>
    
  </entry>
  
  <entry>
    <title>React16æ–°ç‰¹æ€§æ¥è®¤è¯†ä¸€æ³¢</title>
    <link href="https://duanruilong.github.io/2018/11/29/React16%E6%96%B0%E7%89%B9%E6%80%A7%E6%9D%A5%E8%AE%A4%E8%AF%86%E4%B8%80%E6%B3%A2/"/>
    <id>https://duanruilong.github.io/2018/11/29/React16æ–°ç‰¹æ€§æ¥è®¤è¯†ä¸€æ³¢/</id>
    <published>2018-11-29T10:34:52.000Z</published>
    <updated>2018-12-13T08:32:45.000Z</updated>
    
    <content type="html"><![CDATA[<p>Reactçš„16ç‰ˆæœ¬ï¼Œé‡‡ç”¨äº†MITå¼€æºè®¸å¯è¯,React16æ–°ç‰¹æ€§æ¥è®¤è¯†ä¸€æ³¢ã€‚</p><ul><li><code>Fragments</code>ï¼šrenderå‡½æ•°å¯ä»¥è¿”å›æ•°ç»„å’Œå­—ç¬¦ä¸²</li><li><code>error boundaries</code>ï¼šé”™è¯¯å¤„ç†</li><li><code>portals</code> ï¼šæ”¯æŒå£°æ˜æ€§åœ°å°†å­æ ‘æ¸²æŸ“åˆ°å¦ä¸€ä¸ªDOMèŠ‚ç‚¹</li><li><code>custom DOM attributes</code> ï¼šReactDomå…è®¸ä¼ é€’éæ ‡å‡†å±æ€§</li><li><code>improved server-side rendering</code>:æå‡æœåŠ¡ç«¯æ¸²æŸ“æ€§èƒ½</li><li>æ”¯æŒè‡ªå®šä¹‰DOMå±æ€§</li><li>setStateä¼ å…¥nullæ—¶ä¸ä¼šå†è§¦å‘æ›´æ–°</li><li>æ›´å¥½çš„æœåŠ¡å™¨ç«¯æ¸²æŸ“</li><li>æ–°çš„æ‰“åŒ…ç­–ç•¥</li></ul><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/react16.png" alt="React"></p><a id="more"></a><h1 id="æ–°ç‰¹æ€§"><a href="#æ–°ç‰¹æ€§" class="headerlink" title="æ–°ç‰¹æ€§"></a>æ–°ç‰¹æ€§</h1><h1 id="1ã€renderå¯ä»¥returnæ•°ç»„-ï¼Œå­—ç¬¦ä¸²"><a href="#1ã€renderå¯ä»¥returnæ•°ç»„-ï¼Œå­—ç¬¦ä¸²" class="headerlink" title="1ã€renderå¯ä»¥returnæ•°ç»„ ï¼Œå­—ç¬¦ä¸²"></a>1ã€renderå¯ä»¥returnæ•°ç»„ ï¼Œå­—ç¬¦ä¸²</h1><p> React16æ–°å¢åŠ äº†renderçš„è¿”å›æ ¼å¼ï¼Œä½ å¯ä»¥returnè¿”å›<code>stringï¼Œnumberï¼Œbooleanï¼Œnullï¼Œportalï¼Œä»¥åŠfragments(å¸¦æœ‰keyå±æ€§çš„æ•°ç»„)</code>ï¼Œä¸”ä¸éœ€è¦å¤–å±‚åŒ…å«divæ ‡ç­¾ã€‚ä¸è¿‡éœ€è¦æ·»åŠ å¯¹åº”çš„keyå€¼ã€‚</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//string</span></span><br><span class="line">render()&#123;</span><br><span class="line">    return 'Hello,world'</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//number</span></span><br><span class="line">render()&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0123456789</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//boolean</span></span><br><span class="line">render()&#123;</span><br><span class="line">    <span class="keyword">return</span> isTrue ? <span class="literal">true</span> : <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//null</span></span><br><span class="line">render()&#123;</span><br><span class="line">    <span class="keyword">return</span> null</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//fragmentsï¼Œé‡åˆ°æ§åˆ¶å°å‡ºç°warning,æ˜¯æœªåŠ keyæ ‡è¯†ç¬¦ï¼Œ</span></span><br><span class="line">render()&#123;</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">        &lt;div&gt;Hello&lt;/div&gt;,</span><br><span class="line">        &lt;span&gt;world&lt;/span&gt;,</span><br><span class="line">        &lt;p&gt;DRL&lt;/p&gt;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="2ã€error-boundariesé”™è¯¯å¤„ç†"><a href="#2ã€error-boundariesé”™è¯¯å¤„ç†" class="headerlink" title="2ã€error boundariesé”™è¯¯å¤„ç†"></a>2ã€error boundariesé”™è¯¯å¤„ç†</h1><p>React16æ–°å¢åŠ äº†æŠ›å¼‚å¸¸çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°<code>componentDidCatch</code></p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">componentDidCatch(err,info)&#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;isError:<span class="number">1</span>&#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p> è¿ç”¨è¿™ä¸ªå¯¿å‘½å‘¨æœŸåœ¨é‡åˆ°é¡µé¢æŠ¥é”™çš„æ—¶å€™å°±å¯ä»¥å®šä¹‰æŠ¥é”™æ–¹å¼ï¼Œç»™ç”¨æˆ·æ›´å¥½çš„ä½“éªŒã€‚React 16ä¹‹å‰é¡µé¢å†…çš„ç»„ä»¶å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œé‚£ä¹ˆæ•´ä¸ªç»„ä»¶æ ‘å°±ä¼šä»æ ¹èŠ‚ç‚¹è¢«å¸è½½ï¼Œåˆ°äº†React 16 äº§ç”Ÿäº†ä¸€ä¸ªâ€œé”™è¯¯è¾¹ç•Œï¼ˆerror boundariesï¼‰â€çš„æ¦‚å¿µ,å®ƒä¼šæ•æ‰é¡µé¢å†…çš„é”™è¯¯å¹¶ä¸”å¯¹è¿™äº›é”™è¯¯è¿›è¡Œå¤„ç†ã€‚æˆ‘ä»¬å¯ä»¥æŠŠå®ƒæ¯”å–»ä¸º<code>try-catch</code></p><p> åœ¨å®¹æ˜“å‡ºé”™çš„ç»„ä»¶å¤–ä½¿ç”¨ErrorBoundaryå°†å®ƒåŒ…è£¹èµ·æ¥:</p> <figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä½¿ç”¨æ–¹å¼</span></span><br><span class="line"></span><br><span class="line">import React, &#123; Component &#125; from 'react'</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">ErrorBoundary</span> <span class="title">extends</span> <span class="title">Component</span> &#123;</span></span><br><span class="line">    constructor(props) &#123;</span><br><span class="line">        super(props)</span><br><span class="line">        <span class="keyword">this</span>.state = &#123; hasError: <span class="literal">false</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    componentDidCatch(err, info) &#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123; hasError: <span class="literal">true</span> &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.state.hasError)&#123;</span><br><span class="line">            <span class="keyword">return</span> &lt;div&gt;Something wrong!&lt;/div&gt;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.props.children</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">render()&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;ErrorBoundary&gt;</span><br><span class="line">                &lt;Listview user=&#123;<span class="keyword">this</span>.state.data&#125; /&gt;</span><br><span class="line">            &lt;/ErrorBoundary&gt;</span><br><span class="line">            &lt;button onClick=&#123;<span class="keyword">this</span>.onClickChange&#125;&gt;toUpdate&lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœListviewç»„ä»¶å‘ç”Ÿé”™è¯¯ï¼Œå°†ä¼šä½¿ç”¨ErrorBoundaryæä¾›çš„<code>&lt;div&gt;Something went wrong&lt;/div&gt;</code>ä»£æ›¿å®ƒï¼Œä¸ä¼šå¼•èµ·æ•´ä¸ªç»„ä»¶æ ‘çš„å¸è½½ã€‚</p><h1 id="3ã€portalsæ”¯æŒå£°æ˜æ€§åœ°å°†å­æ ‘æ¸²æŸ“åˆ°å¦ä¸€ä¸ªDOMèŠ‚ç‚¹"><a href="#3ã€portalsæ”¯æŒå£°æ˜æ€§åœ°å°†å­æ ‘æ¸²æŸ“åˆ°å¦ä¸€ä¸ªDOMèŠ‚ç‚¹" class="headerlink" title="3ã€portalsæ”¯æŒå£°æ˜æ€§åœ°å°†å­æ ‘æ¸²æŸ“åˆ°å¦ä¸€ä¸ªDOMèŠ‚ç‚¹"></a>3ã€<code>portals</code>æ”¯æŒå£°æ˜æ€§åœ°å°†å­æ ‘æ¸²æŸ“åˆ°å¦ä¸€ä¸ªDOMèŠ‚ç‚¹</h1><p>Portalsæœºåˆ¶æä¾›äº†ä¸€ç§æœ€ç›´æ¥çš„æ–¹å¼å¯ä»¥æŠŠä¸€ä¸ªå­ç»„ä»¶æ¸²æŸ“åˆ°çˆ¶ç»„ä»¶æ¸²æŸ“çš„DOMæ ‘ä¹‹å¤–ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒReactç»„ä»¶æ ‘å’ŒDOMæ ‘æ˜¯å®Œå…¨å¯¹åº”çš„ï¼Œå› æ­¤å¯¹äºä¸€äº›Modal,Overlayä¹‹ç±»çš„ç»„ä»¶ï¼Œé€šå¸¸æ˜¯å°†å®ƒä»¬æ”¾åœ¨é¡¶å±‚ï¼Œä½†é€»è¾‘ä¸Šå®ƒä»¬å¯èƒ½åªæ˜¯å±äºæŸä¸ªå­ç»„ä»¶ï¼Œä¸åˆ©äºç»„ä»¶çš„ä»£ç ç»„ç»‡ã€‚é€šè¿‡ä½¿ç”¨createPortalï¼Œæˆ‘ä»¬å¯ä»¥å°†ç»„ä»¶æ¸²æŸ“åˆ°æˆ‘ä»¬æƒ³è¦çš„ä»»æ„DOMèŠ‚ç‚¹ä¸­ï¼Œä½†è¯¥ç»„ä»¶ä¾ç„¶å¤„åœ¨Reactçš„çˆ¶ç»„ä»¶ä¹‹å†…ã€‚å¸¦æ¥çš„ä¸€ä¸ªç‰¹æ€§å°±æ˜¯ï¼Œåœ¨å­ç»„ä»¶äº§ç”Ÿçš„eventä¾ç„¶å¯ä»¥è¢«Reactçˆ¶ç»„ä»¶æ•è·ï¼Œä½†åœ¨DOMç»“æ„ä¸­ï¼Œå®ƒå´ä¸æ˜¯ä½ çš„çˆ¶ç»„ä»¶ã€‚å¯¹äºç»„ä»¶ç»„ç»‡ï¼Œä»£ç åˆ‡å‰²æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å±æ€§ã€‚</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å®ç°ä¸€ä¸ªç®€æ˜“è’™å±‚æ•ˆæœï¼ŒæŠ½è±¡å‡ºä¸€ä¸ªé€šç”¨çš„Overlayç»„ä»¶</span></span><br><span class="line">import React, &#123; Component &#125; from 'react';</span><br><span class="line">import ReactDOM from 'react-dom';</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Overlay</span> <span class="title">extends</span> <span class="title">Component</span> &#123;</span></span><br><span class="line">    constructor(props) &#123;</span><br><span class="line">        super(props);</span><br><span class="line">        this.container = document.createElement('div');</span><br><span class="line">        document.body.appendChild(<span class="keyword">this</span>.container);</span><br><span class="line">    &#125;</span><br><span class="line">    componentWillUnmount() &#123;</span><br><span class="line">        document.body.removeChild(<span class="keyword">this</span>.container);</span><br><span class="line">    &#125;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> ReactDOM.createPortal(</span><br><span class="line">            &lt;div className='overlay'&gt;</span><br><span class="line">                &lt;span className='overlay-close' onClick=&#123;this.props.onClose&#125;&gt;&amp;times;&lt;/span&gt;</span><br><span class="line">                &#123;<span class="keyword">this</span>.props.children&#125;</span><br><span class="line">            &lt;/div&gt;,</span><br><span class="line">            <span class="keyword">this</span>.container</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è¯¥ç»„ä»¶å¯¹åº”çš„æ ·å¼å¦‚ä¸‹</span></span><br><span class="line">.overlay&#123;</span><br><span class="line">    box-sizing:border-box;</span><br><span class="line">    position: fixed;</span><br><span class="line">    top:<span class="number">50</span>%;</span><br><span class="line">    left:<span class="number">50</span>%;</span><br><span class="line">    width:<span class="number">260</span>px;</span><br><span class="line">    height:<span class="number">200</span>px;</span><br><span class="line">    margin-left:<span class="number">-130</span>px;</span><br><span class="line">    margin-top:<span class="number">-100</span>px;</span><br><span class="line">    padding:<span class="number">10</span>px;</span><br><span class="line">    background-color: <span class="meta">#fff;</span></span><br><span class="line">    outline: rgba(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">.5</span>) solid <span class="number">9999</span>px;</span><br><span class="line">&#125;</span><br><span class="line">.overlay-close&#123;</span><br><span class="line">    position: absolute;</span><br><span class="line">    top:<span class="number">10</span>px;</span><br><span class="line">    right:<span class="number">10</span>px;</span><br><span class="line">    color:red;</span><br><span class="line">    cursor: pointer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="title">extends</span> <span class="title">Component</span> &#123;</span></span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    super(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      overlayActive: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.closeOverlay = <span class="keyword">this</span>.closeOverlay.bind(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">this</span>.showOverlay = <span class="keyword">this</span>.showOverlay.bind(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  closeOverlay() &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; overlayActive: <span class="literal">false</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  showOverlay() &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; overlayActive: <span class="literal">true</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div className=<span class="string">"App"</span>&gt;</span><br><span class="line">        &lt;div&gt;hello world!&lt;/div&gt;</span><br><span class="line">        &#123;<span class="keyword">this</span>.state.overlayActive &amp;&amp;</span><br><span class="line">          &lt;Overlay onClose=&#123;<span class="keyword">this</span>.closeOverlay&#125;&gt;overlay content&lt;/Overlay&gt;&#125;</span><br><span class="line">        &lt;button onClick=&#123;<span class="keyword">this</span>.showOverlay&#125;&gt;show&lt;/button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="4ã€custom-DOM-attributes-ï¼šReactDomå…è®¸ä¼ é€’éæ ‡å‡†å±æ€§"><a href="#4ã€custom-DOM-attributes-ï¼šReactDomå…è®¸ä¼ é€’éæ ‡å‡†å±æ€§" class="headerlink" title="4ã€custom DOM attributes ï¼šReactDomå…è®¸ä¼ é€’éæ ‡å‡†å±æ€§"></a>4ã€<code>custom DOM attributes</code> ï¼šReactDomå…è®¸ä¼ é€’éæ ‡å‡†å±æ€§</h1><h1 id="5ã€-improved-server-side-rendering-æå‡æœåŠ¡ç«¯æ¸²æŸ“æ€§èƒ½"><a href="#5ã€-improved-server-side-rendering-æå‡æœåŠ¡ç«¯æ¸²æŸ“æ€§èƒ½" class="headerlink" title="5ã€ improved server-side rendering:æå‡æœåŠ¡ç«¯æ¸²æŸ“æ€§èƒ½"></a>5ã€ <code>improved server-side rendering</code>:æå‡æœåŠ¡ç«¯æ¸²æŸ“æ€§èƒ½</h1><h1 id="6ã€-æ”¯æŒè‡ªå®šä¹‰DOMå±æ€§"><a href="#6ã€-æ”¯æŒè‡ªå®šä¹‰DOMå±æ€§" class="headerlink" title="6ã€ æ”¯æŒè‡ªå®šä¹‰DOMå±æ€§"></a>6ã€ æ”¯æŒè‡ªå®šä¹‰DOMå±æ€§</h1><h1 id="7ã€-setStateä¼ å…¥nullæ—¶ä¸ä¼šå†è§¦å‘æ›´æ–°"><a href="#7ã€-setStateä¼ å…¥nullæ—¶ä¸ä¼šå†è§¦å‘æ›´æ–°" class="headerlink" title="7ã€ setStateä¼ å…¥nullæ—¶ä¸ä¼šå†è§¦å‘æ›´æ–°"></a>7ã€ setStateä¼ å…¥nullæ—¶ä¸ä¼šå†è§¦å‘æ›´æ–°</h1><h1 id="8ã€-æ›´å¥½çš„æœåŠ¡å™¨ç«¯æ¸²æŸ“"><a href="#8ã€-æ›´å¥½çš„æœåŠ¡å™¨ç«¯æ¸²æŸ“" class="headerlink" title="8ã€ æ›´å¥½çš„æœåŠ¡å™¨ç«¯æ¸²æŸ“"></a>8ã€ æ›´å¥½çš„æœåŠ¡å™¨ç«¯æ¸²æŸ“</h1><h1 id="9ã€-æ–°çš„æ‰“åŒ…ç­–ç•¥"><a href="#9ã€-æ–°çš„æ‰“åŒ…ç­–ç•¥" class="headerlink" title="9ã€ æ–°çš„æ‰“åŒ…ç­–ç•¥"></a>9ã€ æ–°çš„æ‰“åŒ…ç­–ç•¥</h1>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Reactçš„16ç‰ˆæœ¬ï¼Œé‡‡ç”¨äº†MITå¼€æºè®¸å¯è¯,React16æ–°ç‰¹æ€§æ¥è®¤è¯†ä¸€æ³¢ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Fragments&lt;/code&gt;ï¼šrenderå‡½æ•°å¯ä»¥è¿”å›æ•°ç»„å’Œå­—ç¬¦ä¸²&lt;/li&gt;
&lt;li&gt;&lt;code&gt;error boundaries&lt;/code&gt;ï¼šé”™è¯¯å¤„ç†&lt;/li&gt;
&lt;li&gt;&lt;code&gt;portals&lt;/code&gt; ï¼šæ”¯æŒå£°æ˜æ€§åœ°å°†å­æ ‘æ¸²æŸ“åˆ°å¦ä¸€ä¸ªDOMèŠ‚ç‚¹&lt;/li&gt;
&lt;li&gt;&lt;code&gt;custom DOM attributes&lt;/code&gt; ï¼šReactDomå…è®¸ä¼ é€’éæ ‡å‡†å±æ€§&lt;/li&gt;
&lt;li&gt;&lt;code&gt;improved server-side rendering&lt;/code&gt;:æå‡æœåŠ¡ç«¯æ¸²æŸ“æ€§èƒ½&lt;/li&gt;
&lt;li&gt;æ”¯æŒè‡ªå®šä¹‰DOMå±æ€§&lt;/li&gt;
&lt;li&gt;setStateä¼ å…¥nullæ—¶ä¸ä¼šå†è§¦å‘æ›´æ–°&lt;/li&gt;
&lt;li&gt;æ›´å¥½çš„æœåŠ¡å™¨ç«¯æ¸²æŸ“&lt;/li&gt;
&lt;li&gt;æ–°çš„æ‰“åŒ…ç­–ç•¥&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/react16.png&quot; alt=&quot;React&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="React" scheme="https://duanruilong.github.io/categories/React/"/>
    
    
      <category term="ç¼–ç¨‹" scheme="https://duanruilong.github.io/tags/%E7%BC%96%E7%A8%8B/"/>
    
      <category term="React" scheme="https://duanruilong.github.io/tags/React/"/>
    
  </entry>
  
  <entry>
    <title>JavaScript: ä»€ä¹ˆæ˜¯çº¯å‡½æ•°ä»¥åŠä¸ºä»€ä¹ˆè¦ç”¨çº¯å‡½æ•°</title>
    <link href="https://duanruilong.github.io/2018/11/11/JavaScript-%E4%BB%80%E4%B9%88%E6%98%AF%E7%BA%AF%E5%87%BD%E6%95%B0%E4%BB%A5%E5%8F%8A%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E7%94%A8%E7%BA%AF%E5%87%BD%E6%95%B0/"/>
    <id>https://duanruilong.github.io/2018/11/11/JavaScript-ä»€ä¹ˆæ˜¯çº¯å‡½æ•°ä»¥åŠä¸ºä»€ä¹ˆè¦ç”¨çº¯å‡½æ•°/</id>
    <published>2018-11-11T09:57:25.000Z</published>
    <updated>2018-11-11T10:06:18.000Z</updated>
    
    <content type="html"><![CDATA[<p>å½“æˆ‘ç¬¬ä¸€æ¬¡å¬åˆ° â€œçº¯å‡½æ•° (Pure Function)â€ è¿™ä¸ªæœ¯è¯­çš„æ—¶å€™æˆ‘å¾ˆç–‘æƒ‘ã€‚å¸¸è§„çš„å‡½æ•°åšé”™äº†ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆè¦å˜çº¯ï¼Ÿ ä¸ºä»€ä¹ˆæˆ‘éœ€è¦çº¯çš„å‡½æ•°ï¼Ÿ</p><p>é™¤éä½ å·²ç»çŸ¥é“ä»€ä¹ˆæ˜¯çº¯å‡½æ•°ï¼Œå¦åˆ™ä½ å¯èƒ½ä¼šé—®åŒæ ·çš„ç–‘æƒ‘ã€‚ä¸è¿‡è¿™ä¸ªæ¦‚å¿µå…¶å®å¾ˆç®€å•ã€‚å¯ä»¥èŠ±ç‚¹æ—¶é—´ä¸€èµ·æ¥çœ‹ä»¥ä¸‹ã€‚</p><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/js_d.png" alt="js"></p><a id="more"></a><h1 id="ä»€ä¹ˆå‡½æ•°æ˜¯çº¯"><a href="#ä»€ä¹ˆå‡½æ•°æ˜¯çº¯" class="headerlink" title="ä»€ä¹ˆå‡½æ•°æ˜¯çº¯"></a>ä»€ä¹ˆå‡½æ•°æ˜¯çº¯</h1><p>çº¯å‡½æ•°çš„å®šä¹‰æ˜¯ï¼š</p><ul><li><p>1ã€å¦‚æœå‡½æ•°çš„è°ƒç”¨å‚æ•°ç›¸åŒï¼Œåˆ™æ°¸è¿œè¿”å›ç›¸åŒçš„ç»“æœã€‚å®ƒä¸ä¾èµ–äºç¨‹åºæ‰§è¡ŒæœŸé—´å‡½æ•°å¤–éƒ¨ä»»ä½•çŠ¶æ€æˆ–æ•°æ®çš„å˜åŒ–ï¼Œå¿…é¡»åªä¾èµ–äºå…¶è¾“å…¥å‚æ•°ã€‚</p></li><li><p>2ã€è¯¥å‡½æ•°ä¸ä¼šäº§ç”Ÿä»»ä½•å¯è§‚å¯Ÿçš„å‰¯ä½œç”¨ï¼Œä¾‹å¦‚ç½‘ç»œè¯·æ±‚ï¼Œè¾“å…¥å’Œè¾“å‡ºè®¾å¤‡æˆ–æ•°æ®çªå˜ï¼ˆmutationï¼‰ã€‚</p></li></ul><p>è¿™å°±æ˜¯çº¯çš„å‡½æ•°ã€‚ å¦‚æœä¸€ä¸ªå‡½æ•°ç¬¦åˆä¸Šè¿° 2 ä¸ªè¦æ±‚ï¼Œå®ƒå°±æ˜¯çº¯å‡½æ•°ã€‚ ä½ å¯èƒ½åœ¨è¿‡å»ç”šè‡³æ— æ„åœ°æƒ…å†µä¸‹ç¼–å†™è¿‡çº¯å‡½æ•°ã€‚</p><p>åœ¨æˆ‘ä»¬ç ”ç©¶ä¸€ä¸ªå‡½æ•°ä¸€ä¸ªçº¯æˆ–ä¸çº¯ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆè®¨è®ºä¸€ä¸‹å¯æ€•çš„â€œå‰¯ä½œç”¨â€ã€‚</p><h1 id="ä»€ä¹ˆæ˜¯å¯è§‚å¯Ÿçš„å‰¯ä½œç”¨"><a href="#ä»€ä¹ˆæ˜¯å¯è§‚å¯Ÿçš„å‰¯ä½œç”¨" class="headerlink" title="ä»€ä¹ˆæ˜¯å¯è§‚å¯Ÿçš„å‰¯ä½œç”¨"></a>ä»€ä¹ˆæ˜¯å¯è§‚å¯Ÿçš„å‰¯ä½œç”¨</h1><p>ä¸€ä¸ªå¯ä»¥è¢«è§‚å¯Ÿçš„å‰¯ä½œç”¨æ˜¯åœ¨å‡½æ•°å†…éƒ¨ä¸å…¶å¤–éƒ¨çš„ä»»æ„äº¤äº’ã€‚è¿™å¯èƒ½æ˜¯åœ¨å‡½æ•°å†…ä¿®æ”¹å¤–éƒ¨çš„å˜é‡ï¼Œæˆ–è€…åœ¨å‡½æ•°é‡Œè°ƒç”¨å¦å¤–ä¸€ä¸ªå‡½æ•°ç­‰ã€‚</p><p>æ³¨: å¦‚æœçº¯å‡½æ•°è°ƒç”¨çº¯å‡½æ•°ï¼Œåˆ™ä¸äº§ç”Ÿå‰¯ä½œç”¨ä¾æ—§æ˜¯çº¯å‡½æ•°ã€‚</p><p>å‰¯ä½œç”¨æ¥è‡ªï¼Œä½†ä¸é™äºï¼š</p><ul><li><p>è¿›è¡Œä¸€ä¸ª HTTP è¯·æ±‚</p></li><li><p>Mutating data</p></li><li><p>è¾“å‡ºæ•°æ®åˆ°å±å¹•æˆ–è€…æ§åˆ¶å°</p></li><li><p>DOM æŸ¥è¯¢/æ“ä½œ</p></li><li><p>Math.random()</p></li><li><p>è·å–çš„å½“å‰æ—¶é—´</p></li></ul><p>å‰¯ä½œç”¨æœ¬èº«å¹¶ä¸æ˜¯æ¯’è¯ï¼ŒæŸäº›æ—¶å€™å¾€å¾€æ˜¯å¿…éœ€çš„ã€‚ ä½†æ˜¯ï¼Œå¯¹äºè¦ä¿æŒçº¯ç²¹çš„å‡½æ•°ï¼Œå®ƒä¸èƒ½åŒ…å«ä»»ä½•å‰¯ä½œç”¨ã€‚å½“ç„¶ï¼Œå¹¶éæ‰€æœ‰å‡½æ•°éƒ½éœ€è¦æ˜¯çº¯å‡½æ•°ã€‚ æˆ‘å°†åœ¨ç¨åè®¨è®ºè¿™ä¸ªæƒ…å†µã€‚</p><p>ä¸è¿‡é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸€äº›çº¯çš„å’Œä¸çº¯çš„å‡½æ•°å¯¹æ¯”çš„ä¾‹å­â€¦â€¦</p><h1 id="çº¯å‡½æ•°"><a href="#çº¯å‡½æ•°" class="headerlink" title="çº¯å‡½æ•°"></a>çº¯å‡½æ•°</h1><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªè®¡ç®—äº§å“ç¨åä»·æ ¼ï¼ˆè‹±å›½ç¨ç‡æ˜¯20%ï¼‰çš„çº¯å‡½æ•°çš„ä¾‹å­ï¼š<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">function <span class="title">priceAfterTax</span><span class="params">(productPrice)</span> </span>&#123; <span class="keyword">return</span> (productPrice * <span class="number">0.20</span>) + productPrice;&#125;</span><br></pre></td></tr></table></figure></p><p>å®ƒç¬¦åˆæˆ‘ä»¬æ‰€è¯´çš„ä¸¤æ¡çº¯å‡½æ•°çš„å®šä¹‰ã€‚<code>ä¸ä¾èµ–äºä»»ä½•å¤–éƒ¨è¾“å…¥ï¼Œä¸æ”¹å˜ä»»ä½•å¤–éƒ¨æ•°æ®ã€æ²¡æœ‰å‰¯ä½œç”¨</code>ã€‚</p><p>å³ä½¿ä½ ç”¨åŒæ ·çš„è¾“å…¥è¿è¡Œè¿è¡Œè¿™ä¸ªå‡½æ•° 100,000,000 æ¬¡å®ƒä¾æ—§äº§ç”ŸåŒæ ·çš„ç»“æœã€‚</p><h1 id="éçº¯å‡½æ•°"><a href="#éçº¯å‡½æ•°" class="headerlink" title="éçº¯å‡½æ•°"></a>éçº¯å‡½æ•°</h1><p>æˆ‘ä»¬å·²ç»çœ‹äº†çº¯å‡½æ•°çš„ä¾‹å­ï¼Œç°åœ¨ä¸€èµ·æ¥çœ‹ä¸€ä¸ªéçº¯å‡½æ•°ï¼ˆImpure functionï¼‰çš„ JavaScript ä¾‹å­:<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var tax = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line"><span class="function">function <span class="title">calculateTax</span><span class="params">(productPrice)</span> </span>&#123; <span class="keyword">return</span> (productPrice * (tax/<span class="number">100</span>)) + productPrice;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æš‚åœç‰‡åˆ»ï¼Œçœ‹çœ‹ä½ æ˜¯å¦èƒ½çœ‹å‡ºä¸ºä»€ä¹ˆè¿™ä¸ªå‡½æ•°ä¸çº¯ã€‚</p><p>å…¶ä¸­å‡½æ•°çš„è®¡ç®—ç»“æœå–å†³äºå¤–éƒ¨ tax å˜é‡ï¼Œè€Œçº¯å‡½æ•°ä¸èƒ½ä¾èµ–å¤–éƒ¨å˜é‡ã€‚å®ƒæ²¡æœ‰æ»¡è¶³å®šä¹‰ä¸­çš„ç¬¬ä¸€ä¸ªè¦æ±‚ï¼Œå› æ­¤è¿™ä¸ªå‡½æ•°æ˜¯ä¸çº¯çš„ã€‚</p><h1 id="ä¸ºä»€ä¹ˆè¯´çº¯å‡½æ•°åœ¨-JavaScript-å¾ˆé‡è¦"><a href="#ä¸ºä»€ä¹ˆè¯´çº¯å‡½æ•°åœ¨-JavaScript-å¾ˆé‡è¦" class="headerlink" title="ä¸ºä»€ä¹ˆè¯´çº¯å‡½æ•°åœ¨ JavaScript å¾ˆé‡è¦"></a>ä¸ºä»€ä¹ˆè¯´çº¯å‡½æ•°åœ¨ JavaScript å¾ˆé‡è¦</h1><p>çº¯å‡½æ•°åœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­è¢«å¤§é‡ä½¿ç”¨ã€‚è€Œä¸”è¯¸å¦‚ ReactJS å’Œ Redux ç­‰ä¼˜è´¨çš„åº“éƒ½éœ€è¦ä½¿ç”¨çº¯å‡½æ•°ã€‚</p><p>ä¸è¿‡ï¼Œçº¯å‡½æ•°ä¹Ÿå¯ä»¥ç”¨åœ¨å¹³å¸¸çš„ JavaScript å¼€å‘ä¸­ä½¿ç”¨ï¼Œä¸ä¸€å®šè¦é™æ­»åœ¨æŸä¸ªç¼–ç¨‹èŒƒä¾‹ä¸­ã€‚ ä½ å¯ä»¥æ··åˆçº¯çš„å’Œä¸çº¯çš„å‡½æ•°ï¼Œè¿™å®Œå…¨æ²¡é—®é¢˜ã€‚</p><p>å¹¶éæ‰€æœ‰å‡½æ•°éƒ½éœ€è¦æ˜¯çº¯çš„ã€‚ ä¾‹å¦‚ï¼Œæ“ä½œ DOM çš„æŒ‰é’®æŒ‰ä¸‹çš„äº‹ä»¶å¤„ç†ç¨‹åºå°±ä¸é€‚åˆçº¯å‡½æ•°ã€‚ ä¸è¿‡ï¼Œè¿™ç§äº‹ä»¶å¤„ç†å‡½æ•°å¯ä»¥è°ƒç”¨å…¶ä»–çº¯å‡½æ•°æ¥å¤„ç†ï¼Œä»¥æ­¤å‡å°‘é¡¹ç›®ä¸­ä¸çº¯å‡½æ•°çš„æ•°é‡ã€‚</p><h1 id="å¯æµ‹è¯•æ€§å’Œé‡æ„"><a href="#å¯æµ‹è¯•æ€§å’Œé‡æ„" class="headerlink" title="å¯æµ‹è¯•æ€§å’Œé‡æ„"></a>å¯æµ‹è¯•æ€§å’Œé‡æ„</h1><p>å¦ä¸€ä¸ªä½¿ç”¨çº¯å‡½æ•°çš„åŸå› æ˜¯æµ‹è¯•ä»¥åŠé‡æ„ã€‚</p><p>ä½¿ç”¨çº¯å‡½æ•°çš„ä¸€ä¸ªä¸»è¦å¥½å¤„æ˜¯å®ƒä»¬å¯ä»¥ç›´æ¥æµ‹ã€‚ å¦‚æœä¼ å…¥ç›¸åŒçš„å‚æ•°ï¼Œå®ƒä»¬å°†å§‹ç»ˆäº§ç”Ÿç›¸åŒçš„ç»“æœã€‚</p><p>åŒæ—¶çº¯å‡½æ•°è¿˜ä½¿å¾—ç»´æŠ¤å’Œé‡æ„ä»£ç å˜å¾—æ›´åŠ å®¹æ˜“ã€‚ä½ å¯ä»¥æ”¾å¿ƒåœ°é‡æ„ä¸€ä¸ªçº¯å‡½æ•°ï¼Œä¸å¿…æ“å¿ƒæ²¡æ³¨æ„åˆ°çš„å‰¯ä½œç”¨æä¹±äº†æ•´ä¸ªåº”ç”¨è€Œå¯¼è‡´ç»ˆè°ƒè¯•åœ°ç‹±ã€‚ï¼ˆè¯‘æ³¨ï¼šå¦‚æœé¡¹ç›®ä¸­å……æ–¥ç€å‰¯ä½œç”¨ï¼Œé‚£ä¹ˆå‡½æ•°/æ¨¡å—ä¹‹é—´çš„é€»è¾‘å¯èƒ½äº’ç›¸äº¤ç»‡è€¦åˆï¼Œåœ¨åæœŸæ–°å¢é€»è¾‘æ—¶å¯èƒ½ç”±äºä¾èµ–å¤æ‚è€Œéš¾ä»¥é‡æ„ï¼Œæ›´å¸¸è§çš„æ˜¯å¼€å‘ä¸ºäº†åº”ä»˜éœ€æ±‚è€Œä¸æ–­çš„å¼•å…¥æ–°çš„å‰¯ä½œç”¨åˆ°åŸæœ¬çš„é€»è¾‘ä¸Šä»è€Œå¯¼è‡´ä»£ç å˜å¾—è¶Šæ¥è¶Šç³Ÿç³•ã€‚ï¼‰</p><p><code>æ­£ç¡®åœ°ä½¿ç”¨çº¯å‡½æ•°å¯ä»¥äº§ç”Ÿæ›´åŠ é«˜è´¨é‡çš„ä»£ç ã€‚å¹¶ä¸”ä¹Ÿæ˜¯ä¸€ç§æ›´åŠ å¹²å‡€çš„ç¼–ç æ–¹å¼ã€‚</code></p><p>æ­¤å¤–ï¼Œçº¯å‡½æ•°ä¸ä¸æ˜¯ JavaScript çš„ä¸“åˆ©ã€‚æƒ³è¦äº†è§£æ›´å¤šå†…å®¹å¯ä»¥å‚è§ <a href="https://en.wikipedia.org/wiki/Pure_function" target="_blank" rel="noopener">Wiki</a>ã€‚åŒæ—¶ä¹Ÿæ¨èé˜…è¯» <a href="https://drboolean.gitbooks.io/mostly-adequate-guide/ch3.html" target="_blank" rel="noopener">å¼€å‘å»ºè®®æ‰‹å†Œ</a> ä»¥åŠ <a href="https://toddmotto.com/pure-versus-impure-functions" target="_blank" rel="noopener">çº¯å‡½æ•° vs. éçº¯å‡½æ•°</a>.</p><p>åŸæ–‡é“¾æ¥ï¼š medium.com</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å½“æˆ‘ç¬¬ä¸€æ¬¡å¬åˆ° â€œçº¯å‡½æ•° (Pure Function)â€ è¿™ä¸ªæœ¯è¯­çš„æ—¶å€™æˆ‘å¾ˆç–‘æƒ‘ã€‚å¸¸è§„çš„å‡½æ•°åšé”™äº†ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆè¦å˜çº¯ï¼Ÿ ä¸ºä»€ä¹ˆæˆ‘éœ€è¦çº¯çš„å‡½æ•°ï¼Ÿ&lt;/p&gt;
&lt;p&gt;é™¤éä½ å·²ç»çŸ¥é“ä»€ä¹ˆæ˜¯çº¯å‡½æ•°ï¼Œå¦åˆ™ä½ å¯èƒ½ä¼šé—®åŒæ ·çš„ç–‘æƒ‘ã€‚ä¸è¿‡è¿™ä¸ªæ¦‚å¿µå…¶å®å¾ˆç®€å•ã€‚å¯ä»¥èŠ±ç‚¹æ—¶é—´ä¸€èµ·æ¥çœ‹ä»¥ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/js_d.png&quot; alt=&quot;js&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Javascript" scheme="https://duanruilong.github.io/categories/Javascript/"/>
    
    
      <category term="Javascript" scheme="https://duanruilong.github.io/tags/Javascript/"/>
    
      <category term="ç¼–ç¨‹" scheme="https://duanruilong.github.io/tags/%E7%BC%96%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>åœ¨PHPé‡Œå¾ˆå¥½çš„ä½¿ç”¨ImageMagick---convertç¯‡</title>
    <link href="https://duanruilong.github.io/2018/09/18/%E5%9C%A8PHP%E9%87%8C%E5%BE%88%E5%A5%BD%E7%9A%84%E4%BD%BF%E7%94%A8ImageMagick-convert%E7%AF%87/"/>
    <id>https://duanruilong.github.io/2018/09/18/åœ¨PHPé‡Œå¾ˆå¥½çš„ä½¿ç”¨ImageMagick-convertç¯‡/</id>
    <published>2018-09-17T16:15:54.000Z</published>
    <updated>2018-09-18T14:16:16.000Z</updated>
    
    <content type="html"><![CDATA[<p>ImageMagick åŒ…æ‹¬ä¸€ç»„å‘½ä»¤è¡Œå·¥å…·æ¥æ“ä½œå›¾ç‰‡ï¼Œä¹‹å‰çš„ImageMagickå®ç°base64å›¾ç‰‡çš„é€»è¾‘åœ¨æœåŠ¡å™¨ç«¯å¯èƒ½ä¼šé€ æˆæº¢å‡ºçš„äº‹æ•…ï¼Œæ‰€ä»¥åœ¨æ¥ä¸‹çš„æ–‡ç« é‡Œä¼šä»‹ç»å¦å¤–ä¸€ç§å¥½çš„å®ç°æ–¹å¼å°±æ˜¯â€”-convertå‘½ä»¤ã€‚ä½¿ç”¨å‘½ä»¤æ ¼å¼çš„å½¢å¼å»ç”Ÿæˆå›¾ç‰‡å’Œå¤§å°çš„è£å‰ªæ•°æ®æ ¼å¼çš„è½¬æ¢ã€‚</p><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/php.jpg" alt="PHP"></p><a id="more"></a><h1 id="åŸºæœ¬å‘½ä»¤ä¸æ ¼å¼"><a href="#åŸºæœ¬å‘½ä»¤ä¸æ ¼å¼" class="headerlink" title="åŸºæœ¬å‘½ä»¤ä¸æ ¼å¼"></a>åŸºæœ¬å‘½ä»¤ä¸æ ¼å¼</h1><h2 id="1ã€åŸºæœ¬å‘½ä»¤"><a href="#1ã€åŸºæœ¬å‘½ä»¤" class="headerlink" title="1ã€åŸºæœ¬å‘½ä»¤"></a>1ã€åŸºæœ¬å‘½ä»¤</h2><ul><li><code>magick:</code> åˆ›å»ºã€ç¼–è¾‘å›¾åƒï¼Œè½¬æ¢å›¾åƒæ ¼å¼ï¼Œä»¥åŠè°ƒæ•´å›¾åƒå¤§å°ã€æ¨¡ç³Šã€è£åˆ‡ã€é™¤å»æ‚ç‚¹ã€æŠ–åŠ¨ ( dither )ã€ç»˜å›¾ã€ç¿»è½¬ã€åˆå¹¶ã€é‡æ–°é‡‡æ ·ç­‰ã€‚</li><li><code>convert:</code> ç­‰åŒäº magick å‘½ä»¤ã€‚</li><li><code>identify:</code> è¾“å‡ºä¸€ä¸ªæˆ–å¤šä¸ªå›¾åƒæ–‡ä»¶çš„æ ¼å¼å’Œç‰¹å¾ä¿¡æ¯ï¼Œå¦‚åˆ†è¾¨ç‡ã€å¤§å°ã€å°ºå¯¸ã€è‰²å½©ç©ºé—´ç­‰ã€‚</li><li><code>mogrify:</code> ä¸ magick åŠŸèƒ½ä¸€æ ·ï¼Œä¸è¿‡ä¸éœ€è¦æŒ‡å®šè¾“å‡ºæ–‡ä»¶ï¼Œè‡ªåŠ¨è¦†ç›–åŸå§‹å›¾åƒæ–‡ä»¶ã€‚</li><li><code>composite:</code> å°†ä¸€ä¸ªå›¾ç‰‡æˆ–å¤šä¸ªå›¾ç‰‡ç»„åˆæˆæ–°å›¾ç‰‡ã€‚</li><li><p><code>montage:</code> ç»„åˆå¤šä¸ªç‹¬ç«‹çš„å›¾åƒæ¥åˆ›å»ºåˆæˆå›¾åƒã€‚æ¯ä¸ªå›¾åƒéƒ½å¯ä»¥ç”¨è¾¹æ¡†ï¼Œé€æ˜åº¦ç­‰ç‰¹æ€§è¿›è¡Œè£…é¥°ã€‚</p></li><li><p><code>compare:</code> ä»æ•°å­¦å’Œè§†è§‰è§’åº¦æ¯”è¾ƒæºå›¾åƒä¸é‡å»ºå›¾åƒä¹‹é—´çš„å·®å¼‚ã€‚</p></li><li><code>display:</code>åœ¨ä»»ä½• X server ä¸Šæ˜¾ç¤ºä¸€ä¸ªå›¾åƒæˆ–å›¾åƒåºåˆ—ã€‚</li><li><code>animate:</code> åœ¨ä»»ä½• X server ä¸Šæ˜¾ç¤ºå›¾åƒåºåˆ—ã€‚</li><li><code>import:</code> ä¿å­˜ X server ä¸Šçš„ä»»ä½•å¯è§çª—å£å¹¶æŠŠå®ƒä½œä¸ºå›¾åƒæ–‡ä»¶è¾“å‡ºã€‚å¯ä»¥æ•æ‰å•ä¸ªçª—å£ï¼Œæ•´ä¸ªå±å¹•æˆ–å±å¹•çš„ä»»æ„çŸ©å½¢éƒ¨åˆ†ã€‚</li><li><code>conjure:</code>è§£é‡Šå¹¶æ‰§è¡Œ MSL ( Magick Scripting Language ) å†™çš„è„šæœ¬ã€‚</li><li><code>stream:</code> ä¸€ä¸ªè½»é‡çº§å·¥å…·ï¼Œç”¨äºå°†å›¾åƒæˆ–éƒ¨åˆ†å›¾åƒçš„ä¸€ä¸ªæˆ–å¤šä¸ªåƒç´ ç»„ä»¶æµå¼ä¼ è¾“åˆ°å­˜å‚¨è®¾å¤‡ã€‚åœ¨å¤„ç†å¤§å›¾åƒæˆ–åŸå§‹åƒç´ ç»„ä»¶æ—¶å¾ˆæœ‰ç”¨ã€‚</li></ul><h2 id="2ã€å‘½ä»¤æ ¼å¼"><a href="#2ã€å‘½ä»¤æ ¼å¼" class="headerlink" title="2ã€å‘½ä»¤æ ¼å¼"></a>2ã€å‘½ä»¤æ ¼å¼</h2><p>åŸºæœ¬å‘½ä»¤çš„ä½¿ç”¨ï¼Œéµå¾ª Unix é£æ ¼çš„æ ‡å‡†æ ¼å¼ï¼Œä¾‹å¦‚  <code>command [options] input_image output_image</code></p><blockquote><p>å°†ä¸€å¼ å®½é«˜ 300x300 çš„å›¾ç‰‡ goods.png è½¬æ¢æˆ 200x200 çš„goods.jpgï¼Œå¯ä»¥è¿™æ ·ç”¨</p></blockquote><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">convert -resize <span class="number">200</span>x200 goods.png goods.jpg</span><br></pre></td></tr></table></figure><hr><h1 id="å¼€å§‹ç»˜åˆ¶ç”Ÿæˆå›¾ç‰‡"><a href="#å¼€å§‹ç»˜åˆ¶ç”Ÿæˆå›¾ç‰‡" class="headerlink" title="å¼€å§‹ç»˜åˆ¶ç”Ÿæˆå›¾ç‰‡"></a>å¼€å§‹ç»˜åˆ¶ç”Ÿæˆå›¾ç‰‡</h1><h2 id="ä¸€äº›å‰æœŸå‚æ•°"><a href="#ä¸€äº›å‰æœŸå‚æ•°" class="headerlink" title="ä¸€äº›å‰æœŸå‚æ•°"></a>ä¸€äº›å‰æœŸå‚æ•°</h2><h3 id="1ã€å…¥å‚"><a href="#1ã€å…¥å‚" class="headerlink" title="1ã€å…¥å‚"></a>1ã€å…¥å‚</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$item_img='https://img.alicdn.com/bao/uploaded/i1/1750208593/TB1rgM3hhtnkeRjSZSgXXXAuXXa_!!0-item_pic.jpg';</span><br><span class="line">$item_title='æµ‹è¯•å­—ä½“';</span><br><span class="line">$shop_title='æµ‹è¯•åº—é“º';</span><br><span class="line">$shop_img='http://q.aiyongbao.com/item/web/images/qap_img/mobile/userAvatar.png';</span><br><span class="line">$qr_img='https://img.alicdn.com/tfscom/TB1uJDStYZnBKNjSZFKwu3GOVXa.png';</span><br><span class="line">$numid_share='0000000';</span><br><span class="line">$qr_title='é•¿æŒ‰è¯†åˆ«äºŒç»´ç ';</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹å®è´æ ‡é¢˜è£å‰ª</span></span><br><span class="line">$drawtitone=mb_substr($item_title,0,13, 'utf-8');</span><br><span class="line">$drawtittow=mb_substr($item_title,13,13, 'utf-8');</span><br><span class="line">$drawtitthree=mb_substr($item_title,26,13, 'utf-8');</span><br><span class="line">$time_date = time(); <span class="comment">// æ—¶é—´æˆ³</span></span><br><span class="line">$workDir = '/data/tmp/'.$numid_share.'_con'.$time_date; // ç›®æ ‡è·¯å¾„----&gt;æŒ‡å®šä¸€ä¸ªæ–‡ä»¶å¤¹ä¿å­˜ç”Ÿæˆå›¾ç‰‡è¿‡ç¨‹é‡Œçš„å›¾ç‰‡</span><br></pre></td></tr></table></figure><h3 id="2ã€å…ˆä¸‹è½½ç´ ææ–‡ä»¶"><a href="#2ã€å…ˆä¸‹è½½ç´ ææ–‡ä»¶" class="headerlink" title="2ã€å…ˆä¸‹è½½ç´ ææ–‡ä»¶"></a>2ã€å…ˆä¸‹è½½ç´ ææ–‡ä»¶</h3><p>æˆ‘ä»¬è¿™é‡Œéœ€è¦ä¸€ä¸ªæ‹¼æ¥å›¾ç‰‡çš„é“¾æ¥ï¼Œæ‰€ä»¥å…ˆä¸‹è½½åˆ°ä¹‹å‰çš„åˆ›å»ºçš„æ–‡ä»¶å¤¹ä¸‹ï¼Œå› ä¸ºè¿™äº›ç´ æå›¾ç‰‡åªæ˜¯ä¸ºäº†æœ€åçš„æ‹¼æ¥ï¼Œæœ€åå¯ä»¥å®Œå…¨åˆ é™¤ã€‚<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$item_img_down = $workDir<span class="number">.'</span>/itemimage.jpg';</span><br><span class="line">$shop_img_down = $workDir<span class="number">.'</span>/shopimage.jpg';</span><br><span class="line">$qr_img_down = $workDir<span class="number">.'</span>/qrimage.jpg';</span><br><span class="line"><span class="comment">// ä¸‹è½½å®è´ä¸»å›¾</span></span><br><span class="line">\NetworkUtils::curlDownload($item_img, $item_img_down);</span><br><span class="line"><span class="comment">// ä¸‹è½½åº—é“ºå›¾ç‰‡</span></span><br><span class="line">\NetworkUtils::curlDownload($shop_img, $shop_img_down);</span><br><span class="line"><span class="comment">// ä¸‹è½½äºŒç»´ç </span></span><br><span class="line">\NetworkUtils::curlDownload($qr_img, $qr_img_down);</span><br></pre></td></tr></table></figure></p><p><code>\NetworkUtils::curlDownload($item_img, $item_img_down);</code> ä¸‹è½½<code>$item_img</code>ä¿å­˜åœ¨ç›®æ ‡è·¯å¾„æ–‡ä»¶å¤¹ä¸‹çš„<code>$workDir.&#39;/itemimage.jpg&#39;</code>è·¯å¾„ã€‚</p><h3 id="3ã€æŒ‡å®šå­—ä½“å’Œé¢œè‰²"><a href="#3ã€æŒ‡å®šå­—ä½“å’Œé¢œè‰²" class="headerlink" title="3ã€æŒ‡å®šå­—ä½“å’Œé¢œè‰²"></a>3ã€æŒ‡å®šå­—ä½“å’Œé¢œè‰²</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$fontFamily = '/usr/share/fonts/chinese/msyh.ttf';</span><br><span class="line">$fontColor = '#333333';</span><br><span class="line">$fontColor_shoptitle = '#999999';</span><br><span class="line">$fontColor_qrtitlt = '#666666';</span><br></pre></td></tr></table></figure><h3 id="4ã€åˆ›å»ºä¸€ä¸ªåº•å›¾"><a href="#4ã€åˆ›å»ºä¸€ä¸ªåº•å›¾" class="headerlink" title="4ã€åˆ›å»ºä¸€ä¸ªåº•å›¾"></a>4ã€åˆ›å»ºä¸€ä¸ªåº•å›¾</h3><p>åˆ›å»ºä¸€ä¸ª<code>750x1046</code>ç™½è‰²çš„åº•å›¾ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸Šé¢ç»˜åˆ¶æ–‡å­—</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªåº•å›¾(å¹¶ä¸”åŠ ä¸Šä¸€äº›æ–‡å­—)</span></span><br><span class="line"></span><br><span class="line">$back_img=$workDir<span class="number">.'</span>/bg.jpg'; <span class="comment">//è¦ç”Ÿæˆçš„å›¾ç‰‡çš„è·¯å¾„----&gt;å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯çœ‹åˆ°</span></span><br><span class="line">$back_cmds=<span class="string">"convert 'xc:[750x1046!]' -background white -font &#123;$fontFamily&#125; -draw 'text 580,994 \"&#123;$qr_title&#125;\"' -fill \"&#123;$fontColor_qrtitlt&#125;\" </span></span><br><span class="line"><span class="string">            -pointsize 20 -draw 'text 114,990 \"&#123;$shop_title&#125;\"' -font &#123;$fontFamily&#125; -pointsize 22 -fill '#999999' &#123;$workDir&#125;/bg.jpg"</span>;</span><br><span class="line">$result_back_cmds = \SystemCommon::runningCmd($back_cmds);</span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸‹æ–‡å­—çš„ç»˜åˆ¶å‘½ä»¤é¡ºåºï¼Œå¦åˆ™ä¼šå‡ºç°æ²¡æœ‰ç”Ÿæ•ˆçš„é—®é¢˜ã€‚<br><code>-font {$fontFamily} -draw &#39;text 580,994 \&quot;{$qr_title}\&quot;&#39; -fill \&quot;{$fontColor_qrtitlt}\&quot; -pointsize 20</code></p></blockquote><p>è§£é‡Šä¸€ä¸‹ï¼š</p><ul><li><code>xc:[100x40!]</code>: è®¾ç½®ç”»å¸ƒå¤§å°çš„ä¸€ç§ç®€å†™æ–¹å¼ï¼Œæ–¹æ‹¬å·é‡Œå†™å…¥ç”»å¸ƒå®½é«˜ï¼Œæ³¨æ„è¦åŠ  !</li><li><code>-fill &#39;rgba(0, 0, 0, 0)&#39;</code>ï¼šè®¾ç½®äº†æ–‡æœ¬çš„å¡«å……é¢œè‰²</li><li><code>text 114,990</code>: å¯¹æ–‡å­—è¿›è¡Œå®šä½</li><li><code>-font</code>ï¼šæŒ‡å®šå­—ä½“</li><li><code>-pointsize</code>ï¼šæŒ‡å®šæ–‡æœ¬çš„å­—ä½“å¤§å°</li><li><code>-draw</code>ï¼šç»˜å›¾é€‰é¡¹ï¼Œtext å£°æ˜ç»˜åˆ¶æ–‡æœ¬ï¼Œ 0,0 å£°æ˜æ–‡æœ¬è·ç¦»å›¾ç‰‡å·¦ä¸Šè§’çš„åç§»å€¼ï¼Œç»˜åˆ¶æ–‡æœ¬çš„æ ¼å¼ä¸º text x,y stringï¼Œå½“ç„¶è¿˜å¯ä»¥ç»˜åˆ¶å…¶ä»–ç±»å‹ï¼Œè¯¸å¦‚åœ† ( circle )ã€æŠ˜çº¿ ( polyline )</li></ul><p>ç»§ç»­æ·»åŠ æ–‡å­—ï¼š</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$back_img_shoptitle=$workDir<span class="number">.'</span>/btitle.jpg'; <span class="comment">//è¦ç”Ÿæˆçš„å›¾ç‰‡çš„è·¯å¾„</span></span><br><span class="line">$back_cmds_shoptitle=<span class="string">"convert -draw 'text 40,820 \"&#123;$drawtitone&#125;\"' -font &#123;$fontFamily&#125; -pointsize 32 -fill \"&#123;$fontColor&#125;\" -draw 'text 40,866 \"&#123;$drawtittow&#125;\"' </span></span><br><span class="line"><span class="string">                    -font &#123;$fontFamily&#125; -pointsize 32 -fill \"&#123;$fontColor&#125;\" -draw 'text 40,912 \"&#123;$drawtitthree&#125;\"' -font &#123;$fontFamily&#125; -pointsize 32 -fill \"&#123;$fontColor&#125;\"  </span></span><br><span class="line"><span class="string">                    &#123;$back_img&#125; &#123;$workDir&#125;/btitle.jpg"</span>;</span><br><span class="line">$result_back_cmds_shoptitle = \SystemCommon::runningCmd($back_cmds_shoptitle);</span><br></pre></td></tr></table></figure><p>æ•ˆæœï¼š</p><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/php/php_convert_6.png" alt="convert"></p><h3 id="5ã€æ‹¼æ¥å›¾ç‰‡"><a href="#5ã€æ‹¼æ¥å›¾ç‰‡" class="headerlink" title="5ã€æ‹¼æ¥å›¾ç‰‡"></a>5ã€æ‹¼æ¥å›¾ç‰‡</h3><p>ç°åœ¨å°±å¯ä»¥åœ¨ä¹‹å‰å¾—åˆ°çš„å›¾ç‰‡ä¸Šæ‹¼æ¥æ‰€éœ€è¦çš„å›¾ç‰‡äº†</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// åœ¨åº•å›¾ä¸Šåˆå¹¶å•†å“ä¸»å›¾</span></span><br><span class="line">$back_img_itemimg='/data/tmp/' . md5(microtime(true)).'.jpg';  //è¦ç”Ÿæˆçš„å›¾ç‰‡çš„è·¯å¾„</span><br><span class="line">$geometryX = <span class="string">"+"</span> . <span class="number">0</span>; <span class="comment">// å®šä½</span></span><br><span class="line">$geometryY = <span class="string">"+"</span> . <span class="number">0</span>; <span class="comment">// å®šä½</span></span><br><span class="line">$customPicPos = <span class="string">"northwest"</span>;</span><br><span class="line">$back_cmds_itemimg = <span class="string">"convert &#123;$back_img_shoptitle&#125; &#123;$workDir&#125;/item_img_mag.jpg -gravity &#123;$customPicPos&#125; -geometry &#123;$geometryX&#125;&#123;$geometryY&#125; </span></span><br><span class="line"><span class="string">                    -compose over -composite -antialias -set colorspace sRGB -colorspace sRGB &#123;$workDir&#125;/result.jpg"</span>;</span><br><span class="line">$result_back_cmds_itemimg = \SystemCommon::runningCmd($back_cmds_itemimg);</span><br></pre></td></tr></table></figure><p>è§£é‡Šä¸€ä¸‹ï¼š</p><ul><li><code>-geometry</code>: è®¾ç½®æ–‡æœ¬åœ¨å›¾ç‰‡é‡Œçš„æ’åˆ—æ–¹å¼ ( ç±»ä¼¼ CSS é‡Œçš„ align-items + justify-content )ï¼Œcenter è¡¨ç¤ºæ°´å¹³å‚ç›´éƒ½å±…ä¸­ï¼Œå…¶ä»–å€¼è¿˜å¯ä»¥æ˜¯ï¼šNorthWest, North, NorthEast, West, East, SouthWest, South, SouthEastï¼Œä¸è®°å¤§å°å†™</li><li><code>composite</code>: å°†ä¸€ä¸ªå›¾ç‰‡æˆ–å¤šä¸ªå›¾ç‰‡ç»„åˆæˆæ–°å›¾ç‰‡ã€‚</li></ul><p>è¿™é‡Œæ˜¯æŠŠ<code>{$workDir}/item_img_mag.jpg</code>è·¯å¾„çš„å›¾ç‰‡ç»˜åˆ¶åˆ°ä¹‹å‰ç»˜åˆ¶æ–‡å­—çš„å›¾ç‰‡ä¸Š<code>$back_img_shoptitle</code>ï¼Œæœ€ç»ˆå¾—åˆ°çš„å›¾ç‰‡ä¿å­˜è·¯å¾„æ˜¯åœ¨<code>{$workDir}/result.jpg</code></p><p>è®©æˆ‘ä»¬ç»§ç»­æ“ä½œå›¾ç‰‡</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆå¹¶äºŒç»´ç  </span></span><br><span class="line">$geometryXshop = <span class="string">"+"</span> . <span class="number">40</span>;</span><br><span class="line">$geometryYshop = <span class="string">"+"</span> . <span class="number">950</span>;</span><br><span class="line">$back_cmds_shopimg = <span class="string">"convert &#123;$workDir&#125;/result.jpg &#123;$workDir&#125;/shop_img_mag.jpg -gravity &#123;$customPicPos&#125; -geometry &#123;$geometryXshop&#125;&#123;$geometryYshop&#125; -compose over -composite -antialias -set colorspace sRGB -colorspace sRGB &#123;$workDir&#125;/result1.jpg"</span>;</span><br><span class="line">$result_back_cmds_shopimg = \SystemCommon::runningCmd($back_cmds_shopimg);  </span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå¹¶åº—é“ºå›¾æ ‡</span></span><br><span class="line">$geometryXqr = <span class="string">"+"</span> . <span class="number">520</span>;</span><br><span class="line">$geometryYqr = <span class="string">"+"</span> . <span class="number">784</span>;</span><br><span class="line">$back_cmds_qrimg = <span class="string">"convert &#123;$workDir&#125;/result1.jpg &#123;$workDir&#125;/qr_img_mag.jpg -gravity &#123;$customPicPos&#125; -geometry &#123;$geometryXqr&#125;&#123;$geometryYqr&#125; -compose over -composite -antialias -set colorspace sRGB -colorspace sRGB &#123;$workDir&#125;/result2.jpg"</span>;</span><br><span class="line">$result_back_cmds_qrimg = \SystemCommon::runningCmd($back_cmds_qrimg);</span><br></pre></td></tr></table></figure><p>æ•ˆæœï¼š</p><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/php/php_convert_7.png" alt="convert"></p><p>å‘ç°å›¾ç‰‡å¹¶ä¸æ˜¯æˆ‘ä»¬é¢„æœŸçš„æ•ˆæœï¼Œæ‹¼æ¥æˆ‘ä»¬ä¹Ÿè®¾ç½®äº†å›¾ç‰‡çš„å¤§å°ï¼Œä½†æ˜¯æ²¡æœ‰èµ·ä½œç”¨ï¼Œå°è¯•è¿‡ä¸åŒçš„æ–¹æ¡ˆåå†³å®šåœ¨æ‹¼æ¥ä¹‹å‰æŠŠå›¾ç‰‡ç»Ÿä¸€æ”¾å¤§ä¸ºéœ€è¦æ‹¼æ¥çš„å°ºå¯¸æ¥æ“ä½œã€‚</p><h3 id="6ã€æ”¾å¤§æ‹¼æ¥å›¾ç‰‡å°ºå¯¸"><a href="#6ã€æ”¾å¤§æ‹¼æ¥å›¾ç‰‡å°ºå¯¸" class="headerlink" title="6ã€æ”¾å¤§æ‹¼æ¥å›¾ç‰‡å°ºå¯¸"></a>6ã€æ”¾å¤§æ‹¼æ¥å›¾ç‰‡å°ºå¯¸</h3><p>éœ€è¦å¯¹å¤šæ‹¼æ¥çš„å›¾ç‰‡éƒ½è¿›è¡Œæ“ä½œ</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// çœ‹æ¥éœ€è¦å…ˆæ”¾å¤§ä¸»å›¾</span></span><br><span class="line">$item_img_m=<span class="string">"convert -resize '750x766!' &#123;$item_img_down&#125; &#123;$workDir&#125;/item_img_mag.jpg"</span>;</span><br><span class="line">$item_img_mag = \SystemCommon::runningCmd($item_img_m);  </span><br><span class="line"><span class="comment">// çœ‹æ¥éœ€è¦å…ˆæ”¾å¤§äºŒç»´ç </span></span><br><span class="line">$shop_img_m=<span class="string">"convert -resize 64x64 &#123;$shop_img_down&#125; &#123;$workDir&#125;/shop_img_mag.jpg"</span>;</span><br><span class="line">$shop_img_mag = \SystemCommon::runningCmd($shop_img_m);  </span><br><span class="line"><span class="comment">// çœ‹æ¥éœ€è¦å…ˆæ”¾å¤§åº—é“ºå›¾æ ‡</span></span><br><span class="line">$qr_img_m=<span class="string">"convert -resize 200x200 &#123;$qr_img_down&#125; &#123;$workDir&#125;/qr_img_mag.jpg"</span>;</span><br><span class="line">$qr_img_mag = \SystemCommon::runningCmd($qr_img_m);</span><br></pre></td></tr></table></figure><blockquote><p>-resize å»¶ä¼¸è§£è¯»</p></blockquote><p> IamgeMagick æä¾›äº†å‡ ç§ç¬¦å·æ¥å®šä¹‰ç¼©æ”¾</p> <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">convert -resize '150x100!' goods.jpg thumbnail.jpg</span><br><span class="line"></span><br><span class="line">convert -resize '150x100&gt;' goods.jpg thumbnail.jpg</span><br><span class="line"></span><br><span class="line">convert -resize '150x100&lt;' goods.jpg thumbnail.jpg</span><br></pre></td></tr></table></figure><ul><li><code>!</code>ï¼šä¸ç®¡å›¾ç‰‡å®½é«˜å¦‚ä½•ï¼Œéƒ½ç¼©æ”¾æˆ 150x100 è¿™æ ·çš„å°ºå¯¸ã€‚</li><li><code>&gt;</code>ï¼šåªæœ‰å®½é«˜å‡å¤§äº 150x100 çš„å›¾ç‰‡æ‰ç¼©æ”¾æˆè¯¥å°ºå¯¸ ( æŒ‰æ¯”ä¾‹å–æœ€å¤§å€¼ )ï¼Œå°äºçš„å›¾ç‰‡ä¸åšå¤„ç†ã€‚</li><li><code>&lt;</code>ï¼šä¸ &gt; åŠŸèƒ½ç›¸å</li></ul><p>ç¼©æ”¾å¯¹æ¯”</p><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/php/php_convert_1.png" alt="convert"></p><p>è¿™æ ·çš„ç»“æœä¹Ÿä¸æ˜¯æˆ‘ä»¬éœ€è¦çš„<br><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/php/php_convert_4.png" alt="convert"></p><p>åªæœ‰<code>convert -resize &#39;750x766!&#39; {$item_img_down} {$workDir}/item_img_mag.jpg</code>è¿™æ ·å›ºå®šå°ºå¯¸ä¹‹åå¯ä»¥å¾—åˆ°ï¼š</p><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/php/php_convert_5.png" alt="convert"></p><h3 id="7ã€å›¾ç‰‡è½¬æ¢ä¸º-base64æ ¼å¼"><a href="#7ã€å›¾ç‰‡è½¬æ¢ä¸º-base64æ ¼å¼" class="headerlink" title="7ã€å›¾ç‰‡è½¬æ¢ä¸º base64æ ¼å¼"></a>7ã€å›¾ç‰‡è½¬æ¢ä¸º base64æ ¼å¼</h3><p>æˆ‘ä»¬æœ€ååŒæ ·çš„ä»¥base64æ ¼å¼è¾“å‡ºç»™å‰ç«¯</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$<span class="built_in">stdout</span> = trim($result_back_cmds_qrimg[<span class="string">"stdout"</span>]);</span><br><span class="line">$Return = <span class="built_in">array</span>();</span><br><span class="line"><span class="keyword">if</span> (empty($<span class="built_in">stdout</span>) || strpos($result_back_cmds_qrimg[<span class="string">"stderr"</span>], <span class="string">"identify"</span>) != <span class="literal">false</span>) &#123;  <span class="comment">// runningCmdæ‰§è¡ŒæˆåŠŸ</span></span><br><span class="line">    $dest_img = $workDir<span class="number">.'</span>/result2.jpg';</span><br><span class="line">    <span class="comment">// /*å›¾ç‰‡è½¬æ¢ä¸º base64æ ¼å¼ç¼–ç */</span></span><br><span class="line">    $base64_image = '';</span><br><span class="line">    $image_info = getimagesize($dest_img);</span><br><span class="line">    $image_data = fread(fopen($dest_img, <span class="string">'r'</span>), filesize($dest_img));</span><br><span class="line">    $base64_image = 'data:' . $image_info['mime'] . ';base64,' . chunk_split(base64_encode($image_data));</span><br><span class="line"></span><br><span class="line">    $Return['data']=$base64_image;</span><br><span class="line">    $Return['dest_img']=$dest_img;</span><br><span class="line">    $Return['type']='success';</span><br><span class="line">    $Return['msg']=1;</span><br><span class="line">    <span class="keyword">return</span> $Return;</span><br><span class="line">&#125;</span><br><span class="line">$Return['data']='';</span><br><span class="line">$Return['msg']=2;</span><br><span class="line"><span class="keyword">return</span> $Return;</span><br></pre></td></tr></table></figure><p><code>$workDir.&#39;/result2.jpg</code>æ˜¯æˆ‘ä»¬æœ€ç»ˆçš„æ‹¼æ¥å›¾ç‰‡ï¼Œè‡³äºæ–‡ä»¶å¤¹ä¸‹çš„å…¶ä»–å›¾ç‰‡ï¼Œå¯ä»¥é€‰æ‹©åˆ é™¤ã€‚æˆ‘ä»¬åªè¦å¾—åˆ°ç»“æœå°±å¥½äº†ã€‚</p><p>ï¼ˆå°å§å§æ‹¼æ¥å›¾ï¼‰<br><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/php/php_convert_8.png" alt="convert"></p><p>è¿™æ¬¡<code>convertå‘½ä»¤</code>çš„ä»‹ç»æ˜¯ä»¥è§£è¯»æ•´ä¸ªæ–¹æ³•çš„å½¢å¼ï¼Œå¯¹æ‹¼æ¥çš„å¼€å§‹è¿›è¡Œåˆ°ç»“å°¾ç”Ÿæˆæœ€ç»ˆçš„å›¾ç‰‡ï¼Œå¸Œæœ›å¯¹å¤§å®¶æœ‰åŠ›æ‰€èƒ½åŠçš„å¸®åŠ©ã€‚</p><p>æ¬¢è¿å…‰é¡¾ä¸ªäºº<a href="https://duanruilong.github.io/blog">Blog</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ImageMagick åŒ…æ‹¬ä¸€ç»„å‘½ä»¤è¡Œå·¥å…·æ¥æ“ä½œå›¾ç‰‡ï¼Œä¹‹å‰çš„ImageMagickå®ç°base64å›¾ç‰‡çš„é€»è¾‘åœ¨æœåŠ¡å™¨ç«¯å¯èƒ½ä¼šé€ æˆæº¢å‡ºçš„äº‹æ•…ï¼Œæ‰€ä»¥åœ¨æ¥ä¸‹çš„æ–‡ç« é‡Œä¼šä»‹ç»å¦å¤–ä¸€ç§å¥½çš„å®ç°æ–¹å¼å°±æ˜¯â€”-convertå‘½ä»¤ã€‚ä½¿ç”¨å‘½ä»¤æ ¼å¼çš„å½¢å¼å»ç”Ÿæˆå›¾ç‰‡å’Œå¤§å°çš„è£å‰ªæ•°æ®æ ¼å¼çš„è½¬æ¢ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/php.jpg&quot; alt=&quot;PHP&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="åç«¯" scheme="https://duanruilong.github.io/categories/%E5%90%8E%E7%AB%AF/"/>
    
    
      <category term="ç¼–ç¨‹" scheme="https://duanruilong.github.io/tags/%E7%BC%96%E7%A8%8B/"/>
    
      <category term="PHP" scheme="https://duanruilong.github.io/tags/PHP/"/>
    
      <category term="åç«¯" scheme="https://duanruilong.github.io/tags/%E5%90%8E%E7%AB%AF/"/>
    
  </entry>
  
  <entry>
    <title>åœ¨PHPé‡Œä½¿ç”¨ImageMagickç”Ÿæˆbase64å›¾ç‰‡</title>
    <link href="https://duanruilong.github.io/2018/09/05/%E5%9C%A8PHP%E9%87%8C%E5%BE%88%E5%A5%BD%E7%9A%84%E4%BD%BF%E7%94%A8ImageMagick/"/>
    <id>https://duanruilong.github.io/2018/09/05/åœ¨PHPé‡Œå¾ˆå¥½çš„ä½¿ç”¨ImageMagick/</id>
    <published>2018-09-04T16:08:37.000Z</published>
    <updated>2018-09-17T15:58:32.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘çš„PHPé¡¹ç›®ä¸­ï¼Œéœ€è¦ç”¨åˆ°ç”»å›¾å’Œå›¾ç‰‡æ‹¼æ¥æ•ˆæœï¼Œè¿™é‡Œæ˜¯ä¸€äº›å¼€å‘è¿‡ç¨‹é‡Œç”¨åˆ°çš„ä¸€äº›ç‚¹è¿˜æœ‰å°±æ˜¯ä¸€äº›è¸©è¿‡çš„å‘ã€‚é€šè¿‡ImageMagickç”Ÿæˆbase64å›¾ç‰‡æ ¼å¼ï¼Œä¸ºå‰ç«¯æ‰€ä½¿ç”¨ã€‚</p><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/php.jpg" alt="PHP"></p><a id="more"></a><blockquote><p>ä¸€äº›éœ€è¦çš„çŸ¥è¯†ç‚¹</p></blockquote><h1 id="PHPå°†å›¾ç‰‡è½¬base64ç¼–ç ä»¥åŠbase64å›¾ç‰‡è½¬æ¢ä¸ºå›¾ç‰‡å¹¶ä¿å­˜ä»£ç "><a href="#PHPå°†å›¾ç‰‡è½¬base64ç¼–ç ä»¥åŠbase64å›¾ç‰‡è½¬æ¢ä¸ºå›¾ç‰‡å¹¶ä¿å­˜ä»£ç " class="headerlink" title="PHPå°†å›¾ç‰‡è½¬base64ç¼–ç ä»¥åŠbase64å›¾ç‰‡è½¬æ¢ä¸ºå›¾ç‰‡å¹¶ä¿å­˜ä»£ç "></a>PHPå°†å›¾ç‰‡è½¬base64ç¼–ç ä»¥åŠbase64å›¾ç‰‡è½¬æ¢ä¸ºå›¾ç‰‡å¹¶ä¿å­˜ä»£ç </h1><h2 id="å›¾ç‰‡è½¬base64ç¼–ç "><a href="#å›¾ç‰‡è½¬base64ç¼–ç " class="headerlink" title="å›¾ç‰‡è½¬base64ç¼–ç "></a>å›¾ç‰‡è½¬base64ç¼–ç </h2><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/*å›¾ç‰‡è½¬æ¢ä¸º base64æ ¼å¼ç¼–ç */</span></span><br><span class="line">$img = 'uploads/about.png';</span><br><span class="line">$base64_img = base64EncodeImage($img);</span><br><span class="line">echo '&lt;img src="' . $base64_img . '" /&gt;';</span><br><span class="line"> </span><br><span class="line"><span class="function">function <span class="title">base64EncodeImage</span> <span class="params">($image_file)</span> </span>&#123;</span><br><span class="line">    $base64_image = '';</span><br><span class="line">    $image_info = getimagesize($image_file);</span><br><span class="line">    $image_data = fread(fopen($image_file, <span class="string">'r'</span>), filesize($image_file));</span><br><span class="line">    $base64_image = 'data:' . $image_info['mime'] . ';base64,' . chunk_split(base64_encode($image_data));</span><br><span class="line">    <span class="keyword">return</span> $base64_image;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="base64å›¾ç‰‡è½¬æ¢ä¸ºå›¾ç‰‡å¹¶ä¿å­˜"><a href="#base64å›¾ç‰‡è½¬æ¢ä¸ºå›¾ç‰‡å¹¶ä¿å­˜" class="headerlink" title="base64å›¾ç‰‡è½¬æ¢ä¸ºå›¾ç‰‡å¹¶ä¿å­˜"></a>base64å›¾ç‰‡è½¬æ¢ä¸ºå›¾ç‰‡å¹¶ä¿å­˜</h2><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*  base64æ ¼å¼ç¼–ç è½¬æ¢ä¸ºå›¾ç‰‡å¹¶ä¿å­˜å¯¹åº”æ–‡ä»¶å¤¹ */</span></span><br><span class="line"><span class="function">function <span class="title">base64_image_content</span><span class="params">($base64_image_content,$path)</span></span>&#123;</span><br><span class="line">    <span class="comment">//åŒ¹é…å‡ºå›¾ç‰‡çš„æ ¼å¼</span></span><br><span class="line">    if (preg_match('/^(data:\s*image\/(\w+);base64,)/', $base64_image_content, $result))&#123;</span><br><span class="line">        $type = $result[<span class="number">2</span>];</span><br><span class="line">        $new_file = $path."/".date('Ymd',time())."/";</span><br><span class="line">        <span class="keyword">if</span>(!file_exists($new_file))&#123;</span><br><span class="line">            <span class="comment">//æ£€æŸ¥æ˜¯å¦æœ‰è¯¥æ–‡ä»¶å¤¹ï¼Œå¦‚æœæ²¡æœ‰å°±åˆ›å»ºï¼Œå¹¶ç»™äºˆæœ€é«˜æƒé™</span></span><br><span class="line">            mkdir($new_file, <span class="number">0700</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        $new_file = $new_file.time().<span class="string">".&#123;$type&#125;"</span>;</span><br><span class="line">        if (file_put_contents($new_file, base64_decode(str_replace($result[1], '', $base64_image_content))))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">'/'</span>.$new_file;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function">echo <span class="title">base64_image_content</span><span class="params">($base64_img,<span class="string">"uploads/"</span>)</span></span>;</span><br></pre></td></tr></table></figure><h1 id="base64"><a href="#base64" class="headerlink" title="base64"></a>base64</h1><p>Base64æ˜¯ä¸€ç§ç”¨64ä¸ªå­—ç¬¦æ¥è¡¨ç¤ºä»»æ„äºŒè¿›åˆ¶æ•°æ®çš„æ–¹æ³•ã€‚<br>Base64çš„åŸç†å¾ˆç®€å•ï¼Œé¦–å…ˆï¼Œå‡†å¤‡ä¸€ä¸ªåŒ…å«64ä¸ªå­—ç¬¦çš„æ•°ç»„ï¼š</p><p><code>[&#39;A&#39;, &#39;B&#39;, &#39;C&#39;, ... &#39;a&#39;, &#39;b&#39;, &#39;c&#39;, ... &#39;0&#39;, &#39;1&#39;, ... &#39;+&#39;, &#39;/&#39;]</code><br>ç„¶åï¼Œå¯¹äºŒè¿›åˆ¶æ•°æ®è¿›è¡Œå¤„ç†ï¼Œæ¯3ä¸ªå­—èŠ‚ä¸€ç»„ï¼Œä¸€å…±æ˜¯3x8=24bitï¼Œåˆ’ä¸º4ç»„ï¼Œæ¯ç»„æ­£å¥½6ä¸ªbit</p><p>å¦‚æœè¦ç¼–ç çš„äºŒè¿›åˆ¶æ•°æ®ä¸æ˜¯3çš„å€æ•°ï¼Œæœ€åä¼šå‰©ä¸‹1ä¸ªæˆ–2ä¸ªå­—èŠ‚æ€ä¹ˆåŠï¼ŸBase64ç”¨\x00å­—èŠ‚åœ¨æœ«å°¾è¡¥è¶³åï¼Œå†åœ¨ç¼–ç çš„æœ«å°¾åŠ ä¸Š1ä¸ªæˆ–2ä¸ª=å·ï¼Œè¡¨ç¤ºè¡¥äº†å¤šå°‘å­—èŠ‚ï¼Œè§£ç çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨å»æ‰ã€‚</p><p>ä½¿ç”¨jpgå›¾ç‰‡ä½“ç§¯è¦æ¯”pngå°<br>ä½¿ç”¨PHPçš„Imagickç±»è¿›è¡Œå›¾åƒçš„æ“ä½œ</p><h1 id="å…·ä½“æ“ä½œ"><a href="#å…·ä½“æ“ä½œ" class="headerlink" title="å…·ä½“æ“ä½œ"></a>å…·ä½“æ“ä½œ</h1><h2 id="1-åˆ›å»ºä¸€ä¸ªåº•å›¾-å®½750pxï¼Œé«˜1046pxï¼Œç™½è‰²èƒŒæ™¯ï¼Œæ ¼å¼ä¸ºjpgçš„å›¾ç‰‡"><a href="#1-åˆ›å»ºä¸€ä¸ªåº•å›¾-å®½750pxï¼Œé«˜1046pxï¼Œç™½è‰²èƒŒæ™¯ï¼Œæ ¼å¼ä¸ºjpgçš„å›¾ç‰‡" class="headerlink" title="(1).åˆ›å»ºä¸€ä¸ªåº•å›¾,å®½750pxï¼Œé«˜1046pxï¼Œç™½è‰²èƒŒæ™¯ï¼Œæ ¼å¼ä¸ºjpgçš„å›¾ç‰‡"></a>(1).åˆ›å»ºä¸€ä¸ªåº•å›¾,å®½750pxï¼Œé«˜1046pxï¼Œç™½è‰²èƒŒæ™¯ï¼Œæ ¼å¼ä¸ºjpgçš„å›¾ç‰‡</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆå§‹åŒ–ä¸€ä¸ªç”»æ¿</span></span><br><span class="line">        $img =<span class="keyword">new</span> Imagick();</span><br><span class="line">        $img-&gt;newImage(750,1046,'white','jpg') ;</span><br></pre></td></tr></table></figure><h2 id="2-åœ¨åº•å›¾ä¸Šæ·»åŠ éœ€æ±‚å›¾ç‰‡"><a href="#2-åœ¨åº•å›¾ä¸Šæ·»åŠ éœ€æ±‚å›¾ç‰‡" class="headerlink" title="(2).åœ¨åº•å›¾ä¸Šæ·»åŠ éœ€æ±‚å›¾ç‰‡"></a>(2).åœ¨åº•å›¾ä¸Šæ·»åŠ éœ€æ±‚å›¾ç‰‡</h2><p>å‰ææ˜¯æˆ‘ä»¬å·²ç»çŸ¥é“äº†éœ€è¦åˆå¹¶çš„å›¾ç‰‡é“¾æ¥åœ°å€<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">$item_img='https://img.alicdn.com/bao/uploaded/i1/1750208593/TB1rgM3hhtnkeRjSZSgXXXAuXXa_!!0-item_pic.jpg'</span><br><span class="line"></span><br><span class="line">ç¬¬ä¸€æ­¥ï¼šå®ä¾‹åŒ–å›¾ç‰‡</span><br><span class="line">$imgtwo = <span class="keyword">new</span> Imagick($item_img);</span><br><span class="line"></span><br><span class="line">ç¬¬äºŒæ­¥ï¼šè®¾ç½®æ·»åŠ å›¾ç‰‡çš„å¤§å°</span><br><span class="line">$imgtwo-&gt;resizeImage(<span class="number">750</span>,<span class="number">764</span>,Imagick::FILTER_LANCZOS,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">å…³äºresizeImageå‚æ•°è¯´æ˜</span><br><span class="line">    <span class="keyword">bool</span> Imagick::resizeImage ( <span class="keyword">int</span> $columns , <span class="keyword">int</span> $rows , <span class="keyword">int</span> $filter , <span class="keyword">float</span> $blur [, <span class="keyword">bool</span> $bestfit = <span class="literal">false</span> ] )</span><br><span class="line"></span><br><span class="line">å‚æ•°ï¼š</span><br><span class="line">  â— columns å›¾ç‰‡çš„å®½åº¦</span><br><span class="line">  â— rows å›¾ç‰‡é«˜åº¦</span><br><span class="line">  â— filter è¿‡æ»¤å™¨ï¼Œç”¨äºè¿‡æ»¤å›¾ç‰‡ï¼Œæœ‰é«˜æ–¯filteæ ¹æ®æƒ…å†µè€Œå®š</span><br><span class="line">  â— blur blur=<span class="number">1</span> ä¸ºè™šåŒ–ï¼Œ blur =<span class="number">-1</span> ä¸ºé”åŒ–</span><br><span class="line"></span><br><span class="line">ç¬¬ä¸‰æ­¥ï¼šä¸åº•å›¾åˆå¹¶</span><br><span class="line">$img-&gt;compositeImage($imgtwo,$imgtwo-&gt;getImageCompose(),<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">ä½¿ç”¨compositeImage();</span><br><span class="line">    <span class="keyword">bool</span> Imagick::compositeImage ( Imagick $composite_object , <span class="keyword">int</span> $composite , <span class="keyword">int</span> $x , <span class="keyword">int</span> $y [, <span class="keyword">int</span> $channel = Imagick::CHANNEL_ALL ] )</span><br><span class="line"></span><br><span class="line">å‚æ•°ï¼š</span><br><span class="line">  â— composite_object ï¼šç”¨äºåˆå¹¶çš„å›¾ç‰‡çš„Imagickå¯¹è±¡</span><br><span class="line">  â— compositeï¼šåˆå¹¶æ“ä½œï¼Œå®šä¹‰æ“ä½œå¸¸é‡ã€‚ å…·ä½“è¯·æŸ¥çœ‹ åˆå¹¶æ“ä½œå¸¸é‡åˆ—è¡¨</span><br><span class="line">  â— xï¼šç›¸å¯¹å›¾åƒé¡¶ç‚¹å·¦ä¸Šä½ç½®ï¼ˆ<span class="number">0</span>,<span class="number">0</span>ï¼‰çš„æ¨ªåæ ‡</span><br><span class="line">  â— yï¼šç›¸å¯¹å›¾åƒé¡¶ç‚¹å·¦ä¸Šä½ç½®ï¼ˆ<span class="number">0</span>,<span class="number">0</span>ï¼‰çš„çºµåæ ‡</span><br><span class="line">  â— channelï¼šé€šè¿‡ä¼ å…¥ä¸€ä¸ªé€šé“å¸¸é‡ï¼Œæ¥å¼€å¯é€šé“æ¨¡å¼ã€‚ä¸ºäº†æ”¯æŒå¤šä¸ªé€šé“ï¼Œå¯ä»¥é€šè¿‡äºŒè¿›åˆ¶è¿ç®—çš„æ“ä½œæ¥åˆå¹¶å¤šä¸ªé€šé“å¸¸é‡ã€‚</span><br><span class="line"></span><br><span class="line">åˆ°è¿™é‡Œå°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªåˆå¹¶çš„å›¾ç‰‡äº†</span><br><span class="line"><span class="number">1</span>ã€åŠ ä¸€ä¸ªheaderä¿¡æ¯ï¼Œå¯ä»¥ç›´æ¥åœ¨ç½‘é¡µä¸ŠæŸ¥çœ‹å›¾ç‰‡</span><br><span class="line">    header(<span class="string">"Content-Type: img/png"</span>);</span><br><span class="line">    echo $img;</span><br><span class="line"><span class="number">2</span>ã€å¯ä»¥æŠŠå›¾ç‰‡åœ¨æŒ‡å®šç›®å½•ä¸­ç”Ÿæˆï¼Œåœ¨æŒ‡å®šç›®å½•ä¸‹ç”Ÿæˆä¸ºimg.png</span><br><span class="line">$file=<span class="string">"./img.png"</span>;</span><br><span class="line">$img-&gt;writeImage($file);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">æˆ‘è¿™é‡Œæ˜¯è¿™æ ·å¤„ç†ï¼š</span><br><span class="line">    header ( 'Content-type: ' . strtolower ($img-&gt;getImageFormat ()) );</span><br><span class="line">    $type = strtolower($img-&gt;getImageFormat());</span><br><span class="line">    $dest_img='/data/tmp/' . md5(microtime(true)).'.'.$type;    //è¦ç”Ÿæˆçš„å›¾ç‰‡çš„è·¯å¾„ï¼Œéšæœºç”Ÿæˆå›¾ç‰‡åç§°</span><br></pre></td></tr></table></figure></p><h2 id="3-å›¾ç‰‡ä¸Šæ‹¼æ¥æ–‡å­—"><a href="#3-å›¾ç‰‡ä¸Šæ‹¼æ¥æ–‡å­—" class="headerlink" title="(3).å›¾ç‰‡ä¸Šæ‹¼æ¥æ–‡å­—"></a>(3).å›¾ç‰‡ä¸Šæ‹¼æ¥æ–‡å­—</h2><p>å†™å…¥æ–‡å­—ä»¥æ·»åŠ åº—é“ºæ–‡å­—ä¸ºä¾‹ï¼Œé€æ­¥å®Œæˆæ–‡å­—çš„å†™å…¥ã€‚<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$shop_title='æµ‹è¯•åº—é“º'ï¼›</span><br><span class="line"><span class="comment">// æ·»åŠ åº—é“ºæ–‡å­—</span></span><br><span class="line">$drawQr = <span class="keyword">new</span> ImagickDraw(); <span class="comment">// å®ä¾‹åŒ–ImagickDraw</span></span><br><span class="line">$drawQr -&gt; setFillColor(new ImagickPixel('#999999')); // é¢œè‰²</span><br><span class="line">$drawQr -&gt; setFontSize('24'); // å¤§å°</span><br><span class="line">$drawQr -&gt; setFont('../../conf/Microsoftyahei.ttf'); // å­—ä½“</span><br><span class="line">$drawQr -&gt; setTextAlignment(Imagick::ALIGN_LEFT); <span class="comment">// å­—ä½“æ–¹å‘</span></span><br><span class="line"><span class="comment">// psï¼š Imagick::ALIGN_RIGHT æœå³è¾¹    Imagick::ALIGN_LEFT å·¦è¾¹   Imagick::ALIGN_CENTER ä¸­é—´</span></span><br><span class="line">$drawQr -&gt; setTextEncoding(<span class="string">"utf-8"</span>); <span class="comment">// å­—ä½“ç¼–ç </span></span><br><span class="line">$drawQr -&gt; annotation(<span class="number">114</span>,<span class="number">990</span>,$shop_title); <span class="comment">// ç”»å‡ºæ–‡å­—</span></span><br><span class="line">$img -&gt; drawImage($drawQr);  <span class="comment">// ç”»åœ¨åœ°æ¿ä¸Š</span></span><br></pre></td></tr></table></figure></p><p>è¯¦ç»†è§£è¯»ï¼š</p><ul><li>1ã€å®ä¾‹åŒ–ImagickDrawç±»ï¼š<br> <code>$drawQr = new ImagickDraw();</code> </li><li>2ã€è®¾ç½®å­—ä½“é¢œè‰²<br><code>$drawQr -&gt; setFillColor(new ImagickPixel(&#39;#999999&#39;));</code></li><li>3ã€è®¾ç½®å­—ä½“å¤§å°<br><code>$drawQr -&gt; setFontSize(&#39;24&#39;);</code></li><li>4ã€è®¾ç½®å­—ä½“æ ¼å¼<br><code>$drawQr -&gt; setFont(&#39;../../conf/Microsoftyahei.ttf&#39;);</code></li><li>5ã€è®¾ç½®å­—ä½“æ–¹å‘<br><code>$draw-&gt;setTextAlignment(Imagick::ALIGN_RIGHT);</code><blockquote><p>psï¼š Imagick::ALIGN_RIGHT æœå³è¾¹    Imagick::ALIGN_LEFT å·¦è¾¹   Imagick::ALIGN_CENTER ä¸­é—´</p></blockquote></li><li>6ã€è®¾ç½®å­—ä½“ç¼–ç <br><code>$drawQr -&gt; setTextEncoding(&quot;utf-8&quot;);</code></li><li>7ã€ç”»å‡ºæ–‡å­—<br><code>$drawQr -&gt; annotation(114,990,$shop_title);</code></li><li>8ã€åœ¨åº•å›¾ä¸Šå†™å…¥å­—ä½“<br><code>$img -&gt; drawImage($drawQr);</code></li></ul><p>å†™å…¥æ–‡å­—è¿™ä¸ªåœ°æ–¹çš„ä¸€äº›å‘ï¼š</p><p>æ²¡æœ‰è®¾ç½®å­—ä½“æ ¼å¼æ—¶ï¼Œä¸­æ–‡å­—ä¼šè§£æé”™è¯¯<br>ï¼ˆè‹±æ–‡æ²¡æœ‰é—®é¢˜ï¼‰<br><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/php/php_megick_1.png" alt="PHP"></p><p>ï¼ˆæ±‰å­—è§£æå¤±è´¥ï¼‰</p><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/php/php_megick_2.png" alt="PHP"></p><p>(è®¾ç½®å­—ä½“æ ¼å¼æ­£å¸¸æ˜¾ç¤º)</p><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/php/php_megick_3.png" alt="PHP"></p><h2 id="4-å›¾ç‰‡base64å¯¼å‡º"><a href="#4-å›¾ç‰‡base64å¯¼å‡º" class="headerlink" title="(4).å›¾ç‰‡base64å¯¼å‡º"></a>(4).å›¾ç‰‡base64å¯¼å‡º</h2><p>æœ€ç»ˆå¾—åˆ°çš„å›¾ç‰‡æˆ‘ä»¬ç»„è¦ä»¥base64çš„æ ¼å¼ä¼ é€’ç»™å‰ç«¯ï¼Œè¿›è¡Œä»¥ä¸‹æ“ä½œï¼ŒæŠŠæˆ‘ä»¬æœ€åæ‹¼æ¥çš„åˆ°çš„å›¾ç‰‡base64è½¬æ¢è¾“å‡ºã€‚<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$dest_img='/data/tmp/' . md5(microtime(true)).'.'.$type; //è¦ç”Ÿæˆçš„å›¾ç‰‡çš„è·¯å¾„</span><br><span class="line">$Return = <span class="built_in">array</span>();</span><br><span class="line"><span class="comment">// *å›¾ç‰‡è½¬æ¢ä¸º base64æ ¼å¼ç¼–ç *</span></span><br><span class="line">$base64_image = '';</span><br><span class="line">$image_info = getimagesize($dest_img);</span><br><span class="line">$image_data = fread(fopen($dest_img, <span class="string">'r'</span>), filesize($dest_img));</span><br><span class="line">$base64_image = 'data:' . $image_info['mime'] . ';base64,' . chunk_split(base64_encode($image_data));</span><br><span class="line">$Return['data']=$base64_image;</span><br><span class="line"><span class="keyword">return</span>  $Return;</span><br></pre></td></tr></table></figure></p><p><code>$base64_image</code>å°±æ˜¯base64æ ¼å¼çš„å›¾ç‰‡ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯å‰ç«¯å¾—åˆ°çš„é¢base64æ•°æ®é‡ŒåŒ…å«æœ‰<code>&#39;\r\n&#39;</code>å›è½¦å­—ç¬¦ï¼Œéœ€è¦ç‰¹æ®Šå¤„ç†æ‰å¯ä»¥æ­£ç¡®æ˜¾ç¤ºå›¾ç‰‡ã€‚</p><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/php/php_megick_4.png" alt="PHP"></p><p>ï¼ˆæœ€åå¾—åˆ°çš„åˆå¹¶å›¾ç‰‡ï¼‰</p><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/php/php_megick_5.png" alt="PHP"></p><p>(è°ƒæ•´æ‹¼æ¥å›¾ç‰‡å¤§å°å¾—åˆ°ä¸åŒçš„å›¾ç‰‡)<br><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/php/php_megick_6.png" alt="PHP"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ€è¿‘çš„PHPé¡¹ç›®ä¸­ï¼Œéœ€è¦ç”¨åˆ°ç”»å›¾å’Œå›¾ç‰‡æ‹¼æ¥æ•ˆæœï¼Œè¿™é‡Œæ˜¯ä¸€äº›å¼€å‘è¿‡ç¨‹é‡Œç”¨åˆ°çš„ä¸€äº›ç‚¹è¿˜æœ‰å°±æ˜¯ä¸€äº›è¸©è¿‡çš„å‘ã€‚é€šè¿‡ImageMagickç”Ÿæˆbase64å›¾ç‰‡æ ¼å¼ï¼Œä¸ºå‰ç«¯æ‰€ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/php.jpg&quot; alt=&quot;PHP&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="åç«¯" scheme="https://duanruilong.github.io/categories/%E5%90%8E%E7%AB%AF/"/>
    
    
      <category term="ç¼–ç¨‹" scheme="https://duanruilong.github.io/tags/%E7%BC%96%E7%A8%8B/"/>
    
      <category term="PHP" scheme="https://duanruilong.github.io/tags/PHP/"/>
    
      <category term="åç«¯" scheme="https://duanruilong.github.io/tags/%E5%90%8E%E7%AB%AF/"/>
    
  </entry>
  
  <entry>
    <title>å°ç¨‹åºä¹‹æ—…(ä¸ƒ)</title>
    <link href="https://duanruilong.github.io/2018/08/08/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%B9%8B%E6%97%85-%E4%B8%83/"/>
    <id>https://duanruilong.github.io/2018/08/08/å°ç¨‹åºä¹‹æ—…-ä¸ƒ/</id>
    <published>2018-08-08T15:56:51.000Z</published>
    <updated>2018-09-17T15:58:32.000Z</updated>
    
    <content type="html"><![CDATA[<p>å°ç¨‹åºæ˜¯ä¸€ç§æ–°çš„å¼€æ”¾èƒ½åŠ›ï¼Œå¼€å‘è€…å¯ä»¥å¿«é€Ÿåœ°å¼€å‘ä¸€ä¸ªå°ç¨‹åºã€‚å°ç¨‹åºå¯ä»¥åœ¨å¾®ä¿¡å†…è¢«ä¾¿æ·åœ°è·å–å’Œä¼ æ’­ï¼ŒåŒæ—¶å…·æœ‰å‡ºè‰²çš„ä½¿ç”¨ä½“éªŒã€‚è¿™æ˜¯å…³äºå°ç¨‹åºçš„åŠ¨æ€åŠ è½½ä¸€ä¸ªåˆ—è¡¨é¡µå°æ —å­ã€‚</p><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/wechat_d.png" alt="å¾®ä¿¡å°ç¨‹åº"></p><a id="more"></a><p>è¿™é‡Œçš„åˆ—è¡¨å¸ƒå±€æ–¹å¼ï¼Œé‡‡ç”¨flexå¼¹æ€§å¸ƒå±€å®ç°ï¼Œå…·ä½“å†…å®¹å¯ä»¥å‚è€ƒ<a href="http://www.ruanyifeng.com/blog/2015/07/flex-grammar.html" target="_blank" rel="noopener">flex é˜®ä¸€å³°</a></p><h1 id="Num1"><a href="#Num1" class="headerlink" title="Num1"></a>Num1</h1><p>ç®€å•è¯´ä¸€ä¸‹å¸ƒå±€ï¼Œå¤´éƒ¨æ˜¯ä¸€ä¸ªtitleï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªlistï¼Œlistæ˜¯ç”±ä¸€ä¸ªä¸€ä¸ªçš„cardç»„æˆï¼Œè€Œå¯¹äºcardå¸ƒå±€ï¼Œä¸»è¦æ˜¯å¤–éƒ¨ä¸€ä¸ªboxï¼Œé‡Œé¢åˆ†å·¦å³imgå’Œå†…å®¹ã€‚</p><p>list.wxml</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--pages/<span class="built_in">list</span>/<span class="built_in">list</span>.wxml--&gt;</span><br><span class="line">&lt;view <span class="class"><span class="keyword">class</span>="<span class="title">box</span>"&gt;</span></span><br><span class="line"><span class="class"> &lt;text class="list_header"&gt;æ¯æ—¥ä¸€çœ‹&lt;/text&gt;</span></span><br><span class="line"><span class="class">  &lt;view class="list" wx:for="&#123;&#123;list&#125;&#125;"&gt;</span></span><br><span class="line"><span class="class">    &lt;view class='list_img'&gt;</span></span><br><span class="line"><span class="class">      &lt;image src="&#123;&#123;item.img&#125;&#125;" class='avatar'&gt;&lt;/image&gt;</span></span><br><span class="line"><span class="class">    &lt;/view&gt;</span></span><br><span class="line"><span class="class">    &lt;view class='list_main'&gt;</span></span><br><span class="line">      &lt;view class='list_title'&gt;&#123;&#123;item.title&#125;&#125;&lt;/view&gt;</span><br><span class="line">      &lt;view class='list_content'&gt;&#123;&#123;item.content&#125;&#125;&lt;/view&gt;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">&lt;/view&gt;</span><br></pre></td></tr></table></figure><p>list.wxss<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* pages/list/list.wxss */</span></span><br><span class="line"><span class="comment">/*æ•´ä¸ªå®¹å™¨*/</span></span><br><span class="line">.box&#123;</span><br><span class="line">display: flex;</span><br><span class="line">flex-direction: column;<span class="comment">/*ç«–ç›´æ’åˆ—*/</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*titleæ–‡å­—*/</span></span><br><span class="line">.list_header&#123;</span><br><span class="line">font-size: <span class="number">32</span>rpx;</span><br><span class="line">font-weight: bold;</span><br><span class="line">color: #<span class="number">444</span>;</span><br><span class="line">padding:<span class="number">20</span>rpx;</span><br><span class="line">border-bottom: <span class="number">2</span>rpx solid <span class="meta">#ccc;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*åˆ—è¡¨é¡¹å®¹å™¨*/</span></span><br><span class="line">.<span class="built_in">list</span>&#123;</span><br><span class="line">display:flex;</span><br><span class="line">flex-direction: row;<span class="comment">/*æ¨ªå‘æ’åˆ—*/</span></span><br><span class="line">align-content: center;</span><br><span class="line">border-bottom:<span class="number">1</span>rpx solid <span class="meta">#ccc;</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*å›¾ç‰‡å®¹å™¨*/</span></span><br><span class="line">.list_img&#123;</span><br><span class="line">display: flex;</span><br><span class="line">align-content: center;</span><br><span class="line">padding:<span class="number">20</span>rpx <span class="number">10</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*å›¾ç‰‡*/</span></span><br><span class="line">.avatar&#123;</span><br><span class="line">width:<span class="number">130</span>rpx;</span><br><span class="line">height:<span class="number">130</span>rpx;</span><br><span class="line">border-radius: <span class="number">4</span>rpx;</span><br><span class="line">border: <span class="number">1</span>rpx solid #F2F2F2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*æ–‡å­—å®¹å™¨ï¼ŒåŒ…å«æ ‡é¢˜å’Œå†…å®¹*/</span></span><br><span class="line">.list_main&#123;</span><br><span class="line">display: flex;</span><br><span class="line">flex-direction: column;<span class="comment">/*æ–‡å­—ç«–ç›´æ’åˆ—*/</span></span><br><span class="line">align-content: center;</span><br><span class="line">padding:<span class="number">40</span>rpx <span class="number">20</span>rpx;</span><br><span class="line">overflow: hidden;</span><br><span class="line">&#125;</span><br><span class="line">.list_title&#123;</span><br><span class="line">font-size: <span class="number">28</span>rpx;</span><br><span class="line">color: #<span class="number">717171</span>;</span><br><span class="line">font-weight: bold;</span><br><span class="line">padding-bottom: <span class="number">10</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line">.list_content&#123;</span><br><span class="line">font-size: <span class="number">24</span>rpx;</span><br><span class="line">color: #<span class="number">999</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>list.jsé‡Œçš„æ•°æ®å…ˆå†™æˆå‡æ•°æ®ã€‚<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pages/list/list.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * é¡µé¢çš„åˆå§‹æ•°æ®</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  data: &#123;</span><br><span class="line">    <span class="built_in">list</span>:[&#123;</span><br><span class="line">      img: 'http://localhost:9999/image/a1.jpg',</span><br><span class="line">      title: 'ç¾ä¸½çš„å¤§æµ·å•Šï¼',</span><br><span class="line">      content: 'å¤§æµ·å•Šå…¨æ˜¯æ°´ï¼Œç¾ä¸½çš„æµ·æ™¯è®©äººèµå¿ƒæ‚¦ç›®ï¼æµ·æ™¯å£çº¸è¯·æ¬£èµï¼'</span><br><span class="line">    &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        img: 'http://localhost:9999/image/a2.jpg',</span><br><span class="line">        title: 'å›ä¸å»çš„é‚£å«ä»å‰',</span><br><span class="line">        content: 'å›ä¸å»çš„é‚£å«ä»å‰ï¼Œåˆ°ä¸äº†çš„æ‰æ˜¯è¿œæ–¹ï¼›ä¸ä¿ç•™çš„é‚£å«é’æ˜¥ï¼Œä¸å®Œç¾çš„æ‰æ˜¯äººç”Ÿã€‚'</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        img: 'http://localhost:9999/image/a3.jpg',</span><br><span class="line">        title: 'æ£®æ—ç”Ÿå­˜ææ€–æ¸¸æˆ',</span><br><span class="line">        content: 'ã€Šæ£®æ—ã€‹æ˜¯ä¸€æ¬¾PCå¹³å°å¼€æ”¾ä¸–ç•Œç”Ÿå­˜ææ€–æ¸¸æˆï¼Œæ¸¸æˆä¸­ç©å®¶å¿…é¡»å»ºé€ è®¾æ–½ï¼Œæ¢ç´¢ä¸–ç•Œï¼Œç”Ÿå­˜ä¸‹å»ã€‚ã€Šæ£®æ—ã€‹å°†æ‰“é€ ä¸€ä¸ªæ´»ç”Ÿç”Ÿçš„ï¼Œæ°”å€™å¤šå˜ï¼Œæ¤è¢«åŠ¨æ€ç”Ÿé•¿å‡‹é›¶ï¼Œåœ°ä¸‹æ´ç©´é”™ç»¼å¤æ‚çš„æ£®æ—ï¼Œç­‰å¾…ç©å®¶æ¢ç´¢ã€‚'</span><br><span class="line">      &#125;,</span><br><span class="line">        ]</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure></p><p>ï¼ˆä¹Ÿå¯ä»¥ä½¿ç”¨æœ¬åœ°nodeæœåŠ¡ï¼‰<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">var express = require('express');</span><br><span class="line">var fs = require('fs');</span><br><span class="line">var app = express();</span><br><span class="line"><span class="comment">//å¤„ç†é™æ€èµ„æº</span></span><br><span class="line">app.use(express.static('./'));</span><br><span class="line">app.get('/list', function (req, res) &#123;</span><br><span class="line">    res.send(&#123;</span><br><span class="line">        code: <span class="number">200</span>,</span><br><span class="line">        data: [&#123;</span><br><span class="line">                img: 'http://localhost:9999/image/a1.jpg',</span><br><span class="line">                title: 'ç¾ä¸½çš„å¤§æµ·å•Šï¼',</span><br><span class="line">                content: 'å¤§æµ·å•Šå…¨æ˜¯æ°´ï¼Œç¾ä¸½çš„æµ·æ™¯è®©äººèµå¿ƒæ‚¦ç›®ï¼æµ·æ™¯å£çº¸è¯·æ¬£èµï¼'</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                img: 'http://localhost:9999/image/a2.jpg',</span><br><span class="line">                title: 'å›ä¸å»çš„é‚£å«ä»å‰',</span><br><span class="line">                content: 'å›ä¸å»çš„é‚£å«ä»å‰ï¼Œåˆ°ä¸äº†çš„æ‰æ˜¯è¿œæ–¹ï¼›ä¸ä¿ç•™çš„é‚£å«é’æ˜¥ï¼Œä¸å®Œç¾çš„æ‰æ˜¯äººç”Ÿã€‚'</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                img: 'http://localhost:9999/image/a3.jpg',</span><br><span class="line">                title: 'æ£®æ—ç”Ÿå­˜ææ€–æ¸¸æˆ',</span><br><span class="line">                content: 'ã€Šæ£®æ—ã€‹æ˜¯ä¸€æ¬¾PCå¹³å°å¼€æ”¾ä¸–ç•Œç”Ÿå­˜ææ€–æ¸¸æˆï¼Œæ¸¸æˆä¸­ç©å®¶å¿…é¡»å»ºé€ è®¾æ–½ï¼Œæ¢ç´¢ä¸–ç•Œï¼Œç”Ÿå­˜ä¸‹å»ã€‚ã€Šæ£®æ—ã€‹å°†æ‰“é€ ä¸€ä¸ªæ´»ç”Ÿç”Ÿçš„ï¼Œæ°”å€™å¤šå˜ï¼Œæ¤è¢«åŠ¨æ€ç”Ÿé•¿å‡‹é›¶ï¼Œåœ°ä¸‹æ´ç©´é”™ç»¼å¤æ‚çš„æ£®æ—ï¼Œç­‰å¾…ç©å®¶æ¢ç´¢ã€‚'</span><br><span class="line">            &#125;,</span><br><span class="line">        ]</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line">app.listen(<span class="number">9999</span>); <span class="comment">//ç›‘å¬ç«¯å£</span></span><br></pre></td></tr></table></figure></p><h1 id="Num2"><a href="#Num2" class="headerlink" title="Num2"></a>Num2</h1><p>æ¥ä¸‹æ¥æ˜¯imgåœ¨å¤´éƒ¨ï¼Œä¸‹æ–¹æ˜¯æ–‡å­—å†…å®¹ã€‚</p><p>list.wxml</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--pages/listview/listview.wxml--&gt;</span><br><span class="line">&lt;view <span class="class"><span class="keyword">class</span>="<span class="title">box</span>"&gt;</span></span><br><span class="line"><span class="class"> &lt;text class="list_header"&gt;æ¯æ—¥ä¸€çœ‹&lt;/text&gt;</span></span><br><span class="line"><span class="class">  &lt;view class="list" wx:for="&#123;&#123;list&#125;&#125;"&gt;</span></span><br><span class="line"><span class="class">    &lt;view class='list_img'&gt;</span></span><br><span class="line"><span class="class">      &lt;image src="&#123;&#123;item.img&#125;&#125;" class='avatar'&gt;&lt;/image&gt;</span></span><br><span class="line"><span class="class">    &lt;/view&gt;</span></span><br><span class="line"><span class="class">    &lt;view class='list_main'&gt;</span></span><br><span class="line">      &lt;view class='list_title'&gt;&#123;&#123;item.title&#125;&#125;&lt;/view&gt;</span><br><span class="line">      &lt;view class='list_content'&gt;&#123;&#123;item.address&#125;&#125;&lt;/view&gt;</span><br><span class="line">      &lt;view class='list_content'&gt;&#123;&#123;item.content&#125;&#125;&lt;/view&gt;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">&lt;/view&gt;</span><br></pre></td></tr></table></figure><p>list.wxss<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* pages/listview/listview.wxss */</span></span><br><span class="line"><span class="comment">/*æ•´ä¸ªå®¹å™¨*/</span></span><br><span class="line">.box&#123;</span><br><span class="line">display: flex;</span><br><span class="line">background: <span class="meta">#ccc;</span></span><br><span class="line">flex-direction: column;<span class="comment">/*ç«–ç›´æ’åˆ—*/</span></span><br><span class="line">align-content: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*åˆ—è¡¨é¡¹å®¹å™¨*/</span></span><br><span class="line">.<span class="built_in">list</span>&#123;</span><br><span class="line">background: #FFF;</span><br><span class="line">display:flex;</span><br><span class="line">flex-direction: column;<span class="comment">/*ç«–ç›´æ’åˆ—*/</span></span><br><span class="line">align-content: center;</span><br><span class="line">width:<span class="number">90</span>%;</span><br><span class="line">margin:<span class="number">20</span>rpx <span class="keyword">auto</span>;<span class="comment">/*å±…ä¸­å¯¹é½*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*å›¾ç‰‡å®¹å™¨*/</span></span><br><span class="line">.list_img&#123;</span><br><span class="line">display: flex;</span><br><span class="line">align-content: center;</span><br><span class="line">width:<span class="number">100</span>%;</span><br><span class="line">padding:<span class="number">20</span>rpx <span class="number">0</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*å›¾ç‰‡*/</span></span><br><span class="line">.avatar&#123;</span><br><span class="line">width:<span class="number">100</span>%;</span><br><span class="line">height:<span class="number">400</span>rpx;</span><br><span class="line">border-radius: <span class="number">4</span>rpx;</span><br><span class="line">border: <span class="number">1</span>rpx solid #F2F2F2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*æ–‡å­—å®¹å™¨ï¼ŒåŒ…å«æ ‡é¢˜å’Œå†…å®¹*/</span></span><br><span class="line">.list_main&#123;</span><br><span class="line">display: flex;</span><br><span class="line">flex-direction: column;<span class="comment">/*æ–‡å­—ç«–ç›´æ’åˆ—*/</span></span><br><span class="line">align-content: center;</span><br><span class="line">padding:<span class="number">20</span>rpx;</span><br><span class="line">overflow: hidden;</span><br><span class="line">&#125;</span><br><span class="line">.list_title&#123;</span><br><span class="line">font-size: <span class="number">28</span>rpx;</span><br><span class="line">color: #<span class="number">717171</span>;</span><br><span class="line">font-weight: bold;</span><br><span class="line">padding-bottom: <span class="number">10</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line">.list_address&#123;</span><br><span class="line">font-size: <span class="number">24</span>rpx;</span><br><span class="line">color: #<span class="number">717171</span>;</span><br><span class="line">font-weight: bold;</span><br><span class="line">padding-bottom: <span class="number">10</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line">.list_content&#123;</span><br><span class="line">font-size: <span class="number">24</span>rpx;</span><br><span class="line">color: #<span class="number">999</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>list.jsé‡Œçš„æ•°æ®å…ˆå†™æˆå‡æ•°æ®ã€‚<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pages/list/list.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * é¡µé¢çš„åˆå§‹æ•°æ®</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  data: &#123;</span><br><span class="line">    <span class="built_in">list</span>:[&#123;</span><br><span class="line">      img: 'http://localhost:9999/image/a1.jpg',</span><br><span class="line">      title: 'ç¾ä¸½çš„å¤§æµ·å•Šï¼',</span><br><span class="line">      content: 'å¤§æµ·å•Šå…¨æ˜¯æ°´ï¼Œç¾ä¸½çš„æµ·æ™¯è®©äººèµå¿ƒæ‚¦ç›®ï¼æµ·æ™¯å£çº¸è¯·æ¬£èµï¼'</span><br><span class="line">    &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        img: 'http://localhost:9999/image/a2.jpg',</span><br><span class="line">        title: 'å›ä¸å»çš„é‚£å«ä»å‰',</span><br><span class="line">        content: 'å›ä¸å»çš„é‚£å«ä»å‰ï¼Œåˆ°ä¸äº†çš„æ‰æ˜¯è¿œæ–¹ï¼›ä¸ä¿ç•™çš„é‚£å«é’æ˜¥ï¼Œä¸å®Œç¾çš„æ‰æ˜¯äººç”Ÿã€‚'</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        img: 'http://localhost:9999/image/a3.jpg',</span><br><span class="line">        title: 'æ£®æ—ç”Ÿå­˜ææ€–æ¸¸æˆ',</span><br><span class="line">        content: 'ã€Šæ£®æ—ã€‹æ˜¯ä¸€æ¬¾PCå¹³å°å¼€æ”¾ä¸–ç•Œç”Ÿå­˜ææ€–æ¸¸æˆï¼Œæ¸¸æˆä¸­ç©å®¶å¿…é¡»å»ºé€ è®¾æ–½ï¼Œæ¢ç´¢ä¸–ç•Œï¼Œç”Ÿå­˜ä¸‹å»ã€‚ã€Šæ£®æ—ã€‹å°†æ‰“é€ ä¸€ä¸ªæ´»ç”Ÿç”Ÿçš„ï¼Œæ°”å€™å¤šå˜ï¼Œæ¤è¢«åŠ¨æ€ç”Ÿé•¿å‡‹é›¶ï¼Œåœ°ä¸‹æ´ç©´é”™ç»¼å¤æ‚çš„æ£®æ—ï¼Œç­‰å¾…ç©å®¶æ¢ç´¢ã€‚'</span><br><span class="line">      &#125;,</span><br><span class="line">        ]</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure></p><p>ï¼ˆä¹Ÿå¯ä»¥ä½¿ç”¨æœ¬åœ°nodeæœåŠ¡ï¼‰<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">var express = require('express');</span><br><span class="line">var fs = require('fs');</span><br><span class="line">var app = express();</span><br><span class="line"><span class="comment">//å¤„ç†é™æ€èµ„æº</span></span><br><span class="line">app.use(express.static('./'));</span><br><span class="line">app.get('/list', function (req, res) &#123;</span><br><span class="line">    res.send(&#123;</span><br><span class="line">        code: <span class="number">200</span>,</span><br><span class="line">        data: [&#123;</span><br><span class="line">                img: 'http://localhost:9999/image/a1.jpg',</span><br><span class="line">                title: 'ç¾ä¸½çš„å¤§æµ·å•Šï¼',</span><br><span class="line">                address: '1ç¾ä¸½çš„å¤§æµ·å•Šï¼',</span><br><span class="line">                content: 'å¤§æµ·å•Šå…¨æ˜¯æ°´ï¼Œç¾ä¸½çš„æµ·æ™¯è®©äººèµå¿ƒæ‚¦ç›®ï¼æµ·æ™¯å£çº¸è¯·æ¬£èµï¼'</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                img: 'http://localhost:9999/image/a2.jpg',</span><br><span class="line">                title: 'å›ä¸å»çš„é‚£å«ä»å‰',</span><br><span class="line">                address: '1å›ä¸å»çš„é‚£å«ä»å‰',</span><br><span class="line">                content: 'å›ä¸å»çš„é‚£å«ä»å‰ï¼Œåˆ°ä¸äº†çš„æ‰æ˜¯è¿œæ–¹ï¼›ä¸ä¿ç•™çš„é‚£å«é’æ˜¥ï¼Œä¸å®Œç¾çš„æ‰æ˜¯äººç”Ÿã€‚'</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                img: 'http://localhost:9999/image/a3.jpg',</span><br><span class="line">                title: 'æ£®æ—ç”Ÿå­˜ææ€–æ¸¸æˆ',</span><br><span class="line">                address: '1æ£®æ—ç”Ÿå­˜ææ€–æ¸¸æˆ',</span><br><span class="line">                content: 'ã€Šæ£®æ—ã€‹æ˜¯ä¸€æ¬¾PCå¹³å°å¼€æ”¾ä¸–ç•Œç”Ÿå­˜ææ€–æ¸¸æˆï¼Œæ¸¸æˆä¸­ç©å®¶å¿…é¡»å»ºé€ è®¾æ–½ï¼Œæ¢ç´¢ä¸–ç•Œï¼Œç”Ÿå­˜ä¸‹å»ã€‚ã€Šæ£®æ—ã€‹å°†æ‰“é€ ä¸€ä¸ªæ´»ç”Ÿç”Ÿçš„ï¼Œæ°”å€™å¤šå˜ï¼Œæ¤è¢«åŠ¨æ€ç”Ÿé•¿å‡‹é›¶ï¼Œåœ°ä¸‹æ´ç©´é”™ç»¼å¤æ‚çš„æ£®æ—ï¼Œç­‰å¾…ç©å®¶æ¢ç´¢ã€‚'</span><br><span class="line">            &#125;,</span><br><span class="line">        ]</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line">app.listen(<span class="number">9999</span>); <span class="comment">//ç›‘å¬ç«¯å£</span></span><br></pre></td></tr></table></figure></p><h1 id="Num3"><a href="#Num3" class="headerlink" title="Num3"></a>Num3</h1><p>ä¸Šé¢çš„æ ·å¼éƒ½æ˜¯å¾ˆå¸¸è§çš„åˆ—è¡¨é¡µï¼Œæˆ‘ä»¬æœ€ç»ˆçš„ç”¨æˆ·äº¤äº’æ•ˆæœè¿™æ ·æ˜¯å¾ˆä¸å‹å¥½çš„ï¼Œé‚£å°±åœ¨é‡Œé¢åŠ å…¥ä¸‹æ‹‰åˆ·æ–°ï¼Œåº•éƒ¨åŠ è½½æ›´å¤šï¼Œè¿™æ ·æ‰ç¬¦åˆç”¨æˆ·çš„æ“ä½œä¹ æƒ¯ã€‚</p><p>ä¸»è¦ç‚¹ï¼š<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">list</span>.jsoné…ç½®:</span><br><span class="line"></span><br><span class="line"><span class="string">"enablePullDownRefresh"</span>: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">éœ€è¦æ•è·è¿™ä¸¤ä¸ªäº‹ä»¶ï¼š</span><br><span class="line"></span><br><span class="line">onReachBottomï¼ˆæ»šåŠ¨åˆ°åº•éƒ¨äº‹ä»¶ï¼‰</span><br><span class="line">onPullDownRefreshï¼ˆä¸‹æ‹‰åˆ·æ–°äº‹ä»¶ï¼‰</span><br></pre></td></tr></table></figure></p><p>æœ¬åœ°æœåŠ¡ï¼š</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">var express = require('express');</span><br><span class="line">var fs = require('fs');</span><br><span class="line">var app = express();</span><br><span class="line"><span class="comment">//å¤„ç†é™æ€èµ„æº</span></span><br><span class="line">app.use(express.static('./'));</span><br><span class="line">app.get('/list/:num',function(req,res)&#123;</span><br><span class="line">var num = req.params.num;<span class="comment">//é¡µç </span></span><br><span class="line">var arr = [];</span><br><span class="line">(function()&#123;</span><br><span class="line"><span class="keyword">for</span>(var i=(num*<span class="number">5</span><span class="number">-5</span>);i&lt;(num*<span class="number">5</span>);i++)&#123;</span><br><span class="line">var obj = &#123;id:i+1,img:'http://localhost:9999/image/1.jpg',title:'è¿™æ˜¯ç¬¬'+(i+1)+'æ¡æ•°æ®',address:'éŸ©å›½ï¼Œæµå·å²›',content:'æ®è¯´åŠä¸ªäºšæ´²çš„å¥³ç”Ÿéƒ½æƒ³å»æƒå¿—é¾™çš„å’–å•¡å…ä¸Šç­ã€‚è¦æ˜¯ä½ ä¹Ÿæƒ³å»æµå·å²›çš„è“å¤©ç™½äº‘ä¸‹å–å’–å•¡ï¼Œå¶é‡æƒå¿—é¾™ï¼Œé‚£ä¹ˆå°†æ˜¯ä¸€ä»¶éå¸¸ä»¤äººå…´å¥‹çš„äº‹æƒ…ï¼'&#125;;</span><br><span class="line">arr.push(obj);</span><br><span class="line">&#125;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line">res.send(&#123;</span><br><span class="line">code: <span class="number">200</span>,</span><br><span class="line">page:num,</span><br><span class="line">data: arr</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line">app.listen(<span class="number">9999</span>);<span class="comment">//ç›‘å¬ç«¯å£</span></span><br></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--pages/listview/listview.wxml--&gt;</span><br><span class="line"></span><br><span class="line">&lt;loading hidden=<span class="string">"&#123;&#123;isLoading&#125;&#125;"</span>&gt;åŠ è½½ä¸­...&lt;/loading&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;view class=<span class="string">"box"</span>&gt;</span><br><span class="line">  &lt;view wx:<span class="keyword">if</span>=<span class="string">"&#123;&#123;isRefesh&#125;&#125;"</span>&gt;</span><br><span class="line">   &lt;icon type='waiting' size='45'&gt;&lt;/icon&gt;</span><br><span class="line">   &lt;text&gt;åˆ·æ–°ä¸­...&lt;/text&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line"></span><br><span class="line">  &lt;view <span class="class"><span class="keyword">class</span>="<span class="title">list</span>" <span class="title">wx</span>:</span><span class="keyword">for</span>=<span class="string">"&#123;&#123;list&#125;&#125;"</span> id=<span class="string">"&#123;&#123;page&#125;&#125;"</span>&gt;</span><br><span class="line">    &lt;view class='list_img'&gt;</span><br><span class="line">      &lt;image src="&#123;&#123;item.img&#125;&#125;" class='avatar'&gt;&lt;/image&gt;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line">    &lt;view <span class="class"><span class="keyword">class</span>='<span class="title">list_main</span>'&gt;</span></span><br><span class="line">      &lt;view class='list_title'&gt;&#123;&#123;item.title&#125;&#125;&lt;/view&gt;</span><br><span class="line">      &lt;view class='list_content'&gt;&#123;&#123;item.address&#125;&#125;&lt;/view&gt;</span><br><span class="line">      &lt;view class='list_content'&gt;&#123;&#123;item.content&#125;&#125;&lt;/view&gt;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">&lt;/view&gt;</span><br></pre></td></tr></table></figure><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- listview.json --&gt;</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">"enablePullDownRefresh"</span>: <span class="literal">true</span>&#125;</span><br></pre></td></tr></table></figure><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pages/listview/listview.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">  data: &#123;</span><br><span class="line">    <span class="built_in">list</span>: [],<span class="comment">//åˆ—è¡¨é¡¹æ•°æ®</span></span><br><span class="line">    page: <span class="number">1</span>,<span class="comment">//é¡µç </span></span><br><span class="line">    isRefesh: <span class="literal">false</span>,<span class="comment">//æ˜¯å¦åˆ·æ–°</span></span><br><span class="line">    isLoading: <span class="literal">true</span><span class="comment">//æ­£åœ¨åŠ è½½</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//ä¸‹æ‹‰åˆ·æ–°</span></span><br><span class="line">  onPullDownRefresh: function () &#123;</span><br><span class="line">    var that = <span class="keyword">this</span>;</span><br><span class="line">    that.setData(&#123; isRefesh: <span class="literal">true</span> &#125;);<span class="comment">//åˆ·æ–°æ¡å‡ºç°</span></span><br><span class="line">    wx.request(&#123;</span><br><span class="line">      url: 'http://localhost:9999/list/1',</span><br><span class="line">      method: 'GET',</span><br><span class="line">      success: function (res) &#123;</span><br><span class="line">        var listdata = res.data.data;</span><br><span class="line">        setTimeout(function () &#123;</span><br><span class="line">          wx.stopPullDownRefresh;<span class="comment">//åœæ­¢ä¸‹æ‹‰åˆ·æ–°æ•ˆæœ</span></span><br><span class="line">          that.setData(&#123; page: <span class="number">1</span> &#125;);<span class="comment">//é‡ç½®é¡µç </span></span><br><span class="line">          that.setData(&#123; <span class="built_in">list</span>: listdata, isRefesh: <span class="literal">false</span> &#125;);<span class="comment">//é‡æ–°è®¾ç½®åˆ—è¡¨é¡¹å’Œåˆ·æ–°æ¡æ¶ˆå¤±</span></span><br><span class="line">        &#125;, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//æ»‘åˆ°åº•éƒ¨åŠ è½½</span></span><br><span class="line">  onReachBottom: function () &#123;</span><br><span class="line">    var that = <span class="keyword">this</span>;</span><br><span class="line">    var page = that.data.page + <span class="number">1</span>;</span><br><span class="line">    var oldData = <span class="keyword">this</span>.data.<span class="built_in">list</span>;<span class="comment">//è€æ•°æ®</span></span><br><span class="line">    that.setData(&#123; isLoading: <span class="literal">false</span> &#125;);<span class="comment">//loadingå‡ºç°</span></span><br><span class="line">    wx.request(&#123;</span><br><span class="line">      url: 'http://localhost:9999/list/' + page,</span><br><span class="line">      method: 'GET',</span><br><span class="line">      success: function (res) &#123;</span><br><span class="line">        var allData = [];</span><br><span class="line">        var listdata = res.data.data;<span class="comment">//æ–°æ•°æ®</span></span><br><span class="line">        allData = oldData.concat(listdata);<span class="comment">//è€æ•°æ®å’Œæ–°æ•°æ®åˆå¹¶</span></span><br><span class="line">        that.setData(&#123; <span class="built_in">list</span>: allData, page: page &#125;);<span class="comment">//é‡æ–°è®¾ç½®åˆ—è¡¨é¡¹å’Œé¡µç </span></span><br><span class="line">        setTimeout(function () &#123;</span><br><span class="line">          that.setData(&#123; isLoading: <span class="literal">true</span> &#125;);<span class="comment">//loadingæ¶ˆå¤±</span></span><br><span class="line">        &#125;, <span class="number">1000</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//é¡µç åˆå§‹åŒ–</span></span><br><span class="line">  onLoad: function (options) &#123;</span><br><span class="line">    var that = <span class="keyword">this</span>;</span><br><span class="line">    that.setData(&#123; isLoading: <span class="literal">false</span> &#125;);<span class="comment">//loadingå‡ºç°</span></span><br><span class="line">    wx.request(&#123;</span><br><span class="line">      url: 'http://localhost:9999/list/1',</span><br><span class="line">      method: 'GET',</span><br><span class="line">      success: function (res) &#123;</span><br><span class="line">        var listdata = res.data.data;</span><br><span class="line">        that.setData(&#123; <span class="built_in">list</span>: listdata &#125;);</span><br><span class="line">        setTimeout(function () &#123;</span><br><span class="line">          that.setData(&#123; isLoading: <span class="literal">true</span> &#125;);<span class="comment">//loadingæ¶ˆå¤±</span></span><br><span class="line">        &#125;, <span class="number">1000</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å°ç¨‹åºæ˜¯ä¸€ç§æ–°çš„å¼€æ”¾èƒ½åŠ›ï¼Œå¼€å‘è€…å¯ä»¥å¿«é€Ÿåœ°å¼€å‘ä¸€ä¸ªå°ç¨‹åºã€‚å°ç¨‹åºå¯ä»¥åœ¨å¾®ä¿¡å†…è¢«ä¾¿æ·åœ°è·å–å’Œä¼ æ’­ï¼ŒåŒæ—¶å…·æœ‰å‡ºè‰²çš„ä½¿ç”¨ä½“éªŒã€‚è¿™æ˜¯å…³äºå°ç¨‹åºçš„åŠ¨æ€åŠ è½½ä¸€ä¸ªåˆ—è¡¨é¡µå°æ —å­ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/wechat_d.png&quot; alt=&quot;å¾®ä¿¡å°ç¨‹åº&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="å°ç¨‹åº" scheme="https://duanruilong.github.io/categories/%E5%B0%8F%E7%A8%8B%E5%BA%8F/"/>
    
    
      <category term="Javascript" scheme="https://duanruilong.github.io/tags/Javascript/"/>
    
      <category term="ç¼–ç¨‹" scheme="https://duanruilong.github.io/tags/%E7%BC%96%E7%A8%8B/"/>
    
      <category term="å°ç¨‹åº" scheme="https://duanruilong.github.io/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/"/>
    
  </entry>
  
  <entry>
    <title>å‰ç«¯å°ç¬”è®°æœ¬</title>
    <link href="https://duanruilong.github.io/2018/08/01/%E5%89%8D%E7%AB%AF%E5%B0%8F%E7%AC%94%E8%AE%B0%E6%9C%AC/"/>
    <id>https://duanruilong.github.io/2018/08/01/å‰ç«¯å°ç¬”è®°æœ¬/</id>
    <published>2018-07-31T16:09:43.000Z</published>
    <updated>2018-09-17T15:58:32.000Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™é‡Œä¼šæ”¶å½•ä¸€äº›å¶å°”ä¸çŸ¥é“äº†ï¼Œå°±å»æ‰¾ä¸€ä¸‹çš„ä¸œè¥¿ï¼Œæ…¢æ…¢ç§¯ç´¯ã€‚<br><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/webjingnang.png" alt="js"></p><a id="more"></a><h1 id="Nodeç¯å¢ƒèµ·ä¸€ä¸ªæœåŠ¡"><a href="#Nodeç¯å¢ƒèµ·ä¸€ä¸ªæœåŠ¡" class="headerlink" title="Nodeç¯å¢ƒèµ·ä¸€ä¸ªæœåŠ¡"></a>Nodeç¯å¢ƒèµ·ä¸€ä¸ªæœåŠ¡</h1><h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><p>éœ€è¦å®‰è£…NodeJSç¯å¢ƒ</p><ul><li><p>1ã€å®‰è£…Express<br><code>npm install express -g</code><br><code>npm install express-generator -g</code></p></li><li><p>2ã€åˆå§‹åŒ–é¡¹ç›®<br>æ–°å»ºé¡¹ç›®<br><code>express é¡¹ç›®åç§°</code></p></li></ul><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">âœ  Weichat express serverDmo</span><br><span class="line"></span><br><span class="line">  warning: the <span class="keyword">default</span> view engine will <span class="keyword">not</span> be jade in future releases</span><br><span class="line">  warning: use `--view=jade' <span class="keyword">or</span> `--help' <span class="keyword">for</span> additional options</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   create : serverDmo/</span><br><span class="line">   create : serverDmo/<span class="keyword">public</span>/</span><br><span class="line">   create : serverDmo/<span class="keyword">public</span>/javascripts/</span><br><span class="line">   create : serverDmo/<span class="keyword">public</span>/images/</span><br><span class="line">   create : serverDmo/<span class="keyword">public</span>/stylesheets/</span><br><span class="line">   create : serverDmo/<span class="keyword">public</span>/stylesheets/style.css</span><br><span class="line">   create : serverDmo/routes/</span><br><span class="line">   create : serverDmo/routes/index.js</span><br><span class="line">   create : serverDmo/routes/users.js</span><br><span class="line">   create : serverDmo/views/</span><br><span class="line">   create : serverDmo/views/error.jade</span><br><span class="line">   create : serverDmo/views/index.jade</span><br><span class="line">   create : serverDmo/views/layout.jade</span><br><span class="line">   create : serverDmo/app.js</span><br><span class="line">   create : serverDmo/package.json</span><br><span class="line">   create : serverDmo/bin/</span><br><span class="line">   create : serverDmo/bin/www</span><br><span class="line"></span><br><span class="line">   change directory:</span><br><span class="line">     $ cd serverDmo</span><br><span class="line"></span><br><span class="line">   install dependencies:</span><br><span class="line">     $ npm install</span><br><span class="line"></span><br><span class="line">   run the app:</span><br><span class="line">     $ DEBUG=serverdmo:* npm start</span><br></pre></td></tr></table></figure><p>ç›®å½•ä»‹ç»ï¼š<br>/bin:ç”¨æ¥å¯åŠ¨åº”ç”¨ï¼ˆæœåŠ¡å™¨ï¼‰<br>/public: å­˜æ”¾é™æ€èµ„æºç›®å½•<br>/routesï¼šè·¯ç”±ç”¨äºç¡®å®šåº”ç”¨ç¨‹åºå¦‚ä½•å“åº”å¯¹ç‰¹å®šç«¯ç‚¹çš„å®¢æˆ·æœºè¯·æ±‚ï¼ŒåŒ…å«ä¸€ä¸ª URIï¼ˆæˆ–è·¯å¾„ï¼‰å’Œä¸€ä¸ªç‰¹å®šçš„ HTTP è¯·æ±‚æ–¹æ³•ï¼ˆGETã€POST ç­‰ï¼‰ã€‚æ¯ä¸ªè·¯ç”±å¯ä»¥å…·æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå¤„ç†ç¨‹åºå‡½æ•°ï¼Œè¿™äº›å‡½æ•°åœ¨è·¯ç”±åŒ¹é…æ—¶æ‰§è¡Œã€‚<br>/views: æ¨¡æ¿æ–‡ä»¶æ‰€åœ¨ç›®å½• æ–‡ä»¶æ ¼å¼ä¸º.jade<br>ç›®å½•app.jsç¨‹åºmainæ–‡ä»¶ è¿™ä¸ªæ˜¯æœåŠ¡å™¨å¯åŠ¨çš„å…¥å£</p><h2 id="é¦–å…ˆå¯åŠ¨æœåŠ¡å™¨"><a href="#é¦–å…ˆå¯åŠ¨æœåŠ¡å™¨" class="headerlink" title="é¦–å…ˆå¯åŠ¨æœåŠ¡å™¨"></a>é¦–å…ˆå¯åŠ¨æœåŠ¡å™¨</h2><p><code>npm start //å¯åŠ¨æœåŠ¡å™¨</code></p><p>åœ¨æµè§ˆå™¨ä¸­è®¿é—® <a href="http://localhost:3000/" target="_blank" rel="noopener">http://localhost:3000/</a></p><h2 id="åŸºæœ¬ä½¿ç”¨"><a href="#åŸºæœ¬ä½¿ç”¨" class="headerlink" title="åŸºæœ¬ä½¿ç”¨"></a>åŸºæœ¬ä½¿ç”¨</h2><p>æ‰“å¼€app.js è¿™é‡Œä»‹ç»ä¸‹ä¸»è¦ä»£ç <br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"> var express = require('express');</span><br><span class="line"> var path = require('path');</span><br><span class="line"> var favicon = require('serve-favicon');</span><br><span class="line"> var logger = require('morgan');</span><br><span class="line"> var cookieParser = require('cookie-parser');</span><br><span class="line"> var bodyParser = require('body-parser');</span><br><span class="line"></span><br><span class="line"> var app = express();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">///=======è·¯ç”±ä¿¡æ¯ ï¼ˆæ¥å£åœ°å€ï¼‰å¼€å§‹ å­˜æ”¾åœ¨./routesç›®å½•ä¸‹===========//</span></span><br><span class="line"> var routes = require('./routes/index');//home pageæ¥å£</span><br><span class="line"> var users = require('./routes/users'); //ç”¨æˆ·æ¥å£</span><br><span class="line"></span><br><span class="line"> app.use(<span class="string">'/'</span>, routes); <span class="comment">//åœ¨appä¸­æ³¨å†Œroutesè¯¥æ¥å£ </span></span><br><span class="line"> app.use('/users', users);//åœ¨appä¸­æ³¨å†Œusersæ¥å£</span><br><span class="line"><span class="comment">///=======è·¯ç”±ä¿¡æ¯ ï¼ˆæ¥å£åœ°å€ ä»‹ç»===========//</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">///=======æ¨¡æ¿ å¼€å§‹===========//</span></span><br><span class="line"><span class="comment">// view engine setup</span></span><br><span class="line"> app.set('views', path.join(__dirname, 'views'));</span><br><span class="line"> app.set('view engine', 'jade');</span><br><span class="line"><span class="comment">///=======æ¨¡æ¿ ç»“æŸ===========//</span></span><br><span class="line"></span><br><span class="line">å½“æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­ è®¿é—® http:<span class="comment">//localhost:3000/ è°ƒç”¨çš„å°±æ˜¯indexä¸­çš„æ¥å£</span></span><br><span class="line">æˆ‘ä»¬æ‰“å¼€index.jså°±å¯ä»¥çœ‹åˆ°è¯¥æ¥å£çš„å®šä¹‰ï¼š</span><br><span class="line">var express = require('express');</span><br><span class="line">var router = express.Router();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªgetè¯·æ±‚ pathä¸ºæ ¹ç›®å½•</span></span><br><span class="line"><span class="comment">/* GET home page. */</span></span><br><span class="line">router.get(<span class="string">'/'</span>, function(req, res, next) &#123;</span><br><span class="line"> res.render('index', &#123; title: 'Express' &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span>.exports = router;</span><br></pre></td></tr></table></figure></p><p>å®šä¹‰ä¸€ä¸ªè·¯ç”±çš„åŸºæœ¬æ ¼å¼ä¸ºï¼š<br><code>app.METHOD(PATH, HANDLER)</code><br>å…¶ä¸­ï¼š<br>app æ˜¯ express çš„å®ä¾‹ã€‚<br>METHODæ˜¯ HTTP è¯·æ±‚æ–¹æ³•ã€‚<br>PATH æ˜¯æœåŠ¡å™¨ä¸Šçš„è·¯å¾„ã€‚<br>HANDLER æ˜¯åœ¨è·¯ç”±åŒ¹é…æ—¶æ‰§è¡Œçš„å‡½æ•°ã€‚<br>ä»¥ä¸Šçš„å®šä¹‰ä»£è¡¨</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è¿™é‡Œä¼šæ”¶å½•ä¸€äº›å¶å°”ä¸çŸ¥é“äº†ï¼Œå°±å»æ‰¾ä¸€ä¸‹çš„ä¸œè¥¿ï¼Œæ…¢æ…¢ç§¯ç´¯ã€‚&lt;br&gt;&lt;img src=&quot;https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/webjingnang.png&quot; alt=&quot;js&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="ç¼–ç¨‹" scheme="https://duanruilong.github.io/categories/%E7%BC%96%E7%A8%8B/"/>
    
    
      <category term="Javascript" scheme="https://duanruilong.github.io/tags/Javascript/"/>
    
      <category term="ç¼–ç¨‹" scheme="https://duanruilong.github.io/tags/%E7%BC%96%E7%A8%8B/"/>
    
      <category term="React" scheme="https://duanruilong.github.io/tags/React/"/>
    
      <category term="å°ç¨‹åº" scheme="https://duanruilong.github.io/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/"/>
    
  </entry>
  
  <entry>
    <title>å°ç¨‹åºä¹‹æ—…(å…­)</title>
    <link href="https://duanruilong.github.io/2018/07/31/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%B9%8B%E6%97%85-%E5%85%AD/"/>
    <id>https://duanruilong.github.io/2018/07/31/å°ç¨‹åºä¹‹æ—…-å…­/</id>
    <published>2018-07-31T15:32:25.000Z</published>
    <updated>2018-09-18T12:25:20.000Z</updated>
    
    <content type="html"><![CDATA[<p>å°ç¨‹åºæ˜¯ä¸€ç§æ–°çš„å¼€æ”¾èƒ½åŠ›ï¼Œå¼€å‘è€…å¯ä»¥å¿«é€Ÿåœ°å¼€å‘ä¸€ä¸ªå°ç¨‹åºã€‚å°ç¨‹åºå¯ä»¥åœ¨å¾®ä¿¡å†…è¢«ä¾¿æ·åœ°è·å–å’Œä¼ æ’­ï¼ŒåŒæ—¶å…·æœ‰å‡ºè‰²çš„ä½¿ç”¨ä½“éªŒã€‚è¿™æ˜¯å…³äºå°ç¨‹åºçš„æ•°æ®æœ¬åœ°å­˜å‚¨è¿›ä¸€æ­¥çš„è®¤è¯†ï¼Œæ¯”å¦‚å¾ˆå¤šå›¾ç‰‡å’Œè§†é¢‘æ—…è¡Œã€‚</p><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/wechat_d.png" alt="å¾®ä¿¡å°ç¨‹åº"></p><a id="more"></a><p>æœ‰æ—¶å€™çš„éœ€æ±‚å°±æ˜¯ä¸å•å•åªæ˜¯ä¿å­˜åˆ°ä½ è‡ªå·±çš„æ‰‹æœºä¸Šå°±å¯ä»¥äº†ï¼Œè¦è€ƒè™‘åˆ°å¤šåœºæ™¯çš„åº”ç”¨ã€‚è¿˜æœ‰æ–‡ä»¶çš„å†…å®¹å¹¿åº¦ä¸Šä¹Ÿè¦æ‹“å±•ã€‚<br>é‚£ä¹ˆè¿™å°±éœ€è¦ä¸€äº›å‡†å¤‡å·¥ä½œï¼Œæ¯”å¦‚æœåŠ¡å™¨ï¼Œä½¿ç”¨Nodejsæ¥å®ç°æœåŠ¡å™¨çš„ä¸œè¥¿ï¼Œè‡³äºAPIä¸»è¦æ˜¯å®˜æ–¹çš„<code>wx.uploadFile(obj)</code></p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install express</span><br><span class="line">npm install formidable</span><br></pre></td></tr></table></figure><p>Node-serveræ–‡ä»¶</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">var express = require('express');</span><br><span class="line"><span class="comment">//å¤„ç†postéœ€è¦å¼•å…¥è¿™ä¸ªä¸­é—´ä»¶,å¤„ç†çš„æ˜¯form-data</span></span><br><span class="line">var formidable = require('formidable');</span><br><span class="line">var fs = require('fs');</span><br><span class="line">var app = express();</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤„ç†é™æ€èµ„æº</span></span><br><span class="line">app.use(express.static('./'));</span><br><span class="line"><span class="comment">// å¤„ç†postçš„form-data ç±»å‹</span></span><br><span class="line"></span><br><span class="line">app.post('/postformdata',function (req,res) &#123;</span><br><span class="line">    var form = <span class="keyword">new</span> formidable.IncomingForm(); <span class="comment">// è¾“å…¥æµ</span></span><br><span class="line">    form.encoding = 'utf-8';</span><br><span class="line">    form.uploadDir = 'upload'; //è¿™é‡Œè®¾ç½®ä¸Šä¼ ç›®å½•</span><br><span class="line">    form.parse(req,function(err,fields,files)&#123; <span class="comment">// è¿™é‡Œè§£æè¯·æ±‚</span></span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            res.send(err);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        var avatarName = Date.now() + '.jpg'; // ä»¥æ—¶é—´ä½œä¸ºåå­—</span><br><span class="line">        var newPath = form.uploadDir + avatarName;</span><br><span class="line">        fs.renameSync(files.my_upload.path,newPath); <span class="comment">// my_uploadæ˜¯å‰ç«¯è®¾ç½®çš„nameï¼ŒæŠŠå›¾ç‰‡å‚¨å­˜ä¸‹æ¥å¹¶ä¸”é‡æ–°å‘½å</span></span><br><span class="line">        res.send(&#123;</span><br><span class="line">            code:<span class="number">200</span>,</span><br><span class="line">            path:'http:localhost:9998/'+newPath</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">app.listen(<span class="number">9998</span>); <span class="comment">// ç›‘å¬ç«¯å£</span></span><br></pre></td></tr></table></figure><h1 id="Num-1"><a href="#Num-1" class="headerlink" title="Num 1"></a>Num 1</h1><blockquote><p>ç¬¬ä¸€ä¸ªä¾‹å­ï¼Œé€‰æ‹©æœ¬åœ°å›¾ç‰‡ï¼Œç„¶åä¿å­˜åˆ°æœåŠ¡å™¨ï¼Œä¸Šä¼ æˆåŠŸä¹‹åå¯ä»¥çœ‹åˆ°ç¼©ç•¥å›¾ï¼Œä½†æ˜¯ ç‚¹å‡»æ¯ä¸€å¼ å›¾ç‰‡åˆå¯ä»¥å¹»ç¯ç‰‡å¼é¢„è§ˆã€‚</p></blockquote><p>åœ¨uploadæ–‡ä»¶ç›®å½•ä¸‹æ“ä½œ</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--pages/upload/upload.wxml--&gt;</span><br><span class="line">&lt;view <span class="class"><span class="keyword">class</span>='<span class="title">container</span>'&gt;</span></span><br><span class="line"><span class="class">  &lt;button type='primary' bindtap='uploadImg'&gt;ä¸Šä¼ å›¾ç‰‡&lt;/button&gt;</span></span><br><span class="line"><span class="class">    &lt;view class="imginfo" wx:for="&#123;&#123;imglist&#125;&#125;" wx:for-index="id" wx:for-item="item"&gt;</span></span><br><span class="line"><span class="class">      &lt;image src='&#123;&#123;item&#125;&#125;' bindtap='previewImg' data-imgid="&#123;&#123;id&#125;&#125;" class='myimg'&gt;&lt;/image&gt;</span></span><br><span class="line"><span class="class">    &lt;/view&gt;</span></span><br><span class="line"><span class="class">&lt;/view&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/* pages/upload/upload.wxss */</span></span><br><span class="line">.imginfo&#123;</span><br><span class="line">  display: flex;</span><br><span class="line">  flex-direction: column;</span><br><span class="line">  align-items: center;</span><br><span class="line">&#125;</span><br><span class="line">.myimg&#123;</span><br><span class="line">  width: <span class="number">70</span>px;</span><br><span class="line">  height: <span class="number">70</span>px;</span><br><span class="line">  border:<span class="number">1</span>px solid <span class="meta">#ccc;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pages/upload/upload.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * é¡µé¢çš„åˆå§‹æ•°æ®</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  data: &#123;</span><br><span class="line">    imgList:[] <span class="comment">// å›¾ç‰‡åˆ—è¡¨</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ä¸Šä¼ å›¾ç‰‡</span></span><br><span class="line">  uploadImg:function()&#123;</span><br><span class="line">    var that = <span class="keyword">this</span>;</span><br><span class="line">    wx.chooseImage(&#123;</span><br><span class="line">      success: function(res) &#123;</span><br><span class="line">        var tempFilePaths = res.tempFilePaths;</span><br><span class="line">        wx.uploadFile(&#123;</span><br><span class="line">          url: 'http://localhost:9998/postformdata', //nodeJSæ•°æ®æ¥å£</span><br><span class="line">          filePath: tempFilePaths[<span class="number">0</span>],</span><br><span class="line">          name: 'my_upload',//è¿™ä¸ªå‰åå°åç§°éœ€è¦ä¿æŒä¸€è‡´ï¼Œåˆ«ä¹±å†™ã€‚</span><br><span class="line">          formData: &#123;</span><br><span class="line">            'user': 'test'</span><br><span class="line">          &#125;,</span><br><span class="line">          success:function(res)&#123;</span><br><span class="line">            var data = JSON.parse(res.data);<span class="comment">//è¿”å›æ¥çš„æ˜¯å­—ç¬¦ä¸²æ ¼å¼ã€‚</span></span><br><span class="line">            var arr = that.data.imgList;</span><br><span class="line">            arr.push(data.path);</span><br><span class="line">            that.setData(&#123; imgList: arr &#125;);<span class="comment">//åªæœ‰è¿™ç§æ–¹å¼æ‰èƒ½æ›´æ–°è§†å›¾</span></span><br><span class="line">            console.<span class="built_in">log</span>(that.data.imgList);</span><br><span class="line">            wx.showToast(&#123;</span><br><span class="line">              title: 'æ–‡ä»¶ä¸Šä¼ æˆåŠŸ',</span><br><span class="line">              icon: 'success',</span><br><span class="line">              duration: <span class="number">2000</span></span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//é¢„è§ˆå›¾ç‰‡</span></span><br><span class="line">  previewImg: function (e) &#123;</span><br><span class="line">    var index = e.target.dataset.imgid;<span class="comment">//è·å–å›¾ç‰‡çš„id</span></span><br><span class="line">    var that = <span class="keyword">this</span>;</span><br><span class="line">    console.<span class="built_in">log</span>(index);</span><br><span class="line">    wx.previewImage(&#123;</span><br><span class="line">      current: that.data.imgList[index],<span class="comment">//å½“å‰çš„å›¾ç‰‡</span></span><br><span class="line">      urls: that.data.imgList <span class="comment">// éœ€è¦é¢„è§ˆçš„å›¾ç‰‡httpé“¾æ¥åˆ—è¡¨</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šå°±æ˜¯ä¸è¦çš„æ­¥éª¤ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å°ç¨‹åºæ˜¯ä¸€ç§æ–°çš„å¼€æ”¾èƒ½åŠ›ï¼Œå¼€å‘è€…å¯ä»¥å¿«é€Ÿåœ°å¼€å‘ä¸€ä¸ªå°ç¨‹åºã€‚å°ç¨‹åºå¯ä»¥åœ¨å¾®ä¿¡å†…è¢«ä¾¿æ·åœ°è·å–å’Œä¼ æ’­ï¼ŒåŒæ—¶å…·æœ‰å‡ºè‰²çš„ä½¿ç”¨ä½“éªŒã€‚è¿™æ˜¯å…³äºå°ç¨‹åºçš„æ•°æ®æœ¬åœ°å­˜å‚¨è¿›ä¸€æ­¥çš„è®¤è¯†ï¼Œæ¯”å¦‚å¾ˆå¤šå›¾ç‰‡å’Œè§†é¢‘æ—…è¡Œã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/wechat_d.png&quot; alt=&quot;å¾®ä¿¡å°ç¨‹åº&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="å°ç¨‹åº" scheme="https://duanruilong.github.io/categories/%E5%B0%8F%E7%A8%8B%E5%BA%8F/"/>
    
    
      <category term="Javascript" scheme="https://duanruilong.github.io/tags/Javascript/"/>
    
      <category term="ç¼–ç¨‹" scheme="https://duanruilong.github.io/tags/%E7%BC%96%E7%A8%8B/"/>
    
      <category term="å°ç¨‹åº" scheme="https://duanruilong.github.io/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/"/>
    
  </entry>
  
  <entry>
    <title>å¼€å‘å°é”¦å›Š</title>
    <link href="https://duanruilong.github.io/2018/07/30/%E5%BC%80%E5%8F%91%E5%B0%8F%E9%94%A6%E5%9B%8A/"/>
    <id>https://duanruilong.github.io/2018/07/30/å¼€å‘å°é”¦å›Š/</id>
    <published>2018-07-29T16:30:40.000Z</published>
    <updated>2018-12-20T11:54:18.000Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™é‡Œä¼šæ”¶å½•ä¸€ä¸‹é‡åˆ°çš„ï¼Œæˆ–è€…è§£å†³é—®é¢˜çš„æ–¹æ³•ã€‚ä¸æ–­æ”¶é›†ï¼Œä¸æ–­å£®å¤§ã€‚<br><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/webjingnang.png" alt="js"></p><a id="more"></a><blockquote><p>å¼€å‘å°é”¦å›Š</p></blockquote><h1 id="JavaScript"><a href="#JavaScript" class="headerlink" title="JavaScript"></a>JavaScript</h1><h2 id="1ã€js-åˆ¤æ–­å­—ç¬¦ä¸²ä¸­æ˜¯å¦åŒ…å«æŸä¸ªå­—ç¬¦ä¸²"><a href="#1ã€js-åˆ¤æ–­å­—ç¬¦ä¸²ä¸­æ˜¯å¦åŒ…å«æŸä¸ªå­—ç¬¦ä¸²" class="headerlink" title="1ã€js åˆ¤æ–­å­—ç¬¦ä¸²ä¸­æ˜¯å¦åŒ…å«æŸä¸ªå­—ç¬¦ä¸²"></a>1ã€js åˆ¤æ–­å­—ç¬¦ä¸²ä¸­æ˜¯å¦åŒ…å«æŸä¸ªå­—ç¬¦ä¸²</h2><blockquote><p>Stringå¯¹è±¡çš„æ–¹æ³•</p></blockquote><p>æ–¹æ³•ä¸€: indexOf()   (æ¨è)</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var str = <span class="string">"123"</span>;</span><br><span class="line">console.<span class="built_in">log</span>(str.indexOf(<span class="string">"3"</span>) != <span class="number">-1</span> );  <span class="comment">// true</span></span><br><span class="line">indexOf() æ–¹æ³•å¯è¿”å›æŸä¸ªæŒ‡å®šçš„å­—ç¬¦ä¸²å€¼åœ¨å­—ç¬¦ä¸²ä¸­é¦–æ¬¡å‡ºç°çš„ä½ç½®ã€‚å¦‚æœè¦æ£€ç´¢çš„å­—ç¬¦ä¸²å€¼æ²¡æœ‰å‡ºç°ï¼Œåˆ™è¯¥æ–¹æ³•è¿”å› <span class="number">-1</span>ã€‚</span><br></pre></td></tr></table></figure><p>æ–¹æ³•äºŒ: search() </p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var str = <span class="string">"123"</span>;</span><br><span class="line">console.<span class="built_in">log</span>(str.search(<span class="string">"3"</span>) != <span class="number">-1</span> );  <span class="comment">// true</span></span><br><span class="line">search() æ–¹æ³•ç”¨äºæ£€ç´¢å­—ç¬¦ä¸²ä¸­æŒ‡å®šçš„å­å­—ç¬¦ä¸²ï¼Œæˆ–æ£€ç´¢ä¸æ­£åˆ™è¡¨è¾¾å¼ç›¸åŒ¹é…çš„å­å­—ç¬¦ä¸²ã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°ä»»ä½•åŒ¹é…çš„å­ä¸²ï¼Œåˆ™è¿”å› <span class="number">-1</span>ã€‚</span><br></pre></td></tr></table></figure><p>æ–¹æ³•ä¸‰:match()</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var str = <span class="string">"123"</span>;</span><br><span class="line">var reg = RegExp(/<span class="number">3</span>/);</span><br><span class="line"><span class="keyword">if</span>(str.match(reg))&#123;</span><br><span class="line">    <span class="comment">// åŒ…å«        </span></span><br><span class="line">&#125;</span><br><span class="line">match() æ–¹æ³•å¯åœ¨å­—ç¬¦ä¸²å†…æ£€ç´¢æŒ‡å®šçš„å€¼ï¼Œæˆ–æ‰¾åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„åŒ¹é…ã€‚</span><br></pre></td></tr></table></figure><blockquote><p>RegExp å¯¹è±¡æ–¹æ³•</p></blockquote><p>æ–¹æ³•å››:test() </p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var str = <span class="string">"123"</span>;</span><br><span class="line">var reg = RegExp(/<span class="number">3</span>/);</span><br><span class="line">console.<span class="built_in">log</span>(reg.test(str)); <span class="comment">// true</span></span><br><span class="line">test() æ–¹æ³•ç”¨äºæ£€ç´¢å­—ç¬¦ä¸²ä¸­æŒ‡å®šçš„å€¼ã€‚è¿”å› <span class="literal">true</span> æˆ– <span class="literal">false</span>ã€‚</span><br></pre></td></tr></table></figure><p>æ–¹æ³•äº”:exec()</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var str = <span class="string">"123"</span>;</span><br><span class="line">var reg = RegExp(/<span class="number">3</span>/);</span><br><span class="line"><span class="keyword">if</span>(reg.exec(str))&#123;</span><br><span class="line">    <span class="comment">// åŒ…å«        </span></span><br><span class="line">&#125;</span><br><span class="line">exec() æ–¹æ³•ç”¨äºæ£€ç´¢å­—ç¬¦ä¸²ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼çš„åŒ¹é…ã€‚è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­å­˜æ”¾åŒ¹é…çš„ç»“æœã€‚å¦‚æœæœªæ‰¾åˆ°åŒ¹é…ï¼Œåˆ™è¿”å›å€¼ä¸º nullã€‚</span><br></pre></td></tr></table></figure><h2 id="2ã€-JSä¸­every-å’Œsome-çš„ç”¨æ³•"><a href="#2ã€-JSä¸­every-å’Œsome-çš„ç”¨æ³•" class="headerlink" title="2ã€ JSä¸­every()å’Œsome()çš„ç”¨æ³•"></a>2ã€ JSä¸­every()å’Œsome()çš„ç”¨æ³•</h2><blockquote><p>every()ä¸some()æ–¹æ³•éƒ½æ˜¯JSä¸­æ•°ç»„çš„è¿­ä»£æ–¹æ³•ã€‚</p></blockquote><p>every()æ˜¯å¯¹æ•°ç»„ä¸­æ¯ä¸€é¡¹è¿è¡Œç»™å®šå‡½æ•°ï¼Œå¦‚æœè¯¥å‡½æ•°å¯¹æ¯ä¸€é¡¹è¿”å›true,åˆ™è¿”å›trueã€‚</p><p>some()æ˜¯å¯¹æ•°ç»„ä¸­æ¯ä¸€é¡¹è¿è¡Œç»™å®šå‡½æ•°ï¼Œå¦‚æœè¯¥å‡½æ•°å¯¹ä»»ä¸€é¡¹è¿”å›trueï¼Œåˆ™è¿”å›trueã€‚</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">var arr = [ <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span> ]; </span><br><span class="line"> </span><br><span class="line">console.<span class="built_in">log</span>( arr.some( function( item, index, <span class="built_in">array</span> )&#123; </span><br><span class="line">    console.log( 'item=' + item + ',index='+index+',array='+array ); </span><br><span class="line">    <span class="keyword">return</span> item &gt; <span class="number">3</span>; </span><br><span class="line">&#125;)); </span><br><span class="line"> </span><br><span class="line">console.<span class="built_in">log</span>( arr.every( function( item, index, <span class="built_in">array</span> )&#123; </span><br><span class="line">    console.log( 'item=' + item + ',index='+index+',array='+array ); </span><br><span class="line">    <span class="keyword">return</span> item &gt; <span class="number">3</span>; </span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure><h2 id="3ã€-ç”¨Setä¸ºæ•°ç»„å»é‡"><a href="#3ã€-ç”¨Setä¸ºæ•°ç»„å»é‡" class="headerlink" title="3ã€ ç”¨Setä¸ºæ•°ç»„å»é‡"></a>3ã€ ç”¨Setä¸ºæ•°ç»„å»é‡</h2><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>] <span class="comment">// éœ€è¦å»é‡çš„æ•°ç»„</span></span><br><span class="line"></span><br><span class="line">var <span class="built_in">set</span> = <span class="keyword">new</span> Set(arr) <span class="comment">// &#123;1,2,3,4&#125;</span></span><br><span class="line">var newArr = Array.from(<span class="built_in">set</span>) <span class="comment">// å†æŠŠsetè½¬å˜æˆarray</span></span><br><span class="line"></span><br><span class="line">console.<span class="built_in">log</span>(newArr) <span class="comment">// [1,2,3,4]</span></span><br></pre></td></tr></table></figure><h2 id="4ã€-åˆ é™¤æ•°ç»„å°¾éƒ¨å…ƒç´ "><a href="#4ã€-åˆ é™¤æ•°ç»„å°¾éƒ¨å…ƒç´ " class="headerlink" title="4ã€ åˆ é™¤æ•°ç»„å°¾éƒ¨å…ƒç´ "></a>4ã€ åˆ é™¤æ•°ç»„å°¾éƒ¨å…ƒç´ </h2><p>ä¸€ä¸ªç®€å•çš„ç”¨æ¥æ¸…ç©ºæˆ–åˆ™åˆ é™¤æ•°ç»„å°¾éƒ¨å…ƒç´ çš„ç®€å•æ–¹æ³•å°±æ˜¯æ”¹å˜æ•°ç»„çš„lengthå±æ€§å€¼ã€‚<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">11</span>, <span class="number">22</span>, <span class="number">33</span>, <span class="number">44</span>, <span class="number">55</span>, <span class="number">66</span>];</span><br><span class="line"><span class="comment">// truncanting</span></span><br><span class="line">arr.length = <span class="number">3</span>;</span><br><span class="line">console.<span class="built_in">log</span>(arr); <span class="comment">//=&gt; [11, 22, 33]</span></span><br><span class="line"><span class="comment">// clearing</span></span><br><span class="line">arr.length = <span class="number">0</span>;</span><br><span class="line">console.<span class="built_in">log</span>(arr); <span class="comment">//=&gt; []</span></span><br><span class="line">console.<span class="built_in">log</span>(arr[<span class="number">2</span>]); <span class="comment">//=&gt; undefined</span></span><br></pre></td></tr></table></figure></p><h2 id="5ã€-å¹³é“ºå¤šç»´æ•°ç»„"><a href="#5ã€-å¹³é“ºå¤šç»´æ•°ç»„" class="headerlink" title="5ã€ å¹³é“ºå¤šç»´æ•°ç»„"></a>5ã€ å¹³é“ºå¤šç»´æ•°ç»„</h2><p>ä½¿ç”¨Spreadæ“ä½œï¼Œå¯ä»¥å¾ˆå®¹æ˜“å»å¹³é“ºåµŒå¥—å¤šç»´æ•°ç»„ï¼š<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">11</span>, [<span class="number">22</span>, <span class="number">33</span>], [<span class="number">44</span>, <span class="number">55</span>], <span class="number">66</span>];</span><br><span class="line"><span class="keyword">const</span> flatArr = [].concat(...arr); <span class="comment">//=&gt; [11, 22, 33, 44, 55, 66]</span></span><br></pre></td></tr></table></figure></p><p>å¯æƒœï¼Œä¸Šé¢çš„æ–¹æ³•ä»…ä»…é€‚ç”¨äºäºŒç»´æ•°ç»„ã€‚ä¸è¿‡ï¼Œé€šè¿‡é€’å½’ï¼Œæˆ‘ä»¬å¯ä»¥å¹³é“ºä»»æ„ç»´åº¦çš„åµŒå¥—æ•°ç»„ã€‚<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">unction <span class="title">flattenArray</span><span class="params">(arr)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> flattened = [].concat(...arr);</span><br><span class="line">  <span class="keyword">return</span> flattened.some(item =&gt; Array.isArray(item)) ? </span><br><span class="line">    flattenArray(flattened) : flattened;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> arr = [<span class="number">11</span>, [<span class="number">22</span>, <span class="number">33</span>], [<span class="number">44</span>, [<span class="number">55</span>, <span class="number">66</span>, [<span class="number">77</span>, [<span class="number">88</span>]], <span class="number">99</span>]]];</span><br><span class="line"><span class="keyword">const</span> flatArr = flattenArray(arr); </span><br><span class="line"><span class="comment">//=&gt; [11, 22, 33, 44, 55, 66, 77, 88, 99]</span></span><br></pre></td></tr></table></figure></p><h2 id="6ã€-æ ¼å¼åŒ–JSONä»£ç "><a href="#6ã€-æ ¼å¼åŒ–JSONä»£ç " class="headerlink" title="6ã€ æ ¼å¼åŒ–JSONä»£ç "></a>6ã€ æ ¼å¼åŒ–JSONä»£ç </h2><p>JSON.stringifyä¸æ­¢å¯ä»¥å°†ä¸€ä¸ªå¯¹è±¡å­—ç¬¦åŒ–ï¼Œè¿˜å¯ä»¥æ ¼å¼åŒ–è¾“å‡ºJSONå¯¹è±¡ã€‚<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123; </span><br><span class="line">  foo: &#123; bar: [11, 22, 33, 44], baz: &#123; bing: true, boom: 'Hello' &#125; &#125; </span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// The third parameter is the number of spaces used to </span></span><br><span class="line"><span class="comment">// beautify the JSON output.</span></span><br><span class="line">JSON.stringify(obj, null, <span class="number">4</span>); </span><br><span class="line"><span class="comment">// =&gt;"&#123;</span></span><br><span class="line"><span class="comment">// =&gt;    "foo": &#123;</span></span><br><span class="line"><span class="comment">// =&gt;        "bar": [</span></span><br><span class="line"><span class="comment">// =&gt;            11,</span></span><br><span class="line"><span class="comment">// =&gt;            22,</span></span><br><span class="line"><span class="comment">// =&gt;            33,</span></span><br><span class="line"><span class="comment">// =&gt;            44</span></span><br><span class="line"><span class="comment">// =&gt;        ],</span></span><br><span class="line"><span class="comment">// =&gt;        "baz": &#123;</span></span><br><span class="line"><span class="comment">// =&gt;            "bing": true,</span></span><br><span class="line"><span class="comment">// =&gt;            "boom": "Hello"</span></span><br><span class="line"><span class="comment">// =&gt;        &#125;</span></span><br><span class="line"><span class="comment">// =&gt;    &#125;</span></span><br><span class="line"><span class="comment">// =&gt;&#125;"</span></span><br></pre></td></tr></table></figure></p><h2 id="7ã€-awaitå¤šä¸ªasyncå‡½æ•°"><a href="#7ã€-awaitå¤šä¸ªasyncå‡½æ•°" class="headerlink" title="7ã€ awaitå¤šä¸ªasyncå‡½æ•°"></a>7ã€ awaitå¤šä¸ªasyncå‡½æ•°</h2><p>åœ¨ä½¿ç”¨async/awaitçš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨Promise.allæ¥awaitå¤šä¸ªasyncå‡½æ•°ã€‚<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">await Promise.all([anAsyncCall(), thisIsAlsoAsync(), oneMore()])</span><br></pre></td></tr></table></figure></p><h2 id="8ã€JSONå¯¹è±¡å’ŒJSONæ•°ç»„æ·»åŠ åˆ é™¤å…ƒç´ "><a href="#8ã€JSONå¯¹è±¡å’ŒJSONæ•°ç»„æ·»åŠ åˆ é™¤å…ƒç´ " class="headerlink" title="8ã€JSONå¯¹è±¡å’ŒJSONæ•°ç»„æ·»åŠ åˆ é™¤å…ƒç´ "></a>8ã€JSONå¯¹è±¡å’ŒJSONæ•°ç»„æ·»åŠ åˆ é™¤å…ƒç´ </h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">ï¼ˆ<span class="number">1</span>ï¼‰çº¯JSONæ–‡æœ¬å¯ä»¥è¿™æ ·</span><br><span class="line">var json=&#123;</span><br><span class="line">   id:<span class="string">"id1"</span>,</span><br><span class="line">   name:<span class="string">"å¼€å¿ƒ"</span></span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//æ·»åŠ </span></span><br><span class="line">json[<span class="string">"gender"</span>]=<span class="string">"ç”·"</span></span><br><span class="line">json[<span class="string">"age"</span>]=<span class="number">26</span>;</span><br><span class="line">alert(json.age);</span><br><span class="line"> </span><br><span class="line"><span class="comment">//åˆ é™¤</span></span><br><span class="line"><span class="keyword">delete</span> json[<span class="string">"age"</span>];</span><br><span class="line">alert(json.age);</span><br><span class="line">alert(json.gender);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">æ­£å¸¸å¯¹è±¡çš„åˆ é™¤ï¼š</span><br><span class="line">var o = <span class="keyword">new</span> Object;</span><br><span class="line">o.name = <span class="string">"David"</span>;</span><br><span class="line">alert(o.name); <span class="comment">//è¾“å‡º "David"</span></span><br><span class="line"><span class="keyword">delete</span> o.name;</span><br><span class="line">alert(o.name); <span class="comment">//è¾“å‡º "undefined"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ï¼ˆ<span class="number">2</span>çº¯jsonå¯¹è±¡çš„è¯å°±æŠŠä»¥ä¸Šçš„var jsonå…ˆjson1 = JSON.parse(json)å°±å¯ä»¥äº†</span><br><span class="line"></span><br><span class="line">ï¼ˆ<span class="number">3</span>)å¦‚æœç”¨JSONæ•°ç»„æ–‡æœ¬çš„è¯å¯ä»¥è¿™æ ·</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">var mainArray = [</span><br><span class="line">    &#123;<span class="string">"tag"</span> :<span class="string">"ä»»åŠ¡"</span>,<span class="string">"num"</span>:<span class="number">2</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"tag"</span> :<span class="string">"å·¥ä½œ"</span> ,<span class="string">"num"</span>:<span class="number">6</span>&#125;</span><br><span class="line">];</span><br><span class="line"> </span><br><span class="line">mainArray .push(&#123;</span><br><span class="line">   <span class="string">"tag"</span>:<span class="string">"å¼€ä¼š"</span>,<span class="string">"num"</span>:<span class="number">3</span></span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">mainArray.shift();<span class="comment">//åˆ é™¤æ•°ç»„å¤´å…ƒç´ </span></span><br><span class="line">mainArray.pop();<span class="comment">//åˆ é™¤æ•°ç»„å°¾å…ƒç´ </span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">----------------------ç”±objectåˆ›å»ºjsonæ–‡æœ¬æ ¼å¼çš„æ–¹æ³•----------------------</span><br><span class="line"></span><br><span class="line">&lt;p id=<span class="string">"a"</span>&gt;ssss&lt;/p&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">var data = <span class="keyword">new</span> Object();</span><br><span class="line">data.name = <span class="string">"airuikun"</span>;</span><br><span class="line">data.sex = <span class="string">"man"</span>;</span><br><span class="line">var s = JSON.stringify(data);</span><br><span class="line">document.getElementById(<span class="string">"a"</span>).innerHTML = s;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><hr><hr><h1 id="Reactç¯‡"><a href="#Reactç¯‡" class="headerlink" title="Reactç¯‡"></a>Reactç¯‡</h1><hr><h2 id="1ã€-å…³äºthis-setStateæ›´æ–°çš„é—®é¢˜"><a href="#1ã€-å…³äºthis-setStateæ›´æ–°çš„é—®é¢˜" class="headerlink" title="1ã€ å…³äºthis.setStateæ›´æ–°çš„é—®é¢˜"></a>1ã€ å…³äºthis.setStateæ›´æ–°çš„é—®é¢˜</h2><p>this.setStateæ˜¯å¼‚æ­¥ï¼Œæ‰€ä»¥åœ¨this.setStateä¹‹åç«‹å³è°ƒç”¨this.stateæ˜¯è·å–ä¸åˆ°æœ€æ–°çš„æ•°æ®çš„ï¼Œé‚£ä¹ˆæ€ä¹ˆè·å–æœ€æ–°çš„æ•°æ®å‘¢ï¼Ÿä¸‹é¢ä»‹ç»ä¸‰ä¸ªæ–¹æ³•:</p><p>1.å›è°ƒå‡½æ•°callback<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.setState(&#123;</span><br><span class="line">  val: <span class="keyword">this</span>.state.val+<span class="number">1</span></span><br><span class="line">&#125;, () =&gt; &#123;</span><br><span class="line">  console.<span class="built_in">log</span>(<span class="keyword">this</span>.state.val)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><p>2.componentDidUpdate</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">componentDidUpdate()&#123;</span><br><span class="line">    console.<span class="built_in">log</span>(<span class="keyword">this</span>.state.val);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨this.setStateä¹‹åå»componentDidUpdateå‡½æ•°ä¸­è°ƒç”¨ï¼Œæ­¤æ—¶çš„this.stateå·²ç»æ›´æ–°</p><p>3.å°†this.setStateæ”¾å…¥setTimeoutå‡½æ•°ä¸­<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let self = <span class="keyword">this</span>;</span><br><span class="line">setTimeout(function () &#123;</span><br><span class="line">  self.setState(&#123;</span><br><span class="line">    val:self.state.val+<span class="number">1</span></span><br><span class="line">  &#125;);</span><br><span class="line">  console.<span class="built_in">log</span>(self.state.val);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p>åœ¨setTimeoutå‡½æ•°ä¸­ï¼Œåœ¨this.setStateä¹‹åthis.stateæ˜¯ç«‹å³æ›´æ–°çš„ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥è·å–åˆ°æ›´æ–°åçš„æ•°æ®ã€‚</p><hr><hr><h1 id="PHPç¯‡"><a href="#PHPç¯‡" class="headerlink" title="PHPç¯‡"></a>PHPç¯‡</h1><h2 id="php-å­—ç¬¦ä¸²ä¸­æ˜¯å¦åŒ…å«æŒ‡å®šå­—ç¬¦ä¸²çš„å¤šç§æ–¹æ³•"><a href="#php-å­—ç¬¦ä¸²ä¸­æ˜¯å¦åŒ…å«æŒ‡å®šå­—ç¬¦ä¸²çš„å¤šç§æ–¹æ³•" class="headerlink" title="php å­—ç¬¦ä¸²ä¸­æ˜¯å¦åŒ…å«æŒ‡å®šå­—ç¬¦ä¸²çš„å¤šç§æ–¹æ³•"></a>php å­—ç¬¦ä¸²ä¸­æ˜¯å¦åŒ…å«æŒ‡å®šå­—ç¬¦ä¸²çš„å¤šç§æ–¹æ³•</h2><h3 id="1-strstr"><a href="#1-strstr" class="headerlink" title="1. strstr"></a>1. strstr</h3><p>strstr() å‡½æ•°æœç´¢ä¸€ä¸ªå­—ç¬¦ä¸²åœ¨å¦ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­çš„ç¬¬ä¸€æ¬¡å‡ºç°ã€‚<br>è¯¥å‡½æ•°è¿”å›å­—ç¬¦ä¸²çš„å…¶ä½™éƒ¨åˆ†ï¼ˆä»åŒ¹é…ç‚¹ï¼‰ã€‚å¦‚æœæœªæ‰¾åˆ°æ‰€æœç´¢çš„å­—ç¬¦ä¸²ï¼Œåˆ™è¿”å› falseã€‚</p><p>ä»£ç å¦‚ä¸‹:<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"> <span class="comment">/*å¦‚æ‰‹å†Œä¸Šçš„ä¸¾ä¾‹*/</span></span><br><span class="line"> $email = 'user@example.com';</span><br><span class="line"> $domain = <span class="built_in">strstr</span>($email, <span class="string">'@'</span>);</span><br><span class="line"> echo $domain;</span><br><span class="line"> <span class="comment">// prints @example.com</span></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p><h3 id="2-stristr"><a href="#2-stristr" class="headerlink" title="2. stristr"></a>2. stristr</h3><p>stristr() å‡½æ•°æŸ¥æ‰¾å­—ç¬¦ä¸²åœ¨å¦ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ã€‚<br>å¦‚æœæˆåŠŸï¼Œåˆ™è¿”å›å­—ç¬¦ä¸²çš„å…¶ä½™éƒ¨åˆ†ï¼ˆä»åŒ¹é…ç‚¹ï¼‰ã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°è¯¥å­—ç¬¦ä¸²ï¼Œåˆ™è¿”å› falseã€‚</p><p>å®ƒå’Œstrstrçš„ä½¿ç”¨æ–¹æ³•å®Œå…¨ä¸€æ ·.å”¯ä¸€çš„åŒºåˆ«æ˜¯stristrä¸åŒºåˆ†å¤§å°å†™.</p><h3 id="3-strpos"><a href="#3-strpos" class="headerlink" title="3. strpos"></a>3. strpos</h3><p>strposå‡½æ•°è¿”å›booleanå€¼.FALSEå’ŒTRUEä¸ç”¨å¤šè¯´.ç”¨ â€œ===â€è¿›è¡Œåˆ¤æ–­.strposåœ¨æ‰§è¡Œé€Ÿåº¦ä¸Šéƒ½æ¯”ä»¥ä¸Šä¸¤ä¸ªå‡½æ•°å¿«,å¦å¤–strposæœ‰ä¸€ä¸ªå‚æ•°æŒ‡å®šåˆ¤æ–­çš„ä½ç½®,ä½†æ˜¯é»˜è®¤ä¸ºç©º.æ„æ€æ˜¯åˆ¤æ–­æ•´ä¸ªå­—ç¬¦ä¸².ç¼ºç‚¹æ˜¯å¯¹ä¸­æ–‡çš„æ”¯æŒä¸å¥½.</p><p>å®ä¾‹1<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if(strpos('www.jb51.net','jb51') !== false)&#123; </span><br><span class="line"> echo 'åŒ…å«jb51'; </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"> echo 'ä¸åŒ…å«jb51'; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å®ä¾‹2<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$str= 'abc';</span><br><span class="line">$needle= <span class="string">'a'</span>;</span><br><span class="line">$pos = strpos($str, $needle); <span class="comment">// è¿”å›ç¬¬ä¸€æ¬¡æ‰¾åˆ°æ”¹å­—ç¬¦ä¸²çš„ä½ç½®ï¼Œè¿™é‡Œè¿”å›ä¸º1ï¼Œè‹¥æŸ¥ä¸åˆ°åˆ™è¿”å›False</span></span><br></pre></td></tr></table></figure></p><h3 id="4-explode"><a href="#4-explode" class="headerlink" title="4. explode"></a>4. explode</h3><p>ç”¨explodeè¿›è¡Œåˆ¤æ–­PHPåˆ¤æ–­å­—ç¬¦ä¸²çš„åŒ…å«ä»£ç å¦‚ä¸‹:<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">function <span class="title">checkstr</span><span class="params">($str)</span></span>&#123;</span><br><span class="line"> $needle =<span class="string">'a'</span>;<span class="comment">//åˆ¤æ–­æ˜¯å¦åŒ…å«aè¿™ä¸ªå­—ç¬¦</span></span><br><span class="line"> $tmparray = explode($needle,$str);</span><br><span class="line"> <span class="keyword">if</span>(count($tmparray)&gt;<span class="number">1</span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"> &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="5ã€substrä¾‹å¦‚æˆ‘ä»¬éœ€è¦åˆ¤æ–­æœ€åä¸€ä¸ªå­—ç¬¦æ˜¯ä¸æ˜¯åˆ¶å®šå­—ç¬¦"><a href="#5ã€substrä¾‹å¦‚æˆ‘ä»¬éœ€è¦åˆ¤æ–­æœ€åä¸€ä¸ªå­—ç¬¦æ˜¯ä¸æ˜¯åˆ¶å®šå­—ç¬¦" class="headerlink" title="5ã€substrä¾‹å¦‚æˆ‘ä»¬éœ€è¦åˆ¤æ–­æœ€åä¸€ä¸ªå­—ç¬¦æ˜¯ä¸æ˜¯åˆ¶å®šå­—ç¬¦"></a>5ã€substrä¾‹å¦‚æˆ‘ä»¬éœ€è¦åˆ¤æ–­æœ€åä¸€ä¸ªå­—ç¬¦æ˜¯ä¸æ˜¯åˆ¶å®šå­—ç¬¦</h3><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">$str1="&lt;p&gt;è¿™æ˜¯ä¸ªwinrarä¸“ç”¨çš„dllç„¶åä¸‹å“¦å•Šä¸é”™çš„dllæ–‡ä»¶ï¼ŒQlogWin32.dll&lt;/p&gt;";</span></span><br><span class="line"><span class="comment">if(substr($str1,-8)==".dll&lt;/p&gt;")&#123;</span></span><br><span class="line"><span class="comment">echo substr($str1,0,-4);</span></span><br><span class="line"><span class="comment">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="6ã€substr-countç»Ÿè®¡â€œå­å­—ç¬¦ä¸²â€åœ¨â€œåŸå§‹å­—ç¬¦ä¸²ä¸­å‡ºç°çš„æ¬¡æ•°â€"><a href="#6ã€substr-countç»Ÿè®¡â€œå­å­—ç¬¦ä¸²â€åœ¨â€œåŸå§‹å­—ç¬¦ä¸²ä¸­å‡ºç°çš„æ¬¡æ•°â€" class="headerlink" title="6ã€substr_countç»Ÿè®¡â€œå­å­—ç¬¦ä¸²â€åœ¨â€œåŸå§‹å­—ç¬¦ä¸²ä¸­å‡ºç°çš„æ¬¡æ•°â€"></a>6ã€substr_countç»Ÿè®¡â€œå­å­—ç¬¦ä¸²â€åœ¨â€œåŸå§‹å­—ç¬¦ä¸²ä¸­å‡ºç°çš„æ¬¡æ•°â€</h3><p>substr_count()å‡½æ•°æœ¬æ˜¯ä¸€ä¸ªå°å­—ç¬¦ä¸²åœ¨ä¸€ä¸ªå¤§å­—ç¬¦ä¸²ä¸­å‡ºç°çš„æ¬¡æ•°ï¼š<br>$number = substr_count(big_string, small_string);<br>æ­£å¥½ä»Šå¤©éœ€è¦ä¸€ä¸ªæŸ¥æ‰¾å­—ç¬¦ä¸²çš„å‡½æ•°ï¼Œè¦å®ç°åˆ¤æ–­å­—ç¬¦ä¸²big_stringæ˜¯å¦åŒ…å«å­—ç¬¦ä¸²small_stringï¼Œè¿”å›trueæˆ–fasleï¼›</p><p>æŸ¥äº†åŠå¤©æ‰‹å†Œæ²¡æœ‰æ‰¾åˆ°ç°æˆçš„å‡½æ•°ï¼Œäºæ˜¯æƒ³åˆ°å¯ä»¥ç”¨substr_countå‡½æ•°æ¥å®ç°ä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">function <span class="title">check_str</span><span class="params">($str, $substr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> $nums=substr_count($str,$substr);</span><br><span class="line">  <span class="keyword">if</span> ($nums&gt;=<span class="number">1</span>)</span><br><span class="line">  &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><hr><h2 id="phpä¸­æ•°ç»„å’Œå­—ç¬¦ä¸²çš„ç›¸äº’è½¬æ¢"><a href="#phpä¸­æ•°ç»„å’Œå­—ç¬¦ä¸²çš„ç›¸äº’è½¬æ¢" class="headerlink" title="phpä¸­æ•°ç»„å’Œå­—ç¬¦ä¸²çš„ç›¸äº’è½¬æ¢"></a>phpä¸­æ•°ç»„å’Œå­—ç¬¦ä¸²çš„ç›¸äº’è½¬æ¢</h2><p>æ•°ç»„è½¬å­—ç¬¦ä¸²ï¼š<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implode(<span class="string">'!'</span>, $arr);<span class="comment">//å°†ä¸€ç»´æ•°ç»„ä»¥ï¼åˆ†éš”ç»„åˆæˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå‚æ•°ä¸€å¯ä»¥ä¸º""</span></span><br></pre></td></tr></table></figure></p><p>å­—ç¬¦ä¸²è½¬æ•°ç»„ï¼š<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">explode(<span class="string">'!'</span>, $str);<span class="comment">//å°†å­—ç¬¦ä¸²ä»¥!åˆ†å‰²ä¸ºä¸€ä¸ªä¸€ç»´æ•°ç»„,å‚æ•°ä¸€ä¸å¯ä»¥ä¸º""</span></span><br><span class="line"></span><br><span class="line">str_split($str, <span class="number">3</span>);<span class="comment">//å°†å­—ç¬¦ä¸²åˆ†å‰²æˆæ•°ç»„ï¼Œå‚æ•°äºŒå°†å­—ç¬¦ä¸²ä»å·¦å‘å³æ¯3ä¸ªå­—ç¬¦åˆ†å‰²ä¸€æ¬¡ï¼Œæœ€åçš„ä¸å¤Ÿ3ä¸ªäº† æœ‰å‡ ä¸ªç®—å‡ ä¸ªã€‚</span></span><br></pre></td></tr></table></figure></p><hr><h2 id="phpçš„strpos-å‡½æ•°åˆ¤æ–­å­—ç¬¦ä¸²ä¸­æ˜¯å¦åŒ…å«æŸå­—ç¬¦ä¸²çš„æ–¹æ³•"><a href="#phpçš„strpos-å‡½æ•°åˆ¤æ–­å­—ç¬¦ä¸²ä¸­æ˜¯å¦åŒ…å«æŸå­—ç¬¦ä¸²çš„æ–¹æ³•" class="headerlink" title="phpçš„strpos() å‡½æ•°åˆ¤æ–­å­—ç¬¦ä¸²ä¸­æ˜¯å¦åŒ…å«æŸå­—ç¬¦ä¸²çš„æ–¹æ³•"></a>phpçš„strpos() å‡½æ•°åˆ¤æ–­å­—ç¬¦ä¸²ä¸­æ˜¯å¦åŒ…å«æŸå­—ç¬¦ä¸²çš„æ–¹æ³•</h2><p>åˆ¤æ–­æŸå­—ç¬¦ä¸²ä¸­æ˜¯å¦åŒ…å«æŸå­—ç¬¦ä¸²çš„æ–¹æ³•<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if(strpos('www.idc-gz.com','idc-gz') !== false)&#123;</span><br><span class="line">    echo 'åŒ…å«';</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    echo 'ä¸åŒ…å«';</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><hr><h2 id="PHPä¸­å®ç°ä¸­æ–‡å­—ä¸²æˆªå–æ— ä¹±ç çš„æ–¹æ³•"><a href="#PHPä¸­å®ç°ä¸­æ–‡å­—ä¸²æˆªå–æ— ä¹±ç çš„æ–¹æ³•" class="headerlink" title="PHPä¸­å®ç°ä¸­æ–‡å­—ä¸²æˆªå–æ— ä¹±ç çš„æ–¹æ³•"></a>PHPä¸­å®ç°ä¸­æ–‡å­—ä¸²æˆªå–æ— ä¹±ç çš„æ–¹æ³•</h2><p>åœ¨PHPä¸­ï¼Œsubstr()å‡½æ•°æˆªå–å¸¦æœ‰ä¸­æ–‡å­—ç¬¦ä¸²çš„è¯ï¼Œå¯èƒ½ä¼šå‡ºç°ä¹±ç ï¼Œè¿™æ˜¯å› ä¸ºä¸­è¥¿æ–‡ä¸€ä¸ªå­—èŠ‚æ‰€å æœ‰çš„å­—èŠ‚æ•°ä¸ä¸€æ ·ï¼Œè€Œsubstrçš„é•¿åº¦å‚æ•°æ˜¯æŒ‰ç…§å­—èŠ‚å»ç®—çš„ï¼Œåœ¨GB2312ç¼–ç æ—¶ï¼Œä¸€ä¸ªä¸­æ–‡å 2ä¸ªå­—èŠ‚ï¼Œè‹±æ–‡ä¸º1ä¸ªå­—èŠ‚ï¼Œè€Œåœ¨UTF-8ç¼–ç å½“ä¸­ï¼Œä¸€ä¸ªä¸­æ–‡å¯èƒ½å æœ‰2ä¸ªæˆ–3ä¸ªå­—èŠ‚ï¼Œè‹±æ–‡æˆ–åŠè§’æ ‡ç‚¹å 1å­—èŠ‚ã€‚</p><p>ç›´æ¥ä½¿ç”¨PHPå‡½æ•°substræˆªå–ä¸­æ–‡å­—ç¬¦å¯èƒ½ä¼šå‡ºç°ä¹±ç ï¼Œä¸»è¦æ˜¯substrå¯èƒ½ç¡¬ç”Ÿç”Ÿçš„å°†ä¸€ä¸ªä¸­æ–‡å­—ç¬¦â€œé”¯â€æˆä¸¤åŠã€‚è§£å†³åŠæ³•ï¼š<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>ã€ä½¿ç”¨mbstringæ‰©å±•åº“çš„mb_substræˆªå–å°±ä¸ä¼šå‡ºç°ä¹±ç äº†ã€‚</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>ã€è‡ªå·±ä¹¦å†™æˆªå–å‡½æ•°ï¼Œä½†æ•ˆç‡ä¸å¦‚ç”¨mbstringæ‰©å±•åº“æ¥å¾—é«˜ã€‚</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>ã€å¦‚æœä»…æ˜¯ä¸ºäº†è¾“å‡ºæˆªå–çš„ä¸²ï¼Œå¯ç”¨å¦‚ä¸‹æ–¹å¼å®ç°ï¼šsubstr($str, <span class="number">0</span>, <span class="number">30</span>).chr(<span class="number">0</span>)ã€‚</span><br></pre></td></tr></table></figure></p><p>substr()å‡½æ•°å¯ä»¥åˆ†å‰²æ–‡å­—ï¼Œä½†è¦åˆ†å‰²çš„æ–‡å­—å¦‚æœåŒ…æ‹¬ä¸­æ–‡å­—ç¬¦å¾€å¾€ä¼šé‡åˆ°é—®é¢˜ï¼Œè¿™æ—¶å¯ä»¥ç”¨mb_substr()/mb_strcutè¿™ä¸ªå‡½æ•°ï¼Œmb_substr()/mb_strcutçš„ç”¨æ³•ä¸substr()ç›¸ä¼¼ï¼Œåªæ˜¯åœ¨mb_substr()/mb_strcutæœ€åè¦åŠ å…¥å¤šä¸€ä¸ªå‚æ•°ï¼Œä»¥è®¾å®šå­—ç¬¦ä¸²çš„ç¼–ç ï¼Œä½†æ˜¯ä¸€èˆ¬çš„æœåŠ¡å™¨éƒ½æ²¡æ‰“å¼€php_mbstring.dllï¼Œéœ€è¦åœ¨php.iniåœ¨æŠŠphp_mbstring.dllæ‰“å¼€ã€‚<br>ä¸¾ä¸ªä¾‹å­ï¼š<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">echo mb_substr('è¿™æ ·ä¸€æ¥æˆ‘çš„å­—ç¬¦ä¸²å°±ä¸ä¼šæœ‰ä¹±ç ^_^', 0, 7, 'utf-8');</span><br><span class="line">?&gt;</span><br><span class="line">è¾“å‡ºï¼šè¿™æ ·ä¸€æ¥æˆ‘çš„å­—</span><br><span class="line">&lt;?php</span><br><span class="line">echo mb_strcut('è¿™æ ·ä¸€æ¥æˆ‘çš„å­—ç¬¦ä¸²å°±ä¸ä¼šæœ‰ä¹±ç ^_^', 0, 7, 'utf-8');</span><br><span class="line">?&gt;</span><br><span class="line">è¾“å‡ºï¼šè¿™æ ·ä¸€</span><br><span class="line">ä»ä¸Šé¢çš„ä¾‹å­å¯ä»¥çœ‹å‡ºï¼Œmb_substræ˜¯æŒ‰å­—æ¥åˆ‡åˆ†å­—ç¬¦ï¼Œè€Œmb_strcutæ˜¯æŒ‰å­—èŠ‚æ¥åˆ‡åˆ†å­—ç¬¦ï¼Œä½†æ˜¯éƒ½ä¸ä¼šäº§ç”ŸåŠä¸ªå­—ç¬¦çš„ç°è±¡ã€‚</span><br></pre></td></tr></table></figure></p><hr>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è¿™é‡Œä¼šæ”¶å½•ä¸€ä¸‹é‡åˆ°çš„ï¼Œæˆ–è€…è§£å†³é—®é¢˜çš„æ–¹æ³•ã€‚ä¸æ–­æ”¶é›†ï¼Œä¸æ–­å£®å¤§ã€‚&lt;br&gt;&lt;img src=&quot;https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/webjingnang.png&quot; alt=&quot;js&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="ç¼–ç¨‹" scheme="https://duanruilong.github.io/categories/%E7%BC%96%E7%A8%8B/"/>
    
    
      <category term="Javascript" scheme="https://duanruilong.github.io/tags/Javascript/"/>
    
      <category term="ç¼–ç¨‹" scheme="https://duanruilong.github.io/tags/%E7%BC%96%E7%A8%8B/"/>
    
      <category term="React" scheme="https://duanruilong.github.io/tags/React/"/>
    
      <category term="å°ç¨‹åº" scheme="https://duanruilong.github.io/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/"/>
    
  </entry>
  
  <entry>
    <title>æ€æ ·åœ¨JSé‡Œå°½é‡å°‘å†™forå¾ªç¯</title>
    <link href="https://duanruilong.github.io/2018/07/29/%E6%80%8E%E6%A0%B7%E5%9C%A8JS%E9%87%8C%E5%B0%BD%E9%87%8F%E5%B0%91%E5%86%99for%E5%BE%AA%E7%8E%AF/"/>
    <id>https://duanruilong.github.io/2018/07/29/æ€æ ·åœ¨JSé‡Œå°½é‡å°‘å†™forå¾ªç¯/</id>
    <published>2018-07-29T15:39:15.000Z</published>
    <updated>2018-09-17T15:58:32.000Z</updated>
    
    <content type="html"><![CDATA[<p>â€œå¾ˆå¤šåœºæ™¯ï¼Œforæ¥çš„æ›´ç›´æ¥ï¼Œæ›´æ˜äº†ã€‚â€  â€œæœ€å–œæ¬¢forå¾ªç¯äº†ã€‚æƒ³breakå°±breakã€‚å¯èƒ½ä¼šå¤šæ•°æ®çš„è¿˜æ˜¯forå¾ªç¯ã€‚â€ â€œforå¾ªç¯çµæ´»æ˜“ç”¨ï¼Œé«˜é˜¶å‡½æ•°ç®€æ´æ˜äº†ï¼Œåˆé€‚çš„ç”¨åˆé€‚æ–¹å¼ï¼Œè¿˜æ˜¯ä¸èƒ½é™åˆ¶çš„å¤ªæ­»å§ï¼Œä¸ç„¶æ€ç»´ä¹Ÿä¼šå—å½±å“â€,è¿™æ˜¯å¾ˆå¤šæ—¶å€™éƒ½ä¼šè€ƒè™‘çš„é—®é¢˜ã€‚</p><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/js_d.png" alt="js"></p><a id="more"></a><h1 id="ç”¨å¥½-filterï¼Œmapï¼Œå’Œå…¶å®ƒ-ES6-æ–°å¢çš„é«˜é˜¶éå†å‡½æ•°"><a href="#ç”¨å¥½-filterï¼Œmapï¼Œå’Œå…¶å®ƒ-ES6-æ–°å¢çš„é«˜é˜¶éå†å‡½æ•°" class="headerlink" title="ç”¨å¥½ filterï¼Œmapï¼Œå’Œå…¶å®ƒ ES6 æ–°å¢çš„é«˜é˜¶éå†å‡½æ•°"></a>ç”¨å¥½ filterï¼Œmapï¼Œå’Œå…¶å®ƒ ES6 æ–°å¢çš„é«˜é˜¶éå†å‡½æ•°</h1><p>é—®é¢˜ä¸€ï¼š å°†æ•°ç»„ä¸­çš„ç©ºå€¼å»é™¤<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> arrContainsEmptyVal = [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">3</span>, undefined, null, <span class="number">0</span>, <span class="string">""</span>];</span><br><span class="line"></span><br><span class="line">ç­”æ¡ˆï¼š</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> compact = arr =&gt; arr.filter(Boolean);</span><br></pre></td></tr></table></figure></p><p>é—®é¢˜äºŒï¼š å°†æ•°ç»„ä¸­çš„ VIP ç”¨æˆ·ä½™é¢åŠ  10<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> users = [</span><br><span class="line">  &#123; username: <span class="string">"Kelly"</span>, isVIP: <span class="literal">true</span>, balance: <span class="number">20</span> &#125;,</span><br><span class="line">  &#123; username: <span class="string">"Tom"</span>, isVIP: <span class="literal">false</span>, balance: <span class="number">19</span> &#125;,</span><br><span class="line">  &#123; username: <span class="string">"Stephanie"</span>, isVIP: <span class="literal">true</span>, balance: <span class="number">30</span> &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ç­”æ¡ˆï¼š</span><br><span class="line"></span><br><span class="line">users.<span class="built_in">map</span>(</span><br><span class="line">  user =&gt; (user.isVIP ? &#123; ...user, balance: user.balance + <span class="number">10</span> &#125; : user)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">è¡¥å……ï¼šæœ‰äººè¯´å¾ˆæ˜æ˜¾è¿™é‡Œè¯¥ç”¨ forEachï¼Œä½ ä¸ºäº†ä¸¾ä¾‹è€Œä¸¾ä¾‹ï¼æˆ‘æ¯”è¾ƒæ— è¯­ã€‚forEach æ˜¯ç”¨æ¥æ‰§è¡Œå‰¯ä½œç”¨çš„å¥½å—ï¼Ÿä½ æŠŠåŸæ•°æ®éƒ½æ”¹äº†ã€‚æˆ‘çš„ä¹ æƒ¯æ˜¯ä½¿ç”¨ Immutable æ•°æ®ã€‚ä½ è¦æ”¹æ•°æ®çš„è¯ï¼Œå¼€å¿ƒå°±å¥½ã€‚</span><br></pre></td></tr></table></figure></p><p>é—®é¢˜ä¸‰ï¼š åˆ¤æ–­å­—ç¬¦ä¸²ä¸­æ˜¯å¦å«æœ‰å…ƒéŸ³å­—æ¯<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> randomStr = <span class="string">"hdjrwqpi"</span>;</span><br><span class="line"></span><br><span class="line">ç­”æ¡ˆï¼š</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isVowel = <span class="keyword">char</span> =&gt; [<span class="string">"a"</span>, <span class="string">"e"</span>, <span class="string">"o"</span>, <span class="string">"i"</span>, <span class="string">"u"</span>].includes(<span class="keyword">char</span>);</span><br><span class="line"><span class="keyword">const</span> containsVowel = str =&gt; [...str].some(isVowel);</span><br><span class="line"></span><br><span class="line">containsVowel(randomStr);</span><br></pre></td></tr></table></figure></p><p>é—®é¢˜å››ï¼š åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å…¨éƒ¨æ˜¯æˆå¹´äºº<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> users = [</span><br><span class="line">  &#123; name: <span class="string">"Jim"</span>, age: <span class="number">23</span> &#125;,</span><br><span class="line">  &#123; name: <span class="string">"Lily"</span>, age: <span class="number">17</span> &#125;,</span><br><span class="line">  &#123; name: <span class="string">"Will"</span>, age: <span class="number">25</span> &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">ç­”æ¡ˆï¼š</span><br><span class="line"></span><br><span class="line">users.every(user =&gt; user.age &gt;= <span class="number">18</span>);</span><br></pre></td></tr></table></figure></p><p>é—®é¢˜äº”ï¼š æ‰¾å‡ºä¸Šé¢ç”¨æˆ·ä¸­çš„æœªæˆå¹´äºº<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> users = [</span><br><span class="line">  &#123; name: <span class="string">"Jim"</span>, age: <span class="number">23</span> &#125;,</span><br><span class="line">  &#123; name: <span class="string">"Lily"</span>, age: <span class="number">17</span> &#125;,</span><br><span class="line">  &#123; name: <span class="string">"Will"</span>, age: <span class="number">25</span> &#125;</span><br><span class="line">];</span><br><span class="line">ç­”æ¡ˆï¼š</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> findTeen = users =&gt; users.find(user =&gt; user.age &lt; <span class="number">18</span>);</span><br><span class="line"></span><br><span class="line">findTeen(users);</span><br></pre></td></tr></table></figure></p><p>é—®é¢˜å…­ï¼š å°†æ•°ç»„ä¸­é‡å¤é¡¹æ¸…é™¤<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> dupArr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">7</span>];</span><br><span class="line"></span><br><span class="line">ç­”æ¡ˆï¼š</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> uniq = arr =&gt; [...<span class="keyword">new</span> Set(arr)];</span><br><span class="line"></span><br><span class="line">uniq(dupArr);</span><br></pre></td></tr></table></figure></p><p>é—®é¢˜ä¸ƒï¼š ç”Ÿæˆç”±éšæœºæ•´æ•°ç»„æˆçš„æ•°ç»„ï¼Œæ•°ç»„é•¿åº¦å’Œå…ƒç´ å¤§å°å¯è‡ªå®šä¹‰<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ç­”æ¡ˆï¼š</span><br><span class="line"><span class="keyword">const</span> genNumArr = (length, limit) =&gt;</span><br><span class="line">  Array.from(&#123; length &#125;, _ =&gt; Math.<span class="built_in">floor</span>(Math.random() * limit));</span><br><span class="line"></span><br><span class="line">genNumArr(<span class="number">10</span>, <span class="number">100</span>);</span><br></pre></td></tr></table></figure></p><h1 id="ç†è§£å’Œç†Ÿç»ƒä½¿ç”¨-reduce"><a href="#ç†è§£å’Œç†Ÿç»ƒä½¿ç”¨-reduce" class="headerlink" title="ç†è§£å’Œç†Ÿç»ƒä½¿ç”¨ reduce"></a>ç†è§£å’Œç†Ÿç»ƒä½¿ç”¨ reduce</h1><p>é—®é¢˜ä¸€ï¼š ä¸å€ŸåŠ©åŸç”Ÿé«˜é˜¶å‡½æ•°ï¼Œå®šä¹‰ reduce<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ç­”æ¡ˆï¼š</span><br><span class="line"><span class="keyword">const</span> reduce = (f, acc, arr) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (arr.length === <span class="number">0</span>) <span class="keyword">return</span> acc;</span><br><span class="line">  <span class="keyword">const</span> [head, ...tail] = arr;</span><br><span class="line">  <span class="keyword">return</span> reduce(f, f(head, acc), tail);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><p>é—®é¢˜äºŒï¼š å°†å¤šå±‚æ•°ç»„è½¬æ¢æˆä¸€å±‚æ•°ç»„<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> nestedArr = [<span class="number">1</span>, <span class="number">2</span>, [<span class="number">3</span>, <span class="number">4</span>, [<span class="number">5</span>, <span class="number">6</span>]]];</span><br><span class="line"></span><br><span class="line">ç­”æ¡ˆï¼š</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> flatten = arr =&gt;</span><br><span class="line">  arr.reduce(</span><br><span class="line">    (flat, next) =&gt; flat.concat(Array.isArray(next) ? flatten(next) : next),</span><br><span class="line">    []</span><br><span class="line">  );</span><br></pre></td></tr></table></figure></p><p>é—®é¢˜ä¸‰ï¼šå°†ä¸‹é¢æ•°ç»„è½¬æˆå¯¹è±¡ï¼Œkey/value å¯¹åº”é‡Œå±‚æ•°ç»„çš„ä¸¤ä¸ªå€¼<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> objLikeArr = [[<span class="string">"name"</span>, <span class="string">"Jim"</span>], [<span class="string">"age"</span>, <span class="number">18</span>], [<span class="string">"single"</span>, <span class="literal">true</span>]];</span><br><span class="line"></span><br><span class="line">ç­”æ¡ˆï¼š</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fromPairs = pairs =&gt;</span><br><span class="line">  pairs.reduce((res, pair) =&gt; ((res[pair[<span class="number">0</span>]] = pair[<span class="number">1</span>]), res), &#123;&#125;);</span><br><span class="line"></span><br><span class="line">fromPairs(objLikeArr);</span><br></pre></td></tr></table></figure></p><p>é—®é¢˜å››ï¼š å–å‡ºå¯¹è±¡ä¸­çš„æ·±å±‚å±æ€§<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> deepAttr = &#123; a: &#123; b: &#123; c: <span class="number">15</span> &#125; &#125; &#125;;</span><br><span class="line"></span><br><span class="line">ç­”æ¡ˆï¼š</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pluckDeep = path =&gt; obj =&gt;</span><br><span class="line">  path.split(<span class="string">"."</span>).reduce((val, attr) =&gt; val[attr], obj);</span><br><span class="line"></span><br><span class="line">pluckDeep(<span class="string">"a.b.c"</span>)(deepAttr);</span><br></pre></td></tr></table></figure></p><p>é—®é¢˜äº”ï¼šå°†ç”¨æˆ·ä¸­çš„ç”·æ€§å’Œå¥³æ€§åˆ†åˆ«æ”¾åˆ°ä¸åŒçš„æ•°ç»„é‡Œï¼š<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> users = [</span><br><span class="line">  &#123; name: <span class="string">"Adam"</span>, age: <span class="number">30</span>, sex: <span class="string">"male"</span> &#125;,</span><br><span class="line">  &#123; name: <span class="string">"Helen"</span>, age: <span class="number">27</span>, sex: <span class="string">"female"</span> &#125;,</span><br><span class="line">  &#123; name: <span class="string">"Amy"</span>, age: <span class="number">25</span>, sex: <span class="string">"female"</span> &#125;,</span><br><span class="line">  &#123; name: <span class="string">"Anthony"</span>, age: <span class="number">23</span>, sex: <span class="string">"male"</span> &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">ç­”æ¡ˆï¼š</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> partition = (arr, isValid) =&gt;</span><br><span class="line">  arr.reduce(</span><br><span class="line">    ([pass, fail], elem) =&gt;</span><br><span class="line">      isValid(elem) ? [[...pass, elem], fail] : [pass, [...fail, elem]],</span><br><span class="line">    [[], []],</span><br><span class="line">  );</span><br><span class="line">  </span><br><span class="line"><span class="keyword">const</span> isMale = person =&gt; person.sex === <span class="string">"male"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> [maleUser, femaleUser] = partition(users, isMale);</span><br></pre></td></tr></table></figure></p><p>é—®é¢˜å…­ï¼š reduce çš„è®¡ç®—è¿‡ç¨‹ï¼Œåœ¨èŒƒç•´è®ºé‡Œé¢å« catamorphismï¼Œå³ä¸€ç§è¿æ¥çš„å˜å½¢ã€‚å’Œå®ƒç›¸åçš„å˜å½¢å« anamorphismã€‚ç°åœ¨æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå’Œ reduce è®¡ç®—è¿‡ç¨‹ç›¸åçš„å‡½æ•° unfoldï¼ˆæ³¨ï¼šreduce åœ¨ Haskell é‡Œé¢å« foldï¼Œå¯¹åº” unfoldï¼‰</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> unfold = (f, seed) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> go = (f, seed, acc) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> res = f(seed);</span><br><span class="line">    <span class="keyword">return</span> res ? go(f, res[<span class="number">1</span>], acc.concat(res[<span class="number">0</span>])) : acc;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> go(f, seed, []);</span><br><span class="line">&#125;;</span><br><span class="line">æ ¹æ®è¿™ä¸ª unfold å‡½æ•°ï¼Œå®šä¹‰ä¸€ä¸ª Python é‡Œé¢çš„ range å‡½æ•°ã€‚</span><br><span class="line">ç­”æ¡ˆï¼š</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> range = (min, max, step = <span class="number">1</span>) =&gt;</span><br><span class="line">  unfold(x =&gt; x &lt; max &amp;&amp; [x, x + step], min);</span><br></pre></td></tr></table></figure><h1 id="ç”¨é€’å½’ä»£æ›¿å¾ªç¯ï¼ˆå¯ä»¥breakï¼ï¼‰"><a href="#ç”¨é€’å½’ä»£æ›¿å¾ªç¯ï¼ˆå¯ä»¥breakï¼ï¼‰" class="headerlink" title="ç”¨é€’å½’ä»£æ›¿å¾ªç¯ï¼ˆå¯ä»¥breakï¼ï¼‰"></a>ç”¨é€’å½’ä»£æ›¿å¾ªç¯ï¼ˆå¯ä»¥breakï¼ï¼‰</h1><p>é—®é¢˜ä¸€ï¼š å°†ä¸¤ä¸ªæ•°ç»„æ¯ä¸ªå…ƒç´ ä¸€ä¸€å¯¹åº”ç›¸åŠ ã€‚æ³¨æ„ï¼Œç¬¬äºŒä¸ªæ•°ç»„æ¯”ç¬¬ä¸€ä¸ªå¤šå‡ºä¸¤ä¸ªï¼Œä¸è¦æŠŠç¬¬äºŒä¸ªæ•°ç»„éå†å®Œã€‚<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> num1 = [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>];</span><br><span class="line"><span class="keyword">const</span> num2 = [<span class="number">43</span>, <span class="number">23</span>, <span class="number">5</span>, <span class="number">67</span>, <span class="number">87</span>, <span class="number">3</span>, <span class="number">6</span>];</span><br><span class="line"></span><br><span class="line">ç­”æ¡ˆï¼š</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> zipWith = f =&gt; xs =&gt; ys =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (xs.length === <span class="number">0</span> || ys.length === <span class="number">0</span>) <span class="keyword">return</span> [];</span><br><span class="line">  <span class="keyword">const</span> [xHead, ...xTail] = xs;</span><br><span class="line">  <span class="keyword">const</span> [yHead, ...yTail] = ys;</span><br><span class="line">  <span class="keyword">return</span> [f(xHead)(yHead), ...zipWith(f)(xTail)(yTail)];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> add = x =&gt; y =&gt; x + y;</span><br><span class="line"></span><br><span class="line">zipWith(add)(num1)(num2);</span><br></pre></td></tr></table></figure></p><p>é—®é¢˜äºŒï¼š å°† Stark å®¶æ—æˆå‘˜æå–å‡ºæ¥ã€‚æ³¨æ„ï¼Œç›®æ ‡æ•°æ®åœ¨æ•°ç»„å‰é¢ï¼Œä½¿ç”¨ filter æ–¹æ³•éå†æ•´ä¸ªæ•°ç»„æ˜¯æµªè´¹ã€‚<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> houses = [</span><br><span class="line">  <span class="string">"Eddard Stark"</span>,</span><br><span class="line">  <span class="string">"Catelyn Stark"</span>,</span><br><span class="line">  <span class="string">"Rickard Stark"</span>,</span><br><span class="line">  <span class="string">"Brandon Stark"</span>,</span><br><span class="line">  <span class="string">"Rob Stark"</span>,</span><br><span class="line">  <span class="string">"Sansa Stark"</span>,</span><br><span class="line">  <span class="string">"Arya Stark"</span>,</span><br><span class="line">  <span class="string">"Bran Stark"</span>,</span><br><span class="line">  <span class="string">"Rickon Stark"</span>,</span><br><span class="line">  <span class="string">"Lyanna Stark"</span>,</span><br><span class="line">  <span class="string">"Tywin Lannister"</span>,</span><br><span class="line">  <span class="string">"Cersei Lannister"</span>,</span><br><span class="line">  <span class="string">"Jaime Lannister"</span>,</span><br><span class="line">  <span class="string">"Tyrion Lannister"</span>,</span><br><span class="line">  <span class="string">"Joffrey Baratheon"</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">ç­”æ¡ˆï¼š</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> takeWhile = f =&gt; ([head, ...tail]) =&gt;</span><br><span class="line">  f(head) ? [head, ...takeWhile(f)(tail)] : [];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isStark = name =&gt; name.toLowerCase().includes(<span class="string">"stark"</span>);</span><br><span class="line"></span><br><span class="line">takeWhile(isStark)(houses);</span><br></pre></td></tr></table></figure></p><p>é—®é¢˜äºŒï¼š æ‰¾å‡ºæ•°ç»„ä¸­çš„å¥‡æ•°ï¼Œç„¶åå–å‡ºå‰4ä¸ªï¼š<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> numList = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">11</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>];</span><br><span class="line"></span><br><span class="line">ç­”æ¡ˆï¼š</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> takeFirst = (limit, f, arr) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (limit === <span class="number">0</span> || arr.length === <span class="number">0</span>) <span class="keyword">return</span> [];</span><br><span class="line">  <span class="keyword">const</span> [head, ...tail] = arr;</span><br><span class="line">  <span class="keyword">return</span> f(head)</span><br><span class="line">    ? [head, ...takeFirst(limit - <span class="number">1</span>, f, tail)]</span><br><span class="line">    : takeFirst(limit, f, tail);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isOdd = n =&gt; n % <span class="number">2</span> === <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">takeFirst(<span class="number">4</span>, isOdd, numList);</span><br></pre></td></tr></table></figure></p><h1 id="ä½¿ç”¨é«˜é˜¶å‡½æ•°éå†æ•°ç»„æ—¶å¯èƒ½é‡åˆ°çš„é™·é˜±"><a href="#ä½¿ç”¨é«˜é˜¶å‡½æ•°éå†æ•°ç»„æ—¶å¯èƒ½é‡åˆ°çš„é™·é˜±" class="headerlink" title="ä½¿ç”¨é«˜é˜¶å‡½æ•°éå†æ•°ç»„æ—¶å¯èƒ½é‡åˆ°çš„é™·é˜±"></a>ä½¿ç”¨é«˜é˜¶å‡½æ•°éå†æ•°ç»„æ—¶å¯èƒ½é‡åˆ°çš„é™·é˜±</h1><p>é—®é¢˜ä¸€ï¼š  ä»é•¿åº¦ä¸º 100 ä¸‡çš„éšæœºæ•´æ•°ç»„æˆçš„æ•°ç»„ä¸­å–å‡ºå¶æ•°ï¼Œå†æŠŠæ‰€æœ‰æ•°å­—ä¹˜ä»¥ 3<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// ç”¨æˆ‘ä»¬åˆšåˆšå®šä¹‰çš„è¾…åŠ©å‡½æ•°æ¥ç”Ÿæˆç¬¦åˆè¦æ±‚çš„æ•°ç»„</span></span><br><span class="line"><span class="keyword">const</span> bigArr = genNumArr(<span class="number">1e6</span>, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">ç­”æ¡ˆï¼š</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isEven = num =&gt; num % <span class="number">2</span> === <span class="number">0</span>;</span><br><span class="line"><span class="keyword">const</span> triple = num =&gt; num * <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">bigArr.filter(isEven).<span class="built_in">map</span>(triple);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨æ„ï¼Œä¸Šé¢çš„è§£å†³æ–¹æ¡ˆå°†æ•°ç»„éå†äº†ä¸¤æ¬¡ï¼Œæ— ç–‘æ˜¯æµªè´¹ã€‚å¦‚æœå†™ for å¾ªç¯ï¼Œåªç”¨éå†ä¸€æ¬¡ï¼š</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> results = [];</span><br><span class="line"><span class="keyword">for</span> (let i = <span class="number">0</span>; i &lt; bigArr.length; i++) &#123;</span><br><span class="line">  <span class="keyword">if</span> (isEven(bigArr[i])) &#123;</span><br><span class="line">    results.push(triple(bigArr[i]));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æµ‹è¯•ï¼Œå…ˆ filter å† map çš„æ–¹æ³•è€—æ—¶ 105.024 msï¼Œè€Œé‡‡ç”¨ for å¾ªç¯çš„æ–¹æ³•è€—æ—¶ä»… 25.598 msï¼é‚£æ˜¯å¦è¯´æ˜é‡åˆ°æ­¤ç±»æƒ…å†µå¿…é¡»ç”¨ for å¾ªç¯è§£å†³å‘¢? Noï¼</span></span><br><span class="line"></span><br><span class="line"># Transduce</span><br><span class="line"></span><br><span class="line">å…ˆç”¨ reduce æ¥å®šä¹‰ filter å’Œ <span class="built_in">map</span>ï¼Œè‡³äºä¸ºä»€ä¹ˆè¿™æ ·åšç­‰ä¸‹å†è§£é‡Šã€‚</span><br><span class="line">```h</span><br><span class="line"><span class="keyword">const</span> filter = (f, arr) =&gt;</span><br><span class="line">  arr.reduce((acc, val) =&gt; (f(val) &amp;&amp; acc.push(val), acc), []);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="built_in">map</span> = (f, arr) =&gt; arr.reduce((acc, val) =&gt; (acc.push(f(val)), acc), []);</span><br></pre></td></tr></table></figure></p><p>é‡æ–°å®šä¹‰çš„ filter å’Œ map æœ‰å…±æœ‰çš„é€»è¾‘ã€‚æˆ‘ä»¬æŠŠè¿™éƒ¨åˆ†å…±æœ‰çš„é€»è¾‘å«åš reducerã€‚æœ‰äº†å…±æœ‰çš„é€»è¾‘åï¼Œæˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥åœ°æŠ½è±¡ï¼ŒæŠŠ reducer æŠ½ç¦»å‡ºæ¥ï¼Œç„¶åä¼ å…¥ filter å’Œ mapï¼š<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> filter = f =&gt; reducer =&gt; (acc, value) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (f(value)) <span class="keyword">return</span> reducer(acc, value);</span><br><span class="line">  <span class="keyword">return</span> acc;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="built_in">map</span> = f =&gt; reducer =&gt; (acc, value) =&gt; reducer(acc, f(value));</span><br></pre></td></tr></table></figure></p><p>ç°åœ¨ filter å’Œ map çš„å‡½æ•° signature ä¸€æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œå‡½æ•°ç»„åˆï¼ˆfunction compositionï¼‰äº†ã€‚<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pushReducer = (acc, value) =&gt; (acc.push(value), acc);</span><br><span class="line"></span><br><span class="line">bigNum.reduce(<span class="built_in">map</span>(triple)(filter(isEven)(pushReducer)), []);</span><br></pre></td></tr></table></figure></p><p>ä½†æ˜¯è¿™æ ·åµŒå¥—å†™æ³•æ˜“è¯»æ€§å¤ªå·®ï¼Œå¾ˆå®¹æ˜“å‡ºé”™ã€‚æˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªå·¥å…·å‡½æ•°æ¥è¾…åŠ©å‡½æ•°ç»„åˆï¼š<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pipe = (...fns) =&gt; (...args) =&gt; fns.reduce((fx, fy) =&gt; fy(fx), ...args);</span><br></pre></td></tr></table></figure></p><p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥ä¼˜é›…åœ°ç»„åˆå‡½æ•°äº†ï¼š<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">bigNum.reduce(</span><br><span class="line">  pipe(</span><br><span class="line">    filter(isEven),</span><br><span class="line">    <span class="built_in">map</span>(triple)</span><br><span class="line">  )(pushReducer),</span><br><span class="line">  []</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p><p>ç»è¿‡æµ‹è¯•ï¼ˆç”¨ console.time()/console.timeEnd()ï¼‰,ä¸Šé¢çš„å†™æ³•è€—æ—¶ 33.898 msï¼Œä»…æ¯” for å¾ªç¯æ…¢ 8 msã€‚ä¸ºäº†ä»£ç çš„æ˜“ç»´æŠ¤æ€§å’Œæ˜“è¯»æ€§ï¼Œè¿™ç‚¹æ€§èƒ½ä¸Šçš„å¾®å°ç‰ºç‰²ï¼Œæˆ‘è®¤ä¸ºæ˜¯å¯ä»¥æ¥å—çš„ã€‚<br>è¿™ç§å†™æ³•å« transduceã€‚æœ‰å¾ˆå¤šå·¥å…·åº“æä¾›äº† transducer å‡½æ•°ã€‚æ¯”å¦‚ <a href="https://link.juejin.im/?target=https%3A%2F%2Fgithub.com%2Fcognitect-labs%2Ftransducers-js" target="_blank" rel="noopener">transducers-js</a>ã€‚é™¤äº†ç”¨ transducer æ¥éå†æ•°ç»„ï¼Œè¿˜èƒ½ç”¨å®ƒæ¥éå†å¯¹è±¡å’Œå…¶å®ƒæ•°æ®é›†ã€‚åŠŸèƒ½ç›¸å½“å¼ºå¤§ã€‚</p><h1 id="for-å¾ªç¯å’Œ-for-â€¦-of-å¾ªç¯çš„åŒºåˆ«"><a href="#for-å¾ªç¯å’Œ-for-â€¦-of-å¾ªç¯çš„åŒºåˆ«" class="headerlink" title="for å¾ªç¯å’Œ for â€¦ of å¾ªç¯çš„åŒºåˆ«"></a>for å¾ªç¯å’Œ for â€¦ of å¾ªç¯çš„åŒºåˆ«</h1><p>for â€¦ of å¾ªç¯æ˜¯åœ¨ ES6 å¼•å…¥ Iterator åï¼Œä¸ºäº†éå† Iterable æ•°æ®ç±»å‹æ‰äº§ç”Ÿçš„ã€‚EcmaScript çš„ Iterable æ•°æ®ç±»å‹æœ‰æ•°ç»„ï¼Œå­—ç¬¦ä¸²ï¼ŒSet å’Œ Mapã€‚for â€¦ of å¾ªç¯å±äºé‡å‹çš„æ“ä½œï¼ˆå…·ä½“ç»†èŠ‚æˆ‘ä¹Ÿæ²¡äº†è§£è¿‡ï¼‰ï¼Œå¦‚æœç”¨ AirBNB çš„ ESLint è§„åˆ™ï¼Œåœ¨ä»£ç ä¸­ä½¿ç”¨ for â€¦ of æ¥éå†æ•°ç»„æ˜¯ä¼šè¢«ç¦æ­¢çš„ã€‚<br>é‚£ä¹ˆï¼Œfor â€¦ of å¾ªç¯åº”è¯¥åœ¨å“ªäº›åœºæ™¯ä½¿ç”¨å‘¢ï¼Ÿç›®å‰æˆ‘å‘ç°çš„åˆç†ä½¿ç”¨åœºæ™¯æ˜¯éå†è‡ªå®šä¹‰çš„ Iterableã€‚æ¥çœ‹è¿™ä¸ªï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">é—®é¢˜ï¼š å°† Stark å®¶æ—æˆå‘˜åå­—éå†ï¼Œæ¯æ¬¡éå†æš‚åœä¸€ç§’ï¼Œç„¶åå°†å½“å‰éå†çš„åå­—æ‰“å°æ¥ï¼Œéå†å®Œåå›åˆ°ç¬¬ä¸€ä¸ªå…ƒç´ å†é‡æ–°å¼€å§‹ï¼Œæ— é™å¾ªç¯ã€‚</span><br><span class="line">```h</span><br><span class="line"></span><br><span class="line">const starks = [</span><br><span class="line">  &quot;Eddard Stark&quot;,</span><br><span class="line">  &quot;Catelyn Stark&quot;,</span><br><span class="line">  &quot;Rickard Stark&quot;,</span><br><span class="line">  &quot;Brandon Stark&quot;,</span><br><span class="line">  &quot;Rob Stark&quot;,</span><br><span class="line">  &quot;Sansa Stark&quot;,</span><br><span class="line">  &quot;Arya Stark&quot;,</span><br><span class="line">  &quot;Bran Stark&quot;,</span><br><span class="line">  &quot;Rickon Stark&quot;,</span><br><span class="line">  &quot;Lyanna Stark&quot;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">ç­”æ¡ˆï¼š</span><br><span class="line"></span><br><span class="line">function* repeatedArr(arr) &#123;</span><br><span class="line">  let i = 0;</span><br><span class="line">  while (true) &#123;</span><br><span class="line">    yield arr[i++ % arr.length];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const infiniteNameList = repeatedArr(starks);</span><br><span class="line"></span><br><span class="line">const wait = ms =&gt;</span><br><span class="line">  new Promise(resolve =&gt; &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      resolve();</span><br><span class="line">    &#125;, ms);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">(async () =&gt; &#123;</span><br><span class="line">  for (const name of infiniteNameList) &#123;</span><br><span class="line">    await wait(1000);</span><br><span class="line">    console.log(name);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><p>å‰é¢è®²åˆ°çš„é—®é¢˜åŸºæœ¬è¦†ç›–äº†å¤§éƒ¨åˆ†éœ€è¦ä½¿ç”¨ for å¾ªç¯çš„åœºæ™¯ã€‚é‚£æ˜¯å¦æˆ‘ä»¬å¯ä»¥ä¿è¯æ°¸è¿œä¸ç”¨ for å¾ªç¯å‘¢ï¼Ÿå…¶å®ä¸æ˜¯ã€‚å¸¸ç”¨çš„æ•°ç»„åŸå‹é“¾ä¸Šçš„ mapï¼Œfilter ç­‰é«˜é˜¶å‡½æ•°ï¼Œåº•å±‚å…¶å®æ˜¯ç”¨ for å¾ªç¯å®ç°çš„ã€‚åœ¨éœ€è¦å†™ä¸€äº›åº•å±‚ä»£ç çš„æ—¶å€™ï¼Œè¿˜æ˜¯éœ€è¦å†™ for å¾ªç¯çš„ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;â€œå¾ˆå¤šåœºæ™¯ï¼Œforæ¥çš„æ›´ç›´æ¥ï¼Œæ›´æ˜äº†ã€‚â€  â€œæœ€å–œæ¬¢forå¾ªç¯äº†ã€‚æƒ³breakå°±breakã€‚å¯èƒ½ä¼šå¤šæ•°æ®çš„è¿˜æ˜¯forå¾ªç¯ã€‚â€ â€œforå¾ªç¯çµæ´»æ˜“ç”¨ï¼Œé«˜é˜¶å‡½æ•°ç®€æ´æ˜äº†ï¼Œåˆé€‚çš„ç”¨åˆé€‚æ–¹å¼ï¼Œè¿˜æ˜¯ä¸èƒ½é™åˆ¶çš„å¤ªæ­»å§ï¼Œä¸ç„¶æ€ç»´ä¹Ÿä¼šå—å½±å“â€,è¿™æ˜¯å¾ˆå¤šæ—¶å€™éƒ½ä¼šè€ƒè™‘çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/js_d.png&quot; alt=&quot;js&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Javascript" scheme="https://duanruilong.github.io/categories/Javascript/"/>
    
    
      <category term="Javascript" scheme="https://duanruilong.github.io/tags/Javascript/"/>
    
      <category term="ç¼–ç¨‹" scheme="https://duanruilong.github.io/tags/%E7%BC%96%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>å°ç¨‹åºä¹‹æ—…(äº”)</title>
    <link href="https://duanruilong.github.io/2018/07/22/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%B9%8B%E6%97%85-%E4%BA%94/"/>
    <id>https://duanruilong.github.io/2018/07/22/å°ç¨‹åºä¹‹æ—…-äº”/</id>
    <published>2018-07-22T15:54:08.000Z</published>
    <updated>2018-09-17T15:58:32.000Z</updated>
    
    <content type="html"><![CDATA[<p>å°ç¨‹åºæ˜¯ä¸€ç§æ–°çš„å¼€æ”¾èƒ½åŠ›ï¼Œå¼€å‘è€…å¯ä»¥å¿«é€Ÿåœ°å¼€å‘ä¸€ä¸ªå°ç¨‹åºã€‚å°ç¨‹åºå¯ä»¥åœ¨å¾®ä¿¡å†…è¢«ä¾¿æ·åœ°è·å–å’Œä¼ æ’­ï¼ŒåŒæ—¶å…·æœ‰å‡ºè‰²çš„ä½¿ç”¨ä½“éªŒã€‚è¿™æ˜¯å…³äºå°ç¨‹åºçš„æ•°æ®æœ¬åœ°å­˜å‚¨çš„æ—…è¡Œã€‚</p><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/wechat_d.png" alt="å¾®ä¿¡å°ç¨‹åº"></p><a id="more"></a><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æ•°æ®å­˜å‚¨æ˜¯éå¸¸é‡è¦çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œæ¯”å¦‚é¡µé¢ä¹‹é—´çš„åˆ‡æ¢ï¼Œå‚æ•°ä¿å­˜æ˜¯å¿…ä¸å¯å°‘çš„ã€‚html5çš„æœ¬åœ°å­˜å‚¨å…¶å®ä¸æ€ä¹ˆå¥½ä½¿ï¼Œå› ä¸ºå®ƒåªæ”¯æŒå­˜å‚¨å­—ç¬¦ä¸²ï¼Œå¯¹äºobjectå¯¹è±¡ï¼Œå°±åªèƒ½ç”¨åºåˆ—åŒ–çš„æ–¹å¼æ¥å›æŠ˜è…¾ï¼Œä¿©å­—â€”â€”éº»çƒ¦ã€‚<br>è€Œè‡ªä»æœ‰äº†å°ç¨‹åºçš„æ•°æ®å­˜å‚¨ï¼Œå†™ä»£ç çš„æ•ˆç‡æ˜æ˜¾ä¸Šæ¥äº†ï¼Œè¿™å¯éƒ½æ˜¯å’±å°ç¨‹åºçš„æ•°æ®å­˜å‚¨çš„åŠŸåŠ³å“‡ï¼</p><p>é‚£ä¹ˆæ¥çœ‹ä¸ªéœ€æ±‚ï¼š</p><ul><li>åšä¸€ä¸ªæŒ‰é’®ã€‚è¦æ±‚ç‚¹å‡»æŒ‰é’®åå¯ä»¥æµè§ˆç›¸å†Œï¼Œé€‰æ‹©ä¸€å¼ å›¾ç‰‡ï¼Œå¯ä»¥ä¿å­˜åœ¨å°ç¨‹åºé‡Œã€‚å½“ä¸‹æ¬¡æ‰“å¼€å°ç¨‹åºæ—¶ï¼Œè¿™å¼ å›¾ç‰‡è¿˜å­˜åœ¨ã€‚</li></ul><h1 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h1><ul><li>wx.chooseImageï¼šé€‰æ‹©å›¾ç‰‡</li><li>wx.saveFile(OBJ)ï¼šå°†ä¸´æ—¶å›¾ç‰‡ä¿å­˜åœ¨æœ¬åœ°</li><li>wx.setStorage(OBJ)ï¼šä¿å­˜å›¾ç‰‡çš„è·¯å¾„ã€‚</li></ul><p>å½“æˆ‘ä»¬é¢„è§ˆå®Œä¸€å¼ å›¾ç‰‡å¹¶é€‰ä¸­åï¼Œé¦–å…ˆè¦å°†è¿™ä¸ªä¸´æ—¶æ–‡ä»¶ä¿å­˜åœ¨æœ¬åœ°ï¼ŒæˆåŠŸåä¼šè¿”å›å›¾ç‰‡çš„æœ¬åœ°ä¿å­˜è·¯å¾„äº†ï¼Œç„¶åæˆ‘ä»¬å°±ä¿å­˜è¿™ä¸ªè·¯å¾„ï¼Œä¸‹æ¬¡è¿›æ¥æ—¶ç›´æ¥è¯»å–å°±è¡Œäº†ã€‚<br>å¥½äº†ï¼Œç†é¡ºäº†æ€è·¯ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹ä»£ç ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// &lt;!--index.wxml--&gt;</span></span><br><span class="line">&lt;view <span class="class"><span class="keyword">class</span>="<span class="title">container</span>"&gt;</span></span><br><span class="line"><span class="class">  &lt;view class="userinfo"&gt;</span></span><br><span class="line"><span class="class">    &lt;button wx:if="&#123;&#123;!hasUserInfo &amp;&amp; canIUse&#125;&#125;" open-type="getUserInfo" bindgetuserinfo="getUserInfo"&gt; è·å–å¤´åƒæ˜µç§° &lt;/button&gt;</span></span><br><span class="line"><span class="class">    &lt;block wx:else&gt;</span></span><br><span class="line"><span class="class">      &lt;image bindtap="bindViewTap" class="userinfo-avatar" src="&#123;&#123;userInfo.avatarUrl&#125;&#125;" mode="cover"&gt;&lt;/image&gt;</span></span><br><span class="line">      &lt;text class="userinfo-nickname"&gt;&#123;&#123;userInfo.nickName&#125;&#125;&lt;/text&gt;</span><br><span class="line">    &lt;/block&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">  &lt;view <span class="class"><span class="keyword">class</span>="<span class="title">usermotto</span>"&gt;</span></span><br><span class="line">    &lt;text class="user-motto"&gt;&#123;&#123;motto&#125;&#125;&lt;/text&gt;</span><br><span class="line">    &lt;button bindtap='keepImg'&gt;ä¿å­˜å›¾ç‰‡&lt;/button&gt;</span><br><span class="line">    &lt;button bindtap='deleteImg'&gt;åˆ é™¤å›¾ç‰‡&lt;/button&gt;</span><br><span class="line">    &lt;image src='&#123;&#123;imgPath&#125;&#125;'&gt;&lt;/image&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">&lt;/view&gt;</span><br></pre></td></tr></table></figure><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//index.js</span></span><br><span class="line"><span class="comment">//è·å–åº”ç”¨å®ä¾‹</span></span><br><span class="line"><span class="keyword">const</span> app = getApp()</span><br><span class="line"></span><br><span class="line">Page(&#123;</span><br><span class="line">  data: &#123;</span><br><span class="line">    motto: 'Hello World',</span><br><span class="line">    userInfo: &#123;&#125;,</span><br><span class="line">    hasUserInfo: <span class="literal">false</span>,</span><br><span class="line">    canIUse: wx.canIUse('button.open-type.getUserInfo'),</span><br><span class="line">    imgPath:<span class="string">''</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//äº‹ä»¶å¤„ç†å‡½æ•°</span></span><br><span class="line">  bindViewTap: function() &#123;</span><br><span class="line">    wx.navigateTo(&#123;</span><br><span class="line">      url: '../logs/logs'</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  keepImg:function()&#123;</span><br><span class="line">    var that = <span class="keyword">this</span>;</span><br><span class="line">    <span class="comment">// æµè§ˆæ–‡ä»¶</span></span><br><span class="line">    wx.chooseImage(&#123;</span><br><span class="line">      count:<span class="number">1</span>,</span><br><span class="line">      sizeType: ['original', 'compressed'], // å¯ä»¥æŒ‡å®šæ˜¯åŸå›¾è¿˜æ˜¯å‹ç¼©å›¾ï¼Œé»˜è®¤äºŒè€…éƒ½æœ‰</span><br><span class="line">      sourceType: ['album', 'camera'], //// å¯ä»¥æŒ‡å®šæ¥æºæ˜¯ç›¸å†Œè¿˜æ˜¯ç›¸æœºï¼Œé»˜è®¤äºŒè€…éƒ½æœ‰</span><br><span class="line">      success: function(res) &#123;</span><br><span class="line">        <span class="comment">// è¿”å›é€‰å®šç…§ç‰‡çš„æœ¬åœ°æ–‡ä»¶è·¯å¾„åˆ—è¡¨ï¼ŒtempFilePathå¯ä»¥ä½œä¸ºimgæ ‡ç­¾çš„srcå±æ€§æ˜¾ç¤ºå›¾ç‰‡</span></span><br><span class="line">        var tempFilePaths = res.tempFilePaths;</span><br><span class="line">        console.<span class="built_in">log</span>(tempFilePaths)</span><br><span class="line">        <span class="comment">//å°†æœ¬åœ°ç…§ç‰‡ä¿å­˜åœ¨å°ç¨‹åºå†…</span></span><br><span class="line">        wx.saveFile(&#123;</span><br><span class="line">          tempFilePath: tempFilePaths[<span class="number">0</span>],</span><br><span class="line">          success:function(res)&#123;</span><br><span class="line">            var savedFilePath = res.savedFilePath; <span class="comment">// å›¾ç‰‡æˆåŠŸä¹‹åå­˜å‚¨åœ¨æœ¬åœ°çš„è·¯å¾„</span></span><br><span class="line">            console.<span class="built_in">log</span>(savedFilePath)</span><br><span class="line"></span><br><span class="line">            if (!wx.getStorageSync('storageImgPath')) &#123; //æ•°æ®å­˜å‚¨ï¼Œä¿å­˜å›¾ç‰‡çš„è·¯å¾„</span><br><span class="line">              wx.setStorageSync('storageImgPath', savedFilePath)</span><br><span class="line">            &#125;</span><br><span class="line">            that.setData(&#123; imgPath: wx.getStorageSync('storageImgPath')&#125;)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  deleteImg:function()&#123;</span><br><span class="line">    wx.removeStorageSync('storageImgPath'); //ä»æ•°æ®ç¼“å­˜ä¸­åˆ é™¤</span><br><span class="line">    var that = <span class="keyword">this</span>;</span><br><span class="line">    wx.getSavedFileList(&#123; <span class="comment">//è·å–æœ¬åœ°çš„æ–‡ä»¶åˆ—è¡¨</span></span><br><span class="line">      success:function(res)&#123;</span><br><span class="line">        console.<span class="built_in">log</span>(res.errMsg);</span><br><span class="line">        var files = res.fileList;</span><br><span class="line">        <span class="keyword">if</span>(res.fileList.length&gt;<span class="number">0</span>)&#123;</span><br><span class="line">          <span class="comment">// åˆ é™¤ç¬¬ä¸€å¼ </span></span><br><span class="line">          wx.removeSavedFile(&#123;</span><br><span class="line">            filePath:res.fileList[<span class="number">0</span>].filePath,</span><br><span class="line">            success:function(res)&#123;</span><br><span class="line">              <span class="comment">// æç¤ºè¯­</span></span><br><span class="line">              wx.showToast(&#123;</span><br><span class="line">                title: 'åˆ é™¤æˆåŠŸ',</span><br><span class="line">                icon:'success',</span><br><span class="line">                duration:<span class="number">2000</span></span><br><span class="line">              &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  onLoad: function () &#123;</span><br><span class="line">    <span class="keyword">if</span> (app.globalData.userInfo) &#123;</span><br><span class="line">      <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">        userInfo: app.globalData.userInfo,</span><br><span class="line">        hasUserInfo: <span class="literal">true</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.data.canIUse)&#123;</span><br><span class="line">      <span class="comment">// ç”±äº getUserInfo æ˜¯ç½‘ç»œè¯·æ±‚ï¼Œå¯èƒ½ä¼šåœ¨ Page.onLoad ä¹‹åæ‰è¿”å›</span></span><br><span class="line">      <span class="comment">// æ‰€ä»¥æ­¤å¤„åŠ å…¥ callback ä»¥é˜²æ­¢è¿™ç§æƒ…å†µ</span></span><br><span class="line">      app.userInfoReadyCallback = res =&gt; &#123;</span><br><span class="line">        <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">          userInfo: res.userInfo,</span><br><span class="line">          hasUserInfo: <span class="literal">true</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// åœ¨æ²¡æœ‰ open-type=getUserInfo ç‰ˆæœ¬çš„å…¼å®¹å¤„ç†</span></span><br><span class="line">      wx.getUserInfo(&#123;</span><br><span class="line">        success: res =&gt; &#123;</span><br><span class="line">          app.globalData.userInfo = res.userInfo</span><br><span class="line">          <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">            userInfo: res.userInfo,</span><br><span class="line">            hasUserInfo: <span class="literal">true</span></span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  getUserInfo: function(e) &#123;</span><br><span class="line">    console.<span class="built_in">log</span>(e)</span><br><span class="line">    app.globalData.userInfo = e.detail.userInfo</span><br><span class="line">    <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">      userInfo: e.detail.userInfo,</span><br><span class="line">      hasUserInfo: <span class="literal">true</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="æ•ˆæœ"><a href="#æ•ˆæœ" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h1><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/wechat/wechat_05.png" alt="å¾®ä¿¡å°ç¨‹åº"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å°ç¨‹åºæ˜¯ä¸€ç§æ–°çš„å¼€æ”¾èƒ½åŠ›ï¼Œå¼€å‘è€…å¯ä»¥å¿«é€Ÿåœ°å¼€å‘ä¸€ä¸ªå°ç¨‹åºã€‚å°ç¨‹åºå¯ä»¥åœ¨å¾®ä¿¡å†…è¢«ä¾¿æ·åœ°è·å–å’Œä¼ æ’­ï¼ŒåŒæ—¶å…·æœ‰å‡ºè‰²çš„ä½¿ç”¨ä½“éªŒã€‚è¿™æ˜¯å…³äºå°ç¨‹åºçš„æ•°æ®æœ¬åœ°å­˜å‚¨çš„æ—…è¡Œã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/wechat_d.png&quot; alt=&quot;å¾®ä¿¡å°ç¨‹åº&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="å°ç¨‹åº" scheme="https://duanruilong.github.io/categories/%E5%B0%8F%E7%A8%8B%E5%BA%8F/"/>
    
    
      <category term="Javascript" scheme="https://duanruilong.github.io/tags/Javascript/"/>
    
      <category term="ç¼–ç¨‹" scheme="https://duanruilong.github.io/tags/%E7%BC%96%E7%A8%8B/"/>
    
      <category term="å°ç¨‹åº" scheme="https://duanruilong.github.io/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/"/>
    
  </entry>
  
  <entry>
    <title>iTerm2 + oh my zshæ‰“é€ æœ€å¼ºMacç»ˆç«¯</title>
    <link href="https://duanruilong.github.io/2018/07/22/iTerm2-oh-my-zsh-agnoster-%E6%89%93%E9%80%A0%E6%9C%80%E5%BC%BAMac%E7%BB%88%E7%AB%AF/"/>
    <id>https://duanruilong.github.io/2018/07/22/iTerm2-oh-my-zsh-agnoster-æ‰“é€ æœ€å¼ºMacç»ˆç«¯/</id>
    <published>2018-07-22T14:53:37.000Z</published>
    <updated>2018-09-17T15:58:32.000Z</updated>
    
    <content type="html"><![CDATA[<p>iTerm2 + oh my zsh æ‰“é€ æœ€å¼ºMacç»ˆç«¯</p><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/logo2x.jpg" alt="iTerm2"></p><a id="more"></a><p>#å®‰è£…iTerm2<br>iTerm2å®˜æ–¹ä¸‹è½½åœ°å€ <a href="http://www.iterm2.com/downloads.html" target="_blank" rel="noopener">http://www.iterm2.com/downloads.html</a></p><p>#å®‰è£… oh-my-zsh</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -L https:<span class="comment">//raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh | sh</span></span><br></pre></td></tr></table></figure><p>#é…ç½®<br>åˆ›å»ºé…ç½®æ–‡ä»¶<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp ~/.oh-my-zsh/templates/zshrc.zsh-<span class="keyword">template</span> ~/.zshrc</span><br></pre></td></tr></table></figure></p><h1 id="è®¾ç½®zshä¸ºé»˜è®¤çš„shell"><a href="#è®¾ç½®zshä¸ºé»˜è®¤çš„shell" class="headerlink" title="è®¾ç½®zshä¸ºé»˜è®¤çš„shell"></a>è®¾ç½®zshä¸ºé»˜è®¤çš„shell</h1><p><code>chsh -s /bin/zsh</code></p><p>æ­¤æ—¶ï¼Œzshå·²ç»å®‰è£…æˆåŠŸ </p><p>æ¥æ¥ä¸‹ï¼Œå¯ä»¥å»<a href="https://github.com/robbyrussell/oh-my-zsh/wiki/themes" target="_blank" rel="noopener">https://github.com/robbyrussell/oh-my-zsh/wiki/themes</a> ä¸Šä¸‹è½½ä¸€äº›zshçš„ä¸»é¢˜ï¼Œæ”¾ç½®åœ¨ ~/.oh-my-zsh/themes ç›®å½•ç›®å½•ä¸‹ï¼Œå¹¶åœ¨é…ç½®æ–‡ä»¶.zshrcä¸­è¿›è¡Œé€‚å½“çš„é…ç½®ã€‚å…¶å®ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œthemesç›®å½•ä¸‹å·²æœ‰å¾ˆå¤šæ ·å¼ã€‚ </p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;iTerm2 + oh my zsh æ‰“é€ æœ€å¼ºMacç»ˆç«¯&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/logo2x.jpg&quot; alt=&quot;iTerm2&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="è½¯ä»¶" scheme="https://duanruilong.github.io/categories/%E8%BD%AF%E4%BB%B6/"/>
    
    
      <category term="ç¼–ç¨‹" scheme="https://duanruilong.github.io/tags/%E7%BC%96%E7%A8%8B/"/>
    
      <category term="è½¯ä»¶" scheme="https://duanruilong.github.io/tags/%E8%BD%AF%E4%BB%B6/"/>
    
  </entry>
  
  <entry>
    <title>Async Functions (å¼‚æ­¥å‡½æ•°)</title>
    <link href="https://duanruilong.github.io/2018/07/15/Async-Functions-%E5%BC%82%E6%AD%A5%E5%87%BD%E6%95%B0/"/>
    <id>https://duanruilong.github.io/2018/07/15/Async-Functions-å¼‚æ­¥å‡½æ•°/</id>
    <published>2018-07-15T13:43:58.000Z</published>
    <updated>2018-09-17T15:58:32.000Z</updated>
    
    <content type="html"><![CDATA[<p> ECMAScript 2017 æ–°ç‰¹æ€§ Async Functions(å¼‚æ­¥å‡½æ•°) ã€‚</p><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/js_d.png" alt="js"></p><a id="more"></a><h1 id="async-å¼‚æ­¥-å‡½æ•°å˜ä½“"><a href="#async-å¼‚æ­¥-å‡½æ•°å˜ä½“" class="headerlink" title="async(å¼‚æ­¥) å‡½æ•°å˜ä½“"></a>async(å¼‚æ­¥) å‡½æ•°å˜ä½“</h1><p>ä»¥ä¸‹æ˜¯å·²ç»å­˜åœ¨çš„å¼‚æ­¥å‡½æ•°å˜ä½“ã€‚è¯·æ³¨æ„æ— å¤„ä¸åœ¨çš„  async å…³é”®å­—ã€‚</p><ul><li>å¼‚æ­¥å‡½æ•°å£°æ˜ï¼š async function foo() {}</li><li>å¼‚æ­¥å‡½æ•°è¡¨è¾¾å¼ï¼š const foo = async function () {};</li><li>å¼‚æ­¥å‡½æ•°å®šä¹‰ï¼šlet obj = { async foo() {} }</li><li>å¼‚æ­¥ç®­å¤´å‡½æ•°ï¼š const foo = async () =&gt; {};</li></ul><h1 id="async-å¼‚æ­¥-å‡½æ•°æ€»æ˜¯è¿”å›-Promises"><a href="#async-å¼‚æ­¥-å‡½æ•°æ€»æ˜¯è¿”å›-Promises" class="headerlink" title="async(å¼‚æ­¥) å‡½æ•°æ€»æ˜¯è¿”å› Promises"></a>async(å¼‚æ­¥) å‡½æ•°æ€»æ˜¯è¿”å› Promises</h1><p>async(å¼‚æ­¥) å‡½æ•°çš„ Promise å®ŒæˆçŠ¶æ€ï¼š</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">async function <span class="title">asyncFunc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">123</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">asyncFunc()</span><br><span class="line">.then(x =&gt; console.<span class="built_in">log</span>(x));</span><br><span class="line">    <span class="comment">// 123</span></span><br></pre></td></tr></table></figure><p>async(å¼‚æ­¥) å‡½æ•°çš„ Promise æ‹’ç»çŠ¶æ€ï¼š</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">async function <span class="title">asyncFunc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    throw new Error('Problem!');</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">asyncFunc()</span><br><span class="line">.<span class="keyword">catch</span>(err =&gt; console.<span class="built_in">log</span>(err));</span><br><span class="line">    <span class="comment">// Error: Problem!</span></span><br></pre></td></tr></table></figure><h1 id="é€šè¿‡-await-å¤„ç†-async-å¼‚æ­¥-è®¡ç®—çš„ç»“æœå’Œé”™è¯¯"><a href="#é€šè¿‡-await-å¤„ç†-async-å¼‚æ­¥-è®¡ç®—çš„ç»“æœå’Œé”™è¯¯" class="headerlink" title="é€šè¿‡ await å¤„ç† async(å¼‚æ­¥) è®¡ç®—çš„ç»“æœå’Œé”™è¯¯"></a>é€šè¿‡ await å¤„ç† async(å¼‚æ­¥) è®¡ç®—çš„ç»“æœå’Œé”™è¯¯</h1><p>awaitï¼ˆåªå…è®¸åœ¨ async(å¼‚æ­¥) å‡½æ•°å†…éƒ¨ä½¿ç”¨ï¼‰ç­‰å¾…å…¶æ“ä½œå¯¹è±¡ Promise è¿”å›ï¼š</p><ul><li>å¦‚æœ Promise æ˜¯å®ŒæˆçŠ¶æ€ï¼Œawait çš„ç»“æœæ˜¯å®Œæˆæ€çš„å€¼ã€‚</li><li>å¦‚æœ Promise æ˜¯æ‹’ç»çŠ¶æ€ï¼Œawait ä¼šæŠ›å‡ºæ‹’ç»å€¼ã€‚</li></ul><p>å¤„ç†å•ä¸ª async(å¼‚æ­¥) è¿”å›å€¼ï¼š<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">async function <span class="title">asyncFunc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> result = await otherAsyncFunc();</span><br><span class="line">    console.<span class="built_in">log</span>(result);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// ç­‰ä»·äº:</span></span><br><span class="line"><span class="function">function <span class="title">asyncFunc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> otherAsyncFunc()</span><br><span class="line">    .then(result =&gt; &#123;</span><br><span class="line">        console.<span class="built_in">log</span>(result);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æŒ‰é¡ºåºå¤„ç†å¤šä¸ª async(å¼‚æ­¥) è¿”å›å€¼ï¼š</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">async function <span class="title">asyncFunc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> result1 = await otherAsyncFunc1();</span><br><span class="line">    console.<span class="built_in">log</span>(result1);</span><br><span class="line">    <span class="keyword">const</span> result2 = await otherAsyncFunc2();</span><br><span class="line">    console.<span class="built_in">log</span>(result2);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// ç­‰ä»·äº:</span></span><br><span class="line"><span class="function">function <span class="title">asyncFunc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> otherAsyncFunc1()</span><br><span class="line">    .then(result1 =&gt; &#123;</span><br><span class="line">        console.<span class="built_in">log</span>(result1);</span><br><span class="line">        <span class="keyword">return</span> otherAsyncFunc2();</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(result2 =&gt; &#123;</span><br><span class="line">        console.<span class="built_in">log</span>(result2);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¹¶è¡Œå¤„ç†å¤šä¸ª async(å¼‚æ­¥) è¿”å›å€¼ï¼š</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">async function <span class="title">asyncFunc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> [result1, result2] = await Promise.all([</span><br><span class="line">        otherAsyncFunc1(),</span><br><span class="line">        otherAsyncFunc2(),</span><br><span class="line">    ]);</span><br><span class="line">    console.<span class="built_in">log</span>(result1, result2);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// ç­‰ä»·äº:</span></span><br><span class="line"><span class="function">function <span class="title">asyncFunc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Promise.all([</span><br><span class="line">        otherAsyncFunc1(),</span><br><span class="line">        otherAsyncFunc2(),</span><br><span class="line">    ])</span><br><span class="line">    .then([result1, result2] =&gt; &#123;</span><br><span class="line">        console.<span class="built_in">log</span>(result1, result2);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é”™è¯¯å¤„ç†ï¼š</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">async function <span class="title">asyncFunc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="function">await <span class="title">otherAsyncFunc</span><span class="params">()</span></span>;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        console.error(err);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// ç­‰ä»·äº:</span></span><br><span class="line"><span class="function">function <span class="title">asyncFunc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> otherAsyncFunc()</span><br><span class="line">    .<span class="keyword">catch</span>(err =&gt; &#123;</span><br><span class="line">        console.error(err);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ç†è§£-async-å¼‚æ­¥-å‡½æ•°"><a href="#ç†è§£-async-å¼‚æ­¥-å‡½æ•°" class="headerlink" title="ç†è§£ async(å¼‚æ­¥) å‡½æ•°"></a>ç†è§£ async(å¼‚æ­¥) å‡½æ•°</h1><p>è§£é‡Š async(å¼‚æ­¥) å‡½æ•°ä¹‹å‰ï¼Œæˆ‘éœ€è¦è§£é‡Šä¸€ä¸‹å¦‚ä½•ç»„åˆä½¿ç”¨ Promises å’Œ Generator ï¼Œé€šè¿‡çœ‹èµ·æ¥åŒæ­¥çš„ä»£ç æ¥æ‰§è¡Œ async(å¼‚æ­¥) æ“ä½œã€‚</p><p>å¯¹äºèƒ½å¤Ÿ async(å¼‚æ­¥) è®¡ç®—å…¶ä¸€æ¬¡æ€§ç»“æœçš„å‡½æ•°ï¼Œä½œä¸º ES6 ä¸€éƒ¨åˆ†çš„ Promises å·²ç»å˜å¾—æµè¡Œèµ·æ¥ã€‚ä¸€ä¸ªä¾‹å­æ˜¯ å®¢æˆ·ç«¯ fetch API ï¼Œå®ƒæ˜¯ XMLHttpRequest è·å–æ•°æ®çš„æ›¿ä»£æ–¹æ³•ã€‚ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">function <span class="title">fetchJson</span><span class="params">(url)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> fetch(url)</span><br><span class="line">    .then(request =&gt; request.text())</span><br><span class="line">    .then(text =&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> JSON.parse(text);</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="keyword">catch</span>(error =&gt; &#123;</span><br><span class="line">        console.<span class="built_in">log</span>(`ERROR: $&#123;error.<span class="built_in">stack</span>&#125;`);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line">fetchJson('http://example.com/some_file.json')</span><br><span class="line">.then(obj =&gt; console.<span class="built_in">log</span>(obj));</span><br></pre></td></tr></table></figure><h1 id="é€šè¿‡-generator-æ¥ç¼–å†™å¼‚æ­¥ä»£ç "><a href="#é€šè¿‡-generator-æ¥ç¼–å†™å¼‚æ­¥ä»£ç " class="headerlink" title="é€šè¿‡ generator æ¥ç¼–å†™å¼‚æ­¥ä»£ç "></a>é€šè¿‡ generator æ¥ç¼–å†™å¼‚æ­¥ä»£ç </h1><p>co æ˜¯ä¸€ä¸ªä½¿ç”¨ Promise å’Œ generator æ¥å®ç°çœ‹ä¼¼åŒæ­¥ç¼–ç çš„åº“ï¼Œä½†ä¸ä¸Šä¸€ç¤ºä¾‹ä¸­ä½¿ç”¨çš„æ ·å¼ç›¸åŒï¼š</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fetchJson = co.wrap(function* (url) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        let request = yield fetch(url);</span><br><span class="line">        let text = yield request.text();</span><br><span class="line">        <span class="keyword">return</span> JSON.parse(text);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        console.<span class="built_in">log</span>(`ERROR: $&#123;error.<span class="built_in">stack</span>&#125;`);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>æ¯æ¬¡å›è°ƒå‡½æ•°ï¼ˆ generator å‡½æ•°ï¼‰äº§ç”Ÿä¸€ä¸ª Promise å¯¹è±¡ç»™ co ï¼Œå›è°ƒä¼šè¢«æš‚åœï¼Œåªæœ‰å½“ Promise æ‰§è¡Œå®Œæˆåï¼Œco æ‰ä¼šç»§ç»­æ‰§è¡Œå›è°ƒ ã€‚ å¦‚æœ Promise å¤„äºå®ŒæˆçŠ¶æ€ï¼Œyield è¿”å›å®ŒæˆçŠ¶æ€çš„å€¼ï¼Œå¦‚æœå¤„äºæ‹’ç»çŠ¶æ€ï¼Œyield æŠ›å‡ºæ‹’ç»çŠ¶æ€çš„é”™è¯¯ã€‚æ­¤å¤–ï¼Œco ä¿è¯ç»“æœæ˜¯é€šè¿‡å›è°ƒæ‰§è¡Œå®Œæˆæ‰è¿”å›çš„ï¼ˆç±»ä¼¼äº  then() æ‰€åšçš„å·¥ä½œï¼‰ã€‚</p><h1 id="é€šè¿‡-async-å¼‚æ­¥-å‡½æ•°æ¥ç¼–å†™å¼‚æ­¥ä»£ç "><a href="#é€šè¿‡-async-å¼‚æ­¥-å‡½æ•°æ¥ç¼–å†™å¼‚æ­¥ä»£ç " class="headerlink" title="é€šè¿‡ async(å¼‚æ­¥) å‡½æ•°æ¥ç¼–å†™å¼‚æ­¥ä»£ç "></a>é€šè¿‡ async(å¼‚æ­¥) å‡½æ•°æ¥ç¼–å†™å¼‚æ­¥ä»£ç </h1><p>async(å¼‚æ­¥) å‡½æ•°ç”¨çš„ç‰¹å®šè¯­æ³•åŸºæœ¬ä¸Šå’Œ co ç±»ä¼¼ï¼š<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">async function <span class="title">fetchJson</span><span class="params">(url)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        let request = await fetch(url);</span><br><span class="line">        let text = await request.text();</span><br><span class="line">        <span class="keyword">return</span> JSON.parse(text);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        console.<span class="built_in">log</span>(`ERROR: $&#123;error.<span class="built_in">stack</span>&#125;`);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åœ¨å†…éƒ¨ï¼Œå¼‚æ­¥å‡½æ•°å†™æ³•æ›´ç±»ä¼¼äº generators ã€‚</p><h1 id="ä»¥åŒæ­¥å¼€å§‹ï¼Œå¼‚æ­¥å¤„ç†çš„-async-å¼‚æ­¥-å‡½æ•°"><a href="#ä»¥åŒæ­¥å¼€å§‹ï¼Œå¼‚æ­¥å¤„ç†çš„-async-å¼‚æ­¥-å‡½æ•°" class="headerlink" title="ä»¥åŒæ­¥å¼€å§‹ï¼Œå¼‚æ­¥å¤„ç†çš„ async(å¼‚æ­¥) å‡½æ•°"></a>ä»¥åŒæ­¥å¼€å§‹ï¼Œå¼‚æ­¥å¤„ç†çš„ async(å¼‚æ­¥) å‡½æ•°</h1><p>ä»¥ä¸‹æ˜¯ async(å¼‚æ­¥)å‡½æ•°æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼š</p><ul><li>1ã€async(å¼‚æ­¥) å‡½æ•°æ€»æ˜¯è¿”å›ä¸€ä¸ª Promise å¯¹è±¡ p ã€‚Promise å¯¹è±¡åœ¨ async(å¼‚æ­¥) å‡½æ•°å¼€å§‹æ‰§è¡Œæ—¶è¢«åˆ›å»ºã€‚</li><li>2ã€å‡½æ•°ä½“æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯ä»¥é€šè¿‡ return æˆ– throw ç»ˆæ­¢æ‰§è¡Œã€‚æˆ–è€…é€šè¿‡ await æš‚åœæ‰§è¡Œï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé€šå¸¸ä¼šåœ¨ä»¥åç»§ç»­æ‰§è¡Œã€‚</li><li>3ã€è¿”å› Promise å¯¹è±¡ pã€‚</li></ul><p>å½“æ‰§è¡Œ async(å¼‚æ­¥) å‡½æ•°çš„å‡½æ•°ä½“æ—¶ï¼Œreturn x ä¸­çš„ x æ˜¯ Promise å¯¹è±¡ p çš„å®ŒæˆçŠ¶æ€çš„ç»“æœï¼Œè€Œ throw err æ˜¯ p çš„æ‹’ç»çŠ¶æ€çš„ç»“æœã€‚æ‰§è¡Œç»“æœæ˜¯å¼‚æ­¥è¿”å›çš„ã€‚æ¢å¥è¯è¯´ï¼šthen() å’Œ  catch() çš„å›è°ƒæ€»æ˜¯åœ¨å½“å‰ä»£ç å®Œæˆåæ‰§è¡Œã€‚</p><p>ä»¥ä¸‹æ˜¯ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function">async function <span class="title">asyncFunc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    console.log('asyncFunc()'); // (A)</span><br><span class="line">    return 'abc';</span><br><span class="line">&#125;</span><br><span class="line">asyncFunc().</span><br><span class="line">then(x =&gt; console.<span class="built_in">log</span>(`Resolved: $&#123;x&#125;`)); <span class="comment">// (B)</span></span><br><span class="line">console.log('main'); // (C)</span><br><span class="line"> </span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line"><span class="comment">// asyncFunc()</span></span><br><span class="line"><span class="comment">// main</span></span><br><span class="line"><span class="comment">// Resolved: abc</span></span><br></pre></td></tr></table></figure><p>æ‚¨å¯ä»¥è®¤ä¸ºæ˜¯ä»¥ä¸‹çš„æ‰§è¡Œé¡ºåºï¼š</p><ul><li>1ã€è¡ŒAï¼šasync(å¼‚æ­¥) å‡½æ•°ä»¥åŒæ­¥å¼€å§‹ã€‚async(å¼‚æ­¥) å‡½æ•°çš„ Promise é€šè¿‡ return æ¥è¿”å›å®ŒæˆçŠ¶æ€çš„ç»“æœã€‚</li><li>2ã€è¡ŒCï¼šæ‰§è¡Œç»§ç»­ã€‚</li><li>3ã€è¡ŒBï¼šPromise å®ŒæˆçŠ¶æ€é€šçŸ¥æ˜¯å¼‚æ­¥å‘ç”Ÿçš„ã€‚</li></ul><h1 id="è¿”å›ä¸è¢«åŒ…è£¹çš„-Promise-å¯¹è±¡"><a href="#è¿”å›ä¸è¢«åŒ…è£¹çš„-Promise-å¯¹è±¡" class="headerlink" title="è¿”å›ä¸è¢«åŒ…è£¹çš„ Promise å¯¹è±¡"></a>è¿”å›ä¸è¢«åŒ…è£¹çš„ Promise å¯¹è±¡</h1><p>Promise çš„ resolve æ˜¯ä¸€é¡¹æ ‡å‡†æ“ä½œã€‚ return å°±æ˜¯ä½¿ç”¨å®ƒæ¥ resolve async(å¼‚æ­¥) å‡½æ•°çš„ Promise  p çš„ã€‚è¿™æ„å‘³ç€ï¼š</p><ul><li>1ã€è¿”å›ä¸€ä¸ªé Promise å€¼ï¼Œè¯¥å€¼å°†è¢«å¤„ç†æˆ p çš„å®ŒæˆçŠ¶æ€å€¼ã€‚</li><li>2ã€è¿”å›ä¸€ä¸ª Promise å¯¹è±¡ï¼Œé‚£ä¹ˆ p æ­¤æ—¶ç›¸å½“äºæ˜¯è¯¥ Promise çš„çŠ¶æ€ã€‚<br>å› æ­¤ï¼Œæ‚¨å¯ä»¥è¿”å›ä¸€ä¸ª Promise ï¼Œå¹¶ä¸”è¿™ä¸ª Promise ä¸ä¼šåŒ…è£¹åœ¨åˆ«çš„ Promise ä¸­ï¼š<figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">async function <span class="title">asyncFunc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Promise.resolve(<span class="number">123</span>);</span><br><span class="line">&#125;</span><br><span class="line">asyncFunc()</span><br><span class="line">.then(x =&gt; console.<span class="built_in">log</span>(x)) <span class="comment">// 123</span></span><br></pre></td></tr></table></figure></li></ul><p>æœ‰è¶£çš„æ˜¯ï¼Œè¿”å›ä¸€ä¸ªæ‹’ç»çŠ¶æ€ï¼ˆrejectï¼‰çš„ Promise å¯¹è±¡ä¼šå¯¼è‡´ async(å¼‚æ­¥) å‡½æ•°è¢«æ‹’ç»ï¼ˆrejectï¼‰ï¼ˆé€šå¸¸ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ throw ï¼‰ï¼š</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">JavaScript ä»£ç :</span><br><span class="line"><span class="function">async function <span class="title">asyncFunc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    return Promise.reject(new Error('Problem!'));</span><br><span class="line">&#125;</span><br><span class="line">asyncFunc()</span><br><span class="line">.<span class="keyword">catch</span>(err =&gt; console.error(err)); <span class="comment">// Error: Problem!</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ Promise è§£å†³æ–¹æ¡ˆçš„å·¥ä½œæ–¹å¼æ˜¯ä¸€è‡´çš„ã€‚ ä½¿ä½ èƒ½å¤Ÿåœ¨ä¸ä½¿ç”¨ await çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨å…¶ä»– async(å¼‚æ­¥) è®¡ç®—æ¥æ‰§è¡Œå®Œæˆå’Œæ‹’ç»å¤„ç†ï¼š<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">JavaScript ä»£ç :</span><br><span class="line"><span class="function">async function <span class="title">asyncFunc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> anotherAsyncFunc();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä¸Šé¢çš„ä»£ç ç¤ºä¾‹å’Œä¸‹é¢çš„ç±»ä¼¼ï¼Œä½†æ˜¯æ¯”ä¸‹é¢çš„æ›´é«˜æ•ˆã€‚ï¼ˆä»¥ä¸‹ä»£ç ç¤ºä¾‹æ²¡æœ‰åŒ…è£¹  anotherAsyncFunc() çš„ Promise ï¼Œè€Œæ˜¯åŒ…è£¹ anotherAsyncFunc() æœ¬èº« ï¼‰ï¼š<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">JavaScript ä»£ç :</span><br><span class="line"><span class="function">async function <span class="title">asyncFunc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> await anotherAsyncFunc();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h1 id="ä½¿ç”¨-await-å°è´´å£«"><a href="#ä½¿ç”¨-await-å°è´´å£«" class="headerlink" title="ä½¿ç”¨ await å°è´´å£«"></a>ä½¿ç”¨ await å°è´´å£«</h1><h2 id="ä¸è¦å¿˜è®°ä½¿ç”¨-await"><a href="#ä¸è¦å¿˜è®°ä½¿ç”¨-await" class="headerlink" title="ä¸è¦å¿˜è®°ä½¿ç”¨ await"></a>ä¸è¦å¿˜è®°ä½¿ç”¨ await</h2><p>åœ¨ async(å¼‚æ­¥) å‡½æ•°ä¸­å®¹æ˜“çŠ¯çš„ä¸€ä¸ªé”™è¯¯å°±æ˜¯åœ¨è°ƒç”¨ async(å¼‚æ­¥) å‡½æ•°æ—¶å¿˜è®°ä½¿ç”¨ await ï¼š<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">JavaScript ä»£ç :</span><br><span class="line"><span class="function">async function <span class="title">asyncFunc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> value = otherAsyncFunc(); <span class="comment">// missing `await`!</span></span><br><span class="line">    Â·Â·Â·</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ–¹æ³•æ‰§è¡Œè¿”å›çš„ Promise å¯¹è±¡èµ‹å€¼ç»™äº† value ï¼Œå®ƒé€šå¸¸ä¸æ˜¯ä½ åœ¨ async(å¼‚æ­¥) å‡½æ•°ä¸­æƒ³è¦çš„ç»“æœã€‚</p><p>await ç”šè‡³å¯ä»¥åœ¨ async(å¼‚æ­¥) å‡½æ•°ä¸è¿”å›ä»»ä½•å€¼çš„æƒ…å†µä¸‹èµ·ä½œç”¨ã€‚å®ƒçš„ Promise åªæ˜¯ç”¨æ¥å‘Šè¯‰è°ƒç”¨è€…å®ŒæˆçŠ¶æ€ã€‚ä¾‹å¦‚ï¼š<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">JavaScript ä»£ç :</span><br><span class="line"><span class="function">async function <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">await <span class="title">step1</span><span class="params">()</span></span>; <span class="comment">// (A)</span></span><br><span class="line">    Â·Â·Â·</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¡ŒAä¸­çš„ await ç¡®ä¿åœ¨æ‰§è¡Œ foo() å‰©ä½™éƒ¨åˆ†ä¹‹å‰ï¼Œ step1() å·²ç»æ‰§è¡Œå®Œæˆã€‚</p><h2 id="ä¸éœ€è¦ä½¿ç”¨-await-çš„æƒ…å†µ"><a href="#ä¸éœ€è¦ä½¿ç”¨-await-çš„æƒ…å†µ" class="headerlink" title="ä¸éœ€è¦ä½¿ç”¨ await çš„æƒ…å†µ"></a>ä¸éœ€è¦ä½¿ç”¨ await çš„æƒ…å†µ</h2><p>æœ‰æ—¶ï¼Œä½ åªæƒ³è§¦å‘å¼‚æ­¥è®¡ç®—ï¼Œå¹¶ä¸”ä¸éœ€è¦å…³æ³¨å®ƒä»€ä¹ˆæ—¶å€™å®Œæˆã€‚ä»¥ä¸‹æ˜¯ä»£ç ç¤ºä¾‹ï¼š<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">JavaScript ä»£ç :</span><br><span class="line"><span class="function">async function <span class="title">asyncFunc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    const writer = openFile('someFile.txt');</span><br><span class="line">    writer.write('hello'); // donâ€™t wait</span><br><span class="line">    writer.write('world'); // donâ€™t wait</span><br><span class="line">    await writer.close(); <span class="comment">// wait for file to close</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸å…³å¿ƒå•ä¸ªçš„å†™å…¥æ“ä½œæ˜¯å¦å®Œæˆï¼Œåªéœ€è¦ä»–ä»¬ä»¥æ­£ç¡®çš„é¡ºåºæ‰§è¡Œ (APIå¿…é¡»ä¿è¯ï¼Œä½†è¿™æ˜¯ç”± async(å¼‚æ­¥) å‡½æ•°çš„æ‰§è¡Œæ¨¡å‹æ‰€é¼“åŠ±çš„ï¼Œæ­£å¦‚æˆ‘ä»¬æ‰€è§)ã€‚</p><p>asyncFunc() å‡½æ•°æœ€åä¸€è¡Œçš„ await ç¡®ä¿è¯¥å‡½æ•°ä»…åœ¨æ–‡ä»¶å†™å…¥å…³é—­åæ‰ä¼šæ‰§è¡Œã€‚</p><p>ç”±äºè¿”å›çš„ Promises æ²¡æœ‰è¢«å…¶ä»– async(å¼‚æ­¥) å‡½æ•°åŒ…è£¹ï¼Œæ‰€ä»¥ä½ å¯ä»¥ç”¨ return æ›¿æ¢  await writer.close() ï¼š<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">JavaScript ä»£ç :</span><br><span class="line"><span class="function">async function <span class="title">asyncFunc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    const writer = openFile('someFile.txt');</span><br><span class="line">    writer.write('hello');</span><br><span class="line">    writer.write('world');</span><br><span class="line">    <span class="keyword">return</span> writer.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™ä¸¤ä¸ªç‰ˆæœ¬å„æœ‰åˆ©å¼Šï¼Œawait ç‰ˆæœ¬å¯èƒ½ç¨å¾®æ›´å®¹æ˜“ç†è§£ã€‚</p><h2 id="await-æ˜¯é¡ºåºæ‰§è¡Œçš„ï¼ŒPromise-all-æ˜¯å¹¶è¡Œçš„"><a href="#await-æ˜¯é¡ºåºæ‰§è¡Œçš„ï¼ŒPromise-all-æ˜¯å¹¶è¡Œçš„" class="headerlink" title="await æ˜¯é¡ºåºæ‰§è¡Œçš„ï¼ŒPromise.all() æ˜¯å¹¶è¡Œçš„"></a>await æ˜¯é¡ºåºæ‰§è¡Œçš„ï¼ŒPromise.all() æ˜¯å¹¶è¡Œçš„</h2><p>ä¸‹é¢çš„ä»£ç è°ƒç”¨äº†ä¸¤ä¸ª async(å¼‚æ­¥) å‡½æ•°ï¼Œ asyncFunc1() å’Œ asyncFunc1() ã€‚<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">JavaScript ä»£ç :</span><br><span class="line"><span class="function">async function <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> result1 = await asyncFunc1();</span><br><span class="line">    <span class="keyword">const</span> result2 = await asyncFunc2();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™ä¸¤ä¸ªå‡½æ•°è°ƒç”¨é¡ºåºæ‰§è¡Œã€‚ä½†æ˜¯å¹¶è¡Œæ‰§è¡Œå®ƒä»¬å¾€å¾€ä¼šåŠ å¿«é€Ÿåº¦ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ Promise.all() ï¼š</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">JavaScript ä»£ç :</span><br><span class="line"><span class="function">async function <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> [result1, result2] = await Promise.all([</span><br><span class="line">        asyncFunc1(),</span><br><span class="line">        asyncFunc2(),</span><br><span class="line">    ]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ç°åœ¨æ­£åœ¨ç­‰å¾…ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªå…ƒç´ çš„æ•°ç»„çš„ Promise ï¼Œè€Œä¸æ˜¯ç­‰å¾…ä¸¤ä¸ª Promiseã€‚</p><h1 id="å¼‚æ­¥å‡½æ•°å’Œå›è°ƒ"><a href="#å¼‚æ­¥å‡½æ•°å’Œå›è°ƒ" class="headerlink" title="å¼‚æ­¥å‡½æ•°å’Œå›è°ƒ"></a>å¼‚æ­¥å‡½æ•°å’Œå›è°ƒ</h1><p>async(å¼‚æ­¥) å‡½æ•°çš„ä¸€ä¸ªé™åˆ¶æ˜¯ await(ç­‰å¾…) åªå½±å“ç›´æ¥ç›¸å…³çš„ async(å¼‚æ­¥) å‡½æ•°ã€‚å› æ­¤ï¼Œasync(å¼‚æ­¥) å‡½æ•°æ— æ³•åœ¨å›è°ƒï¼ˆä½†æ˜¯ï¼Œå›è°ƒå¯ä»¥æ˜¯ async(å¼‚æ­¥) å‡½æ•°æœ¬èº«ï¼Œç¨åæˆ‘ä»¬å°†ä¼šçœ‹åˆ°ï¼‰ä¸­ä½¿ç”¨ await(ç­‰å¾…)ã€‚è¿™ä½¿å¾—åŸºäºå›è°ƒçš„å®ç”¨å‡½æ•°å’Œæ–¹æ³•éš¾ä»¥ä½¿ç”¨ã€‚ä¾‹å­ä¸­æˆ‘ä»¬å°†ä½¿ç”¨æ•°ç»„æ–¹æ³• map() å’Œ forEach() ã€‚</p><h1 id="Array-prototype-map"><a href="#Array-prototype-map" class="headerlink" title="Array.prototype.map()"></a>Array.prototype.map()</h1><p>æˆ‘ä»¬ä»æ•°ç»„æ–¹æ³• map() å¼€å§‹è®²è§£ã€‚åœ¨ä¸‹é¢çš„ä»£ç ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æƒ³è¦åŠ è½½ç”± URLs æ•°ç»„æŒ‡å‘çš„æ–‡ä»¶ï¼Œå¹¶å°†å®ƒä»¬è¿”å›åˆ°æ•°ç»„ä¸­ã€‚<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">JavaScript ä»£ç :</span><br><span class="line"><span class="function">async function <span class="title">downloadContent</span><span class="params">(urls)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> urls.<span class="built_in">map</span>(url =&gt; &#123;</span><br><span class="line">        <span class="comment">// é”™è¯¯çš„è¯­æ³•!</span></span><br><span class="line">        <span class="keyword">const</span> content = await httpGet(url);</span><br><span class="line">        <span class="keyword">return</span> content;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™ä¸èµ·ä½œç”¨ï¼Œå› ä¸ºåœ¨æ­£å¸¸ç®­å¤´å‡½æ•°ä¸­ await è¯­æ³•ä¸Šæ˜¯éæ³•çš„(æ„šäººç å¤´æ³¨ï¼š await(ç­‰å¾…) åªå½±å“ç›´æ¥ç›¸å…³çš„ async(å¼‚æ­¥) å‡½æ•°)ã€‚é‚£ä¹ˆå¦‚ä½•ä½¿ç”¨å¼‚æ­¥çš„ç®­å¤´å‡½æ•°å‘¢ï¼Ÿ<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">JavaScript ä»£ç :</span><br><span class="line"><span class="function">async function <span class="title">downloadContent</span><span class="params">(urls)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> urls.<span class="built_in">map</span>(async (url) =&gt; &#123; <span class="comment">// æ³¨æ„è¿™ä¸€è¡Œä¸­çš„ async ;</span></span><br><span class="line">        <span class="keyword">const</span> content = await httpGet(url);</span><br><span class="line">        <span class="keyword">return</span> content;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™æ®µä»£ç æœ‰ä¸¤ä¸ªé—®é¢˜ï¼š</p><p>ç°åœ¨è¿”å›çš„ç»“æœæ˜¯ä¸€ä¸ª Promises å¯¹è±¡çš„æ•°ç»„ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²çš„æ•°ç»„ã€‚<br>ä¸€æ—¦ map() æ‰§è¡Œå®Œæˆï¼Œå›è°ƒæ‰§è¡Œçš„å·¥ä½œå¹¶ä¸èƒ½åŒæ—¶å®Œæˆï¼Œå› ä¸º await åªæš‚åœäº†åŒ…è£¹å®ƒçš„ç®­å¤´å‡½æ•° å’Œ httpGet() å¼‚æ­¥æ‰§è¡Œè¾¾åˆ°å®ŒæˆçŠ¶æ€ã€‚è¿™æ„å‘³ç€ä½ ä¸èƒ½ä½¿ç”¨ awaitï¼Œæ¥ç­‰å¾…  downloadContent() æ‰§è¡Œç»“æŸã€‚<br>æˆ‘ä»¬å¯ä»¥é€šè¿‡ Promise.all() æ¥è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ï¼ŒPromise.all() å¯ä»¥å°†ä¸€ç³»åˆ—çš„ Promise è½¬æ¢ä¸ºä¸€ä¸ª Promise æ•°ç»„ï¼ˆæ‰€æœ‰å€¼éƒ½æ˜¯ç»è¿‡ Promise å®Œæˆå¹¶è¿”å›ï¼‰ï¼š<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">JavaScript ä»£ç :</span><br><span class="line"><span class="function">async function <span class="title">downloadContent</span><span class="params">(urls)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> promiseArray = urls.<span class="built_in">map</span>(async (url) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> content = await httpGet(url);</span><br><span class="line">        <span class="keyword">return</span> content;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> await Promise.all(promiseArray);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>map() çš„å›è°ƒå¹¶ä¸å¯¹ httpGet() çš„ç»“æœèµ·ä½œç”¨ï¼Œåªæ˜¯èµ·åˆ°ä¸æ–­æ‰§è¡Œçš„ä½œç”¨ã€‚å› æ­¤ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸éœ€è¦ä¸€ä¸ªå¼‚æ­¥çš„ç®­å¤´å‡½æ•°ï¼Œåªéœ€è¦ä¸€ä¸ªæ™®é€šçš„ç®­å¤´å‡½æ•°å°±èƒ½è¾¾åˆ°ç›¸åŒçš„ç»“æœã€‚<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">JavaScript ä»£ç :</span><br><span class="line"><span class="function">async function <span class="title">downloadContent</span><span class="params">(urls)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> promiseArray = urls.<span class="built_in">map</span>(</span><br><span class="line">        url =&gt; httpGet(url));</span><br><span class="line">    <span class="keyword">return</span> await Promise.all(promiseArray);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æˆ‘ä»¬ä»ç„¶å¯ä»¥åšä¸€ä¸ªå°çš„æ”¹è¿›ï¼šè¿™ä¸ªå¼‚æ­¥å‡½æ•°ç¨å¾®æœ‰ç‚¹ä½æ•ˆ â€“ é¦–å…ˆé€šè¿‡ await æ¥è§£å¼€  Promise.all() çš„ç»“æœï¼Œç„¶åé€šè¿‡ return å†æ¬¡åŒ…è£¹å®ƒã€‚ å‡è®¾ return ä¸åŒ…è£¹ Promisesï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è¿”å› Promise.all() çš„ç»“æœï¼š<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">JavaScript ä»£ç :</span><br><span class="line"><span class="function">async function <span class="title">downloadContent</span><span class="params">(urls)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> promiseArray = urls.<span class="built_in">map</span>(</span><br><span class="line">        url =&gt; httpGet(url));</span><br><span class="line">    <span class="keyword">return</span> Promise.all(promiseArray);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h1 id="Array-prototype-forEach"><a href="#Array-prototype-forEach" class="headerlink" title="Array.prototype.forEach()"></a>Array.prototype.forEach()</h1><p>æˆ‘ä»¬ä½¿ç”¨æ•°ç»„çš„ forEach() æ–¹æ³•åœ¨æ§åˆ¶å°ä¸­æ‰“å°å‡ ä¸ªé€šè¿‡ URLs åŠ è½½çš„æ–‡ä»¶çš„å†…å®¹ï¼š<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">JavaScript ä»£ç :</span><br><span class="line"><span class="function">async function <span class="title">logContent</span><span class="params">(urls)</span> </span>&#123;</span><br><span class="line">    urls.forEach(url =&gt; &#123;</span><br><span class="line">        <span class="comment">// Wrong syntax</span></span><br><span class="line">        <span class="keyword">const</span> content = await httpGet(url);</span><br><span class="line">        console.<span class="built_in">log</span>(content);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åŒæ ·çš„ï¼Œè¿™é‡Œçš„ä»£ç ä¼šäº§ç”Ÿä¸€ä¸ªè¯­æ³•é”™è¯¯ï¼Œå› ä¸ºä½ ä¸èƒ½åœ¨é€šå¸¸çš„ç®­å¤´å‡½æ•°å†…éƒ¨ä½¿ç”¨ await ã€‚</p><p>æˆ‘ä»¬æ¢ä½œå¼‚æ­¥ç®­å¤´å‡½æ•°ï¼š<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">JavaScript ä»£ç :</span><br><span class="line"><span class="function">async function <span class="title">logContent</span><span class="params">(urls)</span> </span>&#123;</span><br><span class="line">    urls.forEach(async url =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> content = await httpGet(url);</span><br><span class="line">        console.<span class="built_in">log</span>(content);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// Not finished here</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™æ®µä»£ç èµ·ä½œç”¨äº†ï¼Œä½†æ˜¯ä¼šå‡ºç°ä¸€ä¸ªè­¦å‘Šï¼šhttpGet() è¿”å›çš„ Promise å¯¹è±¡æ˜¯å¼‚æ­¥å®Œæˆçš„ï¼Œè¿™ä¹Ÿæ„å‘³ç€å½“ forEach() è¿”å›çš„æ—¶å€™å›è°ƒå¯èƒ½è¿˜æ²¡æœ‰ç»“æŸï¼Œå› æ­¤ä½ æ— æ³•ç­‰åˆ° logContent() åªèƒ½ç»“æŸã€‚</p><p>å¦‚æœä½ å¹¶ä¸æƒ³è¦è¿™ä¸ªç»“æœï¼Œä½ å¯ä»¥å°† forEach() è½¬æ¢ä¸º for-of å¾ªç¯ã€‚<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">JavaScript ä»£ç :</span><br><span class="line"><span class="function">async function <span class="title">logContent</span><span class="params">(urls)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> url of urls) &#123;</span><br><span class="line">        <span class="keyword">const</span> content = await httpGet(url);</span><br><span class="line">        console.<span class="built_in">log</span>(content);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç°åœ¨ä¸€åˆ‡éƒ½åœ¨ for-of å¾ªç¯å®Œæˆåå®Œæˆã€‚ä½†æ˜¯ï¼Œå¤„ç†æ­¥éª¤ä¾æ¬¡å‘ç”Ÿï¼šhttpGet() åªæ˜¯åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨å®Œæˆåå†æ¬¡è°ƒç”¨ã€‚å¦‚æœæ‚¨å¸Œæœ›å¤„ç†æ­¥éª¤å¹¶è¡Œæ‰§è¡Œï¼Œä½ å¿…é¡»ä½¿ç”¨ Promise.all()ï¼š<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">JavaScript ä»£ç :</span><br><span class="line"><span class="function">async function <span class="title">logContent</span><span class="params">(urls)</span> </span>&#123;</span><br><span class="line">    await Promise.all(urls.<span class="built_in">map</span>(</span><br><span class="line">        async url =&gt; &#123;</span><br><span class="line">            <span class="keyword">const</span> content = await httpGet(url);</span><br><span class="line">            console.<span class="built_in">log</span>(content);</span><br><span class="line">        &#125;));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>map() ç”¨äºåˆ›å»ºä¸€ä¸ª Promises æ•°ç»„ã€‚ æˆ‘ä»¬å¯¹ä»–ä»¬çš„å®Œæˆç»“æœå¹¶ä¸æ„Ÿå…´è¶£ï¼Œæˆ‘ä»¬åªè¦ await(ç­‰å¾…) æ‰€æœ‰æ–¹æ³•æ‰§è¡Œå®Œæˆã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¸Œæœ›çš„æ˜¯åœ¨ async(å¼‚æ­¥) å‡½æ•°å®Œæˆä¹‹åæ‰€æœ‰çš„æ‰§è¡Œéƒ½å·²ç»å®Œæˆã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥è¿”å› Promise.all() ï¼Œä½†æ˜¯è¯¥å‡½æ•°çš„ç»“æœæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå…¶å…ƒç´ éƒ½æ˜¯æœªå®ŒæˆçŠ¶æ€çš„ã€‚</p><h1 id="ä½¿ç”¨å¼‚æ­¥å‡½æ•°å°è´´å£«"><a href="#ä½¿ç”¨å¼‚æ­¥å‡½æ•°å°è´´å£«" class="headerlink" title="ä½¿ç”¨å¼‚æ­¥å‡½æ•°å°è´´å£«"></a>ä½¿ç”¨å¼‚æ­¥å‡½æ•°å°è´´å£«</h1><h2 id="äº†è§£ä½ çš„-Promises"><a href="#äº†è§£ä½ çš„-Promises" class="headerlink" title="äº†è§£ä½ çš„ Promises"></a>äº†è§£ä½ çš„ Promises</h2><p>async(å¼‚æ­¥) å‡½æ•°çš„åŸºç¡€å°±æ˜¯ <a href="http://exploringjs.com/es6/ch_promises.html" target="_blank" rel="noopener">Promises</a> å¯¹è±¡ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆç†è§£ Promises å¯¹äºç†è§£ async(å¼‚æ­¥) å‡½æ•°è‡³å…³é‡è¦ã€‚ç‰¹åˆ«æ˜¯å½“é‡åˆ°ä¸æ˜¯åŸºäº Promises çš„è€ä»£ç æ¥å®ç° async(å¼‚æ­¥) å‡½æ•°æ—¶ï¼Œä½ é€šå¸¸åˆ«æ— é€‰æ‹©ï¼Œåªèƒ½ç”¨ Promise æ¥é‡æ„ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œè¿™é‡Œæœ‰ä¸ª â€œpromisifiedâ€ ç‰ˆæœ¬çš„ XMLHttpRequest ï¼š<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">JavaScript ä»£ç :</span><br><span class="line"><span class="function">function <span class="title">httpGet</span><span class="params">(url, responseType=<span class="string">""</span>)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Promise(</span><br><span class="line">        function (resolve, reject) &#123;</span><br><span class="line">            <span class="keyword">const</span> request = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">            request.onload = function () &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">this</span>.status === <span class="number">200</span>) &#123;</span><br><span class="line">                    <span class="comment">// Success</span></span><br><span class="line">                    resolve(<span class="keyword">this</span>.response);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// Something went wrong (404 etc.)</span></span><br><span class="line">                    reject(<span class="keyword">new</span> Error(<span class="keyword">this</span>.statusText));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">            request.onerror = function () &#123;</span><br><span class="line">                reject(<span class="keyword">new</span> Error(</span><br><span class="line">                    'XMLHttpRequest Error: '+this.statusText));</span><br><span class="line">            &#125;;</span><br><span class="line">            request.open('GET', url);</span><br><span class="line">            xhr.responseType = responseType;</span><br><span class="line">            request.send();</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>XMLHttpRequest çš„ API æ˜¯åŸºäºå›è°ƒçš„ã€‚é€šè¿‡ä¸€ä¸ª async(å¼‚æ­¥) å‡½æ•°æ¥å®ç°å®ƒï¼Œæ„å‘³ç€ä½ å¿…é¡»åœ¨å›è°ƒä¸­è¿”å› Promise çš„å®Œæˆ(fulfill) æˆ–æ‹’ç»(reject) çŠ¶æ€ã€‚è¿™æ˜¯ä¸å¯èƒ½çš„ï¼Œå› ä¸ºä½ åªèƒ½é€šè¿‡ return æˆ–è€…  throw æ¥å®Œæˆè¿™æ ·çš„æ“ä½œã€‚ä½ ä¸èƒ½ä»å›è°ƒå‡½æ•°å†…éƒ¨ return ä¸€ä¸ªå‡½æ•°çš„ç»“æœã€‚throwä¹Ÿæœ‰ç±»ä¼¼çš„çº¦æŸã€‚</p><p>å› æ­¤ï¼Œå¼‚æ­¥å‡½æ•°çš„é€šç”¨ç¼–ç é£æ ¼æ˜¯ï¼š</p><ul><li>ç›´æ¥ä½¿ç”¨ Promise å¯¹è±¡æ¥æ„å»ºå¼‚æ­¥åŸè¯­ã€‚</li><li>ç”¨å¼‚æ­¥å‡½æ•°æ¥ä½¿ç”¨è¿™äº›åŸè¯­ã€‚<br>æ‰©å±•é˜…è¯»ï¼šâ€œExploring ES6â€ ä¸­çš„ â€œ<a href="http://exploringjs.com/es6/ch_promises.html" target="_blank" rel="noopener">å¼‚æ­¥ç¼–ç¨‹ä¸­çš„ Promises å¯¹è±¡</a>â€ ç« èŠ‚</li></ul><h1 id="ç«‹å³è°ƒç”¨å¼‚æ­¥å‡½æ•°è¡¨è¾¾å¼"><a href="#ç«‹å³è°ƒç”¨å¼‚æ­¥å‡½æ•°è¡¨è¾¾å¼" class="headerlink" title="ç«‹å³è°ƒç”¨å¼‚æ­¥å‡½æ•°è¡¨è¾¾å¼"></a>ç«‹å³è°ƒç”¨å¼‚æ­¥å‡½æ•°è¡¨è¾¾å¼</h1><p>æœ‰æ—¶ï¼Œå¦‚æœä½ å¯ä»¥åœ¨æ¨¡å—æˆ–è„šæœ¬çš„é¡¶å±‚ä½¿ç”¨ await ï¼Œé‚£å°†æ˜¯ä¸€ç§å¾ˆå¥½çš„é€‰æ‹©ã€‚å½“ç„¶ï¼Œå®ƒåªèƒ½åœ¨å¼‚æ­¥å‡½æ•°ä¸­ä½¿ç”¨ã€‚æ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªå¼‚æ­¥å‡½æ•° main()  å¹¶ç«‹å³è°ƒç”¨å®ƒï¼š<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">JavaScript ä»£ç :</span><br><span class="line"><span class="function">async function <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    console.<span class="built_in">log</span>(await asyncFunction());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>main();<br>æˆ–è€…æ‚¨å¯ä»¥ä½¿ç”¨ç«‹å³è°ƒç”¨å¼‚æ­¥å‡½æ•°è¡¨è¾¾å¼ï¼š<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">JavaScript ä»£ç :</span><br><span class="line">(async function () &#123;</span><br><span class="line">    console.<span class="built_in">log</span>(await asyncFunction());</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure></p><p>å¦ä¸€ä¸ªé€‰æ‹©æ˜¯ç«‹å³è°ƒç”¨å¼‚æ­¥ç®­å¤´å‡½æ•°ï¼š<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">JavaScript ä»£ç :</span><br><span class="line">(async () =&gt; &#123;</span><br><span class="line">    console.<span class="built_in">log</span>(await asyncFunction());</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure></p><h1 id="ç”¨å¼‚æ­¥å‡½æ•°è¿›è¡Œå•å…ƒæµ‹è¯•"><a href="#ç”¨å¼‚æ­¥å‡½æ•°è¿›è¡Œå•å…ƒæµ‹è¯•" class="headerlink" title="ç”¨å¼‚æ­¥å‡½æ•°è¿›è¡Œå•å…ƒæµ‹è¯•"></a>ç”¨å¼‚æ­¥å‡½æ•°è¿›è¡Œå•å…ƒæµ‹è¯•</h1><p>ä»¥ä¸‹ä»£ç ä½¿ç”¨ <a href="https://mochajs.org/" target="_blank" rel="noopener">æµ‹è¯•æ¡†æ¶ mocha</a> å¯¹å¼‚æ­¥å‡½æ•° asyncFun1() å’Œ asyncFun2() æ¥è¿›è¡Œå•å…ƒæµ‹è¯•ï¼š</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import assert from 'assert';</span><br><span class="line"> </span><br><span class="line"><span class="comment">// Bug: the following test always succeeds</span></span><br><span class="line">test('Testing async code', function () &#123;</span><br><span class="line">    asyncFunc1() <span class="comment">// (A)</span></span><br><span class="line">    .then(result1 =&gt; &#123;</span><br><span class="line">        assert.strictEqual(result1, <span class="string">'a'</span>); <span class="comment">// (B)</span></span><br><span class="line">        <span class="keyword">return</span> asyncFunc2();</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(result2 =&gt; &#123;</span><br><span class="line">        assert.strictEqual(result2, <span class="string">'b'</span>); <span class="comment">// (C)</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ç„¶è€Œï¼Œè¿™ä¸ªæµ‹è¯•æ€»æ˜¯æˆåŠŸçš„ï¼Œå› ä¸º mocha ä¸ä¼šç­‰å¾… B è¡Œå’Œ C è¡Œæ–­è¨€æ‰§è¡Œå®Œæˆã€‚</p><p>ä½ å¯ä»¥é€šè¿‡è¿”å›é“¾å¼è°ƒç”¨çš„ Promise æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸º mocha ä¼šè¯†åˆ«ä¸€ä¸ªæµ‹è¯•æ˜¯å¦è¿”å›ä¸€ä¸ª Promise ï¼Œç„¶åç­‰å¾…è¯¥ Promise å®Œæˆ å†è¿›è¡Œä¸‹ä¸€æ­¥ï¼ˆé™¤éè¶…æ—¶ï¼‰ã€‚<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">JavaScript ä»£ç :</span><br><span class="line"><span class="keyword">return</span> asyncFunc1() <span class="comment">// (A)</span></span><br></pre></td></tr></table></figure></p><p>å¼‚æ­¥å‡½æ•°æ€»æ˜¯è¿”å› Promises ï¼Œè¿™ä½¿å¾—å®ƒä»¬èƒ½æ–¹ä¾¿çš„ã€å®Œç¾çš„æ¥è¿›è¡Œè¿™ç§å•å…ƒæµ‹è¯•ï¼š<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">JavaScript ä»£ç :</span><br><span class="line">import assert from 'assert';</span><br><span class="line">test('Testing async code', async function () &#123;</span><br><span class="line">    <span class="keyword">const</span> result1 = await asyncFunc1();</span><br><span class="line">    assert.strictEqual(result1, <span class="string">'a'</span>);</span><br><span class="line">    <span class="keyword">const</span> result2 = await asyncFunc2();</span><br><span class="line">    assert.strictEqual(result2, <span class="string">'b'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><p>åœ¨ mocha ä¸­ä½¿ç”¨å¼‚æ­¥å•å…ƒæµ‹è¯•å¼‚æ­¥å‡½æ•°æœ‰ä¸¤ä¸ªä¼˜ç‚¹ï¼šä»£ç æ›´ç®€æ´ï¼Œèƒ½å¤Ÿå‡†ç¡®å¤„ç†è¿”å›çš„ Promise å¯¹è±¡ã€‚</p><h1 id="ä¸è¦æ‹…å¿ƒæ²¡æœ‰å¤„ç†çš„æ‹’ç»æ‹’æ€"><a href="#ä¸è¦æ‹…å¿ƒæ²¡æœ‰å¤„ç†çš„æ‹’ç»æ‹’æ€" class="headerlink" title="ä¸è¦æ‹…å¿ƒæ²¡æœ‰å¤„ç†çš„æ‹’ç»æ‹’æ€"></a>ä¸è¦æ‹…å¿ƒæ²¡æœ‰å¤„ç†çš„æ‹’ç»æ‹’æ€</h1><p>å½“å‰çš„ JavaScript å¼•æ“å¯ä»¥åœ¨æ‹’ç»æ€æœªå¤„ç†çš„æƒ…å†µä¸‹æå‡ºè­¦å‘Šã€‚ä»¥ä¸‹ä»£ç åœ¨è¿‡å»ä¼šç»å¸¸æ‰§è¡Œå¤±è´¥ï¼Œä½†æ˜¯å½“å‰çš„ JavaScript å¼•æ“å¯ä»¥è¿›è¡Œè­¦å‘Šï¼š<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">JavaScript ä»£ç :</span><br><span class="line"><span class="function">async function <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    throw new Error('Problem!');</span><br><span class="line">&#125;</span><br><span class="line">foo();</span><br></pre></td></tr></table></figure></p><h1 id="é˜…è¯»å»¶ä¼¸"><a href="#é˜…è¯»å»¶ä¼¸" class="headerlink" title="é˜…è¯»å»¶ä¼¸"></a>é˜…è¯»å»¶ä¼¸</h1><ul><li><a href="https://github.com/tc39/ecmascript-asyncawait" target="_blank" rel="noopener">å¼‚æ­¥å‡½æ•°</a> ï¼ˆæå‡ºè€…Brian Terlsonï¼‰</li><li><a href="http://exploringjs.com/es6/ch_generators.html#sec_co-library" target="_blank" rel="noopener">é€šè¿‡generatorsæ¥ç®€åŒ–å¼‚æ­¥è®¡ç®—</a>ï¼ˆâ€œExporing ES6â€ä¸­çš„éƒ¨åˆ†ç« èŠ‚ï¼‰<br>åŸæ–‡åœ°å€ï¼š<a href="http://exploringjs.com/es2016-es2017/ch_async-functions.html" target="_blank" rel="noopener">http://exploringjs.com/es2016-es2017/ch_async-functions.html</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt; ECMAScript 2017 æ–°ç‰¹æ€§ Async Functions(å¼‚æ­¥å‡½æ•°) ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/js_d.png&quot; alt=&quot;js&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Javascript" scheme="https://duanruilong.github.io/categories/Javascript/"/>
    
    
      <category term="Javascript" scheme="https://duanruilong.github.io/tags/Javascript/"/>
    
      <category term="ç¼–ç¨‹" scheme="https://duanruilong.github.io/tags/%E7%BC%96%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>å°ç¨‹åºä¹‹æ—…(å››)</title>
    <link href="https://duanruilong.github.io/2018/06/28/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%B9%8B%E6%97%85-%E5%9B%9B/"/>
    <id>https://duanruilong.github.io/2018/06/28/å°ç¨‹åºä¹‹æ—…-å››/</id>
    <published>2018-06-27T16:23:57.000Z</published>
    <updated>2018-09-17T15:58:32.000Z</updated>
    
    <content type="html"><![CDATA[<p>å°ç¨‹åºæ˜¯ä¸€ç§æ–°çš„å¼€æ”¾èƒ½åŠ›ï¼Œå¼€å‘è€…å¯ä»¥å¿«é€Ÿåœ°å¼€å‘ä¸€ä¸ªå°ç¨‹åºã€‚å°ç¨‹åºå¯ä»¥åœ¨å¾®ä¿¡å†…è¢«ä¾¿æ·åœ°è·å–å’Œä¼ æ’­ï¼ŒåŒæ—¶å…·æœ‰å‡ºè‰²çš„ä½¿ç”¨ä½“éªŒã€‚è¿™æ˜¯å…³äºå°ç¨‹åº<code>websocket</code>ä¹‹æ—…ã€‚<code>websocket</code>æ˜¯html5å®šä¹‰çš„ä¸€ç§æ–°åè®®ï¼ŒåŸç†å°±æ˜¯åœ¨å®¢æˆ·ç«¯(æµè§ˆå™¨)å’ŒæœåŠ¡å™¨ä¹‹é—´å»ºç«‹ä¸€æ¡ä¸“ç”¨é€šé“è¿æ¥ï¼ŒäºŒè€…å¯ä»¥å®æ—¶é€šä¿¡ï¼Œç±»ä¼¼äºæˆ‘ä»¬æ—¥å¸¸é‡Œçš„æ‰“ç”µè¯ä¸€æ ·ã€‚</p><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/wechat_d.png" alt="å¾®ä¿¡å°ç¨‹åº"></p><a id="more"></a><h1 id="ä¸€ä¸ªå°æ —å­"><a href="#ä¸€ä¸ªå°æ —å­" class="headerlink" title="ä¸€ä¸ªå°æ —å­"></a>ä¸€ä¸ªå°æ —å­</h1><p>ä»¥å®ç°ä¸€ä¸ªè‚¡ç¥¨èµ°åŠ¿å›¾çš„åŠŸèƒ½ä¸ºä¾‹ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“è‚¡ç¥¨è¿™ä¸ªä¸œè¥¿çš„å®æ—¶æ€§å’Œå‡†ç¡®æ€§æ˜¯å¾ˆé‡è¦çš„ï¼Œä¸€èˆ¬å¯ä»¥ä½¿ç”¨<code>ajax</code>è½®è¯¢ï¼ˆ<code>setinterval</code>å‡½æ•°ï¼‰çš„æ–¹å¼æ¥è§£å†³ï¼Œå¯ä»¥æ¯åŠç§’è½®è¯¢ä¸€æ¬¡æ•°æ®æ¥å£ï¼Œå†æ¸²æŸ“é¡µé¢è§†å›¾ã€‚ä½†æ˜¯è¿™ä¸ªæ–¹å¼æ˜¯æœ‰ä¸€äº›ç¼ºç‚¹çš„ï¼Œæ¯”å¦‚ï¼Œæµè§ˆå™¨è¦æ—¶åˆ»ä¸æ–­çš„å‘æœåŠ¡å™¨å‘é€æ•°æ®è¯·æ±‚å¹¶ä¸”æ¥å—æ•°æ®ï¼Œè¿™æ ·å¾ˆæ¶ˆè€—å¸¦å®½ï¼Œè¿˜å¾ˆå®¹æ˜“æŠŠæœåŠ¡å™¨ç»™æå¡æ­»äº†ã€‚<br>å¯¹äº<code>websocket</code>æŠ€æœ¯æ¥è¯´ï¼Œå®¢æˆ·ç«¯å°±ä¸æœåŠ¡å™¨ä¹‹é—´å»ºç«‹äº†ä¸€ä¸ªä¸“ç”¨é€šé“ï¼Œä»–ä»¬ä¹‹é—´çš„æ•°æ®é€šä¿¡å°±ä¸éœ€è¦è½®è¯¢å¯ä»¥ä¸€ç›´è¿›è¡Œæ•°æ®äº¤äº’ï¼ŒæœåŠ¡å™¨ä¸å†æ˜¯è¢«åŠ¨çš„è¿”å›æ•°æ®ï¼Œè€Œæ˜¯æœ‰äº†æ–°æ•°æ®ä¹‹åå°±ä¼šä¸»åŠ¨çš„æ¨é€ç»™å®¢æˆ·ç«¯ã€‚<code>websocket</code>å¾ˆé€‚åˆå¯¹å®æ—¶æ€§è¦æ±‚çš„åœºæ™¯ï¼Œå®æ—¶æ€§ä¸é«˜è¿˜æ˜¯ç”¨ajaxå°±å¯ä»¥å®ç°äº†ã€‚</p><blockquote><p>å¿«é€Ÿç”Ÿæˆæ ‡å‡†æ–‡ä»¶</p></blockquote><p>ä»¥chartsä¸ºä¾‹ï¼Œåªéœ€è¦åœ¨app.jsonæ–‡ä»¶ä¸‹æ·»åŠ è·¯åŠ²ï¼Œä¿å­˜ä¹‹åå°±ä¼šè‡ªåŠ¨ç”Ÿæˆæ–‡ä»¶å¤¹ã€‚</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- app.jsonæ–‡ä»¶ --&gt;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"pages"</span>:[</span><br><span class="line">    <span class="string">"pages/index/index"</span>,</span><br><span class="line">    <span class="string">"pages/logs/logs"</span>,</span><br><span class="line">    <span class="string">"pages/charts/charts"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"window"</span>:&#123;</span><br><span class="line">    <span class="string">"backgroundTextStyle"</span>:<span class="string">"light"</span>,</span><br><span class="line">    <span class="string">"navigationBarBackgroundColor"</span>: <span class="string">"#fff"</span>,</span><br><span class="line">    <span class="string">"navigationBarTitleText"</span>: <span class="string">"WeChat"</span>,</span><br><span class="line">    <span class="string">"navigationBarTextStyle"</span>:<span class="string">"black"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å‰æœŸå‡†å¤‡"><a href="#å‰æœŸå‡†å¤‡" class="headerlink" title="å‰æœŸå‡†å¤‡"></a>å‰æœŸå‡†å¤‡</h1><h2 id="1ã€å°æ —å­è¯•å›¾æ’ä»¶"><a href="#1ã€å°æ —å­è¯•å›¾æ’ä»¶" class="headerlink" title="1ã€å°æ —å­è¯•å›¾æ’ä»¶"></a>1ã€å°æ —å­è¯•å›¾æ’ä»¶</h2><p>å›¾è¡¨ç±»çš„æ’ä»¶ä¸€èˆ¬å°±æ˜¯<code>echarts</code>å’Œ<code>highcharts</code>,è€Œåœ¨å°ç¨‹åºé‡Œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>wxcharts</code>,<code>wxcharts</code>çš„å®ç°æ–¹å¼æ˜¯canvas,å°ç¨‹åºæœ¬èº«ä¹Ÿæ˜¯æ”¯æŒçš„ã€‚æŠŠjsæ–‡ä»¶æ”¾åˆ°chartsæ–‡ä»¶ä¸‹ï¼Œ<a href="https://raw.githubusercontent.com/jiangzy27/how_to_react/master/tools/wxcharts.js" target="_blank" rel="noopener">ä¸‹è½½é“¾æ¥</a></p><h2 id="2ã€æ•°æ®æ¥å£æ”¯æŒ"><a href="#2ã€æ•°æ®æ¥å£æ”¯æŒ" class="headerlink" title="2ã€æ•°æ®æ¥å£æ”¯æŒ"></a>2ã€æ•°æ®æ¥å£æ”¯æŒ</h2><p>è¿™é‡Œçš„æ•°æ®æ”¯æŒä½¿ç”¨çš„æ˜¯<code>Nodejs</code>ï¼Œè¿˜è¦äº†è§£ä¸€ä¸‹<code>websocket</code>,å®ƒå…¶å®å°±æ˜¯webç‰ˆçš„socketæŠ€æœ¯ã€‚å› ä¸ºæµè§ˆå™¨æ”¯æŒçš„javascriptè¯­è¨€å¹¶ä¸æ”¯æŒsocketï¼Œæ‰€ä»¥åœ¨html5æŠ€æœ¯æ ‡å‡†ä¸­æ–°æ·»åŠ äº†è¿™é¡¹ç‰¹æ€§ã€‚ç”¨é€šä¿—çš„è¯è¯­è§£é‡Šå°±æ˜¯ï¼šsocketå…¶å®å°±æ˜¯åœ¨æµè§ˆå™¨å’ŒæœåŠ¡ç«¯å„å¼€è¾Ÿä¸€ä¸ªä¸“é—¨çš„ç«¯å£ï¼ŒåŒæ–¹éƒ½ç›‘å¬è¿™ä¸ªç«¯å£ï¼Œç„¶åäº’ç›¸å‘é€å’Œæ¥æ”¶æ•°æ®ã€‚</p><p>Nodejsæœ‰ä¸ªæ’ä»¶å°è£…äº†socketï¼Œå«<code>nodejs-websocket</code>ã€‚ä½¿ç”¨npmå®‰è£…ä¸€ä¸‹:<br><code>npm install nodejs-websocket</code></p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">âœ  ~ npm i nodejs-websocket -g</span><br><span class="line">/usr/local/lib</span><br><span class="line">â””â”€â”€ nodejs-websocket@<span class="number">1.7</span><span class="number">.1</span></span><br></pre></td></tr></table></figure><blockquote><p>server.js</p></blockquote><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">var ws = require('nodejs-websocket');</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºserver</span></span><br><span class="line"></span><br><span class="line">var server = ws.createServer(function(conn)&#123;</span><br><span class="line">    conn.on(<span class="string">"text"</span>,function(str)&#123; <span class="comment">// ç›‘å¬æ–‡æœ¬è¾“å…¥</span></span><br><span class="line">        <span class="keyword">if</span> (str == <span class="string">"stock"</span>) &#123;</span><br><span class="line">            setInterval(function()&#123;</span><br><span class="line">                var arr=[];</span><br><span class="line">                <span class="keyword">for</span> (let i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) &#123;</span><br><span class="line">                    var count = (Math.<span class="built_in">ceil</span>((Math.random()*<span class="number">100</span>))/<span class="number">100</span>).toFixed(<span class="number">2</span>);</span><br><span class="line">                    arr.push(count)</span><br><span class="line">                &#125;</span><br><span class="line">                var obj = &#123;data:arr&#125;</span><br><span class="line">                conn.send(JSON.stringify(obj))</span><br><span class="line">            &#125;,<span class="number">2000</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;).listen(<span class="number">8000</span>)</span><br></pre></td></tr></table></figure><p><code>websocket</code>å»ºç«‹ä¸“ç”¨é€šé“åï¼ŒæœåŠ¡ç«¯åªè¦ç›‘å¬åˆ°å®¢æˆ·ç«¯å‘æ¥çš„æ–‡æœ¬å†…å®¹æ˜¯â€stockâ€,å°±æ¯éš”2sä¿®æ”¹ä¸€æ¬¡æ•°æ®ï¼Œä¿®æ”¹åçš„æ•°æ®ï¼Œå®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰é©¬ä¸Šå°±ä¼šç›‘å¬åˆ°ï¼Œåˆ©ç”¨è¿™ç§æ–¹å¼æ¥æ¨¡æ‹Ÿè‚¡ç¥¨æ•°æ®çš„å˜åŒ–ã€‚</p><blockquote><p>æ³¨æ„</p></blockquote><p>åˆ©ç”¨webstormçš„runæˆ–ä½¿ç”¨å‘½ä»¤è¡Œè¿è¡Œè„šæœ¬åï¼Œwebsocketçš„åè®®æ˜¯wsåè®®å’Œwssåè®®ã€‚<br>wså°±ç›¸å½“äºhttpï¼Œwsså°±ç›¸å½“äºhttpsï¼Œæ‰€ä»¥æ­£ç¡®çš„å†™æ³•åº”è¯¥æ˜¯ï¼š<code>ws://localhost:8000</code></p><blockquote><p>å¾®ä¿¡å®¢æˆ·ç«¯</p></blockquote><p>ä½¿ç”¨websocketå¾ˆå®¹æ˜“ï¼Œä¸»è¦å°±æ˜¯ä½ è¿™å‡ ä¸ªæ­¥éª¤ï¼š</p><ul><li>å»ºç«‹è¿æ¥</li><li>å‘é€æ•°æ®</li><li>æ¥æ”¶æ•°æ®</li><li>ç»“æŸ</li></ul><blockquote><p>charts.js</p></blockquote><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pages/charts/charts.js</span></span><br><span class="line">var wxCharts = require('wxcharts.js');</span><br><span class="line">Page(&#123;</span><br><span class="line">  data: &#123;&#125;,</span><br><span class="line">  onLoad: function (options) &#123;</span><br><span class="line">    <span class="comment">// var data1 = [0.15, 0.2, 0.45, 0.37, 0.4, 0.8];</span></span><br><span class="line">    <span class="comment">// var data2 = [0.30, 0.37, 0.65, 0.78, 0.69, 0.94];</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//å»ºç«‹è¿æ¥</span></span><br><span class="line">    wx.connectSocket(&#123;</span><br><span class="line">      url: 'ws://localhost:8000',//è¿™é‡Œè¿æ¥çš„å°±æ˜¯æœåŠ¡ç«¯çš„socket</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//è¿æ¥æˆåŠŸç›‘å¬</span></span><br><span class="line">    wx.onSocketOpen(function (res) &#123;</span><br><span class="line">      <span class="comment">//å‘é€ä¿¡æ¯</span></span><br><span class="line">      wx.sendSocketMessage(&#123;</span><br><span class="line">        data: <span class="string">"stock"</span></span><br><span class="line">      &#125;);</span><br><span class="line">      console.log('WebSocketè¿æ¥å·²æ‰“å¼€ï¼')</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//è¿æ¥å¤±è´¥ç›‘å¬</span></span><br><span class="line">    wx.onSocketError(function (res) &#123;</span><br><span class="line">      console.log('WebSocketè¿æ¥æ‰“å¼€å¤±è´¥ï¼Œè¯·æ£€æŸ¥ï¼')</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//æ¥æ”¶æ•°æ®</span></span><br><span class="line">    wx.onSocketMessage(function (res) &#123;</span><br><span class="line">      <span class="comment">//æ”¶åˆ°çš„ä¿¡æ¯</span></span><br><span class="line">      console.log('æ”¶åˆ°æœåŠ¡å™¨å†…å®¹ï¼š' + res.data);</span><br><span class="line">      var obj = JSON.parse(res.data);</span><br><span class="line">      console.<span class="built_in">log</span>(obj);</span><br><span class="line">      <span class="comment">//ç»˜åˆ¶å›¾è¡¨ï¼Œåˆ©ç”¨canvasç»˜å›¾æŠ€æœ¯ã€‚</span></span><br><span class="line">      <span class="keyword">new</span> wxCharts(&#123;</span><br><span class="line">        canvasId: 'lineCanvas',//æŒ‡å®šcanvasçš„id</span><br><span class="line">        type: 'line',//ç±»å‹æ˜¯çº¿å½¢å›¾</span><br><span class="line">        categories: ['2012', '2013', '2014', '2015', '2016', '2017'],</span><br><span class="line"></span><br><span class="line">        series: [&#123;</span><br><span class="line">          name: 'æˆäº¤é‡1',</span><br><span class="line">          data: obj.data,<span class="comment">//websocketæ¥æ”¶åˆ°çš„æ•°æ®</span></span><br><span class="line">          format: function (val) &#123;</span><br><span class="line">            <span class="keyword">if</span> (typeof val == <span class="string">"string"</span>) &#123;</span><br><span class="line">              val = parseFloat(val);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> val.toFixed(<span class="number">2</span>) + <span class="string">'ä¸‡'</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          name: 'æˆäº¤é‡2',</span><br><span class="line">          data: [<span class="number">0.30</span>, <span class="number">0.37</span>, <span class="number">0.65</span>, <span class="number">0.78</span>, <span class="number">0.69</span>, <span class="number">0.94</span>],</span><br><span class="line">          format: function (val) &#123;</span><br><span class="line">            <span class="keyword">return</span> val.toFixed(<span class="number">2</span>) + <span class="string">'ä¸‡'</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;],</span><br><span class="line">        yAxis: &#123;</span><br><span class="line">          title: 'æˆäº¤é‡‘é¢ (ä¸‡å…ƒ)',</span><br><span class="line">          format: function (val) &#123;</span><br><span class="line">            <span class="keyword">return</span> val.toFixed(<span class="number">2</span>);</span><br><span class="line">          &#125;,</span><br><span class="line">          min: <span class="number">0</span></span><br><span class="line">        &#125;,</span><br><span class="line">        width: <span class="number">320</span>,</span><br><span class="line">        height: <span class="number">200</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><blockquote><p>charts.wxml:</p></blockquote><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--pages/charts/charts.wxml--&gt;</span><br><span class="line">&lt;canvas style=<span class="string">"width: 100%; height: 200px;border:1px solid #ccc;"</span> canvas-id=<span class="string">"lineCanvas"</span>&gt;</span><br><span class="line">&lt;/canvas&gt;</span><br></pre></td></tr></table></figure><p><img src="http://mmbiz.qpic.cn/mmbiz_gif/amhuPdMsm1nHiaOW0568UbEodbWhIZ4gj5uzrzPwcpeEniaAXGSYSiaUZI3g7gZqlZaeoAROMHB9MVjgqfrL68JHQ/0?wx_fmt=gif&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt="websocketè¯·"></p><p>çœ‹ä¸‹æ§åˆ¶å°ï¼Œåªæœ‰ä¸€æ¬¡è¯·æ±‚è€Œå·²ï¼Œæ²¡æœ‰åƒè½®è¯¢é‚£æ ·ä¸€å¨ä¸€å¨çš„å‘è¯·æ±‚äº†ã€‚<br>ä¸‹é¢é€šè¿‡æ§åˆ¶å°ï¼Œçœ‹ä¸‹websocketè¯·æ±‚çš„ç‰¹å¾ï¼š</p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/amhuPdMsm1nHiaOW0568UbEodbWhIZ4gjeNlDTTIGia8eLvAy3zWjAOV9WTicDFbBONETA7BHvwSpMsK4A5k7Jw8A/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt="websocketè¯·"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å°ç¨‹åºæ˜¯ä¸€ç§æ–°çš„å¼€æ”¾èƒ½åŠ›ï¼Œå¼€å‘è€…å¯ä»¥å¿«é€Ÿåœ°å¼€å‘ä¸€ä¸ªå°ç¨‹åºã€‚å°ç¨‹åºå¯ä»¥åœ¨å¾®ä¿¡å†…è¢«ä¾¿æ·åœ°è·å–å’Œä¼ æ’­ï¼ŒåŒæ—¶å…·æœ‰å‡ºè‰²çš„ä½¿ç”¨ä½“éªŒã€‚è¿™æ˜¯å…³äºå°ç¨‹åº&lt;code&gt;websocket&lt;/code&gt;ä¹‹æ—…ã€‚&lt;code&gt;websocket&lt;/code&gt;æ˜¯html5å®šä¹‰çš„ä¸€ç§æ–°åè®®ï¼ŒåŸç†å°±æ˜¯åœ¨å®¢æˆ·ç«¯(æµè§ˆå™¨)å’ŒæœåŠ¡å™¨ä¹‹é—´å»ºç«‹ä¸€æ¡ä¸“ç”¨é€šé“è¿æ¥ï¼ŒäºŒè€…å¯ä»¥å®æ—¶é€šä¿¡ï¼Œç±»ä¼¼äºæˆ‘ä»¬æ—¥å¸¸é‡Œçš„æ‰“ç”µè¯ä¸€æ ·ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/wechat_d.png&quot; alt=&quot;å¾®ä¿¡å°ç¨‹åº&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="å°ç¨‹åº" scheme="https://duanruilong.github.io/categories/%E5%B0%8F%E7%A8%8B%E5%BA%8F/"/>
    
    
      <category term="Javascript" scheme="https://duanruilong.github.io/tags/Javascript/"/>
    
      <category term="ç¼–ç¨‹" scheme="https://duanruilong.github.io/tags/%E7%BC%96%E7%A8%8B/"/>
    
      <category term="å°ç¨‹åº" scheme="https://duanruilong.github.io/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/"/>
    
  </entry>
  
  <entry>
    <title>ES6é‡Œ ä¸‰ç§å¼‚æ­¥è§£å†³æ–¹æ¡ˆ</title>
    <link href="https://duanruilong.github.io/2018/06/27/ES6%E9%87%8C-%E4%B8%89%E7%A7%8D%E5%BC%82%E6%AD%A5%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"/>
    <id>https://duanruilong.github.io/2018/06/27/ES6é‡Œ-ä¸‰ç§å¼‚æ­¥è§£å†³æ–¹æ¡ˆ/</id>
    <published>2018-06-27T15:47:45.000Z</published>
    <updated>2018-09-17T15:58:32.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä»‹ç»ä¸€ä¸‹ES6é‡Œçš„ä¸‰ç§å¼‚æ­¥æ–¹æ¡ˆã€‚</p><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/es6_d.png" alt="ES6æ”»ç•¥"></p><a id="more"></a><h1 id="çŸ¥è¯†å°é²œ"><a href="#çŸ¥è¯†å°é²œ" class="headerlink" title="çŸ¥è¯†å°é²œ"></a>çŸ¥è¯†å°é²œ</h1><blockquote><p>1ã€newGenerator å‡½æ•°ï¼Œå®ƒæ‰§è¡Œä¹‹åä¼šè¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼Œåœ¨è¿™ä¸ªè¿­ä»£å™¨ä¸Šæˆ‘ä»¬å¯ä»¥å»è°ƒç”¨<code>next()</code>  æ–¹æ³•ï¼›<br>2ã€next() æ–¹æ³•ï¼Œå¯ä»¥ç»™ä»–ä¼ å…¥ä¸€ä¸ªå‚æ•°ã€‚è°ƒç”¨<code>next()</code>æ–¹æ³•ï¼Œä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡<code>{value: res,done: false}</code> ,è¿™é‡Œçš„done è¡¨ç¤ºè¿­ä»£å™¨ã€‚</p></blockquote><h1 id="æ–¹æ³•ä¸€ï¼š-Generator-Promise"><a href="#æ–¹æ³•ä¸€ï¼š-Generator-Promise" class="headerlink" title="æ–¹æ³•ä¸€ï¼š Generator + Promise"></a>æ–¹æ³•ä¸€ï¼š Generator + Promise</h1><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">const fund = require('fund')</span><br><span class="line"></span><br><span class="line"><span class="comment">// Promise ç‰ˆçš„readFile</span></span><br><span class="line"><span class="keyword">const</span> readFile = function (fileName) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Promise(function(resolve, reject) &#123;</span><br><span class="line">    fund.readFile(fileName, function(err, data)&#123;</span><br><span class="line">      <span class="keyword">if</span> (err) <span class="keyword">return</span> reject(error);</span><br><span class="line">      resolve(data);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> newgen = function * () &#123;</span><br><span class="line">  let demo1 = yield readFile('a.txt');</span><br><span class="line">  let demo2 = yield readFile('b.txt');</span><br><span class="line"></span><br><span class="line">  console.log('demo1---&gt;', demo1.toString());</span><br><span class="line">  console.log('demo2---&gt;', demo2.toString());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// åŸºäº Generator å’Œ Promise çš„è‡ªåŠ¨æ‰§è¡Œå™¨</span></span><br><span class="line"><span class="function">function <span class="title">run</span><span class="params">(gen)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  let g = gen();</span><br><span class="line">  </span><br><span class="line">  <span class="function">function <span class="title">next</span><span class="params">(data)</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    let result = g.next(data);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (result.done) <span class="keyword">return</span> result.value;</span><br><span class="line"></span><br><span class="line">    result.value.then(function(data) &#123;</span><br><span class="line">      next(data);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  next();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">run(gen);</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå™¨ ä¸­çš„ <code>result.value</code> ç°åœ¨æ˜¯ä¸€ä¸ªPromise, é€šè¿‡ then æ–¹æ³•æ‹¿åˆ°éœ€è¦çš„ç»“æœï¼Œä¼ ä¸‹ä¸€æ¬¡ next æ–¹æ³•ï¼Œè¿™æ ·  <code>let f1 = yield readFile(&#39;a.txt&#39;);</code>å°±å¯ä»¥æ‹¿åˆ°å€¼.</p><h1 id="æ–¹æ³•äºŒï¼š-Generator-Thunkå‡½æ•°"><a href="#æ–¹æ³•äºŒï¼š-Generator-Thunkå‡½æ•°" class="headerlink" title="æ–¹æ³•äºŒï¼š Generator + Thunkå‡½æ•°"></a>æ–¹æ³•äºŒï¼š Generator + Thunkå‡½æ•°</h1><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">const fs = require('fs')</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŠŠä¸€ä¸ªå•ä¸€æ‰§è¡Œçš„å‡½æ•° ï¼Œå˜æˆéœ€è¦å†æ¬¡è°ƒç”¨çš„å‡½æ•°ï¼Œå›ºå®šä¸€éƒ¨åˆ†å‚æ•°</span></span><br><span class="line"><span class="function">function <span class="title">thunkify</span><span class="params">(fn, obj = &#123;&#125;)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> function () &#123;</span><br><span class="line">        let args = Array.from(arguments);</span><br><span class="line">        <span class="keyword">return</span> function (m) &#123;</span><br><span class="line">            args.push(m)</span><br><span class="line">            <span class="keyword">return</span> fn.apply(obj, args)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> readFile = thunkify(fs.readFile, fs);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> gen = function* () &#123;</span><br><span class="line">    let f1 = yield readFile('a.txt');</span><br><span class="line">    let f2 = yield readFile('b.txt');</span><br><span class="line"></span><br><span class="line">    console.log('F1--&gt;', f1.toString());</span><br><span class="line">    console.log('F2--&gt;', f2.toString());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// åŸºäº Generator å’Œ Thunkå‡½æ•°çš„è‡ªåŠ¨æ‰§è¡Œå™¨</span></span><br><span class="line"><span class="function">function <span class="title">run</span><span class="params">(fn)</span> </span>&#123;</span><br><span class="line">    let gen = fn();</span><br><span class="line"></span><br><span class="line">    <span class="function">function <span class="title">next</span><span class="params">(err, data)</span> </span>&#123;</span><br><span class="line">        let result = gen.next(data);</span><br><span class="line">        <span class="keyword">if</span> (result.done) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        result.value(next);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    next();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">run(gen);</span><br></pre></td></tr></table></figure><p><code>Thunk</code>è½¬æ¢å™¨ï¼ŒæŠŠåŸæ¥çš„ fs.readFile å‡½æ•° è½¬æ¢æˆéœ€è¦ä¸¤æ¬¡è°ƒç”¨çš„å‡½æ•° ï¼ŒreadFile çš„æ‰§è¡Œç»“æœï¼Œå¯ä»¥é€šè¿‡å›è°ƒå‡½æ•°èƒ½å‚æ•°ä¼ é€’å‡ºæ¥ï¼Œå†ä¼ ç»™ next æ–¹æ³•</p><h1 id="æ–¹æ³•ä¸‰ï¼šasync-å‡½æ•°-await-çš„å¼‚æ­¥å¤„ç†æ–¹å¼"><a href="#æ–¹æ³•ä¸‰ï¼šasync-å‡½æ•°-await-çš„å¼‚æ­¥å¤„ç†æ–¹å¼" class="headerlink" title="æ–¹æ³•ä¸‰ï¼šasync å‡½æ•° + await çš„å¼‚æ­¥å¤„ç†æ–¹å¼"></a>æ–¹æ³•ä¸‰ï¼šasync å‡½æ•° + await çš„å¼‚æ­¥å¤„ç†æ–¹å¼</h1><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">const fs = require('fs')</span><br><span class="line"></span><br><span class="line"><span class="comment">// Promise ç‰ˆçš„readFile</span></span><br><span class="line"><span class="keyword">const</span> readFile = function (fileName) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Promise(function(resolve, reject) &#123;</span><br><span class="line">    fs.readFile(fileName, function(err, data)&#123;</span><br><span class="line">      <span class="keyword">if</span> (err) <span class="keyword">return</span> reject(err);</span><br><span class="line">      resolve(data);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> asyncReadFile = async function () &#123;</span><br><span class="line">  const f1 = await readFile('a.txt');</span><br><span class="line">  const f2 = await readFile('b.txt');</span><br><span class="line">  console.<span class="built_in">log</span>(f1.toString());</span><br><span class="line">  console.<span class="built_in">log</span>(f2.toString());</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">asyncReadFile();</span><br></pre></td></tr></table></figure><p><code>readFile</code>å‡½æ•° å¯¹æ¯”æ–¹æ³•ä¸€æ²¡æœ‰å¤§çš„å˜åŒ– ï¼ŒGenerator å‡½æ•°å˜æˆ äº† async å‡½æ•°ï¼Œå¯è§è¿™å¤„æ–¹å¼ åªæ˜¯ä¸€ä¸ªè¯­æ³•ç³–ï¼Œasync å‡½æ•°è‡ªå¸¦äº†æ‰§è¡Œå™¨ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä»‹ç»ä¸€ä¸‹ES6é‡Œçš„ä¸‰ç§å¼‚æ­¥æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/es6_d.png&quot; alt=&quot;ES6æ”»ç•¥&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="ES6" scheme="https://duanruilong.github.io/categories/ES6/"/>
    
    
      <category term="Javascript" scheme="https://duanruilong.github.io/tags/Javascript/"/>
    
      <category term="ç¼–ç¨‹" scheme="https://duanruilong.github.io/tags/%E7%BC%96%E7%A8%8B/"/>
    
      <category term="ES6" scheme="https://duanruilong.github.io/tags/ES6/"/>
    
  </entry>
  
  <entry>
    <title>å°ç¨‹åºä¹‹æ—…(ä¸‰)</title>
    <link href="https://duanruilong.github.io/2018/06/19/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%B9%8B%E6%97%85-%E4%B8%89/"/>
    <id>https://duanruilong.github.io/2018/06/19/å°ç¨‹åºä¹‹æ—…-ä¸‰/</id>
    <published>2018-06-19T15:40:53.000Z</published>
    <updated>2018-09-17T15:58:32.000Z</updated>
    
    <content type="html"><![CDATA[<p>å°ç¨‹åºæ˜¯ä¸€ç§æ–°çš„å¼€æ”¾èƒ½åŠ›ï¼Œå¼€å‘è€…å¯ä»¥å¿«é€Ÿåœ°å¼€å‘ä¸€ä¸ªå°ç¨‹åºã€‚å°ç¨‹åºå¯ä»¥åœ¨å¾®ä¿¡å†…è¢«ä¾¿æ·åœ°è·å–å’Œä¼ æ’­ï¼ŒåŒæ—¶å…·æœ‰å‡ºè‰²çš„ä½¿ç”¨ä½“éªŒã€‚è¿™æ˜¯å…³äºå°ç¨‹åºç”Ÿå‘½å‘¨æœŸå’Œæ¨¡æ¿çš„å¼•ç”¨ä¹‹æ—…ã€‚</p><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/wechat_d.png" alt="å¾®ä¿¡å°ç¨‹åº"></p><a id="more"></a><h1 id="ä¿®æ”¹å¯¼èˆªæ ä¿¡æ¯"><a href="#ä¿®æ”¹å¯¼èˆªæ ä¿¡æ¯" class="headerlink" title="ä¿®æ”¹å¯¼èˆªæ ä¿¡æ¯"></a>ä¿®æ”¹å¯¼èˆªæ ä¿¡æ¯</h1><p>å…ˆä»ä¿®æ”¹å¯¼èˆªæ ä¿¡æ¯å¼€å§‹ï¼Œä¸»è¦ä¿®æ”¹çš„æ–‡ä»¶æ˜¯<code>app.json</code>æ–‡ä»¶ï¼Œåœ¨é‡Œé¢å¯ä»¥å®šä¹‰ä¸€äº›æ ·å¼</p><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/wechat/wechat_2_2.png" alt="å¾®ä¿¡å°ç¨‹åº"></p><h1 id="å®šä¹‰åº•éƒ¨tabå¯¼èˆªæ "><a href="#å®šä¹‰åº•éƒ¨tabå¯¼èˆªæ " class="headerlink" title="å®šä¹‰åº•éƒ¨tabå¯¼èˆªæ "></a>å®šä¹‰åº•éƒ¨tabå¯¼èˆªæ </h1><p>å¯ä»¥æ ¹æ®è‡ªå·±éœ€æ±‚è‡ªå®šä¹‰åº•éƒ¨å¯¼èˆªæ çš„æ ·å¼å’Œiconï¼Œè¿™äº›æ“ä½œåŒæ ·æ˜¯åœ¨<code>app.json</code>æ–‡ä»¶é‡Œæ“ä½œã€‚</p><blockquote><p>app.json æ˜¯å¯¹å½“å‰å°ç¨‹åºçš„å…¨å±€é…ç½®ï¼ŒåŒ…æ‹¬äº†å°ç¨‹åºçš„æ‰€æœ‰é¡µé¢è·¯å¾„ã€ç•Œé¢è¡¨ç°ã€ç½‘ç»œè¶…æ—¶æ—¶é—´ã€åº•éƒ¨ tab ç­‰ã€‚</p></blockquote><p>ç®€å•è¯´ä¸€ä¸‹è¿™ä¸ªé…ç½®å„ä¸ªé¡¹çš„å«ä¹‰:</p><p>1ã€<code>pageså­—æ®µ</code> â€”â€” ç”¨äºæè¿°å½“å‰å°ç¨‹åºæ‰€æœ‰é¡µé¢è·¯å¾„ï¼Œè¿™æ˜¯ä¸ºäº†è®©å¾®ä¿¡å®¢æˆ·ç«¯çŸ¥é“å½“å‰ä½ çš„å°ç¨‹åºé¡µé¢å®šä¹‰åœ¨å“ªä¸ªç›®å½•ã€‚<br>2ã€<code>windowå­—æ®µ</code> â€”â€” å°ç¨‹åºæ‰€æœ‰é¡µé¢çš„é¡¶éƒ¨èƒŒæ™¯é¢œè‰²ï¼Œæ–‡å­—é¢œè‰²å®šä¹‰åœ¨è¿™é‡Œçš„ã€‚<br>å…¶ä»–é…ç½®é¡¹ç»†èŠ‚å¯ä»¥å‚è€ƒæ–‡æ¡£ <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/config.html" target="_blank" rel="noopener">å°ç¨‹åºçš„é…ç½® app.json</a> ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªåŒ…å«äº†æ‰€æœ‰é…ç½®é€‰é¡¹çš„ app.json ï¼š<br><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/config.html" target="_blank" rel="noopener">å‚è€ƒåœ°å€</a><br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"pages"</span>: [</span><br><span class="line">    <span class="string">"pages/index/index"</span>,</span><br><span class="line">    <span class="string">"pages/logs/index"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"window"</span>: &#123;</span><br><span class="line">    <span class="string">"navigationBarTitleText"</span>: <span class="string">"Demo"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"tabBar"</span>: &#123;</span><br><span class="line">    <span class="string">"list"</span>: [&#123;</span><br><span class="line">      <span class="string">"pagePath"</span>: <span class="string">"pages/index/index"</span>,</span><br><span class="line">      <span class="string">"text"</span>: <span class="string">"é¦–é¡µ"</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">      <span class="string">"pagePath"</span>: <span class="string">"pages/logs/logs"</span>,</span><br><span class="line">      <span class="string">"text"</span>: <span class="string">"æ—¥å¿—"</span></span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"networkTimeout"</span>: &#123;</span><br><span class="line">    <span class="string">"request"</span>: <span class="number">10000</span>,</span><br><span class="line">    <span class="string">"downloadFile"</span>: <span class="number">10000</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"debug"</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>app.json é…ç½®é¡¹åˆ—è¡¨</p><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/wechat/wechat_2_3.png" alt="å¾®ä¿¡å°ç¨‹åº"></p><p>tabBarçš„é…ç½®å‚æ•°å¯ä»¥åœ¨<code>list</code>é‡Œé¢é…ç½®ï¼ŒåŒ…æ‹¬iconçš„è®¾ç½®ï¼Œå¯ä»¥å»<a href="">iconfont</a>å»ä¸‹è½½ï¼ŒæŠŠä¸‹è½½å¥½çš„iconå›¾ç‰‡æ”¾åˆ°imagesæ–‡ä»¶å¤¹ä¸‹ï¼Œæ­£ç¡®å¼•ç”¨å›¾ç‰‡å°±å¥½äº†ã€‚</p><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/wechat/wechat_2_4.png" alt="å¾®ä¿¡å°ç¨‹åº"></p><p>iconPathä¸selectedIconPathå°±å¯ä»¥å®ç°é€‰ä¸­ä¸æ²¡æœ‰é€‰ä¸­æ•ˆæœã€‚å…·ä½“é…ç½®å‚è€ƒä¸‹å›¾ï¼š</p><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/wechat/wechat_2_5.png" alt="å¾®ä¿¡å°ç¨‹åº"></p><h1 id="æŠ½ç¦»å…¬å…±éƒ¨åˆ†"><a href="#æŠ½ç¦»å…¬å…±éƒ¨åˆ†" class="headerlink" title="æŠ½ç¦»å…¬å…±éƒ¨åˆ†"></a>æŠ½ç¦»å…¬å…±éƒ¨åˆ†</h1><p>æŠŠå¤´åƒå’Œæ˜µç§°æŠ½ç¦»æˆå…¬å…±éƒ¨åˆ†å…±ç”¨ï¼Œå°ç¨‹åºæä¾›äº†<code>import</code>å’Œ<code>include</code>ä¸¤ç§æ–¹å¼ï¼Œå¾®ä¿¡å¤´åƒå’Œæ˜µç§°ï¼Œæ˜¾ç„¶æ˜¯å¼‚æ­¥è·å–çš„ã€‚<br>ä¸ºé¿å…é‡å¤è¯·æ±‚æ•°æ®ï¼Œå¯ä»¥åˆ©ç”¨ç¼“å­˜ï¼Œåœ¨é¦–é¡µè·å–ä¸€æ¬¡æ•°æ®åï¼Œç¼“å­˜åˆ°æœ¬åœ°ä¿å­˜èµ·æ¥ï¼Œåœ¨å…¶ä»–é¡µé¢ç›´æ¥è°ƒå–ç¼“å­˜çš„æ•°æ®å°±å¯ä»¥äº†ã€‚ä¸ºé¿å…æ¯ä¸ªé¡µé¢éƒ½å†™ä¸€éæ ·å¼ï¼Œå¯ä»¥æŠŠå±•ç¤ºå¤´åƒå’Œæ˜µç§°ç›¸å…³çš„æ ·å¼ï¼Œç»Ÿä¸€å†™åˆ°<code>app.wxss</code>å…¨å±€æ ·å¼è¡¨æ–‡ä»¶ä¸­ã€‚é€€å‡ºçš„æ—¶å€™ï¼Œé”€æ¯æœ¬åœ°å­˜å‚¨ï¼Œä¿è¯æ•°æ®çš„å‡†ç¡®æ€§ã€‚</p><p>æŠŠ<code>index.wxss</code>é‡Œçš„ç”¨æˆ·æ ·å¼ç§»åŠ¨åˆ°<code>app.wxss</code>ä¸‹ï¼š<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**index.wxssç”¨æˆ·ä¿¡æ¯æ ·å¼**/</span></span><br><span class="line">.userinfo &#123;</span><br><span class="line">  display: flex;</span><br><span class="line">  flex-direction: column;</span><br><span class="line">  align-items: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.userinfo-avatar &#123;</span><br><span class="line">  width: <span class="number">128</span>rpx;</span><br><span class="line">  height: <span class="number">128</span>rpx;</span><br><span class="line">  margin: <span class="number">20</span>rpx;</span><br><span class="line">  border-radius: <span class="number">50</span>%;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.userinfo-nickname &#123;</span><br><span class="line">  color: <span class="meta">#aaa;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.usermotto &#123;</span><br><span class="line">  margin-top: <span class="number">200</span>px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ¥ä¸‹æ¥æ–°å»º<code>common</code>ç›®å½•ï¼Œæ–°å»ºæ–‡ä»¶<code>header.wxml</code></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- åœ¨è¿™ä¸ªæ–‡ä»¶é‡ŒæŠŠindexé¡µé¢çš„ç”¨æˆ·ä¿¡æ¯ç§»åŠ¨è¿‡æ¥ --&gt;</span><br><span class="line"></span><br><span class="line">&lt;view <span class="class"><span class="keyword">class</span>="<span class="title">userinfo</span>"&gt;</span></span><br><span class="line"><span class="class">    &lt;button wx:if="&#123;&#123;!hasUserInfo &amp;&amp; canIUse&#125;&#125;" open-type="getUserInfo" bindgetuserinfo="getUserInfo"&gt; è·å–å¤´åƒæ˜µç§° &lt;/button&gt;</span></span><br><span class="line"><span class="class">    &lt;block wx:else&gt;</span></span><br><span class="line"><span class="class">      &lt;image bindtap="bindViewTap" class="userinfo-avatar" src="&#123;&#123;userInfo.avatarUrl&#125;&#125;" background-size="cover"&gt;&lt;/image&gt;</span></span><br><span class="line">      &lt;text class="userinfo-nickname"&gt;&#123;&#123;userInfo.nickName&#125;&#125;&lt;/text&gt;</span><br><span class="line">    &lt;/block&gt;</span><br><span class="line">&lt;/view&gt;</span><br></pre></td></tr></table></figure><p>åœ¨ <code>index.wxml</code>åˆé€‚ä½ç½®å¼•å…¥æ–‡ä»¶ï¼š</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;include src=<span class="string">"../common/header.wxml"</span>/&gt;</span><br></pre></td></tr></table></figure><p>åœ¨ <code>index.js</code>åˆé€‚ä½ç½®ç¼“å­˜æœ¬åœ°ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¼“å­˜æœ¬åœ°</span></span><br><span class="line">wx.setStorageSync('userData', this.data.userInfo)</span><br></pre></td></tr></table></figure><p>åœ¨éœ€è¦å±•ç¤ºçš„é¡µé¢å°±å¯ä»¥å¼•å…¥å…¬å…±æ¨¡å—ï¼Œå’Œæ•°æ®å…·ä½“é…ç½®ï¼š</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;include src=<span class="string">"../common/header.wxml"</span>/&gt;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/wechat/wechat_2_6.png" alt="å¾®ä¿¡å°ç¨‹åº"></p><p>åŒæ—¶å°ç¨‹åºè¿˜æä¾›äº†<code>template</code>æ¨¡æ¿ç»„ä»¶ï¼Œå¯ä»¥åœ¨æ¨¡æ¿é‡Œè‡ªå®šä¹‰ä»£ç ç‰‡æ®µï¼Œåœ¨ä¸åŒçš„éœ€è¦çš„åœ°æ–¹è°ƒç”¨ã€‚<br>æ¥ä¸‹æ¥å¯ä»¥è¯•ç€åŠ å…¥ä¸€ä¸ª<code>footer.wxml</code>å…¬å…±ç»„ä»¶æ–‡ä»¶å§ã€‚</p><p>footer.wxmlï¼š<br><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/wechat/wechat_2_7.png" alt="å¾®ä¿¡å°ç¨‹åº"></p><p>éœ€è¦å¼•å…¥çš„æ–‡ä»¶é…ç½®ï¼š</p><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/wechat/wechat_2_8.png" alt="å¾®ä¿¡å°ç¨‹åº"></p><p>æ³¨æ„name ä¸ is çš„å¯¹åº”å…³ç³»ï¼Œä¹Ÿå¯ä»¥è‡ªå·±å®šä¹‰å‡ºå¤šä¸ªnameæ¨¡æ¿é€‚åº”ä¸åŒçš„ç¯å¢ƒã€‚</p><h1 id="ç”Ÿå‘½å‘¨æœŸ"><a href="#ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸ"></a>ç”Ÿå‘½å‘¨æœŸ</h1><p><code>app.js</code>æ–‡ä»¶,å°±æ˜¯ä¸ª<code>App()</code>å‡½æ•°,App()å‡½æ•°çš„æ„æ€ï¼Œå…¶å®å°±æ˜¯æ³¨å†Œä¸€ä¸ªå°ç¨‹åºã€‚çœ‹åˆ°index.jsæ–‡ä»¶ä¸­ï¼Œä¼šæœ‰<code>var app = getApp()</code>è¿™æ ·çš„ä»£ç å‡ºç°ï¼Œè¿™æ˜¯è·å–å°ç¨‹åºå®ä¾‹çš„æ„æ€ã€‚å…¶å®è¿™æ˜¯é…å¥—çš„ã€‚åªæœ‰å…ˆæ³¨å†Œäº†å°ç¨‹åºï¼Œåé¢æ‰èƒ½è·å¾—å°ç¨‹åºçš„å®ä¾‹ã€‚<br>å†æ¥çœ‹ä¸‹App()çš„ä½¿ç”¨æ–¹æ³•ã€‚å°±æ˜¯æ¥æ”¶äº†ä¸€ä¸ªobjectå‚æ•°è€Œå·²ã€‚è¿™ä¸ªå¯¹è±¡å‚æ•°ä½ å¯ä»¥æŠŠå®ƒæ‹†å‡ºæ¥ï¼Œå•ç‹¬ç”¨ä¸ªå˜é‡å‘½åã€‚<br>è¿™ä¸ªobjectï¼Œé™¤äº†<code>getUserInfo</code>è¿™ä¸ªè‡ªå®šä¹‰å‡½æ•°ï¼Œè¿˜æœ‰<code>onLaunch</code>æ˜¯å†…ç½®çš„å‡½æ•°ï¼Œé‚£ä¹ˆonLaunchæ˜¯å•¥æ„æ€å‘¢ï¼Ÿ<br>å…ˆæ¥è¯´ä¸‹ç”Ÿå‘½å‘¨æœŸçš„æ¦‚å¿µã€‚<br>ç”Ÿå‘½å‘¨æœŸï¼Œå°±æ˜¯ç¨‹åºä»åˆ›å»ºåˆ°é”€æ¯çš„å…¨è¿‡ç¨‹ã€‚æ¯”å¦‚reactçš„ç”Ÿå‘½å‘¨æœŸï¼Œå¤§ä½“åˆ†ä¸ºï¼š<code>åˆå§‹åŒ–ï¼Œæ¸²æŸ“å‰ï¼Œæ¸²æŸ“ä¸­ï¼Œæ¸²æŸ“åï¼Œé”€æ¯</code>ç­‰æƒ…æ™¯ï¼Œè¿™ä¸ªä¸»è¦æ˜¯è€ƒè™‘webç½‘é¡µçš„ç‰¹æ€§åˆ’åˆ†çš„ï¼›è€Œå°ç¨‹åºæœ¬èº«å¹¶ä¸æ˜¯ç½‘é¡µï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸï¼Œæ›´åƒæ˜¯appã€‚<br>ä»¥å®‰å“çš„Activity(å¯ä»¥ç†è§£ä¸ºè§†å›¾)ä¸ºä¾‹,appçš„ç”Ÿå‘½å‘¨æœŸæ˜¯ä¸‹å›¾ç¤ºï¼š</p><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/wechat/wechat_2_9.png" alt="å¾®ä¿¡å°ç¨‹åº"></p><blockquote><p>1.å¯åŠ¨Activityï¼šç³»ç»Ÿä¼šå…ˆè°ƒç”¨onCreateæ–¹æ³•ï¼Œç„¶åè°ƒç”¨onStartæ–¹æ³•ï¼Œæœ€åè°ƒç”¨onResumeï¼ŒActivityè¿›å…¥è¿è¡ŒçŠ¶æ€ã€‚<br>2.å½“å‰Activityè¢«å…¶ä»–Activityè¦†ç›–å…¶ä¸Šæˆ–è¢«é”å±ï¼šç³»ç»Ÿä¼šè°ƒç”¨onPauseæ–¹æ³•ï¼Œæš‚åœå½“å‰Activityçš„æ‰§è¡Œã€‚<br>3.å½“å‰Activityç”±è¢«è¦†ç›–çŠ¶æ€å›åˆ°å‰å°æˆ–è§£é”å±ï¼šç³»ç»Ÿä¼šè°ƒç”¨onResumeæ–¹æ³•ï¼Œå†æ¬¡è¿›å…¥è¿è¡ŒçŠ¶æ€ã€‚<br>4.å½“å‰Activityè½¬åˆ°æ–°çš„Activityç•Œé¢æˆ–æŒ‰Homeé”®å›åˆ°ä¸»å±ï¼Œè‡ªèº«é€€å±…åå°ï¼šç³»ç»Ÿä¼šå…ˆè°ƒç”¨onPauseæ–¹æ³•ï¼Œç„¶åè°ƒç”¨onStopæ–¹æ³•ï¼Œè¿›å…¥åœæ»çŠ¶æ€ã€‚<br>5.ç”¨æˆ·åé€€å›åˆ°æ­¤Activityï¼šç³»ç»Ÿä¼šå…ˆè°ƒç”¨onRestartæ–¹æ³•ï¼Œç„¶åè°ƒç”¨onStartæ–¹æ³•ï¼Œæœ€åè°ƒç”¨onResumeæ–¹æ³•ï¼Œå†æ¬¡è¿›å…¥è¿è¡ŒçŠ¶æ€ã€‚<br>6.å½“å‰Activityå¤„äºè¢«è¦†ç›–çŠ¶æ€æˆ–è€…åå°ä¸å¯è§çŠ¶æ€ï¼Œå³ç¬¬2æ­¥å’Œç¬¬4æ­¥ï¼Œç³»ç»Ÿå†…å­˜ä¸è¶³ï¼Œæ€æ­»å½“å‰Activityï¼Œè€Œåç”¨æˆ·é€€å›å½“å‰Activityï¼šå†æ¬¡è°ƒç”¨onCreateæ–¹æ³•ã€onStartæ–¹æ³•ã€onResumeæ–¹æ³•ï¼Œè¿›å…¥è¿è¡ŒçŠ¶æ€ã€‚<br>7.ç”¨æˆ·é€€å‡ºå½“å‰Activityï¼šç³»ç»Ÿå…ˆè°ƒç”¨onPauseæ–¹æ³•ï¼Œç„¶åè°ƒç”¨onStopæ–¹æ³•ï¼Œæœ€åè°ƒç”¨onDestoryæ–¹æ³•ï¼Œç»“æŸå½“å‰Activityã€‚</p></blockquote><p>æ­£å¸¸ä¸€ä¸ªappçš„ç”Ÿå‘½å‘¨æœŸè¿˜æ˜¯ååˆ†ç¹ççš„ï¼Œæœ‰å¾ˆå¤šçš„ä½¿ç”¨åœºæ™¯éƒ½å¾—è€ƒè™‘åˆ°ã€‚<br>å°ç¨‹åºç”Ÿå‘½å‘¨æœŸï¼Œåˆ†ä¸ºæ³¨å†ŒAppå’Œæ³¨å†ŒPageä¸¤æ®µã€‚<br>å…¶å®ä¹Ÿç®€å•ã€‚Appå¯ä»¥æ¯”ä½œæµè§ˆå™¨ï¼ŒPageå¯ä»¥æ¯”ä½œç½‘é¡µã€‚<br>é‚£ä¹ˆAppçš„ç”Ÿå‘½å‘¨æœŸå‘¢ï¼Œå°±æ˜¯ä½ åŒå‡»æµè§ˆå™¨æ‰“å¼€çš„è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯ï¼šåˆ›å»ºã€å±•ç¤ºã€éšè—ï¼ŒåŒºåŒºä¸‰ä¸ªè€Œå·².</p><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/wechat/wechat_2_10.png" alt="å¾®ä¿¡å°ç¨‹åº"></p><p>onShowå’ŒonHideï¼Œä¹Ÿå°±æ˜¯å‰å°å’Œåå°çš„å®šä¹‰ã€‚<br> å½“ç”¨æˆ·ç‚¹å‡»å·¦ä¸Šè§’å…³é—­ï¼Œæˆ–è€…æŒ‰äº†è®¾å¤‡ Home é”®ç¦»å¼€å¾®ä¿¡ï¼Œå°ç¨‹åºå¹¶æ²¡æœ‰ç›´æ¥é”€æ¯ï¼Œè€Œæ˜¯è¿›å…¥äº†åå°(onHide)ï¼›å½“å†æ¬¡è¿›å…¥å¾®ä¿¡æˆ–å†æ¬¡æ‰“å¼€å°ç¨‹åºï¼Œåˆä¼šä»åå°è¿›å…¥å‰å°(onShow)ã€‚<br>å½“onShowçš„åŠ¨ä½œæ‰§è¡Œå®Œæ¯•åï¼Œç´§æ¥ç€å°±è¿›å…¥Pageçš„ç”Ÿå‘½å‘¨æœŸäº†ï¼ˆonLoadï¼‰ã€‚<br>è€Œå¯¹äºonErrorå’Œå…¶ä»–é€‰é¡¹ï¼Œä¸€èˆ¬ä¸ç»å¸¸ä½¿ç”¨ã€‚</p><p>Pageï¼ˆç½‘é¡µï¼‰çš„ç”Ÿå‘½å‘¨æœŸã€‚Page() å‡½æ•°ç”¨æ¥æ³¨å†Œä¸€ä¸ªé¡µé¢ã€‚æ¥å—ä¸€ä¸ª object å‚æ•°ï¼Œå…¶æŒ‡å®šé¡µé¢çš„åˆå§‹æ•°æ®ã€ç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€äº‹ä»¶å¤„ç†å‡½æ•°ç­‰ã€‚</p><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/wechat/wechat_2_11.png" alt="å¾®ä¿¡å°ç¨‹åº"><br>è¿™é‡Œä¹Ÿæœ‰<code>onShow</code>å’Œ<code>onHide</code>ï¼Œé‚£ä¹ˆè¿™ä¿©å“¥ä»¬åˆæ˜¯å•¥æ—¶å€™è§¦å‘å‘¢ï¼Ÿ<br>onShowæ˜¯é¡µé¢åŠ è½½ï¼ˆonLoadï¼‰åé©¬ä¸Šè§¦å‘çš„ï¼Œä¹Ÿå°±å±•ç¤ºé¡µé¢çš„æ„æ€ã€‚ä½†æ˜¯ï¼Œå±•ç¤ºå¹¶ä¸ä»£è¡¨æ¸²æŸ“å®Œæˆï¼Œæ‰€ä»¥è¿˜æœ‰ä¸ªç›‘å¬æ¸²æŸ“æ˜¯å¦å®Œæˆï¼ˆonReadyï¼‰çš„è¿‡ç¨‹ï¼›å½“è·³åˆ°å¦å¤–ä¸€ä¸ªé¡µé¢åï¼Œå°±è§¦å‘äº†onHideéšè—é¡µé¢ï¼Œæœ€åå½“é¡µé¢å…³é—­æ—¶ï¼Œå°±è§¦å‘äº†onUnloadäº‹ä»¶ã€‚<br>å•¥å«é¡µé¢å…³é—­å‘¢ï¼Ÿå°ç¨‹åºä¸æ˜¯ç½‘é¡µå•Šï¼Œä¹Ÿæ²¡å…³é—­æŒ‰é’®ï¼Œæ€ä¹ˆå…³é—­å‘¢ï¼Ÿ</p><blockquote><p>é¡µé¢è·³è½¬åˆ†ä¸¤ç§æƒ…å†µï¼š<br>1ã€wx.navigateToä¿ç•™å½“å‰é¡µé¢ï¼Œè·³è½¬<br>2ã€wx.redirectToå…³é—­å½“å‰é¡µé¢ï¼Œè·³è½¬</p></blockquote><p>è¿™äºŒè€…çš„åŒºåˆ«å°±æ˜¯æ˜¯å¦èƒ½å¤Ÿè¿”å›ä¸Šä¸€ä¸ªé¡µé¢ã€‚å¦‚æœæ˜¯å…³é—­äº†å½“å‰é¡µé¢è·³è½¬ï¼Œå°±æ— æ³•è¿”å›äº†ã€‚</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;button open-type=<span class="string">"getUserInfo"</span> bindtap=<span class="string">"keepJump"</span>&gt;ä¿ç•™å½“å‰é¡µé¢å¹¶è·³è½¬ &lt;/button&gt;</span><br><span class="line">&lt;button open-type=<span class="string">"getUserInfo"</span> bindtap=<span class="string">"closeJump"</span>&gt;å…³é—­å½“å‰é¡µé¢å¹¶è·³è½¬ &lt;/button&gt;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/wechat/wechat_2_12.png" alt="å¾®ä¿¡å°ç¨‹åº"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å°ç¨‹åºæ˜¯ä¸€ç§æ–°çš„å¼€æ”¾èƒ½åŠ›ï¼Œå¼€å‘è€…å¯ä»¥å¿«é€Ÿåœ°å¼€å‘ä¸€ä¸ªå°ç¨‹åºã€‚å°ç¨‹åºå¯ä»¥åœ¨å¾®ä¿¡å†…è¢«ä¾¿æ·åœ°è·å–å’Œä¼ æ’­ï¼ŒåŒæ—¶å…·æœ‰å‡ºè‰²çš„ä½¿ç”¨ä½“éªŒã€‚è¿™æ˜¯å…³äºå°ç¨‹åºç”Ÿå‘½å‘¨æœŸå’Œæ¨¡æ¿çš„å¼•ç”¨ä¹‹æ—…ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/wechat_d.png&quot; alt=&quot;å¾®ä¿¡å°ç¨‹åº&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="å°ç¨‹åº" scheme="https://duanruilong.github.io/categories/%E5%B0%8F%E7%A8%8B%E5%BA%8F/"/>
    
    
      <category term="Javascript" scheme="https://duanruilong.github.io/tags/Javascript/"/>
    
      <category term="ç¼–ç¨‹" scheme="https://duanruilong.github.io/tags/%E7%BC%96%E7%A8%8B/"/>
    
      <category term="å°ç¨‹åº" scheme="https://duanruilong.github.io/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/"/>
    
  </entry>
  
  <entry>
    <title>å°ç¨‹åºä¹‹æ—…(äºŒ)</title>
    <link href="https://duanruilong.github.io/2018/06/15/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%B9%8B%E6%97%85-%E4%BA%8C/"/>
    <id>https://duanruilong.github.io/2018/06/15/å°ç¨‹åºä¹‹æ—…-äºŒ/</id>
    <published>2018-06-14T17:00:05.000Z</published>
    <updated>2018-09-17T15:58:32.000Z</updated>
    
    <content type="html"><![CDATA[<p>å°ç¨‹åºæ˜¯ä¸€ç§æ–°çš„å¼€æ”¾èƒ½åŠ›ï¼Œå¼€å‘è€…å¯ä»¥å¿«é€Ÿåœ°å¼€å‘ä¸€ä¸ªå°ç¨‹åºã€‚å°ç¨‹åºå¯ä»¥åœ¨å¾®ä¿¡å†…è¢«ä¾¿æ·åœ°è·å–å’Œä¼ æ’­ï¼ŒåŒæ—¶å…·æœ‰å‡ºè‰²çš„ä½¿ç”¨ä½“éªŒã€‚è¿™æ˜¯å…³äº<code>form</code>ç»„ä»¶ã€æœ¬åœ°å­˜å‚¨å’Œé¡µé¢çš„è·³è½¬å’Œå›é€€çš„å°ç¨‹åºä¹‹æ—…ã€‚</p><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/wechat_d.png" alt="å¾®ä¿¡å°ç¨‹åº"></p><a id="more"></a><p>ä»‹ç»ä¸‹ <code>form</code>ç»„ä»¶ã€æœ¬åœ°å­˜å‚¨å’Œé¡µé¢çš„è·³è½¬å’Œå›é€€</p><h1 id="è¡¨å•ç»„ä»¶å’Œæ•°æ®å­˜å‚¨åŠŸèƒ½"><a href="#è¡¨å•ç»„ä»¶å’Œæ•°æ®å­˜å‚¨åŠŸèƒ½" class="headerlink" title="è¡¨å•ç»„ä»¶å’Œæ•°æ®å­˜å‚¨åŠŸèƒ½"></a>è¡¨å•ç»„ä»¶å’Œæ•°æ®å­˜å‚¨åŠŸèƒ½</h1><p>æ–°å»ºä¸€ä¸ªç™»å½•é¡µé¢ï¼Œè¡¨å•é‡Œé¢åŒ…æ‹¬å§“åã€å¯†ç ã€æŒ‰é’®ã€‚ç‚¹å‡»æŒ‰é’®éœ€ä¿å­˜æ•°æ®ã€‚å¯ä»¥äº†è§£åˆ°è¡¨å•ç»„ä»¶å’Œæ•°æ®å­˜å‚¨åŠŸèƒ½</p><p>åœ¨<code>pages</code>ä¸‹æ–°å¢ä¸€ä¸ª<code>login</code>æ–‡ä»¶å¤¹ã€‚</p><blockquote><p>æ“ä½œæ­¥éª¤ä¸ºï¼špagesæ–‡ä»¶å¤¹å³é”®-&gt;æ–°å»º-&gt;ç›®å½•ï¼Œ</p></blockquote><p>ç„¶åæ–°å»ºä¸‰ä¸ªåŸºæœ¬æ–‡ä»¶,åœ¨å…¥å£app.jsonçš„pagesæ•°ç»„ä¸­ï¼Œæ·»åŠ ä¸Šæ–°åŠ çš„é¡µé¢è·¯å¾„ã€‚</p><p>é…ç½®ä»£ç ï¼š</p><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/wechat/wechat_2.png" alt="å¾®ä¿¡å°ç¨‹åº"></p><p>login.wxml:<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--login.wxml--&gt;</span><br><span class="line">&lt;form bindsubmit=<span class="string">"formSubmit"</span>&gt;</span><br><span class="line">  &lt;view class=<span class="string">"container"</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;input name=<span class="string">"userName"</span> type=<span class="string">"text"</span> class=<span class="string">"myinput"</span> placeholder=<span class="string">"è¯·è¾“å…¥ç”¨æˆ·å"</span> value=<span class="string">"&#123;&#123;userName&#125;&#125;"</span>/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;input name=<span class="string">"userPass"</span> type=<span class="string">"text"</span> class=<span class="string">"myinput"</span> password placeholder=<span class="string">"è¯·è¾“å…¥å¯†ç "</span> value=<span class="string">"&#123;&#123;userPass&#125;&#125;"</span>/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;button formType=<span class="string">"submit"</span>&gt;æ ‡è®°æˆ‘&lt;/button&gt;</span><br><span class="line"> &lt;/view&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure></p><p>login.js:</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//login.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">  data: &#123;</span><br><span class="line">    userName: '',//ç”¨æˆ·å</span><br><span class="line">    userPass: '',//å¯†ç </span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//è¡¨å•æäº¤å‡½æ•°ï¼Œæ¯ä¸ªinputéœ€è¦æœ‰nameï¼Œå¦åˆ™è·å–ä¸åˆ°å€¼ã€‚</span></span><br><span class="line">  formSubmit: function (e) &#123;</span><br><span class="line">    console.<span class="built_in">log</span>(e.detail.value);<span class="comment">//è¿”å›æ ¼å¼ï¼šObject &#123;userName: "hello", userPass: "123"&#125;</span></span><br><span class="line">    var obj = e.detail.value;</span><br><span class="line">    <span class="keyword">if</span> (obj.userName &amp;&amp; obj.userPass) &#123;</span><br><span class="line">      <span class="comment">//æœ¬åœ°å­˜å‚¨ç”¨æˆ·åå’Œå¯†ç </span></span><br><span class="line">      wx.setStorageSync('userName', obj.userName);</span><br><span class="line">      wx.setStorageSync('userPass', obj.userPass);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//åŠ è½½äº‹ä»¶ï¼Œå¦‚æœåˆ¤æ–­æœ‰ç¼“å­˜ä¿¡æ¯ï¼Œå°±è¯»å–å¹¶æ˜¾ç¤ºåœ¨inputé‡Œã€‚</span></span><br><span class="line">  onLoad: function () &#123;</span><br><span class="line">    var name = wx.getStorageSync('userName');</span><br><span class="line">    var password = wx.getStorageSync('userPass');</span><br><span class="line">    <span class="keyword">if</span> (name) &#123;</span><br><span class="line">      <span class="keyword">this</span>.setData(&#123; userName: name &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (password) &#123;</span><br><span class="line">      <span class="keyword">this</span>.setData(&#123; userPass: password &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>login.wxsss:</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.myinput&#123;</span><br><span class="line">  border:<span class="number">1</span>px solid cyan;</span><br><span class="line">  border-radius: <span class="number">40</span>px;</span><br><span class="line">  margin-bottom: <span class="number">10</span>px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥åœ¨é¦–é¡µåˆ›å»ºä¸€ä¸ªæŒ‰é’®ï¼Œç„¶ååˆ©ç”¨<code>wx.navigateTo</code>ç»„ä»¶è·³è½¬ä¸€ä¸‹å³å¯ï¼Œç›´æ¥çœ‹ä¸€ä¸‹æ•ˆæœï¼š<br><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/wechat/wechat_2_m1.gif" alt="å¾®ä¿¡å°ç¨‹åº"></p><p>å°ç¨‹åºçš„è¡¨å•ï¼Œé»˜è®¤æ˜¯å¼‚æ­¥æäº¤çš„ã€‚å®ƒåœ¨<code>form</code>ä¸Šå…¨å±€ç»‘å®šä¸€ä¸ªäº‹ä»¶ï¼Œç„¶åæ ¹æ®<code>name</code>å»å¯»æ‰¾è¡¨å•å…ƒç´ çš„å€¼ã€‚æ‰€ä»¥æ¯ä¸ª<code>input</code>è¾“å…¥æ¡†ä¸€å®šè¦è·Ÿä¸Š<code>name</code>ï¼Œå¦åˆ™æ‰¾ä¸åˆ°ã€‚è¿™é‡Œåªæ˜¯inputï¼Œè‡³äºå…¶ä»–çš„è¡¨å•å…ƒç´ å¯ä»¥å†å»çœ‹çœ‹ã€‚<br>è¿˜æœ‰å°±æ˜¯æœ‰å…³æ•°æ®å­˜å‚¨ï¼Œè¦ç”¨å°ç¨‹åºæä¾›çš„apiï¼š</p><blockquote><p>wx.setStorage(OBJ)ï¼šå¼‚æ­¥å­˜å‚¨å†…å®¹ã€‚<br>wx.setStorageSync(key,data)ï¼šåŒæ­¥å­˜å‚¨å†…å®¹ã€‚dataå¯ä»¥æ˜¯stringæˆ–objectã€‚<br>wx.getStorage(OBJ)ï¼šå¼‚æ­¥è·å–å†…å®¹ã€‚<br>wx.getStorageSync(key)ï¼šåŒæ­¥è·å–å†…å®¹ã€‚</p></blockquote><p>ä¸€èˆ¬æ¥è¯´ï¼ŒåŒæ­¥å­˜å‚¨çš„æ¯”è¾ƒå¸¸ç”¨ï¼Œå› ä¸ºä¸æ¶‰åŠåˆ°å›è°ƒï¼Œæ¯”è¾ƒç®€å•ã€‚<br>è€Œå¼‚æ­¥å­˜å‚¨çš„è¯ï¼Œè¦æ³¨æ„å…¶<code>OBJå‚æ•°</code>çš„ä¹¦å†™æ ¼å¼ï¼Œå®ƒåŒ…æ‹¬ï¼š</p><blockquote><p>keyï¼Œdataï¼Œsuccesså›è°ƒå‡½æ•°ï¼Œfailå›è°ƒå‡½æ•°ç­‰å‚æ•°çš„å¯¹è±¡</p></blockquote><p>å°ç¨‹åºçš„æœ¬åœ°æ•°æ®å­˜å‚¨ä¹Ÿæœ‰å¤§å°é™åˆ¶ï¼š<code>ä¸èƒ½è¶…è¿‡10MB</code></p><h1 id="å¼‚æ­¥å­˜å‚¨ç™»å½•é¡µçš„ç”¨æˆ·åå’Œå¯†ç "><a href="#å¼‚æ­¥å­˜å‚¨ç™»å½•é¡µçš„ç”¨æˆ·åå’Œå¯†ç " class="headerlink" title="å¼‚æ­¥å­˜å‚¨ç™»å½•é¡µçš„ç”¨æˆ·åå’Œå¯†ç "></a>å¼‚æ­¥å­˜å‚¨ç™»å½•é¡µçš„ç”¨æˆ·åå’Œå¯†ç </h1><p>åœ¨å¼‚æ­¥å­˜å‚¨ç™»å½•é¡µçš„ç”¨æˆ·åå’Œå¯†ç ä¹‹åå­˜å‚¨æˆåŠŸï¼Œè¿”å›åˆ°ä¸Šä¸€ä¸ªé¡µé¢ï¼Œè¿™é‡Œæœ‰å¼‚æ­¥å­˜å‚¨å’Œå†…å®¹è·å–ã€‚</p><p>login.jsï¼š</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//login.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">  data: &#123;</span><br><span class="line">    userName: null,</span><br><span class="line">    userPass: null</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//è¡¨å•æäº¤å‡½æ•°ï¼Œæ¯ä¸ªinputéœ€è¦æœ‰nameï¼Œå¦åˆ™è·å–ä¸åˆ°å€¼ã€‚</span></span><br><span class="line">  formSubmit: function (e) &#123;</span><br><span class="line">    console.<span class="built_in">log</span>(e.detail.value);<span class="comment">//è¿”å›æ ¼å¼ï¼šObject &#123;userName: "hello", userPass: "123"&#125;</span></span><br><span class="line">    var obj = e.detail.value;</span><br><span class="line">    <span class="keyword">if</span> (obj.userName &amp;&amp; obj.userPass) &#123;</span><br><span class="line">      <span class="comment">//å¼‚æ­¥å­˜å‚¨</span></span><br><span class="line">      wx.setStorage(&#123;</span><br><span class="line">        key: 'userInfo',</span><br><span class="line">        data: obj,</span><br><span class="line">        success: function (res) &#123;</span><br><span class="line">          <span class="comment">// success</span></span><br><span class="line">          wx.navigateBack(&#123;</span><br><span class="line">            delta: <span class="number">1</span>, <span class="comment">// å›é€€å‰ delta(é»˜è®¤ä¸º1) é¡µé¢</span></span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;,</span><br><span class="line">        fail: function () &#123;</span><br><span class="line">          <span class="comment">// fail</span></span><br><span class="line">          console.log('error');</span><br><span class="line">        &#125;,</span><br><span class="line">        complete: function () &#123;</span><br><span class="line">          <span class="comment">// complete</span></span><br><span class="line">          console.log('complete');</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">//åŠ è½½äº‹ä»¶ï¼Œå¦‚æœåˆ¤æ–­æœ‰ç¼“å­˜ä¿¡æ¯ï¼Œå°±è¯»å–å¹¶æ˜¾ç¤ºåœ¨inputé‡Œã€‚</span></span><br><span class="line">  onLoad: function () &#123;</span><br><span class="line">    var that = <span class="keyword">this</span>;</span><br><span class="line">    wx.getStorage(&#123;</span><br><span class="line">      key: 'userInfo',</span><br><span class="line">      success: function (res) &#123;</span><br><span class="line">        <span class="comment">// success</span></span><br><span class="line">        that.setData(&#123; userName: res.data.userName &#125;);</span><br><span class="line">        that.setData(&#123; userPass: res.data.userPass &#125;);</span><br><span class="line">      &#125;,</span><br><span class="line">      fail: function () &#123;</span><br><span class="line">        <span class="comment">// fail</span></span><br><span class="line">        console.log('error');</span><br><span class="line">      &#125;,</span><br><span class="line">      complete: function () &#123;</span><br><span class="line">        <span class="comment">// complete</span></span><br><span class="line">        console.log('complete');</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/wechat/wechat_2_m2.gif" alt="å¾®ä¿¡å°ç¨‹åº"></p><p>è¿˜æœ‰å°±æ˜¯å¯¹äºå­˜å‚¨çš„æ•°æ®è¦æ€ä¹ˆé”€æ¯å‘¢ï¼Ÿå°ç¨‹åºåŒæ ·æä¾›äº†apiï¼š</p><blockquote><p>wx.removeStorage(OBJ)ï¼šå¼‚æ­¥ç§»é™¤æŸæ¡æ•°æ®ã€‚<br>wx.removeStorageSync(key)ï¼šåŒæ­¥ç§»é™¤æŸæ¡æ•°æ®ã€‚<br>wx.clearStorage()ï¼šå¼‚æ­¥æ¸…é™¤æ‰€æœ‰æ•°æ®ã€‚<br>wx.clearStorageSync()ï¼šåŒæ­¥æ¸…é™¤æ‰€æœ‰æ•°æ®ã€‚</p></blockquote><p>åœ¨ä¹‹å‰çš„é¡µé¢é‡ŒåŠ å…¥ä¸€ä¸ªæ¸…é™¤æœ¬åœ°ç¼“å­˜æ•°æ®çš„ä¸€ä¸ªæŒ‰é’®</p><p>index.js:<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.js</span></span><br><span class="line"><span class="comment">//è·å–åº”ç”¨å®ä¾‹</span></span><br><span class="line"><span class="keyword">const</span> app = getApp()</span><br><span class="line"></span><br><span class="line">Page(&#123;</span><br><span class="line">  data: &#123;</span><br><span class="line">    motto: 'Hello World',</span><br><span class="line">    userInfo: &#123;&#125;,</span><br><span class="line">    hasUserInfo: <span class="literal">false</span>,</span><br><span class="line">    canIUse: wx.canIUse('button.open-type.getUserInfo')</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//äº‹ä»¶å¤„ç†å‡½æ•°</span></span><br><span class="line">  bindViewTap: function () &#123;</span><br><span class="line">    wx.navigateTo(&#123;</span><br><span class="line">      url: '../logs/logs'</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//é¡µé¢è·³è½¬äº‹ä»¶å¤„ç†å‡½æ•°</span></span><br><span class="line">  bindViewLogin: function () &#123;</span><br><span class="line">    wx.navigateTo(&#123;</span><br><span class="line">      url: '../login/login'</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  clearData: function () &#123;</span><br><span class="line">    <span class="comment">//æ¸…é™¤æ‰€æœ‰æ•°æ®</span></span><br><span class="line">    wx.clearStorageSync();</span><br><span class="line">  &#125;,</span><br><span class="line">  onLoad: function () &#123;</span><br><span class="line">    <span class="keyword">if</span> (app.globalData.userInfo) &#123;</span><br><span class="line">      <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">        userInfo: app.globalData.userInfo,</span><br><span class="line">        hasUserInfo: <span class="literal">true</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.data.canIUse)&#123;</span><br><span class="line">      <span class="comment">// ç”±äº getUserInfo æ˜¯ç½‘ç»œè¯·æ±‚ï¼Œå¯èƒ½ä¼šåœ¨ Page.onLoad ä¹‹åæ‰è¿”å›</span></span><br><span class="line">      <span class="comment">// æ‰€ä»¥æ­¤å¤„åŠ å…¥ callback ä»¥é˜²æ­¢è¿™ç§æƒ…å†µ</span></span><br><span class="line">      app.userInfoReadyCallback = res =&gt; &#123;</span><br><span class="line">        <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">          userInfo: res.userInfo,</span><br><span class="line">          hasUserInfo: <span class="literal">true</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// åœ¨æ²¡æœ‰ open-type=getUserInfo ç‰ˆæœ¬çš„å…¼å®¹å¤„ç†</span></span><br><span class="line">      wx.getUserInfo(&#123;</span><br><span class="line">        success: res =&gt; &#123;</span><br><span class="line">          app.globalData.userInfo = res.userInfo</span><br><span class="line">          <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">            userInfo: res.userInfo,</span><br><span class="line">            hasUserInfo: <span class="literal">true</span></span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  getUserInfo: function(e) &#123;</span><br><span class="line">    console.<span class="built_in">log</span>(e)</span><br><span class="line">    app.globalData.userInfo = e.detail.userInfo</span><br><span class="line">    <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">      userInfo: e.detail.userInfo,</span><br><span class="line">      hasUserInfo: <span class="literal">true</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/wechat/wechat_2_1.png" alt="å¾®ä¿¡å°ç¨‹åº"></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ä»¥ä¸Šå°±æ˜¯è¡¨å•å’Œæœ¬åœ°æ•°æ®å­˜å‚¨çš„ä¸€äº›ç»ƒä¹ ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å°ç¨‹åºæ˜¯ä¸€ç§æ–°çš„å¼€æ”¾èƒ½åŠ›ï¼Œå¼€å‘è€…å¯ä»¥å¿«é€Ÿåœ°å¼€å‘ä¸€ä¸ªå°ç¨‹åºã€‚å°ç¨‹åºå¯ä»¥åœ¨å¾®ä¿¡å†…è¢«ä¾¿æ·åœ°è·å–å’Œä¼ æ’­ï¼ŒåŒæ—¶å…·æœ‰å‡ºè‰²çš„ä½¿ç”¨ä½“éªŒã€‚è¿™æ˜¯å…³äº&lt;code&gt;form&lt;/code&gt;ç»„ä»¶ã€æœ¬åœ°å­˜å‚¨å’Œé¡µé¢çš„è·³è½¬å’Œå›é€€çš„å°ç¨‹åºä¹‹æ—…ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/wechat_d.png&quot; alt=&quot;å¾®ä¿¡å°ç¨‹åº&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="å°ç¨‹åº" scheme="https://duanruilong.github.io/categories/%E5%B0%8F%E7%A8%8B%E5%BA%8F/"/>
    
    
      <category term="Javascript" scheme="https://duanruilong.github.io/tags/Javascript/"/>
    
      <category term="ç¼–ç¨‹" scheme="https://duanruilong.github.io/tags/%E7%BC%96%E7%A8%8B/"/>
    
      <category term="å°ç¨‹åº" scheme="https://duanruilong.github.io/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/"/>
    
  </entry>
  
  <entry>
    <title>Reactå¼€å‘å¸¸ç”¨è®¾è®¡æ¨¡å¼-é›†æˆç¬¬ä¸‰æ–¹åº“</title>
    <link href="https://duanruilong.github.io/2018/06/14/React%E5%BC%80%E5%8F%91%E5%B8%B8%E7%94%A8%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E9%9B%86%E6%88%90%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93/"/>
    <id>https://duanruilong.github.io/2018/06/14/Reactå¼€å‘å¸¸ç”¨è®¾è®¡æ¨¡å¼-é›†æˆç¬¬ä¸‰æ–¹åº“/</id>
    <published>2018-06-14T15:49:58.000Z</published>
    <updated>2018-09-17T15:58:32.000Z</updated>
    
    <content type="html"><![CDATA[<p>React æˆ–è®¸æ˜¯æ„å»º UI çš„æœ€ä½³é€‰æ‹©ä¹‹ä¸€ã€‚è‰¯å¥½çš„è®¾è®¡ä¸å¼ºå¤§çš„æ”¯æŒï¼Œè¿˜æœ‰åºå¤§çš„ç¤¾åŒºã€‚ä½†æ˜¯ï¼Œæœ‰äº›æƒ…å†µä¸‹ï¼Œæƒ³è¦ä½¿ç”¨å¤–éƒ¨æœåŠ¡æˆ–æƒ³è¦é›†æˆä¸€äº›å®Œå…¨ä¸åŒçš„ä¸œè¥¿ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼ŒReact åœ¨åº•å±‚ä¸å®é™… DOM æœ‰å¤§é‡çš„äº¤äº’å¹¶æ§åˆ¶é¡µé¢ä¸Šæ¸²æŸ“ä»€ä¹ˆï¼ŒåŸºæœ¬ä¸Šå®ƒæ˜¯å¼€å‘è€…ä¸å®é™… DOM é—´çš„æ¡¥æ¢ã€‚è¿™ä¹Ÿæ­£æ˜¯ä¸ºä»€ä¹ˆ React é›†æˆç¬¬ä¸‰æ–¹ç»„ä»¶æœ‰äº›éº»çƒ¦çš„åœ°æ–¹ã€‚</p><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/react_d.png" alt="React"></p><a id="more"></a><h1 id="é›†æˆç¬¬ä¸‰æ–¹åº“"><a href="#é›†æˆç¬¬ä¸‰æ–¹åº“" class="headerlink" title="é›†æˆç¬¬ä¸‰æ–¹åº“"></a>é›†æˆç¬¬ä¸‰æ–¹åº“</h1><p>æ¥ä¸‹æ¥ä»‹ç»å¦‚ä½•å®‰å…¨åœ°æ··ç”¨ React å’Œ jQuery çš„ UI æ’ä»¶ã€‚</p><h2 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h2><p>è¿™ä¸ªç¤ºä¾‹æŒ‘é€‰äº† <a href="https://github.com/aehlke/tag-it" target="_blank" rel="noopener">tag-it</a> è¿™ä¸ª jQuery æ’ä»¶ã€‚å®ƒå°†æ— åºåˆ—è¡¨è½¬æ¢æˆå¯ä»¥ç®¡ç†æ ‡ç­¾çš„è¾“å…¥æ¡†ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul&gt;</span><br><span class="line">  &lt;li&gt;JavaScript&lt;/li&gt;</span><br><span class="line">  &lt;li&gt;CSS&lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure><p>è½¬æ¢æˆ:</p><p><img src="http://druilong.coding.me/blog/2018/06/11/Reactå¼€å‘å¸¸ç”¨è®¾è®¡æ¨¡å¼-Redux/tag-it.png" alt="react"></p><p>è¦è¿è¡Œèµ·æ¥ï¼Œéœ€è¦å¼•å…¥ <code>jQueyrã€jQuery UI å’Œ tag-it</code>æ’ä»¶ã€‚è¿™æ˜¯è¿è¡Œçš„ä»£ç <br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$('&lt;dom element selector&gt;').tagit();</span><br></pre></td></tr></table></figure></p><p>é€‰æ‹© DOM å…ƒç´ ï¼Œç„¶åè°ƒç”¨ <code>tagit()</code> ã€‚</p><p>ç°åœ¨ï¼Œæ¥åˆ›å»ºä¸€ä¸ªç®€å•çš„ React åº”ç”¨ï¼Œå®ƒå°†ä½¿ç”¨ jQuery æ’ä»¶:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Tags.jsx</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tags</span> <span class="title">extends</span> <span class="title">React</span>.<span class="title">Component</span> &#123;</span></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;ul&gt;</span><br><span class="line">      &#123; </span><br><span class="line">        <span class="keyword">this</span>.props.tags.<span class="built_in">map</span>(</span><br><span class="line">          (tag, i) =&gt; &lt;li key=&#123; i &#125;&gt;&#123; tag &#125; &lt;/li&gt;</span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// App.jsx</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="title">extends</span> <span class="title">React</span>.<span class="title">Component</span> &#123;</span></span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    super(props);</span><br><span class="line"></span><br><span class="line">    this.state = &#123; tags: ['JavaScript', 'CSS' ] &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;Tags tags=&#123; <span class="keyword">this</span>.state.tags &#125; /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(&lt;App /&gt;, document.querySelector('#container'));</span><br></pre></td></tr></table></figure><p>App ç±»æ˜¯å…¥å£ã€‚å®ƒä½¿ç”¨äº†<code>Tags</code>ç»„ä»¶ï¼ŒTags ç»„ä»¶ä¼šæ ¹æ®ä¼ å…¥çš„ <code>tags</code> å±æ€§æ¥å±•ç¤ºæ— åºåˆ—è¡¨ã€‚å½“ React åœ¨é¡µé¢ä¸Šæ¸²æŸ“åˆ—è¡¨æ—¶å°±æœ‰äº†<code>&lt;ul&gt;</code>æ ‡ç­¾ï¼Œè¿™æ ·å°±å¯ä»¥å’Œ <code>jQuery</code> æ’ä»¶è¿æ¥èµ·æ¥ã€‚</p><h2 id="å¼ºåˆ¶å•é€šé“æ¸²æŸ“"><a href="#å¼ºåˆ¶å•é€šé“æ¸²æŸ“" class="headerlink" title="å¼ºåˆ¶å•é€šé“æ¸²æŸ“"></a>å¼ºåˆ¶å•é€šé“æ¸²æŸ“</h2><p>é¦–å…ˆï¼Œè¦åšçš„å°±æ˜¯å¼ºåˆ¶ <code>Tags</code> ç»„ä»¶è¿›è¡Œå•é€šé“æ¸²æŸ“ã€‚è¿™æ˜¯å› ä¸ºå½“ React åœ¨å®é™… <code>DOM</code>ä¸­æ·»åŠ å®Œå®¹å™¨å…ƒç´ åï¼Œæƒ³å°†æ§åˆ¶æƒäº¤ç»™ jQuery ã€‚å¦‚æœä¸åšæ§åˆ¶çš„è¯ï¼Œé‚£ä¹ˆ React å’Œ jQuery å°†ä¼šæ“çºµåŒä¸€ä¸ª DOM å…ƒç´ è€Œå½¼æ­¤ä¹‹é—´ä¸çŸ¥æƒ…ã€‚è¦å®ç°å•é€šé“æ¸²æŸ“ï¼Œéœ€è¦ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸæ–¹æ³• <code>shouldComponentUpdate</code>ï¼Œåƒè¿™æ ·:<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tags</span> <span class="title">extends</span> <span class="title">React</span>.<span class="title">Component</span> &#123;</span></span><br><span class="line">  shouldComponentUpdate() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure></p><p>è¿™é‡Œæ°¸è¿œéƒ½è¿”å› false ï¼Œæƒ³è®©ç»„ä»¶çŸ¥é“æ°¸è¿œä¸è¿›è¡Œé‡æ–°æ¸²æŸ“ã€‚å®šä¹‰ <code>shouldComponentUpdate</code> å¯¹äº React ç»„ä»¶æ¥è¯´ï¼Œæ˜¯è®©å…¶çŸ¥é“æ˜¯å¦è§¦å‘ <code>render</code> æ–¹æ³•ã€‚è¿™é€‚ç”¨äºçš„åœºæ™¯ï¼Œå› ä¸ºæƒ³ä½¿ç”¨ React æ¥æ·»åŠ  <code>HTML</code> æ ‡è®°ï¼Œæ·»åŠ å®Œåå°±ä¸æƒ³å†ä¾é  React ã€‚</p><h2 id="åˆå§‹åŒ–æ’ä»¶"><a href="#åˆå§‹åŒ–æ’ä»¶" class="headerlink" title="åˆå§‹åŒ–æ’ä»¶"></a>åˆå§‹åŒ–æ’ä»¶</h2><p>React æä¾›äº† <a href="https://facebook.github.io/react/docs/refs-and-the-dom.html" target="_blank" rel="noopener">API</a> æ¥è®¿é—®å®é™… DOM èŠ‚ç‚¹ã€‚éœ€è¦åœ¨ç›¸åº”çš„èŠ‚ç‚¹ä¸Šä½¿ç”¨ ref å±æ€§ï¼Œç¨åå¯ä»¥é€šè¿‡ this.refs æ¥è®¿é—® DOM ã€‚componentDidMount æ˜¯æœ€é€‚åˆåˆå§‹åŒ– tag-it æ’ä»¶çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ã€‚è¿™æ˜¯å› ä¸ºå½“ React å°† render æ–¹æ³•è¿”å›çš„ç»“æœæŒ‚è½½åˆ° DOM æ—¶æ‰è°ƒç”¨æ­¤æ–¹æ³•ã€‚</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tags</span> <span class="title">extends</span> <span class="title">React</span>.<span class="title">Component</span> &#123;</span></span><br><span class="line">  ...</span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">this</span>.<span class="built_in">list</span> = $(<span class="keyword">this</span>.refs.<span class="built_in">list</span>);</span><br><span class="line">    <span class="keyword">this</span>.<span class="built_in">list</span>.tagit();</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;ul ref='list'&gt;</span><br><span class="line">      &#123; </span><br><span class="line">        <span class="keyword">this</span>.props.tags.<span class="built_in">map</span>(</span><br><span class="line">          (tag, i) =&gt; &lt;li key=&#123; i &#125;&gt;&#123; tag &#125; &lt;/li&gt;</span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç å’Œ <code>shouldComponentUpdate</code> ä¸€èµ·ä½¿ç”¨å°±ä¼šä½¿ React æ¸²æŸ“å‡ºæœ‰ä¸¤é¡¹çš„ <code>&lt;ul&gt;</code>ï¼Œç„¶å <code>tag-it</code> ä¼šå…¶è½¬æ¢æˆæ ‡ç­¾å¯ç¼–è¾‘çš„æ’ä»¶ã€‚</p><h2 id="ä½¿ç”¨-React-æ§åˆ¶æ’ä»¶"><a href="#ä½¿ç”¨-React-æ§åˆ¶æ’ä»¶" class="headerlink" title="ä½¿ç”¨ React æ§åˆ¶æ’ä»¶"></a>ä½¿ç”¨ React æ§åˆ¶æ’ä»¶</h2><p>å‡å¦‚è¯´æˆ‘ä»¬æƒ³è¦é€šè¿‡ä»£ç æ¥ä¸ºå·²ç»è¿è¡Œçš„ <code>tag-it</code> æ’ä»¶æ·»åŠ æ–°æ ‡ç­¾ã€‚è¿™ç§æ“ä½œå°†ç”± React ç»„ä»¶è§¦å‘ï¼Œå¹¶éœ€è¦ä½¿ç”¨ jQuery API ã€‚æˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ç§æ–¹å¼å°†æ•°æ®ä¼ é€’ç»™ <code>Tags</code> ç»„ä»¶ï¼Œä½†åŒæ—¶è¿˜è¦ä¿æŒå•é€šé“æ¸²æŸ“ã€‚</p><p>ä¸ºäº†è¯´æ˜æ•´ä¸ªè¿‡ç¨‹ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ App ç±»ä¸­æ·»åŠ ä¸€ä¸ªè¾“å…¥æ¡†å’ŒæŒ‰é’®ï¼Œç‚¹å‡»æŒ‰é’®æ—¶å°†è¾“å…¥æ¡†çš„å€¼ä¼ ç»™ <code>Tags</code> ç»„ä»¶ã€‚</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="title">extends</span> <span class="title">React</span>.<span class="title">Component</span> &#123;</span></span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    super(props);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>._addNewTag = <span class="keyword">this</span>._addNewTag.bind(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      tags: ['JavaScript', 'CSS' ],</span><br><span class="line">      newTag: null</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  _addNewTag() &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; newTag: <span class="keyword">this</span>.refs.field.value &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;p&gt;Add <span class="keyword">new</span> tag:&lt;/p&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          &lt;input type='text' ref='field' /&gt;</span><br><span class="line">          &lt;button onClick=&#123; <span class="keyword">this</span>._addNewTag &#125;&gt;Add&lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;Tags</span><br><span class="line">          tags=&#123; <span class="keyword">this</span>.state.tags &#125;</span><br><span class="line">          newTag=&#123; <span class="keyword">this</span>.state.newTag &#125; /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä½¿ç”¨å†…éƒ¨çŠ¶æ€æ¥å­˜å‚¨æ–°æ·»åŠ çš„æ ‡ç­¾åç§°ã€‚æ¯æ¬¡ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œæˆ‘å°±æ›´æ–°çŠ¶æ€å¹¶è§¦å‘ <code>Tags</code> ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ã€‚ä½†ç”±äº <code>shouldComponentUpdate</code>çš„å­˜åœ¨ï¼Œé¡µé¢ä¸Šä¸ä¼šæœ‰ä»»ä½•çš„æ›´æ–°ã€‚å”¯ä¸€çš„å˜åŒ–å°±æ˜¯å¾—åˆ° <code>newTag</code>å±æ€§çš„æ–°å€¼ï¼Œå¦ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸæ–¹æ³• <code>componentWillReceiveProps</code> ä¼šæ•è·åˆ°å±æ€§çš„æ–°å€¼:</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tags</span> <span class="title">extends</span> <span class="title">React</span>.<span class="title">Component</span> &#123;</span></span><br><span class="line">  ...</span><br><span class="line">  componentWillReceiveProps(newProps) &#123;</span><br><span class="line">    this.list.tagit('createTag', newProps.newTag);</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure><p><code>.tagit(&#39;createTag&#39;, newProps.newTag)</code>æ˜¯çº¯ç²¹çš„ jQuery ä»£ç ã€‚å¦‚æœæƒ³è°ƒç”¨ç¬¬ä¸‰æ–¹åº“çš„æ–¹æ³•ï¼Œ<code>componentWillReceiveProps</code>æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</p><p>ä¸‹é¢æ˜¯ Tags ç»„ä»¶çš„å®Œæ•´ä»£ç :</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tags</span> <span class="title">extends</span> <span class="title">React</span>.<span class="title">Component</span> &#123;</span></span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">this</span>.<span class="built_in">list</span> = $(<span class="keyword">this</span>.refs.<span class="built_in">list</span>);</span><br><span class="line">    <span class="keyword">this</span>.<span class="built_in">list</span>.tagit();</span><br><span class="line">  &#125;</span><br><span class="line">  shouldComponentUpdate() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  componentWillReceiveProps(newProps) &#123;</span><br><span class="line">    this.list.tagit('createTag', newProps.newTag);</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;ul ref='list'&gt;</span><br><span class="line">      &#123; </span><br><span class="line">        <span class="keyword">this</span>.props.tags.<span class="built_in">map</span>(</span><br><span class="line">          (tag, i) =&gt; &lt;li key=&#123; i &#125;&gt;&#123; tag &#125; &lt;/li&gt;</span><br><span class="line">        ) </span><br><span class="line">      &#125;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h1><p>å°½ç®¡ React æ‰¿æ‹…äº†æ“çºµ DOM æ ‘çš„å·¥ä½œï¼Œä½†ä»å¯ä»¥é›†æˆç¬¬ä¸‰æ–¹çš„åº“å’ŒæœåŠ¡ã€‚ç”Ÿå‘½å‘¨æœŸæ–¹æ³•è®©åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­å¯ä»¥è¿›è¡Œè¶³å¤Ÿçš„æ§åˆ¶ï¼Œè¿™æ ·æ‰èƒ½å¤Ÿå®Œç¾åœ°è¿æ¥ React å’Œé React ä¸–ç•Œã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>React å·²ç„¶æˆä¸ºæœ€æµè¡Œçš„ UI æ„å»ºåº“ã€‚å®ƒè‡ªå¸¦çš„ API å¾ˆæ£’ï¼Œç®€å•è€Œå¼ºå¤§ã€‚éº»çƒ¦çš„éƒ¨åˆ†æ˜¯æ„å»ºå¤æ‚åº”ç”¨çš„è¯ï¼Œ React æœ¬èº«å¾€å¾€å¹¶ä¸è¶³å¤Ÿã€‚æœ‰äº›æ¦‚å¿µå¿…é¡»è¦çŸ¥é“ï¼Œæ‰èƒ½åšå‡ºæ­£ç¡®çš„é€‰æ‹©ã€‚ç”±ç¤¾åŒºæ‰€æå‡ºçš„è¿™äº›è®¾è®¡æ¨¡å¼åœ¨å¤§è§„æ¨¡åº”ç”¨ä¸­è¿è¡Œè‰¯å¥½ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;React æˆ–è®¸æ˜¯æ„å»º UI çš„æœ€ä½³é€‰æ‹©ä¹‹ä¸€ã€‚è‰¯å¥½çš„è®¾è®¡ä¸å¼ºå¤§çš„æ”¯æŒï¼Œè¿˜æœ‰åºå¤§çš„ç¤¾åŒºã€‚ä½†æ˜¯ï¼Œæœ‰äº›æƒ…å†µä¸‹ï¼Œæƒ³è¦ä½¿ç”¨å¤–éƒ¨æœåŠ¡æˆ–æƒ³è¦é›†æˆä¸€äº›å®Œå…¨ä¸åŒçš„ä¸œè¥¿ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼ŒReact åœ¨åº•å±‚ä¸å®é™… DOM æœ‰å¤§é‡çš„äº¤äº’å¹¶æ§åˆ¶é¡µé¢ä¸Šæ¸²æŸ“ä»€ä¹ˆï¼ŒåŸºæœ¬ä¸Šå®ƒæ˜¯å¼€å‘è€…ä¸å®é™… DOM é—´çš„æ¡¥æ¢ã€‚è¿™ä¹Ÿæ­£æ˜¯ä¸ºä»€ä¹ˆ React é›†æˆç¬¬ä¸‰æ–¹ç»„ä»¶æœ‰äº›éº»çƒ¦çš„åœ°æ–¹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/react_d.png&quot; alt=&quot;React&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="React" scheme="https://duanruilong.github.io/categories/React/"/>
    
    
      <category term="Javascript" scheme="https://duanruilong.github.io/tags/Javascript/"/>
    
      <category term="React" scheme="https://duanruilong.github.io/tags/React/"/>
    
  </entry>
  
  <entry>
    <title>Reactå¼€å‘å¸¸ç”¨è®¾è®¡æ¨¡å¼-ç»„ä»¶æ ·å¼</title>
    <link href="https://duanruilong.github.io/2018/06/14/React%E5%BC%80%E5%8F%91%E5%B8%B8%E7%94%A8%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E7%BB%84%E4%BB%B6%E6%A0%B7%E5%BC%8F/"/>
    <id>https://duanruilong.github.io/2018/06/14/Reactå¼€å‘å¸¸ç”¨è®¾è®¡æ¨¡å¼-ç»„ä»¶æ ·å¼/</id>
    <published>2018-06-13T16:10:32.000Z</published>
    <updated>2018-09-17T15:58:32.000Z</updated>
    
    <content type="html"><![CDATA[<p>React æ˜¯è§†å›¾å±‚ã€‚å› æ­¤ï¼Œå®ƒå¯ä»¥æ§åˆ¶åœ¨æµè§ˆå™¨ä¸­æ¸²æŸ“çš„æ ‡è®°ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œé¡µé¢ä¸Šçš„ HTML æ ‡è®°ä¸ CSS çš„æ ·å¼æ˜¯ç´§å¯†è”ç³»åœ¨ä¸€èµ·çš„ã€‚æœ‰å‡ ç§æ–¹å¼æ¥å¤„ç† React åº”ç”¨çš„æ ·å¼ï¼Œæ¥ä¸‹æ¥ä»‹ç»è¿™äº›æœ€æµè¡Œçš„æ–¹å¼ã€‚</p><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/react_d.png" alt="React"></p><a id="more"></a><h1 id="ç»„ä»¶æ ·å¼"><a href="#ç»„ä»¶æ ·å¼" class="headerlink" title="ç»„ä»¶æ ·å¼"></a>ç»„ä»¶æ ·å¼</h1><h2 id="ç»å…¸-CSS-ç±»"><a href="#ç»å…¸-CSS-ç±»" class="headerlink" title="ç»å…¸ CSS ç±»"></a>ç»å…¸ CSS ç±»</h2><p>JSX è¯­æ³•ç›¸å½“æ¥è¿‘äº HTML è¯­æ³•ã€‚å› æ­¤ï¼Œæ‹¥æœ‰ä¸ HTML å‡ ä¹ç›¸åŒçš„æ ‡ç­¾å±æ€§ï¼Œä»ç„¶å¯ä»¥ä½¿ç”¨ CSS ç±»æ¥å¤„ç†æ ·å¼ã€‚ç±»æ˜¯å®šä¹‰åœ¨å¤–éƒ¨çš„ <code>.css</code>æ–‡ä»¶ä¸­çš„ã€‚å”¯ä¸€éœ€è¦æ³¨æ„çš„æ˜¯ React ä¸­ä½¿ç”¨çš„æ˜¯ <code>className</code>ï¼Œè€Œä¸æ˜¯ <code>class</code> ã€‚ä¾‹å¦‚:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1 className='title'&gt;Styling&lt;/h1&gt;</span><br></pre></td></tr></table></figure><h2 id="å†…è”æ ·å¼"><a href="#å†…è”æ ·å¼" class="headerlink" title="å†…è”æ ·å¼"></a>å†…è”æ ·å¼</h2><p>å†…è”æ ·å¼ä¹Ÿèƒ½å¾ˆå¥½çš„å·¥ä½œã€‚ç±»ä¼¼äº HTML ï¼Œå¯ä»¥é€šè¿‡ style å±æ€§æ¥ç›´æ¥ä¼ å…¥æ ·å¼ã€‚ä½†æ˜¯ï¼Œstyle å±æ€§åœ¨ HTML ä¸­æ˜¯å­—ç¬¦ä¸²ï¼Œè€Œåœ¨ JSX ä¸­å¿…é¡»å¾—æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> inlineStyles = &#123;</span><br><span class="line">  color: 'red',</span><br><span class="line">  fontSize: '10px',</span><br><span class="line">  marginTop: '2em',</span><br><span class="line">  'border-top': 'solid 1px #000'</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&lt;h2 style=&#123; inlineStyles &#125;&gt;Inline styling&lt;/h2&gt;</span><br></pre></td></tr></table></figure><p>å› ä¸ºç”¨ JavaScript ç¼–å†™æ ·å¼ï¼Œæ‰€ä»¥ä»è¯­æ³•è§’åº¦æ¥çœ‹ï¼Œæ˜¯æœ‰ä¸€äº›é™åˆ¶çš„ã€‚å¦‚æœæƒ³è¦ä½¿ç”¨åŸå§‹çš„ CSS å±æ€§åç§°ï¼Œé‚£ä¹ˆéœ€è¦ç”¨å¼•å·åŒ…è£¹èµ·æ¥ï¼Œå¦åˆ™éœ€è¦éµå¾ªé©¼å³°å¼å‘½åè§„åˆ™ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨ JavaScript ç¼–å†™æ ·å¼å´éå¸¸æœ‰è¶£ï¼Œå®ƒæ¯”æ™®é€šçš„ CSS æ›´å…·çµæ´»æ€§ã€‚ä¾‹å¦‚æ ·å¼çš„ç»§æ‰¿:</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> theme = &#123;</span><br><span class="line">  fontFamily: 'Georgia',</span><br><span class="line">  color: 'blue'</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> paragraphText = &#123;</span><br><span class="line">  ...theme,</span><br><span class="line">  fontSize: '20px'</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><code>theme</code>ä¸­æœ‰ä¸€äº›åŸºç¡€æ ·å¼ï¼Œç„¶ååœ¨ <code>paragraphText</code> ä¸­æ··å…¥ <code>theme</code> çš„æ ·å¼ã€‚ç®€è€Œè¨€ä¹‹ï¼Œèƒ½å¤Ÿä½¿ç”¨ JavaScript çš„å…¨éƒ¨èƒ½åŠ›æ¥ç»„ç»‡ CSS ã€‚é‡è¦çš„æ˜¯æœ€ç»ˆç”Ÿæˆäº†ä¸€ä¸ªä¼ ç»™ style å±æ€§çš„å¯¹è±¡ã€‚</p><h2 id="CSS-æ¨¡å—"><a href="#CSS-æ¨¡å—" class="headerlink" title="CSS æ¨¡å—"></a>CSS æ¨¡å—</h2><p><a href="https://github.com/css-modules/css-modules/blob/master/docs/get-started.md" target="_blank" rel="noopener">CSS æ¨¡å—</a> æ˜¯å»ºç«‹åœ¨åˆ°ç›®å‰ä¸ºæ­¢æ‰€ä»‹ç»è¿‡çš„å†…å®¹ä¹‹ä¸Šçš„ã€‚å¦‚æœä½ ä¸å–œæ¬¢ JavaScript ç”¨æ³•æ¥å†™ CSS ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ CSS æ¨¡å—ï¼Œå®ƒå¯ä»¥è®©ç»§ç»­ç¼–å†™æ™®é€šçš„ CSS ã€‚é€šå¸¸ï¼Œè¿™ä¸ªåº“æ˜¯åœ¨æ‰“åŒ…é˜¶æ®µå‘æŒ¥ä½œç”¨çš„ã€‚å¯ä»¥å°†å®ƒä½œä¸ºç¼–è¯‘æ­¥éª¤çš„ä¸€éƒ¨åˆ†è¿›è¡Œè¿æ¥ï¼Œä½†é€šå¸¸ä½œä¸ºæ„å»ºç³»ç»Ÿæ’ä»¶åˆ†å‘ã€‚</p><p>ä¸‹é¢çš„ç¤ºä¾‹å¯ä»¥è®©ä½ å¿«é€Ÿå¯¹å…¶è¿è¡ŒåŸç†æœ‰ä¸ªå¤§è‡´çš„äº†è§£:<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* style.css */</span></span><br><span class="line">.title &#123;</span><br><span class="line">  color: green;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// App.jsx</span></span><br><span class="line"><span class="keyword">import</span> styles from <span class="string">"./style.css"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function">function <span class="title">App</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &lt;h1 style=&#123; styles.title &#125;&gt;Hello world&lt;/h1&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>é»˜è®¤æƒ…å†µä¸‹æ˜¯æ— æ³•è¿™æ ·ä½¿ç”¨çš„ï¼Œåªæœ‰ä½¿ç”¨äº† CSS æ¨¡å—ï¼Œæ‰èƒ½ç›´æ¥å¯¼å…¥æ™®é€šçš„ CSS æ–‡ä»¶å¹¶ä½¿ç”¨å…¶ä¸­çš„ç±»ã€‚</p><p>å½“æåˆ° æ™®é€šçš„ CSS ï¼Œå¹¶éçœŸçš„æŒ‡æœ€åŸå§‹çš„ CSS ã€‚å®ƒæ”¯æŒä¸€äº›éå¸¸æœ‰ç”¨çš„ç»„åˆæŠ€å·§ã€‚ä¾‹å¦‚:<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">.title &#123;</span><br><span class="line">  composes: mainColor from <span class="string">"./brand-colors.css"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="Styled-components"><a href="#Styled-components" class="headerlink" title="Styled-components"></a>Styled-components</h2><p><a href="https://www.styled-components.com/" target="_blank" rel="noopener">Styled-components</a> åˆ™æ˜¯å¦ä¸€ç§å®Œå…¨ä¸åŒçš„æ–¹å‘ã€‚æ­¤åº“ä¸å†ä¸º React ç»„ä»¶æä¾›å†…è”æ ·å¼ã€‚éœ€è¦ä½¿ç”¨ç»„ä»¶æ¥è¡¨ç¤ºå®ƒçš„å¤–è§‚æ„Ÿå—ã€‚ä¾‹å¦‚ï¼Œåˆ›å»ºäº† <code>Link</code>ç»„ä»¶ï¼Œå®ƒå…·æœ‰ç‰¹å®šçš„é£æ ¼å’Œç”¨æ³•ï¼Œè€Œå†ä½¿ç”¨ <code>&lt;a&gt;</code>æ ‡ç­¾ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Link = styled.a`</span><br><span class="line">  text-decoration: none;</span><br><span class="line">  padding: <span class="number">4</span>px;</span><br><span class="line">  border: solid <span class="number">1</span>px #<span class="number">999</span>;</span><br><span class="line">  color: black;</span><br><span class="line">`;</span><br><span class="line"></span><br><span class="line">&lt;Link href='http://google.com'&gt;Google&lt;/Link&gt;</span><br></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸€ç§æ‰©å±•ç±»çš„æœºåˆ¶ã€‚è¿˜å¯ä»¥ä½¿ç”¨ Link ç»„ä»¶ï¼Œä½†æ˜¯ä¼šæ”¹å˜å®ƒçš„æ–‡å­—é¢œè‰²ï¼Œåƒè¿™æ ·:<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> AnotherLink = styled(Link)`</span><br><span class="line">  color: blue;</span><br><span class="line">`;</span><br><span class="line"></span><br><span class="line">&lt;AnotherLink href='http://facebook.com'&gt;Facebook&lt;/AnotherLink&gt;</span><br></pre></td></tr></table></figure></p><p>åˆ°ç›®å‰ä¸ºæ­¢ <code>styled-components</code> å¯èƒ½æ˜¯å¤šç§å¤„ç† React æ ·å¼çš„æ–¹æ³•ä¸­æˆ‘æœ€æ„Ÿå…´è¶£çš„ã€‚ç”¨å®ƒæ¥åˆ›å»ºç»„ä»¶éå¸¸ç®€å•ï¼Œå¹¶å¯ä»¥å¿˜è®°æ ·å¼æœ¬èº«çš„å­˜åœ¨ã€‚å¦‚æœä½ çš„å…¬å¸æœ‰èƒ½åŠ›åˆ›å»ºä¸€ä¸ªè®¾è®¡ç³»ç»Ÿå¹¶ç”¨å®ƒæ„å»ºäº§å“çš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ªé€‰é¡¹å¯èƒ½æ˜¯æœ€åˆé€‚çš„ã€‚</p><h1 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h1><p>å¤„ç† React åº”ç”¨çš„æ ·å¼æœ‰å¤šç§æ–¹å¼ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¯•éªŒè¿‡æ‰€æœ‰æ–¹å¼ï¼Œå¯ä»¥è¯´æ— æ‰€è°“å¯¹ä¸é”™ã€‚æ­£å¦‚ JavaScript ä¸­å¤§å¤šæ•°æŠ€æœ¯ä¸€æ ·ï¼Œä½ éœ€è¦æŒ‘é€‰ä¸€ä¸ªæ›´é€‚åˆä½ çš„æ–¹å¼ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;React æ˜¯è§†å›¾å±‚ã€‚å› æ­¤ï¼Œå®ƒå¯ä»¥æ§åˆ¶åœ¨æµè§ˆå™¨ä¸­æ¸²æŸ“çš„æ ‡è®°ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œé¡µé¢ä¸Šçš„ HTML æ ‡è®°ä¸ CSS çš„æ ·å¼æ˜¯ç´§å¯†è”ç³»åœ¨ä¸€èµ·çš„ã€‚æœ‰å‡ ç§æ–¹å¼æ¥å¤„ç† React åº”ç”¨çš„æ ·å¼ï¼Œæ¥ä¸‹æ¥ä»‹ç»è¿™äº›æœ€æµè¡Œçš„æ–¹å¼ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/react_d.png&quot; alt=&quot;React&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="React" scheme="https://duanruilong.github.io/categories/React/"/>
    
    
      <category term="Javascript" scheme="https://duanruilong.github.io/tags/Javascript/"/>
    
      <category term="React" scheme="https://duanruilong.github.io/tags/React/"/>
    
  </entry>
  
  <entry>
    <title>Reactå¼€å‘å¸¸ç”¨è®¾è®¡æ¨¡å¼-ä¾èµ–æ³¨å…¥</title>
    <link href="https://duanruilong.github.io/2018/06/13/React%E5%BC%80%E5%8F%91%E5%B8%B8%E7%94%A8%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/"/>
    <id>https://duanruilong.github.io/2018/06/13/Reactå¼€å‘å¸¸ç”¨è®¾è®¡æ¨¡å¼-ä¾èµ–æ³¨å…¥/</id>
    <published>2018-06-12T16:13:53.000Z</published>
    <updated>2018-09-17T15:58:32.000Z</updated>
    
    <content type="html"><![CDATA[<p>å†™çš„å¥½å¤šæ¨¡å—å’Œç»„ä»¶éƒ½æœ‰ä¾èµ–ã€‚èƒ½å¦ç®¡ç†è¿™äº›ä¾èµ–å¯¹äºé¡¹ç›®çš„æˆåŠŸè‡³å…³é‡è¦ã€‚æœ‰ä¸€ç§å«åš <a href="http://krasimirtsonev.com/blog/article/Dependency-injection-in-JavaScript" target="_blank" rel="noopener">ä¾èµ–æ³¨å…¥</a> çš„æŠ€æœ¯ (å¤§å¤šæ•°äººè®¤ä¸ºå®ƒæ˜¯ä¸€ç§æ¨¡å¼) ç”¨æ¥è§£å†³è¿™ç§é—®é¢˜ã€‚</p><p>åœ¨ React ä¸­ï¼Œå¯¹ä¾èµ–æ³¨å…¥çš„éœ€è¦æ˜¯æ˜¾è€Œæ˜“è§çš„ã€‚</p><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/react_d.png" alt="React"></p><a id="more"></a><h1 id="ä¾èµ–æ³¨å…¥"><a href="#ä¾èµ–æ³¨å…¥" class="headerlink" title="ä¾èµ–æ³¨å…¥"></a>ä¾èµ–æ³¨å…¥</h1><p>æ¥è€ƒè™‘ä¸‹é¢çš„åº”ç”¨çš„ç»„ä»¶æ ‘:<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Title.jsx</span></span><br><span class="line"><span class="function"><span class="keyword">export</span> <span class="keyword">default</span> function <span class="title">Title</span><span class="params">(props)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &lt;h1&gt;&#123; props.title &#125;&lt;/h1&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Header.jsx</span></span><br><span class="line">import Title from './Title.jsx';</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">export</span> <span class="keyword">default</span> function <span class="title">Header</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;header&gt;</span><br><span class="line">      &lt;Title /&gt;</span><br><span class="line">    &lt;/header&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// App.jsx</span></span><br><span class="line">import Header from './Header.jsx';</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="title">extends</span> <span class="title">React</span>.<span class="title">Component</span> &#123;</span></span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    super(props);</span><br><span class="line">    this.state = &#123; title: 'React in patterns' &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> &lt;Header /&gt;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><p>å­—ç¬¦ä¸² â€œReact in patternsâ€ åº”è¯¥ä»¥æŸç§æ–¹å¼åˆ°è¾¾ <code>Title</code> ç»„ä»¶ã€‚æœ€ç›´æ¥çš„æ–¹å¼å°±ä» <code>App</code> ä¼ åˆ° <code>Header</code>ï¼Œå†ä» <code>Header</code> ä¼ åˆ° Title ã€‚ä½†æ˜¯ï¼Œå¯¹äºä¸‰å±‚ç»„ä»¶è¿˜å¥½ï¼Œä½†æ˜¯å¦‚æœåµŒå¥—çš„å±‚çº§å¾ˆæ·±ï¼Œå¹¶ä¸”éœ€è¦ä¼ å¤šä¸ªå±æ€§å‘¢ï¼Ÿå¤§å¤šæ•°ç»„ä»¶éƒ½æ‰®æ¼”ç€ä»£ç†çš„è§’è‰²ï¼Œå°†å±æ€§è½¬å‘ç»™å­ç»„ä»¶ã€‚</p><p>å·²ç»äº†è§£è¿‡ <a href="http://sangka-z.com/react-in-patterns-cn/chapter-4/#%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6" target="_blank" rel="noopener">é«˜é˜¶ç»„ä»¶</a> ï¼Œå®ƒå¯ä»¥ç”¨æ¥æ³¨å…¥æ•°æ®ã€‚æ¥ä½¿ç”¨åŒæ ·çš„æŠ€æœ¯æ¥æ³¨å…¥ title å˜é‡:</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// inject.jsx</span></span><br><span class="line">const title = 'React in patterns';</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">export</span> <span class="keyword">default</span> function <span class="title">inject</span><span class="params">(Component)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> class Injector extends React.Component &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        &lt;Component</span><br><span class="line">          &#123;...<span class="keyword">this</span>.props&#125;</span><br><span class="line">          title=&#123; title &#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// -----------------------------------</span></span><br><span class="line"><span class="comment">// Header.jsx</span></span><br><span class="line">import inject from './inject.jsx';</span><br><span class="line">import Title from './Title.jsx';</span><br><span class="line"></span><br><span class="line">var EnhancedTitle = inject(Title);</span><br><span class="line"><span class="function"><span class="keyword">export</span> <span class="keyword">default</span> function <span class="title">Header</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;header&gt;</span><br><span class="line">      &lt;EnhancedTitle /&gt;</span><br><span class="line">    &lt;/header&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>title</code>éšè—åœ¨äº†ä¸­é—´å±‚ (é«˜é˜¶ç»„ä»¶) ï¼Œåœ¨ä¸­é—´å±‚å°†<code>title</code>å±æ€§ä¼ ç»™äº†åŸå§‹çš„ Title ç»„ä»¶ã€‚ä¸€åˆ‡éƒ½å¾ˆä¸é”™ï¼Œä½†å®ƒåªè§£å†³äº†ä¸€åŠé—®é¢˜ã€‚ç°åœ¨ä¸å†éœ€è¦åœ¨ç»„ä»¶æ ‘ä¸­å°† title å‘ä¸‹å±‚å±‚ä¼ é€’ï¼Œä½†æ˜¯éœ€è¦è€ƒè™‘æ•°æ®å¦‚ä½•åˆ°è¾¾ inject.jsx è¾…åŠ©å‡½æ•°ã€‚</p><h2 id="ä½¿ç”¨-React-context-16-3-ä¹‹å‰çš„ç‰ˆæœ¬"><a href="#ä½¿ç”¨-React-context-16-3-ä¹‹å‰çš„ç‰ˆæœ¬" class="headerlink" title="ä½¿ç”¨ React context (16.3 ä¹‹å‰çš„ç‰ˆæœ¬)"></a>ä½¿ç”¨ React context (16.3 ä¹‹å‰çš„ç‰ˆæœ¬)</h2><blockquote><p>åœ¨ React 16.3 ç‰ˆæœ¬ä¸­ï¼ŒReact å›¢é˜Ÿå¼•å…¥äº†æ–°ç‰ˆçš„ context API ï¼Œå¦‚æœä½ æƒ³ä½¿ç”¨æ–°ç‰ˆ API ï¼Œé‚£ä¹ˆå¯ä»¥è·³è¿‡æ­¤å¤„ã€‚</p></blockquote><p>React æœ‰ <code>context</code> çš„æ¦‚å¿µã€‚æ¯ä¸ª React ç»„ä»¶éƒ½å¯ä»¥è®¿é—® <code>context</code>ã€‚å®ƒæœ‰äº›ç±»ä¼¼äº <a href="https://github.com/krasimir/EventBus" target="_blank" rel="noopener">äº‹ä»¶æ€»çº¿</a> ï¼Œä½†æ˜¯ä¸ºæ•°æ®è€Œç”Ÿã€‚å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆåœ¨ä»»æ„åœ°æ–¹éƒ½å¯ä»¥è®¿é—®çš„å•ä¸€ <code>store</code> ã€‚<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰ context çš„åœ°æ–¹</span></span><br><span class="line">var context = &#123; title: 'React in patterns' &#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="title">extends</span> <span class="title">React</span>.<span class="title">Component</span> &#123;</span></span><br><span class="line">  getChildContext() &#123;</span><br><span class="line">    <span class="keyword">return</span> context;</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;;</span><br><span class="line">App.childContextTypes = &#123;</span><br><span class="line">  title: React.PropTypes.<span class="built_in">string</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ context çš„åœ°æ–¹</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Inject</span> <span class="title">extends</span> <span class="title">React</span>.<span class="title">Component</span> &#123;</span></span><br><span class="line">  render() &#123;</span><br><span class="line">    var title = <span class="keyword">this</span>.context.title;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">Inject.contextTypes = &#123;</span><br><span class="line">  title: React.PropTypes.<span class="built_in">string</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><p>æ³¨æ„ï¼Œéœ€è¦ä½¿ç”¨<code>childContextTypes</code>å’Œ <code>contextTypes</code> æ¥æŒ‡å®š <code>context</code>å¯¹è±¡çš„å…·ä½“ç­¾åã€‚å¦‚æœä¸æŒ‡å®šçš„è¯ï¼Œé‚£ä¹ˆ <code>context</code> å¯¹è±¡å°†ä¸ºç©ºã€‚è¿™ç‚¹å¯èƒ½æœ‰ç‚¹ä»¤äººæ²®ä¸§ï¼Œå› ä¸ºå¯èƒ½ä¼šå¤šå†™å¾ˆå¤šä»£ç ã€‚æ‰€ä»¥å°† <code>context</code>å†™æˆå…è®¸å‚¨å­˜å’Œè·å–æ•°æ®çš„æœåŠ¡ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæ™®é€šå¯¹è±¡æ˜¯ä¸€ç§æœ€ä½³å®è·µã€‚ä¾‹å¦‚:</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// dependencies.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  data: &#123;&#125;,</span><br><span class="line">  get(key) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.data[key];</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">register</span>(key, value) &#123;</span><br><span class="line">    <span class="keyword">this</span>.data[key] = value;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œå›åˆ°ç¤ºä¾‹ä¸­ï¼ŒApp ç»„ä»¶åº”è¯¥æ˜¯è¿™æ ·çš„:<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import dependencies from './dependencies';</span><br><span class="line"></span><br><span class="line">dependencies.register('title', 'React in patterns');</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="title">extends</span> <span class="title">React</span>.<span class="title">Component</span> &#123;</span></span><br><span class="line">  getChildContext() &#123;</span><br><span class="line">    <span class="keyword">return</span> dependencies;</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> &lt;Header /&gt;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">App.childContextTypes = &#123;</span><br><span class="line">  data: React.PropTypes.object,</span><br><span class="line">  get: React.PropTypes.func,</span><br><span class="line">  <span class="keyword">register</span>: React.PropTypes.func</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><p>Title ç»„ä»¶é€šè¿‡ context æ¥è·å–æ•°æ®:<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// Title.jsx</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Title</span> <span class="title">extends</span> <span class="title">React</span>.<span class="title">Component</span> &#123;</span></span><br><span class="line">  render() &#123;</span><br><span class="line">    return &lt;h1&gt;&#123; this.context.get('title') &#125;&lt;/h1&gt;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">Title.contextTypes = &#123;</span><br><span class="line">  data: React.PropTypes.object,</span><br><span class="line">  get: React.PropTypes.func,</span><br><span class="line">  <span class="keyword">register</span>: React.PropTypes.func</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><p>ç†æƒ³æƒ…å†µä¸‹ï¼Œä¸æƒ³æ¯æ¬¡éœ€è¦è®¿é—® <code>context</code>æ—¶éƒ½æŒ‡å®š<code>contextTypes</code>ã€‚å¯ä»¥ä½¿ç”¨é«˜é˜¶ç»„ä»¶æ¥åŒ…è£…ç±»å‹ç»†èŠ‚ã€‚ä½†æ›´å¥½çš„åšæ³•æ˜¯ï¼Œå¯ä»¥ç¼–å†™ä¸€ä¸ªæ›´å…·æè¿°æ€§çš„å·¥å…·å‡½æ•°ï¼Œä»è€Œå¸®åŠ©å£°æ˜ç¡®åˆ‡çš„ç±»å‹ã€‚ä¾‹å¦‚ï¼Œä¸å†ç›´æ¥ä½¿ç”¨<code>this.context.get(&#39;title&#39;)</code> æ¥è®¿é—® context ï¼Œè€Œæ˜¯å‘Šè¯‰é«˜é˜¶ç»„ä»¶éœ€è¦ä¼ é€’ç»™ç»„ä»¶çš„å±æ€§ã€‚ä¾‹å¦‚:<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// Title.jsx</span></span><br><span class="line">import wire from './wire';</span><br><span class="line"></span><br><span class="line"><span class="function">function <span class="title">Title</span><span class="params">(props)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &lt;h1&gt;&#123; props.title &#125;&lt;/h1&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default wire(Title, ['title'], function resolve(title) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; title &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><p><code>wire</code>å‡½æ•°æ¥æ”¶ React ç»„ä»¶ã€æ‰€éœ€ä¾èµ– (ä¾èµ–éƒ½å·²ç»æ³¨å†Œè¿‡äº†) çš„æ•°ç»„å’Œæˆ‘å–œæ¬¢ç§°ä¹‹ä¸º <code>mapper</code>çš„è½¬æ¢å‡½æ•°ã€‚mapper å‡½æ•°æ¥æ”¶å­˜å‚¨åœ¨ context ä¸­çš„åŸå§‹æ•°æ®ï¼Œå¹¶è¿”å›ç»„ä»¶ ( Title ) ç¨åä½¿ç”¨çš„å±æ€§ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œä¼ å…¥åªæ˜¯å­—ç¬¦ä¸²ï¼Œå³ title å˜é‡ã€‚ä½†æ˜¯ï¼Œåœ¨çœŸæ­£çš„åº”ç”¨ä¸­ï¼Œè¿™ä¸ªä¾èµ–é¡¹å¯ä»¥æ˜¯å¤§å‹çš„æ•°æ®é›†åˆï¼Œé…ç½®å¯¹è±¡æˆ–å…¶ä»–ä¸œè¥¿ã€‚</p><p><code>wire</code> å‡½æ•°çš„ä»£ç å¦‚ä¸‹æ‰€ç¤º:<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">export</span> <span class="keyword">default</span> function <span class="title">wire</span><span class="params">(Component, dependencies, mapper)</span> </span>&#123;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Inject</span> <span class="title">extends</span> <span class="title">React</span>.<span class="title">Component</span> &#123;</span></span><br><span class="line">    render() &#123;</span><br><span class="line">      var resolved = dependencies.<span class="built_in">map</span>(</span><br><span class="line">        <span class="keyword">this</span>.context.get.bind(<span class="keyword">this</span>.context)</span><br><span class="line">      );</span><br><span class="line">      var props = mapper(...resolved);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> React.createElement(Component, props);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  Inject.contextTypes = &#123;</span><br><span class="line">    data: React.PropTypes.object,</span><br><span class="line">    get: React.PropTypes.func,</span><br><span class="line">    <span class="keyword">register</span>: React.PropTypes.func</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> Inject;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><p><code>Inject</code> æ˜¯é«˜é˜¶ç»„ä»¶ï¼Œå®ƒå¯ä»¥è®¿é—® <code>context</code>å¹¶è·å– <code>dependencies</code>æ•°ç»„ä¸­çš„æ‰€æœ‰é¡¹ã€‚<code>mapper</code> å‡½æ•°æ¥æ”¶ context æ•°æ®å¹¶å°†å…¶è½¬æ¢æˆæˆ‘ä»¬ç»„å»ºæ‰€éœ€è¦çš„å±æ€§ã€‚</p><h2 id="ä½¿ç”¨-React-context-16-3-åŠä¹‹åçš„ç‰ˆæœ¬"><a href="#ä½¿ç”¨-React-context-16-3-åŠä¹‹åçš„ç‰ˆæœ¬" class="headerlink" title="ä½¿ç”¨ React context (16.3 åŠä¹‹åçš„ç‰ˆæœ¬)"></a>ä½¿ç”¨ React context (16.3 åŠä¹‹åçš„ç‰ˆæœ¬)</h2><p>Fackbook å¹¶ä¸æ¨èä½¿ç”¨ context API ã€‚åœ¨å®˜æ–¹æ–‡æ¡£ä¸­ä¹Ÿæœ‰æåˆ°ï¼Œæ­¤ API ä¸ç¨³å®šï¼Œéšæ—¶å¯èƒ½æ›´æ”¹ã€‚ç¡®å®ä¹Ÿè¨€ä¸­äº†ã€‚16.3 ç‰ˆæœ¬æä¾›äº†ä¸€ä¸ªæ–°çš„ context API ï¼Œæˆ‘è®¤ä¸ºæ–°ç‰ˆ API æ›´è‡ªç„¶ï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿæ›´ç®€å•ã€‚</p><p>è¿˜æ˜¯ä½¿ç”¨åŒä¸€ä¸ªç¤ºä¾‹ï¼Œè®©å­—ç¬¦ä¸²æŠµè¾¾<code>&lt;Title&gt;</code>ç»„ä»¶ã€‚</p><p>å…ˆæ¥å®šä¹‰åŒ…å« <code>context</code>åˆå§‹åŒ–çš„æ–‡ä»¶:<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// context.js</span></span><br><span class="line">import &#123; createContext &#125; from 'react';</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Context = createContext(&#123;&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Provider = Context.Provider;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Consumer = Context.Consumer;</span><br></pre></td></tr></table></figure></p><p><code>createContext</code>è¿”å›çš„å¯¹è±¡å…·æœ‰ <code>Provider å’Œ Consumer</code>å±æ€§ã€‚å®ƒä»¬å®é™…ä¸Šæ˜¯æœ‰æ•ˆçš„ React ç±»ã€‚Provicer ä»¥ value å±æ€§çš„å½¢å¼æ¥æ”¶ context ã€‚Consumer ç”¨æ¥è®¿é—® context å¹¶ä»ä¸­è¯»å–æ•°æ®ã€‚å› ä¸ºå®ƒä»¬é€šå¸¸å­˜åœ¨äºä¸åŒçš„æ–‡ä»¶ä¸­ï¼Œæ‰€ä»¥å•ç‹¬åˆ›å»ºä¸€ä¸ªæ–‡ä»¶æ¥è¿›è¡Œå®ƒä»¬çš„åˆå§‹åŒ–æ˜¯ä¸ªä¸é”™çš„ä¸»æ„ã€‚</p><p>å‡è®¾è¯´ App ç»„ä»¶æ˜¯æ ¹ç»„ä»¶ã€‚åœ¨æ­¤éœ€è¦ä¼ å…¥ <code>context</code>ã€‚</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Provider &#125; from './context';</span><br><span class="line"></span><br><span class="line">const context = &#123; title: 'React In Patterns' &#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="title">extends</span> <span class="title">React</span>.<span class="title">Component</span> &#123;</span></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Provider value=&#123; context &#125;&gt;</span><br><span class="line">        &lt;Header /&gt;</span><br><span class="line">      &lt;/Provider&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>åŒ…è£…ç»„ä»¶ä»¥åŠå­ç»„ä»¶ç°åœ¨å…±äº«åŒä¸€ä¸ª context ã€‚<code>&lt;Title&gt;</code>ç»„ä»¶æ˜¯éœ€è¦ title å­—ç¬¦ä¸²çš„ç»„ä»¶ä¹‹ä¸€ï¼Œæ‰€ä»¥è¦åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ <code>&lt;Consumer&gt;</code> ã€‚<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Consumer &#125; from './context';</span><br><span class="line"></span><br><span class="line"><span class="function">function <span class="title">Title</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Consumer&gt;&#123;</span><br><span class="line">      (&#123; title &#125;) =&gt; &lt;h1&gt;Title: &#123; title &#125;&lt;/h1&gt;</span><br><span class="line">    &#125;&lt;/Consumer&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ³¨æ„ï¼Œ<code>Consumer</code>ç±»ä½¿ç”¨å‡½æ•°ä½œä¸ºåµŒå¥—å­å…ƒç´  ( render prop æ¨¡å¼) æ¥ä¼ é€’ context ã€‚</p><p>æ–°çš„ API è®©äººæ„Ÿè§‰æ›´å®¹æ˜“ç†è§£ï¼ŒåŒæ—¶æ ·æ¿æ–‡ä»¶ä»£ç æ›´å°‘ã€‚æ­¤ API ä»ç„¶è¿˜å¾ˆæ–°ï¼Œä½†çœ‹èµ·æ¥å¾ˆæœ‰å‰é€”ã€‚å®ƒå¼€å¯äº†ä¸€ç³»åˆ—å…¨æ–°çš„å¯èƒ½æ€§ã€‚</p><h2 id="ä½¿ç”¨æ¨¡å—ç³»ç»Ÿ"><a href="#ä½¿ç”¨æ¨¡å—ç³»ç»Ÿ" class="headerlink" title="ä½¿ç”¨æ¨¡å—ç³»ç»Ÿ"></a>ä½¿ç”¨æ¨¡å—ç³»ç»Ÿ</h2><p>å¦‚æœä¸åƒä½¿ç”¨ context çš„è¯ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–æ–¹å¼æ¥å®ç°æ³¨å…¥ã€‚å®ƒä»¬å¹¶é React ç›¸å…³çš„ï¼Œä½†æ˜¯å€¼å¾—ä¸€æã€‚æ–¹å¼ä¹‹ä¸€å°±æ˜¯ä½¿ç”¨æ¨¡å—ç³»ç»Ÿã€‚</p><p>ä¼—æ‰€å‘¨çŸ¥ï¼ŒJavaScript ä¸­çš„å…¸å‹æ¨¡å—ç³»ç»Ÿå…·æœ‰ç¼“å­˜æœºåˆ¶ã€‚åœ¨ <a href="https://nodejs.org/api/modules.html#modules_caching" target="_blank" rel="noopener">Node å®˜æ–¹æ–‡æ¡£</a> ä¸­å¯ä»¥çœ‹åˆ°:</p><blockquote><p>æ¨¡å—åœ¨ç¬¬ä¸€æ¬¡åŠ è½½åä¼šè¢«ç¼“å­˜ã€‚è¿™ä¹Ÿæ„å‘³ç€ï¼ˆç±»ä¼¼å…¶ä»–ç¼“å­˜æœºåˆ¶ï¼‰å¦‚æœæ¯æ¬¡è°ƒç”¨ require(â€˜fooâ€™) éƒ½è§£æåˆ°åŒä¸€æ–‡ä»¶ï¼Œåˆ™è¿”å›ç›¸åŒçš„å¯¹è±¡ã€‚<br>å¤šæ¬¡è°ƒç”¨ require(foo) ä¸ä¼šå¯¼è‡´æ¨¡å—çš„ä»£ç è¢«æ‰§è¡Œå¤šæ¬¡ã€‚è¿™æ˜¯ä¸€ä¸ªé‡è¦çš„ç‰¹æ€§ã€‚å€ŸåŠ©å®ƒ, å¯ä»¥è¿”å›â€œéƒ¨åˆ†å®Œæˆâ€çš„å¯¹è±¡ï¼Œä»è€Œå…è®¸åŠ è½½ä¾èµ–çš„ä¾èµ–, å³ä½¿å®ƒä»¬ä¼šå¯¼è‡´å¾ªç¯ä¾èµ–ã€‚</p></blockquote><p>è¿™å¯¹ä¾èµ–æ³¨å…¥æœ‰ä»€ä¹ˆå¸®åŠ©å—ï¼Ÿå½“ç„¶ï¼Œå¦‚æœå¯¼å‡ºä¸€ä¸ªå¯¹è±¡ï¼Œå®é™…ä¸Šå¯¼å‡ºçš„æ˜¯ä¸€ä¸ª <a href="https:/addyosmani.com/resources/essentialjsdesignpatterns/book#singletonpatternjavascript" target="_blank" rel="noopener">å•ä¾‹</a>ï¼Œå¹¶ä¸”æ¯ä¸ªå¯¼å…¥è¯¥æ–‡ä»¶çš„å…¶ä»–æ¨¡å—éƒ½å°†è·å¾—åŒä¸€ä¸ªå¯¹è±¡ã€‚è¿™ä½¿å¾—å¯ä»¥ register ä¾èµ–ï¼Œå¹¶ç¨ååœ¨å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ fetch å®ƒä»¬ã€‚</p><p>æ¥åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶<code>di.jsx</code> ï¼Œå®ƒçš„ä»£ç å¦‚ä¸‹æ‰€ç¤º:</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">var dependencies = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">export</span> function <span class="title">register</span><span class="params">(key, dependency)</span> </span>&#123;</span><br><span class="line">  dependencies[key] = dependency;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">export</span> function <span class="title">fetch</span><span class="params">(key)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (dependencies[key]) <span class="keyword">return</span> dependencies[key];</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> Error(`<span class="string">"$&#123; key &#125; is not registered as dependency.`);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">export function wire(Component, deps, mapper) &#123;</span></span><br><span class="line"><span class="string">  return class Injector extends React.Component &#123;</span></span><br><span class="line"><span class="string">    constructor(props) &#123;</span></span><br><span class="line"><span class="string">      super(props);</span></span><br><span class="line"><span class="string">      this._resolvedDependencies = mapper(...deps.map(fetch));</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    render() &#123;</span></span><br><span class="line"><span class="string">      return (</span></span><br><span class="line"><span class="string">        &lt;Component</span></span><br><span class="line"><span class="string">          &#123;...this.state&#125;</span></span><br><span class="line"><span class="string">          &#123;...this.props&#125;</span></span><br><span class="line"><span class="string">          &#123;...this._resolvedDependencies&#125;</span></span><br><span class="line"><span class="string">        /&gt;</span></span><br><span class="line"><span class="string">      );</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><p>å°†ä¾èµ–ä¿å­˜åœ¨äº† <code>dependencies</code>è¿™ä¸ªå…¨å±€å˜é‡ä¸­ (å¯¹äºæ¨¡å—å®ƒæ˜¯å…¨å±€çš„ï¼Œä½†å¯¹äºæ•´ä¸ªåº”ç”¨æ¥æ˜¯å¹¶ä¸æ˜¯) ã€‚ç„¶åï¼Œå¯¼å‡º <code>register å’Œ fetch</code>è¿™ä¸¤ä¸ªå‡½æ•°ï¼Œå®ƒä»¬è´Ÿè´£è¯»å†™ä¾èµ–å…³ç³»çš„æ•°æ®ã€‚å®ƒçœ‹èµ·æ¥æœ‰ç‚¹åƒå¯¹ç®€å•çš„ JavaScript å¯¹è±¡å®ç°çš„ <code>setter å’Œ getter</code>ã€‚å†ç„¶åæ˜¯ <code>wire</code>å‡½æ•°ï¼Œå®ƒæ¥æ”¶ React ç»„ä»¶å¹¶è¿”å› é«˜é˜¶ç»„ä»¶ ã€‚åœ¨ç»„ä»¶çš„æ„é€ å‡½æ•°ä¸­ï¼Œè§£æäº†ä¾èµ–ï¼Œå¹¶åœ¨ç¨åæ¸²æŸ“åŸå§‹ç»„ä»¶æ—¶å°†å…¶ä½œä¸ºå±æ€§ä¼ ç»™ç»„ä»¶ã€‚æŒ‰ç…§ç›¸åŒçš„æ¨¡å¼æ¥æè¿°éœ€è¦çš„ä¸œè¥¿ (deps å‚æ•°)ï¼Œå¹¶ä½¿ç”¨ <code>mapper</code> å‡½æ•°æ¥æå–æ‰€éœ€å±æ€§ã€‚</p><p>æœ‰äº†<code>di.jsx</code> è¾…åŠ©å‡½æ•°ï¼Œæˆ‘ä»¬åˆèƒ½å¤Ÿåœ¨åº”ç”¨çš„å…¥å£ç‚¹ ( app.jsx ) æ³¨å†Œä¾èµ–ï¼Œå¹¶ä¸”åœ¨ä»»æ„ç»„ä»¶ ( Title.jsx ) ä¸­è¿›è¡Œæ³¨å…¥ã€‚</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.jsx</span></span><br><span class="line">import Header from './Header.jsx';</span><br><span class="line">import &#123; register &#125; from './di.jsx';</span><br><span class="line"></span><br><span class="line">register('my-awesome-title', 'React in patterns');</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="title">extends</span> <span class="title">React</span>.<span class="title">Component</span> &#123;</span></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> &lt;Header /&gt;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// -----------------------------------</span></span><br><span class="line"><span class="comment">// Header.jsx</span></span><br><span class="line">import Title from './Title.jsx';</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">export</span> <span class="keyword">default</span> function <span class="title">Header</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;header&gt;</span><br><span class="line">      &lt;Title /&gt;</span><br><span class="line">    &lt;/header&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// -----------------------------------</span></span><br><span class="line"><span class="comment">// Title.jsx</span></span><br><span class="line">import &#123; wire &#125; from './di.jsx';</span><br><span class="line"></span><br><span class="line">var Title = function(props) &#123;</span><br><span class="line">  <span class="keyword">return</span> &lt;h1&gt;&#123; props.title &#125;&lt;/h1&gt;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title">wire</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  Title,</span></span></span><br><span class="line">  ['my-awesome-title'],</span><br><span class="line">  title =&gt; (&#123; title &#125;)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>å¦‚æœæŸ¥çœ‹ Title.jsx æ–‡ä»¶çš„è¯ï¼Œå¯ä»¥çœ‹åˆ°å®é™…çš„ç»„ä»¶å’Œ <code>wire</code> å­˜åœ¨äºä¸åŒçš„æ–‡ä»¶ä¸­ã€‚è¿™ç§æ–¹å¼è®©ç»„ä»¶å’Œ <code>mapper</code> å‡½æ•°çš„å•å…ƒæµ‹è¯•æ›´ç®€å•ã€‚</p><h1 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h1><p>ä¾èµ–æ³¨å…¥æ˜¯ä¸€ä¸ªå¤§é—®é¢˜ï¼Œå°¤å…¶æ˜¯åœ¨ JavaScript ä¸­ã€‚è®¸å¤šäººå¹¶æ²¡æœ‰æ„è¯†åˆ°ï¼Œä½†æ˜¯ï¼Œæ­£ç¡®çš„ä¾èµ–ç®¡ç†æ˜¯æ¯ä¸ªå¼€å‘å‘¨æœŸä¸­çš„å…³é”®è¿‡ç¨‹ã€‚JavaScript ç”Ÿæ€æä¾›äº†ä¸åŒçš„å·¥å…·ï¼Œä½œä¸ºå¼€å‘è€…çš„æˆ‘ä»¬åº”è¯¥æŒ‘é€‰æœ€é€‚åˆè‡ªå·±çš„å·¥å…·ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å†™çš„å¥½å¤šæ¨¡å—å’Œç»„ä»¶éƒ½æœ‰ä¾èµ–ã€‚èƒ½å¦ç®¡ç†è¿™äº›ä¾èµ–å¯¹äºé¡¹ç›®çš„æˆåŠŸè‡³å…³é‡è¦ã€‚æœ‰ä¸€ç§å«åš &lt;a href=&quot;http://krasimirtsonev.com/blog/article/Dependency-injection-in-JavaScript&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;ä¾èµ–æ³¨å…¥&lt;/a&gt; çš„æŠ€æœ¯ (å¤§å¤šæ•°äººè®¤ä¸ºå®ƒæ˜¯ä¸€ç§æ¨¡å¼) ç”¨æ¥è§£å†³è¿™ç§é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ React ä¸­ï¼Œå¯¹ä¾èµ–æ³¨å…¥çš„éœ€è¦æ˜¯æ˜¾è€Œæ˜“è§çš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/react_d.png&quot; alt=&quot;React&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="React" scheme="https://duanruilong.github.io/categories/React/"/>
    
    
      <category term="Javascript" scheme="https://duanruilong.github.io/tags/Javascript/"/>
    
      <category term="React" scheme="https://duanruilong.github.io/tags/React/"/>
    
  </entry>
  
  <entry>
    <title>Reactå¼€å‘å¸¸ç”¨è®¾è®¡æ¨¡å¼-Redux</title>
    <link href="https://duanruilong.github.io/2018/06/11/React%E5%BC%80%E5%8F%91%E5%B8%B8%E7%94%A8%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-Redux/"/>
    <id>https://duanruilong.github.io/2018/06/11/Reactå¼€å‘å¸¸ç”¨è®¾è®¡æ¨¡å¼-Redux/</id>
    <published>2018-06-11T15:52:51.000Z</published>
    <updated>2018-12-18T03:11:12.000Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://redux.js.org/" target="_blank" rel="noopener">Redux</a> æ˜¯ä¸€ä¸ªåº“ï¼Œå®ƒæ‰®æ¼”ç€çŠ¶æ€å®¹å™¨çš„è§’è‰²ï¼Œå¹¶è´Ÿè´£ç®¡ç†åº”ç”¨çš„æ•°æ®æµã€‚å®ƒæ˜¯ Dan Abramov åœ¨ 2015 å¹´çš„ ReactEurope å¼€å‘è€…å¤§ä¼šä¸Šæ¨å‡ºçš„ (<a href="https://www.youtube.com/watch?v=xsSnOQynTHs" target="_blank" rel="noopener">è§†é¢‘</a>)ã€‚å®ƒç±»ä¼¼äº <a href="https://github.com/krasimir/react-in-patterns/blob/master/book/chapter-8/README.md#flux-architecture-and-its-main-characteristics" target="_blank" rel="noopener">Flux æ¶æ„</a> å¹¶æœ‰å¾ˆå¤šå…±åŒç‚¹ã€‚</p><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/react_d.png" alt="React"></p><a id="more"></a><h1 id="Redux"><a href="#Redux" class="headerlink" title="Redux"></a>Redux</h1><h2 id="Redux-æ¶æ„åŠå…¶ä¸»è¦ç‰¹ç‚¹"><a href="#Redux-æ¶æ„åŠå…¶ä¸»è¦ç‰¹ç‚¹" class="headerlink" title="Redux æ¶æ„åŠå…¶ä¸»è¦ç‰¹ç‚¹"></a>Redux æ¶æ„åŠå…¶ä¸»è¦ç‰¹ç‚¹</h2><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/react_type/redux-architecture.jpg" alt="redux"></p><p>ç±»ä¼¼äº <a href="https://github.com/krasimir/react-in-patterns/blob/master/book/chapter-8/README.md" target="_blank" rel="noopener">Flux</a> æ¶æ„ï¼Œç”±è§†å›¾ç»„ä»¶ (React) æ¥æ´¾å‘åŠ¨ä½œã€‚åŒä¸€ä¸ªåŠ¨ä½œä¹Ÿå¯èƒ½æ˜¯ç”±ç³»ç»Ÿçš„å…¶ä»–éƒ¨åˆ†æ´¾å‘çš„ï¼Œä¾‹å¦‚å¼•å¯¼é€»è¾‘ã€‚åŠ¨ä½œä¸æ˜¯æ´¾å‘åˆ°ä¸­å¿ƒæ¢çº½ä¸­ï¼Œè€Œæ˜¯ç›´æ¥æ´¾å‘åˆ° <code>store</code>ä¸­ã€‚æ³¨æ„ï¼Œæˆ‘ä»¬è¯´çš„æ˜¯ <code>store</code>ï¼Œè€Œä¸æ˜¯ <code>stores</code> ï¼Œè¿™æ˜¯å› ä¸ºåœ¨ <code>Redux</code> ä¸­åªæœ‰ä¸€ä¸ª <code>store</code> ï¼Œè¿™æ˜¯ <code>Redux</code> ä¸ <code>Flux</code> çš„æœ€é‡è¦çš„åŒºåˆ«ä¹‹ä¸€ã€‚å†³å®šæ•°æ®å¦‚ä½•æ”¹å˜çš„é€»è¾‘ä»¥çº¯å‡½æ•° ( pure functions ) çš„å½¢å¼å­˜åœ¨ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º <code>reducers</code> ã€‚ä¸€æ—¦ <code>store</code>æ¥æ”¶åˆ°åŠ¨ä½œï¼Œå®ƒä¼šå°†å½“å‰çŠ¶æ€å’Œç»™å®šåŠ¨ä½œå‘é€ç»™<code>reducer</code>å¹¶è¦æ±‚å…¶è¿”å›ä¸€ä¸ªæ–°çš„çŠ¶æ€ã€‚ç„¶åï¼Œåœ¨æ•°æ®ä¸å¯å˜çš„æ–¹å¼ä¸‹ï¼Œ <code>reducer</code>éœ€è¦è¿”å›æ–°çš„çŠ¶æ€ã€‚å†ç„¶åï¼Œ <code>store</code>æ›´æ–°è‡ªèº«çš„å†…éƒ¨çŠ¶æ€ã€‚æœ€åï¼Œä¸ <code>store</code>è¿æ¥çš„ <code>React</code>ç»„ä»¶ä¼šé‡æ–°æ¸²æŸ“ã€‚</p><p>æ¦‚å¿µç›¸å½“æ¸…æ™°å¹¶å†æ¬¡éµå¾ªäº† <a href="https://github.com/krasimir/react-in-patterns/blob/master/book/chapter-7/README.md" target="_blank" rel="noopener">å•å‘æ•°æ®æµ</a> ã€‚æˆ‘ä»¬æ¥è®¨è®ºæ¯ä¸€ä¸ªéƒ¨åˆ†å¹¶å¼•å…¥ä¸€äº›æ”¯æŒ <code>Redux</code> æ¨¡å¼å·¥ä½œçš„æ–°æœ¯è¯­ã€‚</p><h2 id="åŠ¨ä½œ-Actions"><a href="#åŠ¨ä½œ-Actions" class="headerlink" title="åŠ¨ä½œ ( Actions )"></a>åŠ¨ä½œ ( Actions )</h2><p><code>Redux</code> ä¸­çš„åŠ¨ä½œå’Œ <code>Flux</code>ä¸€æ ·ï¼Œä¹Ÿåªæ˜¯æœ‰ <code>type</code>å±æ€§çš„å¯¹è±¡è€Œå·²ã€‚è¯¥å¯¹è±¡ä¸­çš„å…¶ä»–æ‰€æœ‰å†…å®¹éƒ½è¢«è§†ä¸ºç‰¹å®šäºä¸Šä¸‹æ–‡çš„æ•°æ®ï¼Œå¹¶ä¸”ä¸æ¨¡å¼æ— å…³ï¼Œè€Œä¸åº”ç”¨çš„é€»è¾‘ç›¸å…³ã€‚ä¾‹å¦‚:</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const CHANGE_VISIBILITY = 'CHANGE_VISIBILITY';</span><br><span class="line"><span class="keyword">const</span> action = &#123;</span><br><span class="line">  type: CHANGE_VISIBILITY,</span><br><span class="line">  visible: <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨åƒ <code>CHANGE_VISIBILITY</code> è¿™æ ·çš„å¸¸é‡ä½œä¸ºåŠ¨ä½œçš„ç±»å‹æ˜¯ä¸€ç§æœ€ä½³å®è·µã€‚æœ‰å¾ˆå¤šæ”¯æŒ <code>Redux</code>çš„å·¥å…·å’Œåº“ï¼Œå®ƒä»¬ç”¨æ¥è§£å†³ä¸ç”¨çš„é—®é¢˜ï¼Œå¹¶ä¸”éƒ½åªéœ€è¦åŠ¨ä½œçš„ç±»å‹å³å¯ã€‚æ‰€ä»¥è¯´ï¼ŒåŠ¨ä½œåªæ˜¯ä¼ é€’ä¿¡æ¯çš„ä¸€ç§ä¾¿æ·æ–¹å¼ã€‚</p><p><code>visible</code> å±æ€§æ˜¯æˆ‘ä»¬æ‰€æåˆ°è¿‡çš„å…ƒæ•°æ®ã€‚å®ƒä¸ <code>Redux</code>æœ¬èº«æ— å…³ï¼Œå®ƒè¡¨ç¤ºåº”ç”¨ä¸­æŸå¤„éœ€è¦ä½¿ç”¨çš„æ•°æ®ã€‚</p><p>æ¯æ¬¡æˆ‘ä»¬æƒ³è¦æ´¾å‘åŠ¨ä½œæ—¶éƒ½éœ€è¦ä½¿ç”¨è¿™æ ·çš„å¯¹è±¡ã€‚ä½†æ˜¯ï¼Œä¸€éåˆä¸€éåœ°å†™ç¡®å®æ˜¯è®©å¤ªäººçƒ¦èºäº†ã€‚è¿™ä¹Ÿæ­£æ˜¯æ¦‚å¿µ <code>action creators</code> è¯ç”Ÿçš„åŸå› ã€‚<code>action creator</code> æ˜¯è¿”å›åŠ¨ä½œå¯¹è±¡çš„å‡½æ•°ï¼Œå®ƒå¯é€‰é¡¹æ€§åœ°æ¥æ”¶ä¸åŠ¨ä½œç›¸å…³è”çš„å±æ€§ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå°†ä¸Šé¢çš„ action å†™æˆ action creator ä¼šæ˜¯è¿™æ ·:<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> changeVisibility = visible =&gt; (&#123;</span><br><span class="line">  type: CHANGE_VISIBILITY,</span><br><span class="line">  visible</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">changeVisibility(<span class="literal">false</span>);</span><br><span class="line"><span class="comment">// &#123; type: CHANGE_VISIBILITY, visible: false &#125;</span></span><br></pre></td></tr></table></figure></p><p>æ³¨æ„ï¼Œå°† <code>visible</code> çš„å€¼ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œè¿™æ ·æˆ‘ä»¬ä¸å¿…å»è®°ä½ (æˆ–å¯¼å…¥) åŠ¨ä½œçš„ç¡®åˆ‡ç±»å‹ã€‚ä½¿ç”¨è¿™ç§è¾…åŠ©å‡½æ•°å¯ä»¥è®©ä»£ç æ›´ç´§å‡‘ï¼Œæ›´æ˜“äºé˜…è¯»ã€‚</p><h2 id="Store"><a href="#Store" class="headerlink" title="Store"></a>Store</h2><p><code>Redux</code> æä¾›è¾…åŠ©å‡½æ•° <code>createStore</code> æ¥åˆ›å»º <code>store</code> ã€‚å®ƒçš„å‡½æ•°ç­¾åå¦‚ä¸‹:<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import &#123; createStore &#125; from 'redux';</span><br><span class="line"></span><br><span class="line">createStore([reducer], [initial state], [enhancer]);</span><br></pre></td></tr></table></figure></p><p>æ­£å¦‚ä¹‹å‰æ‰€æåˆ°çš„ï¼Œ<code>reducer</code> æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæ¥æ”¶å½“å‰çŠ¶æ€å’ŒåŠ¨ä½œï¼Œç„¶åè¿”å›ä¸€ä¸ªæ–°çš„çŠ¶æ€ã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯ <code>store</code> çš„åˆå§‹çŠ¶æ€ã€‚è¿™æ˜¯ä¸€ç§ä¾¿æ·çš„æ‰‹æ®µï¼Œå¯ä»¥ç”¨å·²æœ‰çš„æ•°æ®æ¥åˆå§‹åŒ–æˆ‘ä»¬çš„åº”ç”¨ã€‚è¿™ä¸ªåŠŸèƒ½æ˜¯åƒæœåŠ¡å™¨ç«¯æ¸²æŸ“æˆ–æŒä¹…ä½“éªŒè¿™æ ·çš„è¿‡ç¨‹çš„æœ¬è´¨ã€‚ç¬¬ä¸‰ä¸ªå‚æ•°<code>enhancer</code>æä¾› API æ¥ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„ä¸­é—´ä»¶æ¥æ‰©å±•<code>Redux</code>ï¼ŒåŸºæœ¬ä¸Šæ˜¯æ’å…¥ä¸€äº›è‡ªèº«æ²¡æœ‰æä¾›çš„åŠŸèƒ½ï¼Œä¾‹å¦‚å¤„ç†å¼‚æ­¥æµç¨‹çš„å·¥å…·ã€‚</p><p>åˆ›å»ºå¥½çš„<code>store</code> å…·æœ‰å››ä¸ªæ–¹æ³•:<code>getStateã€dispatchã€subscribe</code>å’Œ <code>replaceReducer</code> ã€‚å…¶ä¸­æœ€é‡è¦çš„æˆ–è®¸å°±æ˜¯<code>dispatch</code>:<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">store.dispatch(changeVisibility(<span class="literal">false</span>));</span><br></pre></td></tr></table></figure></p><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ <code>action creator</code>ã€‚æˆ‘ä»¬å°†å…¶ç»“æœ (å³ action å¯¹è±¡) ä¼ ç»™ <code>dispatch</code>æ–¹æ³•ã€‚ç„¶åï¼Œå®ƒä¼šä¼ æ’­ç»™åº”ç”¨ä¸­çš„ <code>reducers</code>ã€‚</p><p>åœ¨å…¸å‹çš„<code>React</code>åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¸ä¼šç›´æ¥ä½¿ç”¨<code>getState å’Œ subscribe</code>ï¼Œå› ä¸ºæœ‰è¾…åŠ©å‡½æ•°  å¯ä»¥å°†<code>ç»„ä»¶</code>å’Œ <code>store</code>è”ç³»èµ·æ¥å¹¶æœ‰æ•ˆåœ°è®¢é˜… <code>store</code> çš„å˜åŒ–ã€‚ä½œä¸ºè®¢é˜…çš„ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬è‡ªç„¶å¯ä»¥æ”¶åˆ°å½“å‰çš„çŠ¶æ€ï¼Œæ‰€ä»¥ä¸å¿…è‡ªå·±å»è°ƒç”¨<code>getState</code>ã€‚<code>replaceReducer</code>æ˜¯ä¸€ä¸ªé«˜çº§ API ï¼Œå®ƒç”¨æ¥äº¤äº’ <code>store</code>æ‰€ä½¿ç”¨çš„å½“å‰ <code>reducer</code> ã€‚</p><h2 id="Reducer"><a href="#Reducer" class="headerlink" title="Reducer"></a>Reducer</h2><p><code>reducer</code>å‡½æ•°å¤§æ¦‚æ˜¯<code>Redux</code>ä¸­æœ€ç²¾åçš„éƒ¨åˆ†ã€‚<code>reducer</code>è¿˜æœ‰ä¸¤ä¸ªç‰¹ç‚¹éå¸¸é‡è¦ï¼Œæ²¡æœ‰å®ƒä»¬çš„è¯åŸºæœ¬ä¸Šè¿™ç§æ¨¡å¼ä¹Ÿä¸å¤å­˜åœ¨ã€‚</p><div class="note danger"><p>(1) å®ƒå¿…é¡»æ˜¯çº¯å‡½æ•° - è¿™æ„å‘³ç€åœ¨è¾“å…¥ä¸å˜çš„æƒ…å†µä¸‹ï¼Œæ°¸è¿œåº”è¯¥è¿”å›ç›¸åŒçš„ç»“æœã€‚ </p></div><div class="note danger"><p>(2) å®ƒåº”è¯¥æ²¡æœ‰å‰¯ä½œç”¨ - åƒè®¿é—®å…¨å±€å˜é‡ã€å‘èµ·å¼‚æ­¥è¯·æ±‚æˆ–ç­‰å¾… promise è§£æè¿™æ ·çš„æ“ä½œéƒ½ä¸åº”è¯¥ç”¨åœ¨æ­¤å¤„ã€‚ </p></div><p>ä¸‹é¢æ˜¯ä¸ªå¾ˆç®€å•çš„è®¡æ•°å™¨ reducer :</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> counterReducer = function (state, action) &#123;</span><br><span class="line">  <span class="keyword">if</span> (action.type === ADD) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; value: state.value + <span class="number">1</span> &#125;;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (action.type === SUBTRACT) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; value: state.value - <span class="number">1</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123; value: <span class="number">0</span> &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å®ƒæ²¡æœ‰ä»»ä½•å‰¯ä½œç”¨ï¼Œæ¯æ¬¡éƒ½æ˜¯è¿”å›ä¸€ä¸ªå…¨æ–°çš„å¯¹è±¡ã€‚æˆ‘ä»¬æ ¹æ®ä¹‹å‰çš„çŠ¶æ€å’Œä¼ å…¥çš„åŠ¨ä½œç±»å‹æ¥ç´¯åŠ å‡ºæ–°çš„å€¼ã€‚</p><h2 id="è¿æ¥-React-ç»„ä»¶"><a href="#è¿æ¥-React-ç»„ä»¶" class="headerlink" title="è¿æ¥ React ç»„ä»¶"></a>è¿æ¥ React ç»„ä»¶</h2><p>å¦‚æœæ˜¯åœ¨ <code>React</code>ä¸Šä¸‹æ–‡ä¸­è®¨è®º<code>Redux</code>çš„è¯ï¼Œé‚£åŸºæœ¬ç¦»ä¸å¼€ <a href="https://github.com/reactjs/react-redux" target="_blank" rel="noopener">react-redux</a> æ¨¡å—ã€‚å®ƒæä¾›ä¸¤æ ·ä¸œè¥¿æ¥è¿›è¡Œ <code>Redux</code> åˆ°ç»„ä»¶çš„è¿æ¥ã€‚</p><blockquote><p>(1) <code>&lt;Provider&gt; ç»„ä»¶</code> - å®ƒæ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œå®ƒæ¥æ”¶ <code>store</code>å¹¶ä½¿å¾—æ‰€æœ‰çš„å­ç»„ä»¶éƒ½å¯ä»¥é€šè¿‡ React çš„ context API æ¥è®¿é—® <code>store</code>ã€‚</p></blockquote><p>ä¾‹å¦‚:<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;Provider store=&#123; myStore &#125;&gt;</span><br><span class="line">  &lt;MyApp /&gt;</span><br><span class="line">&lt;/Provider&gt;</span><br></pre></td></tr></table></figure></p><p>é€šå¸¸ï¼Œæˆ‘ä»¬åªåœ¨åº”ç”¨ä¸­çš„å•ä¸ªåœ°æ–¹ä½¿ç”¨å®ƒã€‚</p><blockquote><p>(2) <code>connect å‡½æ•°</code> - å®ƒæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒè´Ÿè´£è®¢é˜… <code>store</code>çš„æ›´æ–°å’Œé‡æ–°æ¸²æŸ“ç»„ä»¶ã€‚å®ƒæ˜¯é€šè¿‡ <a href="https://github.com/krasimir/react-in-patterns/blob/master/book/chapter-4/README.md#higher-order-component" target="_blank" rel="noopener">é«˜é˜¶ç»„ä»¶</a> å®ç°çš„ã€‚</p></blockquote><p>è¿™æ˜¯å®ƒçš„å‡½æ•°ç­¾å:<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">connect(</span><br><span class="line">  [mapStateToProps],</span><br><span class="line">  [mapDispatchToProps],</span><br><span class="line">  [mergeProps],</span><br><span class="line">  [options]</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p><p><code>mapDispatchToProps</code>ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œåªæ˜¯å®ƒæ¥æ”¶çš„æ˜¯ <code>dispatch</code>å‡½æ•°ï¼Œè€Œä¸æ˜¯<code>state</code> ã€‚è¿™é‡Œæ˜¯æˆ‘ä»¬å°†æ´¾å‘åŠ¨ä½œå®šä¹‰æˆå±æ€§çš„åœ°æ–¹ã€‚<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mapDispatchToProps = dispatch =&gt; (&#123;</span><br><span class="line">  changeVisibility: value =&gt; dispatch(changeVisibility(value))</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><p><code>mergeProps</code>å°† <code>mapStateToPropsã€ mapDispatchToProps</code>å’Œå‘é€ç»™ç»„ä»¶çš„å±æ€§è¿›è¡Œåˆå¹¶ï¼Œå®ƒèµ‹äºˆæˆ‘ä»¬æœºä¼šå»ç´¯åŠ å‡ºæ›´é€‚åˆçš„å±æ€§ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦è§¦å‘ä¸¤ä¸ªåŠ¨ä½œï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒä»¬ç»„åˆæˆä¸€ä¸ªå•ç‹¬çš„å±æ€§å¹¶å°†å…¶å‘é€ç»™ React ã€‚<code>options</code> æ¥æ”¶ä¸€ç»„å¦‚ä½•æ§åˆ¶è¿æ¥çš„è®¾ç½®ã€‚</p><h2 id="ä½¿ç”¨-Redux-çš„ç®€å•è®¡æ•°å™¨åº”ç”¨"><a href="#ä½¿ç”¨-Redux-çš„ç®€å•è®¡æ•°å™¨åº”ç”¨" class="headerlink" title="ä½¿ç”¨ Redux çš„ç®€å•è®¡æ•°å™¨åº”ç”¨"></a>ä½¿ç”¨ Redux çš„ç®€å•è®¡æ•°å™¨åº”ç”¨</h2><p>ä½¿ç”¨ä¸Šé¢æ‰€æœ‰çš„ API æ¥åˆ›å»ºä¸€ä¸ªç®€å•çš„è®¡æ•°å™¨åº”ç”¨ã€‚<br><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/react_type/redux-counter-app.png" alt="react"></p><p>â€œAddâ€ å’Œ â€œSubtractâ€ æŒ‰é’®åªæ˜¯æ”¹å˜ <code>store</code> çš„å€¼ã€‚â€Visibleâ€ å’Œ â€œHiddenâ€ æŒ‰é’®ç”¨æ¥æ§åˆ¶è®¡æ•°å™¨æ˜¯å¦æ˜¾ç¤ºã€‚</p><h3 id="åˆ›å»ºåŠ¨ä½œ"><a href="#åˆ›å»ºåŠ¨ä½œ" class="headerlink" title="åˆ›å»ºåŠ¨ä½œ"></a>åˆ›å»ºåŠ¨ä½œ</h3><p>æ¯ä¸ª <code>Redux</code> çš„å¼€å§‹éƒ½æ˜¯å¯¹åŠ¨ä½œç±»å‹å»ºæ¨¡åŠå®šä¹‰æˆ‘ä»¬æ‰€è¦ä¿å­˜çš„çŠ¶æ€ã€‚åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œä¼šæœ‰ä¸‰ä¸ªæ“ä½œ:<code>å¢åŠ ã€å‡å°‘å’Œç®¡ç†å¯è§æ€§</code>ã€‚æ‰€æœ‰åŠ¨ä½œä»£ç å¦‚ä¸‹æ‰€ç¤º:<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const ADD = 'ADD';</span><br><span class="line">const SUBTRACT = 'SUBTRACT';</span><br><span class="line">const CHANGE_VISIBILITY = 'CHANGE_VISIBILITY';</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> add = () =&gt; (&#123; type: ADD &#125;);</span><br><span class="line"><span class="keyword">const</span> subtract = () =&gt; (&#123; type: SUBTRACT &#125;);</span><br><span class="line"><span class="keyword">const</span> changeVisibility = visible =&gt; (&#123;</span><br><span class="line">  type: CHANGE_VISIBILITY,</span><br><span class="line">  visible</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><h3 id="Store-åŠå…¶-reducers"><a href="#Store-åŠå…¶-reducers" class="headerlink" title="Store åŠå…¶ reducers"></a>Store åŠå…¶ reducers</h3><p>åœ¨è§£é‡Š <code>store</code> å’Œ <code>reudcers</code>æ—¶ï¼Œæœ‰äº›æŠ€æœ¯ç‚¹æ˜¯æ²¡æœ‰è®¨è®ºåˆ°çš„ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬ä¼šæœ‰å¤šä¸ª reducer ï¼Œå› ä¸ºè¦ç®¡ç†å¤šç§çŠ¶æ€ã€‚<code>store</code> åªæœ‰ä¸€ä¸ªï¼Œæ‰€ä»¥ç†è®ºä¸Šåªæœ‰ä¸€ä¸ªçŠ¶æ€å¯¹è±¡ã€‚ä½†æ˜¯å¤§å¤šæ•°ç”Ÿäº§ç¯å¢ƒçš„åº”ç”¨çš„çŠ¶æ€éƒ½æ˜¯çŠ¶æ€åˆ‡ç‰‡çš„ç»„åˆã€‚æ¯ä¸ªåˆ‡ç‰‡ä»£è¡¨åº”ç”¨çš„ä¸€éƒ¨åˆ†ã€‚è¿™ä¸ªå°ç¤ºä¾‹æ‹¥æœ‰è®¡æ•°å’Œå¯è§æ€§ä¸¤ä¸ªåˆ‡ç‰‡ã€‚æ‰€ä»¥åˆå§‹çŠ¶æ€åº”è¯¥æ˜¯è¿™æ ·çš„:<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> initialState = &#123;</span><br><span class="line">  counter: &#123;</span><br><span class="line">    value: <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  visible: <span class="literal">true</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><p>éœ€è¦ä¸ºè¿™ä¸¤éƒ¨åˆ†åˆ†åˆ«å®šä¹‰ <code>reducer</code>ã€‚è¿™æ ·ä¼šå¸¦æ¥çµæ´»æ€§å¹¶æå‡ä»£ç çš„å¯è¯»æ€§ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªæ‹¥æœ‰åä¸ªæˆ–æ›´å¤šçŠ¶æ€åˆ‡ç‰‡çš„å·¨å‹åº”ç”¨ï¼Œå¹¶ä¸”æˆ‘ä»¬åªä½¿ç”¨å•ä¸ª <code>reducer</code> å‡½æ•°æ¥è¿›è¡Œç»´æŠ¤ï¼Œè¿™æ ·ç®¡ç†èµ·æ¥å°†ä¼šéå¸¸å›°éš¾ã€‚</p><p><code>Redux</code>æä¾›è¾…åŠ©å‡½æ•°æ¥è®©æˆ‘ä»¬èƒ½å¤Ÿé”å®š<code>state</code>çš„æŸä¸ªç‰¹å®šéƒ¨åˆ†å¹¶ä¸ºå…¶åˆ†é…ä¸€ä¸ª <code>reducer</code>ã€‚å®ƒå°±æ˜¯ <code>combineReducers</code> :<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import &#123; createStore, combineReducers &#125; from 'redux';</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rootReducer = combineReducers(&#123;</span><br><span class="line">  counter: function A() &#123; ... &#125;,</span><br><span class="line">  visible: function B() &#123; ... &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> store = createStore(rootReducer);</span><br></pre></td></tr></table></figure></p><p>å‡½æ•° A åªæ¥æ”¶ <code>counter</code> åˆ‡ç‰‡ä½œä¸ºçŠ¶æ€ï¼Œå¹¶ä¸”åªè¿”å›åˆ‡ç‰‡è¿™éƒ¨åˆ†çš„çŠ¶æ€ã€‚å‡½æ•° B ä¹Ÿæ˜¯åŒæ ·çš„ï¼Œå®ƒæ¥æ”¶å¸ƒå°”å€¼ (visible çš„å€¼) å¹¶ä¸”å¿…é¡»è¿”å›å¸ƒå°”å€¼ã€‚</p><p><code>counter</code> åˆ‡ç‰‡çš„<code>reducer</code> åº”è¯¥è€ƒè™‘åˆ° ADD å’Œ SUBTRACT ä¸¤ä¸ªåŠ¨ä½œï¼Œå¹¶åŸºäºåŠ¨ä½œæ¥è®¡ç®—å‡ºæ–°çš„ <code>counter</code> çŠ¶æ€ã€‚<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> counterReducer = function (state, action) &#123;</span><br><span class="line">  <span class="keyword">if</span> (action.type === ADD) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; value: state.value + <span class="number">1</span> &#125;;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (action.type === SUBTRACT) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; value: state.value - <span class="number">1</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> state || &#123; value: <span class="number">0</span> &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><p>å½“ <code>store</code> åˆå§‹åŒ–æ—¶ï¼Œæ¯ä¸ª reducer è‡³å°‘è§¦å‘ä¸€æ¬¡ã€‚æœ€åˆè¿è¡Œçš„è¿™ä¸€æ¬¡ï¼Œstate ä¸º undefined ï¼Œaction ä¸º <code>{ type: &quot;@@redux/INIT&quot;}</code> ã€‚åœ¨è¿™ä¸ªå®ä¾‹ä¸­ï¼Œreducer åº”è¯¥è¿”å›æ•°æ®çš„åˆå§‹å€¼ <code>{ value: 0 }</code> ã€‚</p><p>visible çš„ reducer ç›¸å½“ç®€å•ï¼Œå®ƒåªå¤„ç†åŠ¨ä½œ <code>CHANGE_VISIBILITY</code> :<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> visibilityReducer = function (state, action) &#123;</span><br><span class="line">  <span class="keyword">if</span> (action.type === CHANGE_VISIBILITY) &#123;</span><br><span class="line">    <span class="keyword">return</span> action.visible;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><p>æœ€åï¼Œæˆ‘ä»¬éœ€è¦å°†è¿™ä¸¤ä¸ª reducers ä¼ ç»™ combineReducers æ¥åˆ›å»º rootReducer ã€‚</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> rootReducer = combineReducers(&#123;</span><br><span class="line">  counter: counterReducer,</span><br><span class="line">  visible: visibilityReducer</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="é€‰æ‹©å™¨-Selectors"><a href="#é€‰æ‹©å™¨-Selectors" class="headerlink" title="é€‰æ‹©å™¨ ( Selectors )"></a>é€‰æ‹©å™¨ ( Selectors )</h3><p>æˆ‘ä»¬çŸ¥é“çŠ¶æ€é€šå¸¸éƒ½æ˜¯ç»†åŒ–æˆå¤šä¸ªçŠ¶æ€åˆ‡ç‰‡ã€‚æˆ‘ä»¬æœ‰ä¸“é—¨çš„ <code>reducer</code>æ¥è´Ÿè´£æ›´æ–°æ•°æ®ï¼Œä½†æ˜¯å½“æ¶‰åŠåˆ°è·å–çŠ¶æ€æ•°æ®æ—¶ï¼Œæˆ‘ä»¬ä»ç„¶åªæ˜¯æœ‰ä¸€ä¸ªå¯¹è±¡ã€‚è¿™é‡Œå°±æ˜¯é€‰æ‹©å™¨ ( Selectors )æ´¾ä¸Šç”¨åœºçš„åœ°æ–¹ã€‚é€‰æ‹©å™¨å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæ¥æ”¶æ•´ä¸ªçŠ¶æ€å¯¹è±¡å¹¶æå–å‡ºæˆ‘ä»¬æ‰€éœ€è¦çš„æ•°æ®ã€‚ä¾‹å¦‚ï¼Œåœ¨è¿™ä¸ªå°ç¤ºä¾‹åº”ç”¨ä¸­æˆ‘ä»¬éœ€è¦ä¸¤ä¸ªæ•°æ®:<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getCounterValue = state =&gt; state.counter.value;</span><br><span class="line"><span class="keyword">const</span> getVisibility = state =&gt; state.visible;</span><br></pre></td></tr></table></figure></p><p>è¿™ä¸ªè®¡æ•°å™¨åº”ç”¨å®åœ¨æ˜¯å¤ªå°äº†ï¼Œå®Œå…¨ä½“ç°ä¸å‡ºé€‰æ‹©å™¨çš„å¨åŠ›ã€‚ä½†æ˜¯ï¼Œåœ¨ä¸€ä¸ªå¤§é¡¹ç›®ä¸­ä¾¿æˆªç„¶ä¸åŒã€‚é€‰æ‹©å™¨çš„å­˜åœ¨å¹¶ä¸æ˜¯ä¸ºäº†å°‘äº›å‡ è¡Œä»£ç ï¼Œä¹Ÿä¸æ˜¯ä¸ºäº†å¯è¯»æ€§ã€‚é€‰æ‹©å™¨é™„å¸¦äº†è¿™äº›å†…å®¹ï¼Œä½†å®ƒä»¬ä¹Ÿæ˜¯ä¸Šä¸‹æ–‡ç›¸å…³çš„ï¼Œå¯èƒ½åŒ…å«é€»è¾‘ã€‚ç”±äºå®ƒä»¬å¯ä»¥è®¿é—®æ•´ä¸ªçŠ¶æ€ï¼Œæ‰€ä»¥å®ƒä»¬èƒ½å¤Ÿå›ç­”ä¸šåŠ¡é€»è¾‘ç›¸å…³çš„é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œâ€œåœ¨ Y é¡µé¢ç”¨æˆ·æ˜¯å¦æœ‰æƒé™å¯ä»¥åš X è¿™ä»¶äº‹â€ã€‚è¿™æ ·çš„äº‹é€šè¿‡ä¸€ä¸ªé€‰æ‹©å™¨å°±å¯ä»¥å®Œæˆã€‚</p><h3 id="React-ç»„ä»¶"><a href="#React-ç»„ä»¶" class="headerlink" title="React ç»„ä»¶"></a>React ç»„ä»¶</h3><p>å…ˆæ¥å¤„ç†ç®¡ç†è®¡æ•°å™¨å¯è§æ€§çš„ UI éƒ¨åˆ†ã€‚<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">function <span class="title">Visibility</span><span class="params">(&#123; changeVisibility &#125;)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;button onClick=&#123; () =&gt; changeVisibility(<span class="literal">true</span>) &#125;&gt;</span><br><span class="line">        Visible</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">      &lt;button onClick=&#123; () =&gt; changeVisibility(<span class="literal">false</span>) &#125;&gt;</span><br><span class="line">        Hidden</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> VisibilityConnected = connect(</span><br><span class="line">  null,</span><br><span class="line">  dispatch =&gt; (&#123;</span><br><span class="line">    changeVisibility: value =&gt; dispatch(changeVisibility(value))</span><br><span class="line">  &#125;)</span><br><span class="line">)(Visibility);</span><br></pre></td></tr></table></figure></p><p>ç¬¬äºŒä¸ªç»„ä»¶ç•¥å¾®æœ‰äº›å¤æ‚ã€‚å°†å®ƒå‘½åä¸º Counter ï¼Œå®ƒæ¸²æŸ“ä¸¤ä¸ªæŒ‰é’®å’Œè®¡æ•°å€¼ã€‚</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">function <span class="title">Counter</span><span class="params">(&#123; value, add, subtract &#125;)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;Value: &#123; value &#125;&lt;/p&gt;</span><br><span class="line">      &lt;button onClick=&#123; add &#125;&gt;Add&lt;/button&gt;</span><br><span class="line">      &lt;button onClick=&#123; subtract &#125;&gt;Subtract&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> CounterConnected = connect(</span><br><span class="line">  state =&gt; (&#123;</span><br><span class="line">    value: getCounterValue(state)</span><br><span class="line">  &#125;),</span><br><span class="line">  dispatch =&gt; (&#123;</span><br><span class="line">    add: () =&gt; dispatch(add()),</span><br><span class="line">    subtract: () =&gt; dispatch(subtract())</span><br><span class="line">  &#125;)</span><br><span class="line">)(Counter);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œ mapStateToProps å’Œ mapDispatchToProps éƒ½éœ€è¦ï¼Œå› ä¸ºæˆ‘ä»¬æƒ³è¯»å– store ä¸­çš„æ•°æ®ï¼ŒåŒæ—¶è¿˜è¦æ´¾å‘åŠ¨ä½œã€‚è¿™ä¸ªç»„ä»¶è¦æ¥æ”¶ä¸‰ä¸ªå±æ€§: <code>valueã€add å’Œ subtract</code>ã€‚</p><p>æœ€åè¦å®Œæˆçš„å°±æ˜¯ App ç»„ä»¶ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œè¿›è¡Œåº”ç”¨çš„ç»„è£…ã€‚</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">function <span class="title">App</span><span class="params">(&#123; visible &#125;)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;VisibilityConnected /&gt;</span><br><span class="line">      &#123; visible &amp;&amp; &lt;CounterConnected /&gt; &#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> AppConnected = connect(</span><br><span class="line">  state =&gt; (&#123;</span><br><span class="line">    visible: getVisibility(state)</span><br><span class="line">  &#125;)</span><br><span class="line">)(App);</span><br></pre></td></tr></table></figure><p>å†ä¸€æ¬¡éœ€è¦å¯¹ç»„ä»¶è¿›è¡Œ connect æ“ä½œï¼Œå› ä¸ºæˆ‘ä»¬æƒ³è¦æ§åˆ¶è®¡æ•°å™¨çš„æ˜¾ç¤ºã€‚getVisibility é€‰æ‹©å™¨è¿”å›å¸ƒå°”å€¼ï¼Œå®ƒè¡¨ç¤ºæ˜¯å¦æ¸²æŸ“ CounterConnected ç»„ä»¶ã€‚</p><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>Redux æ˜¯ä¸€ç§å¾ˆæ£’çš„æ¨¡å¼ã€‚JavaScript ç¤¾åŒºå°†è¿™ç§ç†å¿µå‘æ‰¬ä¸‹å»ï¼Œå¹¶ä½¿ç”¨ä¸€äº›æ–°æœ¯è¯­å¯¹å…¶è¿›è¡Œäº†å¢å¼ºã€‚æˆ‘è®¤ä¸ºä¸€ä¸ªå…¸å‹çš„ Redux åº”ç”¨åº”è¯¥æ˜¯ä¸‹é¢è¿™æ ·çš„:</p><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/react_type/redux-reallife.jpg" alt="react"></p><p>é¡ºä¾¿ä¸€æï¼Œè¿˜æ²¡æœ‰ä»‹ç»è¿‡å‰¯ä½œç”¨ç®¡ç†ã€‚é‚£å°†æ˜¯å¦å¤–çš„æ–°ç¯‡ç« äº†ï¼Œå®ƒæœ‰è‡ªå·±çš„ç†å¿µå’Œè§£å†³æ–¹æ¡ˆã€‚</p><p>æˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼ŒRedux æœ¬èº«æ˜¯ä¸€ç§éå¸¸ç®€å•çš„æ¨¡å¼ã€‚å®ƒä¼ æˆäº†éå¸¸æœ‰ç”¨çš„æŠ€æœ¯ï¼Œä½†ä¸å¹¸çš„æ˜¯å…‰é å®ƒè‡ªèº«å¾€å¾€æ˜¯ä¸å¤Ÿçš„ã€‚æˆ‘ä»¬è¿Ÿæ—©è¦å¼•å…¥æ›´å¤šçš„æ¦‚å¿µæˆ–æ¨¡å¼ã€‚å½“ç„¶è¿™æ²¡æœ‰é‚£ä¹ˆç³Ÿç³•ï¼Œæˆ‘ä»¬åªæ˜¯å…ˆæèµ·è®¡åˆ’ä¸€ä¸‹ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://redux.js.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Redux&lt;/a&gt; æ˜¯ä¸€ä¸ªåº“ï¼Œå®ƒæ‰®æ¼”ç€çŠ¶æ€å®¹å™¨çš„è§’è‰²ï¼Œå¹¶è´Ÿè´£ç®¡ç†åº”ç”¨çš„æ•°æ®æµã€‚å®ƒæ˜¯ Dan Abramov åœ¨ 2015 å¹´çš„ ReactEurope å¼€å‘è€…å¤§ä¼šä¸Šæ¨å‡ºçš„ (&lt;a href=&quot;https://www.youtube.com/watch?v=xsSnOQynTHs&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;è§†é¢‘&lt;/a&gt;)ã€‚å®ƒç±»ä¼¼äº &lt;a href=&quot;https://github.com/krasimir/react-in-patterns/blob/master/book/chapter-8/README.md#flux-architecture-and-its-main-characteristics&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Flux æ¶æ„&lt;/a&gt; å¹¶æœ‰å¾ˆå¤šå…±åŒç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/react_d.png&quot; alt=&quot;React&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="React" scheme="https://duanruilong.github.io/categories/React/"/>
    
    
      <category term="Javascript" scheme="https://duanruilong.github.io/tags/Javascript/"/>
    
      <category term="React" scheme="https://duanruilong.github.io/tags/React/"/>
    
  </entry>
  
  <entry>
    <title>ES6æ”»ç•¥(äº”)</title>
    <link href="https://duanruilong.github.io/2018/05/29/ES6%E6%94%BB%E7%95%A5-%E4%BA%94/"/>
    <id>https://duanruilong.github.io/2018/05/29/ES6æ”»ç•¥-äº”/</id>
    <published>2018-05-29T14:50:35.000Z</published>
    <updated>2018-09-17T15:58:32.000Z</updated>
    
    <content type="html"><![CDATA[<p>ES6çš„æ”¹ç‰ˆï¼Œä¸»è¦æ˜¯é€šè¿‡å¼•å…¥JAVAç­‰é™æ€è¯­è¨€çš„ä¼˜ç§€æ€æƒ³æ¥è§£å†³è€ç‰ˆæœ¬çš„ä¸€äº›ç—¼ç–¾ï¼Œå¦‚ä½œç”¨åŸŸï¼Œå›è°ƒï¼Œç»§æ‰¿å’Œå°è£…ç­‰é—®é¢˜ã€‚è¿™äº›æ”¹é©æªæ–½æ˜¯éå¸¸æˆåŠŸçš„ï¼ŒES6è®©JSçœŸæ­£å˜æˆäº†ä¸€ç§å¥½ç”¨çš„è¯­è¨€ã€‚è¿™é‡Œæ˜¯å…³äºä¸€äº›å¯¼å‡ºæ¨¡å—ã€‚</p><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/es6_d.png" alt="ES6æ”»ç•¥"></p><a id="more"></a><h1 id="æ•°ç»„æ‰©å±•"><a href="#æ•°ç»„æ‰©å±•" class="headerlink" title="æ•°ç»„æ‰©å±•"></a>æ•°ç»„æ‰©å±•</h1><h2 id="forEach-æ–¹æ³•"><a href="#forEach-æ–¹æ³•" class="headerlink" title="forEach()æ–¹æ³•"></a>forEach()æ–¹æ³•</h2><p>è¿™ä¸ªæ–¹æ³•å…¶å®æ˜¯<code>es5</code>çš„ï¼Œè¿˜æ˜¯å¾ˆå¥½ç”¨çš„ã€‚<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var arr = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>];</span><br><span class="line"><span class="comment">//éå†æ•°ç»„</span></span><br><span class="line">arr.forEach(function(val)&#123;</span><br><span class="line"> console.<span class="built_in">log</span>(val);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><h2 id="Array-from-æ–¹æ³•"><a href="#Array-from-æ–¹æ³•" class="headerlink" title="Array.from()æ–¹æ³•"></a>Array.from()æ–¹æ³•</h2><p>å®ƒæ˜¯å°†ä¸¤ç±»å¯¹è±¡è£…æ¢ä¸ºçœŸçš„æ•°ç»„ï¼š<code>ç±»æ•°ç»„å¯¹è±¡arguments</code>ã€<code>å¯éå†å¯¹è±¡</code>ï¼ˆå¯æ•°Objectã€Setã€Map).</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">let myObj = &#123;length:2,'0':'hello','1':'world'&#125;;</span><br><span class="line">console.<span class="built_in">log</span>(Array.from(myObj));</span><br><span class="line"><span class="comment">//[ 'hello', 'world' ]</span></span><br><span class="line"></span><br><span class="line">&lt;!-- Set --&gt;</span><br><span class="line"></span><br><span class="line">let mySet = <span class="keyword">new</span> Set([<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]);</span><br><span class="line">mySet.add('hello');</span><br><span class="line">mySet.add('hello');</span><br><span class="line">mySet.add(NaN);</span><br><span class="line">mySet.add(NaN);</span><br><span class="line">mySet.add(undefined);</span><br><span class="line">mySet.add(undefined);</span><br><span class="line">console.<span class="built_in">log</span>(Array.from(mySet));</span><br><span class="line"><span class="comment">//[ 1, 2, 3, 'hello', NaN, undefined ]</span></span><br><span class="line"></span><br><span class="line">&lt;!-- Map --&gt;</span><br><span class="line">let myMap = <span class="keyword">new</span> Map();</span><br><span class="line">myMap.set(0,'hello');</span><br><span class="line">myMap.set(true,'world');</span><br><span class="line">myMap.set(1,'haha');</span><br><span class="line">console.<span class="built_in">log</span>(Array.from(myMap));</span><br><span class="line"><span class="comment">//[ [ 0, 'hello' ], [ true, 'world' ], [ 1, 'haha' ] ]</span></span><br><span class="line"></span><br><span class="line">&lt;!-- arguments --&gt;</span><br><span class="line"><span class="function">function <span class="title">foo</span><span class="params">()</span></span>&#123;</span><br><span class="line">console.<span class="built_in">log</span>(Array.from(arguments));</span><br><span class="line">&#125;</span><br><span class="line">foo(<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>);</span><br><span class="line"><span class="comment">//[ 1, 3, 5 ]</span></span><br></pre></td></tr></table></figure><h2 id="find-å’Œfindindex"><a href="#find-å’Œfindindex" class="headerlink" title="find()å’Œfindindex()"></a>find()å’Œfindindex()</h2><p><code>find()</code>æŸ¥æ‰¾æ•°ç»„é‡Œç¬¦åˆæ¡ä»¶çš„<code>ç¬¬ä¸€ä¸ªå€¼</code><br><code>findindex()</code>æ˜¯æŸ¥æ‰¾æ•°ç»„é‡Œç¬¦åˆæ¡ä»¶çš„ç¬¬ä¸€ä¸ªç´¢å¼•çš„<code>ä¸‹æ ‡</code></p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;!-- find() --&gt;</span><br><span class="line">console.<span class="built_in">log</span>([<span class="number">-1</span>, <span class="number">4</span>, <span class="number">-5</span>, <span class="number">10</span>].find((n) =&gt; n &lt; <span class="number">2</span>));</span><br><span class="line"><span class="comment">// -1</span></span><br><span class="line"></span><br><span class="line">&lt;!-- findindex() --&gt;</span><br><span class="line">console.<span class="built_in">log</span>([<span class="number">1</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">15</span>].findIndex(function(value, index, arr) &#123;</span><br><span class="line"> <span class="keyword">return</span> value &gt; <span class="number">4</span>;</span><br><span class="line"> <span class="comment">//5è¿™ä¸ªå€¼çš„ç´¢å¼•ä¸‹æ ‡æ˜¯1</span></span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1</span></span><br></pre></td></tr></table></figure><h2 id="fill-å¡«å……æ–¹æ³•"><a href="#fill-å¡«å……æ–¹æ³•" class="headerlink" title="fill()å¡«å……æ–¹æ³•"></a>fill()å¡«å……æ–¹æ³•</h2><p>å°†<code>ç©ºæ•°ç»„</code>å¡«å……å›ºå®šçš„æŸä¸€ä¸ªå€¼ã€‚</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">console.<span class="built_in">log</span>(<span class="keyword">new</span> Array(<span class="number">4</span>));</span><br><span class="line"><span class="comment">//[ , , , ]</span></span><br><span class="line">console.<span class="built_in">log</span>(<span class="keyword">new</span> Array(<span class="number">4</span>).fill(<span class="number">2</span>));</span><br><span class="line"><span class="comment">//[2, 2, 2, 2]</span></span><br></pre></td></tr></table></figure><h2 id="lterator-éå†å™¨"><a href="#lterator-éå†å™¨" class="headerlink" title="lterator éå†å™¨"></a>lterator éå†å™¨</h2><p>ä½¿ç”¨æœ€å¤šçš„éå†å™¨æ˜¯ï¼š<code>for...in</code>å’Œ<code>for</code><br>å‰è€…æ˜¯å¾ªç¯éå†<code>Object</code>å¯¹è±¡ï¼Œåè€…æ˜¯éå†æ•°ç»„<br>åœ¨<code>ES6</code>é‡Œåˆæ–°å¢åŠ äº†2ç§æ•°æ®ç»“æ„ï¼š<code>Set</code>å’Œ<code>Map</code>ã€‚è¿™é‡Œå°±ç”¨åˆ°äº†<code>lterator</code>ï¼Œä»–å…¶å®å°±æ˜¯é“¾è¡¨ç»“æ„ï¼Œæ¯ä¸€ä¸ªå¯¹è±¡è®°å½•å®ƒä¸‹ä¸ªå¯¹è±¡çš„ä½ç½®ï¼Œä¸€ä¸ªä¸€ä¸ªè¿æˆä¸²ã€‚ä»–ä»¬äºŒè€…çš„åŸç†æ˜¯åˆ©ç”¨<code>for....of</code>å¾ªç¯ã€‚</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">let myMap = <span class="keyword">new</span> Map();</span><br><span class="line">myMap.set(0,'hello');</span><br><span class="line">myMap.set(1,'world');</span><br><span class="line">myMap.set('hi','jack');</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(let v of myMap)&#123;</span><br><span class="line"> console.<span class="built_in">log</span>(v);</span><br><span class="line"> console.log(v[0]+'--'+v[1]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    [0, "hello"]</span></span><br><span class="line"><span class="comment">    0--hello</span></span><br><span class="line"><span class="comment">    [1, "world"]</span></span><br><span class="line"><span class="comment">    1--world</span></span><br><span class="line"><span class="comment">    ["hi", "jack"]</span></span><br><span class="line"><span class="comment">    hi--jack</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">let mySet = <span class="keyword">new</span> Set([<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(let v of mySet)&#123;</span><br><span class="line"> console.<span class="built_in">log</span>(v);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    1</span></span><br><span class="line"><span class="comment">    3</span></span><br><span class="line"><span class="comment">    5</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h2 id="Module"><a href="#Module" class="headerlink" title="Module"></a>Module</h2><p><code>Module</code>å®ƒå¯ä»¥è®©JSå˜æˆä¸€ä¸ªä¸ªå¯ä»¥æ‹†åˆ†çš„å…ˆæ–‡ä»¶ï¼Œç„¶åé€šè¿‡ç®€å•çš„æ–¹æ‹¼æ¥èµ·æ¥ï¼Œæå¤§çš„å¢å¤§äº†çµæ´»æ€§ã€‚å®ƒçš„ä¸€äº›å…³é”®å­—æ˜¯é»˜è®¤çš„ï¼Œå¯ä»¥å¿½ç•¥ã€‚</p><p>è¿™é‡Œéœ€è¦æ³¨æ„ï¼š<br><code>Node</code>ç¯å¢ƒä¸‹ä½¿ç”¨<code>export</code>å’Œ<code>require</code><br><code>å‰ç«¯JS</code>ç¯å¢ƒä¸‹ä½¿ç”¨<code>export</code>å’Œ<code>import</code>(éœ€è¦babelç­‰å·¥å…·æ¥è§£æ)</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- foo.js --&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¯¼å‡ºæ–¹æ³•</span></span><br><span class="line"><span class="keyword">module</span>.exports.sayHi = function()&#123;</span><br><span class="line"> console.log('hello,world');</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//å¯¼å‡ºå¯¹è±¡</span></span><br><span class="line"><span class="keyword">module</span>.exports.obj = &#123;<span class="string">'a'</span>:<span class="number">1</span>,<span class="string">'b'</span>:<span class="number">2</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> &#123;</span></span><br><span class="line"> constructor( name)&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line"> &#125;</span><br><span class="line"> eat() &#123;</span><br><span class="line">  console.log(this.name+' eat');</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¯¼å‡ºä¸€ä¸ªç±»</span></span><br><span class="line"><span class="keyword">module</span>.exports.Person = Person;</span><br></pre></td></tr></table></figure><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- text.js --&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¼•å…¥æ¨¡å—</span></span><br><span class="line">var text = require('./foo.js');</span><br><span class="line"><span class="comment">//ä½¿ç”¨æ¨¡å—</span></span><br><span class="line">text.sayHi();</span><br><span class="line">console.<span class="built_in">log</span>(text.obj.a);</span><br><span class="line"></span><br><span class="line">var p = new text.Person('jack');</span><br><span class="line">p.eat();</span><br></pre></td></tr></table></figure><p>åœ¨se6çš„è¯­æ³•ä¸‹ï¼Œéœ€è¦babel çš„æ”¯æŒã€‚<br>1ã€å®‰è£…</p><p><code>npm install   babel-preset-es2015</code><br><code>npminstall --global  babel-cli</code></p><p>2ã€é…ç½®.babelrcæ–‡ä»¶</p><p><code>{&quot;presets&quot;:[&quot;es2015&quot;]}</code></p><p>3ã€æµ‹è¯•ä¸€ä¸‹</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- <span class="keyword">export</span>.js --&gt;</span><br><span class="line"></span><br><span class="line">var yourname = 'Jack';</span><br><span class="line">var age = <span class="number">18</span>;</span><br><span class="line"><span class="keyword">export</span> &#123;yourname, age&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- <span class="keyword">import</span>.js --&gt;</span><br><span class="line"></span><br><span class="line">import &#123;yourname, age&#125; from './export.js';</span><br><span class="line"><span class="function">function <span class="title">say</span><span class="params">()</span> </span>&#123;</span><br><span class="line"> console.<span class="built_in">log</span>(yourname,age);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4ã€è¿è¡Œ</p><p><code>babel export.js --out-file export_out.js</code><br><code>babel import.js --out-file import_out.js</code></p><p>è¿è¡Œç»“æŸä¹‹åï¼Œç›®å½•ä¸‹å¢åŠ äº†2ä¸ªè¾“å‡ºæ–‡ä»¶ï¼Œ<code>export_out.js</code>å’Œ<code>import_out.js</code></p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--  export_out.js--&gt;</span><br><span class="line"></span><br><span class="line">'use strict';</span><br><span class="line"></span><br><span class="line">Object.defineProperty(exports, <span class="string">"__esModule"</span>, &#123;</span><br><span class="line">value: <span class="literal">true</span></span><br><span class="line">&#125;);</span><br><span class="line">var yourname = 'Jack';</span><br><span class="line">var age = <span class="number">18</span>;</span><br><span class="line"></span><br><span class="line">exports.yourname = yourname;</span><br><span class="line">exports.age = age;</span><br></pre></td></tr></table></figure><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- import_out.js --&gt;</span><br><span class="line"></span><br><span class="line">'use strict';</span><br><span class="line"></span><br><span class="line">var _export = require('./export.js');</span><br><span class="line"></span><br><span class="line"><span class="function">function <span class="title">say</span><span class="params">()</span> </span>&#123;</span><br><span class="line"> console.<span class="built_in">log</span>(_export.yourname, _export.age);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶å®ç¿»è¯‘è¿‡æ¥åï¼Œä»æ—§æ˜¯<code>exports</code>å’Œ<code>require</code>ï¼</p><p>5ã€åœ¨å‰ç«¯æµ‹è¯•text.html</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;æµ‹è¯•ä¸€ä¸‹&lt;/title&gt;</span><br><span class="line">&lt;script src=<span class="string">"./import_out.js"</span>&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div&gt;&lt;/div&gt;ã€€ã€€ã€€</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    say();</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>è¿™æ ·æ˜¯è¿è¡Œä¸äº†çš„ï¼Œä»–ä»¬ç¯å¢ƒéƒ½ä¸ä¸€æ ·ï¼Œæ€ä¹ˆå¯èƒ½è¿è¡Œã€‚<br><code>babel</code>åªæ˜¯ä¸€ä¸ªç¼–è¯‘å·¥å…·ï¼Œè¿™é‡Œåªæ˜¯æŠŠes6ç¼–è¯‘ä¸º<code>common.js</code>è§„èŒƒçš„è¯­æ³•ï¼Œ<code>require</code>è¿™ä¸ªå…³é”®å­—å±äºcommomJSèŒƒç•´ï¼Œå¹¶ä¸æ˜¯å‰ç«¯åŸç”Ÿçš„JS,ä¹Ÿå°±æ— æ³•è¯†åˆ«ã€‚</p><blockquote><p>commonã€cmdã€amd:<br><code>cmd</code>æ˜¯seajséµå¾ªçš„è§„èŒƒ<br><code>amd</code>æ˜¯requirejséµå¾ªçš„è§„èŒƒ<br><code>commomJS</code>æ˜¯nodeéµå¾ªçš„è§„èŒƒ</p></blockquote><p>å°±éœ€è¦åŠ å…¥<code>webpack</code>.</p><h2 id="webpack"><a href="#webpack" class="headerlink" title="webpack"></a>webpack</h2><p>1ã€å®‰è£…<br><code>npm install webpack -g (å…¨å±€å®‰è£…)</code><br><code>npm install webpack (æœ¬åœ°å®‰è£…)</code></p><p>2ã€è¿è¡Œç¼–è¯‘<br><code>webpack import_out.js bundle.js</code></p><p>å› ä¸ºæˆ‘ä»¬å·²ç»å¯¹import_out.jsä½¿ç”¨babelç¼–è¯‘è¿‡äº†ï¼Œæ‰€ä»¥åªéœ€è¦ä½¿ç”¨WebpackæŠŠcommonJSè§„èŒƒè¿™ä¸ªæ–‡ä»¶ï¼Œç¼–è¯‘æˆæµè§ˆå™¨è¯†åˆ«çš„æ–‡ä»¶ã€‚</p><p>3ã€ å†ä¸€æ¬¡æµ‹è¯•test.html</p><blockquote><p>ä¼šæœ‰é”™è¯¯æŠ›å‡ºï¼šsay is not defined</p></blockquote><p>è¿™ä¸ªå…¶å®æ˜¯æ¨¡å—åŒ–çš„é—®é¢˜ï¼Œ<code>say()</code>æ–¹æ³•çš„å­˜æ´»ç©ºé—´åªå­˜åœ¨æ¨¡å—å†…ï¼Œä¹Ÿå°±æ˜¯Webpackè§£æåçš„è‡ªæ‰§è¡Œå‡½æ•°é‡Œï¼Œè¿™æ ·çš„å¥½å¤„å°±æ˜¯é¿å…äº†å…¨å±€å˜é‡çš„æ±¡æŸ“ï¼Œåœ¨bundle.jsæ–‡ä»¶ä¸‹æœ‰<br><code>(function(modules) { ....... })();</code> è¿™å°±æ˜¯ä¸€ä¸ªè‡ªæ‰§è¡Œçš„å°é—­ç©ºé—´ã€‚<br>å¦‚æœéœ€è¦åœ¨å¤–éƒ¨è°ƒç”¨say()è¿™ä¸ªæ–¹æ³•ï¼Œåªéœ€è¦æŠŠå®ƒæš´éœ²åœ¨å…¨å±€å°±å¥½äº†ã€‚<br>webpackæœ‰ä¸ª<code>expose-loader</code>è¿™ä¸ªæ’ä»¶ï¼Œå¯ä»¥å°†jqueryçš„$æš´éœ²åˆ°å…¨å±€ï¼Œä»¥æ­¤ç±»æ¨ï¼ŒæŠŠsay()æ–¹æ³•æŒ‚åˆ°windowä¸‹é¢å°±okäº†ã€‚æˆ‘ä»¬ç›´æ¥ä¿®æ”¹babelç¿»è¯‘è¿‡çš„æ–‡ä»¶import_out.js:<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">'use strict';</span><br><span class="line"></span><br><span class="line">var _export = require('./export.js');</span><br><span class="line"></span><br><span class="line"><span class="function">function <span class="title">say</span><span class="params">()</span> </span>&#123;</span><br><span class="line">console.<span class="built_in">log</span>(_export.yourname, _export.age);</span><br><span class="line">&#125;</span><br><span class="line">&lt;!-- æŠŠsay()æ–¹æ³•æŒ‚åˆ°windowä¸‹é¢ --&gt;</span><br><span class="line">window.say = say;</span><br></pre></td></tr></table></figure></p><p>ç„¶åå†è¿è¡Œä¸€ä¸‹webpackå‘½ä»¤ï¼š<br><code>webpack import_out.js bundle.js</code><br>å¥½å•¦ï¼Œä½ å†è¿è¡Œä¸‹test.htmlï¼Œå‘ç°ç»ˆäºæˆåŠŸå•¦ï¼</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>å…¶å®webpacké›†æˆäº†babelç¿»è¯‘çš„ç›¸å…³å·¥ä½œï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦è¿™ä¹ˆéº»çƒ¦æ‹†åˆ†å‡ºæ¥ã€‚ä¸è¿‡ä¸ºäº†ææ¸…æ¥šä»–ä»¬å„è‡ªçš„å·¥ä½œåŸç†ï¼Œè¿˜æ˜¯éœ€è¦è¿™æ ·çš„æ‹†åˆ†ã€‚</p><blockquote><p>å‚è€ƒåŸæ–‡ï¼š<a href="https://mp.weixin.qq.com/mp/homepage?__biz=MzIzMTU4MzMzOQ==&amp;hid=13&amp;sn=7b07c59cafcf19e4805a803bf9f34347&amp;scene=1&amp;devicetype=android-26&amp;version=26060637&amp;lang=zh_CN&amp;nettype=WIFI&amp;ascene=7&amp;session_us=gh_be748ba8c36a&amp;wx_header=1" target="_blank" rel="noopener">ES6æ”»ç•¥</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ES6çš„æ”¹ç‰ˆï¼Œä¸»è¦æ˜¯é€šè¿‡å¼•å…¥JAVAç­‰é™æ€è¯­è¨€çš„ä¼˜ç§€æ€æƒ³æ¥è§£å†³è€ç‰ˆæœ¬çš„ä¸€äº›ç—¼ç–¾ï¼Œå¦‚ä½œç”¨åŸŸï¼Œå›è°ƒï¼Œç»§æ‰¿å’Œå°è£…ç­‰é—®é¢˜ã€‚è¿™äº›æ”¹é©æªæ–½æ˜¯éå¸¸æˆåŠŸçš„ï¼ŒES6è®©JSçœŸæ­£å˜æˆäº†ä¸€ç§å¥½ç”¨çš„è¯­è¨€ã€‚è¿™é‡Œæ˜¯å…³äºä¸€äº›å¯¼å‡ºæ¨¡å—ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/es6_d.png&quot; alt=&quot;ES6æ”»ç•¥&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="ES6" scheme="https://duanruilong.github.io/categories/ES6/"/>
    
    
      <category term="Javascript" scheme="https://duanruilong.github.io/tags/Javascript/"/>
    
      <category term="ç¼–ç¨‹" scheme="https://duanruilong.github.io/tags/%E7%BC%96%E7%A8%8B/"/>
    
      <category term="ES6" scheme="https://duanruilong.github.io/tags/ES6/"/>
    
  </entry>
  
  <entry>
    <title>ES6æ”»ç•¥(å››)</title>
    <link href="https://duanruilong.github.io/2018/05/29/ES6%E6%94%BB%E7%95%A5-%E5%9B%9B/"/>
    <id>https://duanruilong.github.io/2018/05/29/ES6æ”»ç•¥-å››/</id>
    <published>2018-05-28T16:09:06.000Z</published>
    <updated>2018-09-17T15:58:32.000Z</updated>
    
    <content type="html"><![CDATA[<p>ES6çš„æ”¹ç‰ˆï¼Œä¸»è¦æ˜¯é€šè¿‡å¼•å…¥JAVAç­‰é™æ€è¯­è¨€çš„ä¼˜ç§€æ€æƒ³æ¥è§£å†³è€ç‰ˆæœ¬çš„ä¸€äº›ç—¼ç–¾ï¼Œå¦‚ä½œç”¨åŸŸï¼Œå›è°ƒï¼Œç»§æ‰¿å’Œå°è£…ç­‰é—®é¢˜ã€‚è¿™äº›æ”¹é©æªæ–½æ˜¯éå¸¸æˆåŠŸçš„ï¼ŒES6è®©JSçœŸæ­£å˜æˆäº†ä¸€ç§å¥½ç”¨çš„è¯­è¨€ã€‚è¿™é‡Œæ˜¯å…³äºReflectå’ŒProxyã€‚</p><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/es6_d.png" alt="ES6æ”»ç•¥"></p><a id="more"></a><h1 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h1><p>ä¹‹å‰çš„JSåªæä¾›äº†ä¸¤ç§å®¹å™¨ï¼š<code>æ•°ç»„</code>å’Œ<code>å¯¹è±¡</code>ã€‚es6åˆæ·»åŠ äº†å¦ä¸€ç§éå¸¸æœ‰ç”¨çš„æ•°æ®ç»“æ„ï¼š<code>Set</code>ã€‚ä»–å°±æ˜¯<code>é›†åˆ</code>çš„æ„æ€ï¼Œæœ¬èº«ä¹Ÿæ˜¯ä¸€ç§å®¹å™¨ã€‚<br>æ—¢ç„¶æ˜¯å®¹å™¨ï¼Œè‚¯å®šæœ‰å¯¹åº”çš„å¢æŸ¥æ”¹åˆ çš„æ“ä½œäº†ã€‚å¢æŸ¥æ”¹åˆ æ˜¯å®¹å™¨å¿…å¤‡çš„èŒèƒ½ã€‚é‚£ä¹ˆè¿™ç§æ–°å¼å®¹å™¨ï¼Œåˆ°åº•æœ‰ä»€ä¹ˆç‰¹ç‚¹å‘¢ï¼Ÿ<br>æ‹¿ä»–è·Ÿæ•°ç»„æ¯”è¾ƒçš„è¯ï¼Œ<code>Set</code>çš„æœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯<code>æ¯ä¸ªå€¼éƒ½æ˜¯å”¯ä¸€çš„ï¼Œä¸èƒ½æœ‰é‡å¤å€¼</code>ã€‚ç»å¸¸ä¼šé‡åˆ°æ•°ç»„å»é‡çš„é—®é¢˜å§ï¼Ÿè‡ªä»æœ‰äº†Setï¼Œå°±å¼€å§‹å˜å¾—ç¾å¥½äº†ã€‚</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">let container = <span class="keyword">new</span> Set([<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">4</span>]);<span class="comment">//å¯ä»¥ç›´æ¥ä¼ å…¥æ•°ç»„è¿›è¡Œåˆå§‹åŒ–</span></span><br><span class="line">container.add(<span class="number">5</span>);<span class="comment">//æ·»åŠ å…ƒç´ </span></span><br><span class="line">container.<span class="keyword">delete</span>(<span class="number">5</span>);<span class="comment">//åˆ é™¤å…ƒç´ </span></span><br><span class="line">console.<span class="built_in">log</span>(container.has(<span class="number">5</span>));<span class="comment">//falseï¼Œ5è¿™ä¸ªå…ƒç´ è¢«åˆ é™¤äº†</span></span><br><span class="line">console.<span class="built_in">log</span>(container);<span class="comment">//Set &#123; 1, 2, 3, 4 &#125;</span></span><br><span class="line">console.<span class="built_in">log</span>(container.size);<span class="comment">//é•¿åº¦4</span></span><br><span class="line">let unique_arr = [...container];<span class="comment">//çœç•¥å·è¯­æ³•</span></span><br><span class="line">console.<span class="built_in">log</span>(unique_arr);<span class="comment">//å”¯ä¸€å€¼æ•°ç»„ï¼š[ 1, 2, 3, 4 ]</span></span><br></pre></td></tr></table></figure><p>Setçš„æ„é€ æ–¹æ³•å¯ä»¥ç›´æ¥ä¼ æ•°ç»„è¿›è¡Œåˆå§‹åŒ–ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥è¿™æ ·å£°æ˜ï¼š<br><code>let mySet = new Set();</code></p><p>Setè·Ÿæ•°ç»„æä¸ºç±»ä¼¼ï¼ŒäºŒè€…å¯ä»¥äº’ç›¸è½¬æ¢ç€ç”¨ã€‚æœ‰äº†å®ƒï¼Œå°±å¯ä»¥è½»æ¾çš„è§£å†³æ•°ç»„å»é‡é—®é¢˜äº†ã€‚</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç®€å•å»é‡æ–¹æ¡ˆ</span></span><br><span class="line">var arr = [<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>];</span><br><span class="line">console.<span class="built_in">log</span>([...<span class="keyword">new</span> Set(arr)]);<span class="comment">//ä¸€å¥è¯æå®š</span></span><br></pre></td></tr></table></figure><p>è¿™å¹¶ä¸é€‚ç”¨äºå«æœ‰<code>é‡å¤å¯¹è±¡çš„æ•°ç»„</code>ï¼Œå› ä¸ºå¯¹è±¡æ˜¯æ¯”è¾ƒçš„æ˜¯å†…å­˜åœ°å€ã€‚<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">console.<span class="built_in">log</span>(&#123;&#125;==&#123;&#125;);<span class="comment">//false,å†…å­˜åœ°å€ä¸åŒ</span></span><br><span class="line">let arr = [&#123;&#125;,&#123;&#125;,&#123;&#125;];</span><br><span class="line">console.<span class="built_in">log</span>([...<span class="keyword">new</span> Set(arr)]);<span class="comment">//å¯¹è±¡æ˜¯æ— æ³•å»é‡çš„</span></span><br></pre></td></tr></table></figure></p><p>å¯¹è±¡æ•°ç»„åˆ°åº•å¦‚ä½•å»é‡å‘¢ï¼Ÿ<br>ä¸€ç§åŠæ³•æ˜¯ä½ éœ€è¦é€’å½’æ¯”è¾ƒï¼Œä¸¤ä¸ªå¯¹è±¡çš„æ¯ä¸€ä¸ªå€¼æ˜¯å¦ç›¸ç­‰ï¼Œä¸ç­‰çš„æ”¾å…¥ä¸€ä¸ªæ–°æ•°ç»„ä¸­ï¼Œç›¸ç­‰çš„è·³è¿‡ã€‚ä½†æ˜¯è¿™ä¸ªæ–¹æ³•å¾ˆæ™®é€šï¼Œå¯ä»¥åˆ©ç”¨<code>Set</code>çš„ä¸é‡å¤ç‰¹æ€§ï¼ŒæŠŠå¯¹è±¡å…ˆè½¬æˆå­—ç¬¦ä¸²å­˜å…¥<code>Set</code>ï¼Œå»æ‰é‡å¤å€¼åï¼Œå†è½¬å›æ¥å°±å¥½ã€‚</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">function <span class="title">unique</span><span class="params">(arr)</span></span>&#123;</span><br><span class="line"> var container = <span class="keyword">new</span> Set();</span><br><span class="line"><span class="comment">//éå†</span></span><br><span class="line"> arr.forEach(function(val)&#123;</span><br><span class="line"><span class="comment">//å°†å¯¹è±¡è½¬æ¢ä¸ºå­—ç¬¦ä¸²,å­˜å…¥setå®¹å™¨ä¸­ï¼Œç¡®ä¿å”¯ä¸€æ€§ã€‚</span></span><br><span class="line">  container.add(JSON.stringify(val));</span><br><span class="line"> &#125;);</span><br><span class="line"></span><br><span class="line"> var newarr = [...container].<span class="built_in">map</span>(function(item)&#123;</span><br><span class="line">   <span class="keyword">return</span> JSON.parse(item);<span class="comment">//è½¬æ¢å›å»</span></span><br><span class="line">  &#125;);</span><br><span class="line"> <span class="keyword">return</span> newarr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ–°æ•°æ®ç»“æ„ï¼šMap"><a href="#æ–°æ•°æ®ç»“æ„ï¼šMap" class="headerlink" title="æ–°æ•°æ®ç»“æ„ï¼šMap"></a>æ–°æ•°æ®ç»“æ„ï¼šMap</h1><p>è¿™ä¸ªæ˜¯<code>Map</code>å®¹å™¨ï¼Œè€Œä¸æ˜¯å‰é¢çš„<code>map()</code>æ–¹æ³•ï¼Œåƒä¸‡åˆ«å¼„æ··äº†ï¼ˆæ³¨æ„å¤§å°å†™ï¼‰ï¼<code>Map</code>å°±æ˜¯é”®å€¼å¯¹å®¹å™¨ï¼Œè·Ÿ<code>Object</code>éå¸¸ç±»ä¼¼ã€‚å®ƒæœ‰ä»€ä¹ˆç‰¹åˆ«ä¹‹å¤„å‘¢ï¼Ÿ<br>å…¶å®<code>Object</code>æœ‰ä¸ªå¾ˆå¤§çš„é—®é¢˜ï¼šå°±æ˜¯é”®åªèƒ½ç”¨å­—ç¬¦ä¸²ï¼Œè€Œä¸èƒ½ä½¿ç”¨å…¶ä»–æ•°æ®ç±»å‹ã€‚<br>å¦‚æœè®©é”®ä¸é™äºå­—ç¬¦ä¸²ï¼Œè€Œæ˜¯å„ç§æ•°æ®ç±»å‹å‘¢ï¼Ÿæ¯”å¦‚numï¼Ÿ</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;<span class="built_in">map</span>&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;button id=<span class="string">"btn1"</span>&gt;æäº¤&lt;/button&gt;</span><br><span class="line">            &lt;button id=<span class="string">"btn2"</span>&gt;å…³é—­&lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;ã€€ã€€ã€€</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    var dom1 = document.getElementById('btn1');</span><br><span class="line">    var dom2 = document.getElementById('btn2');</span><br><span class="line"></span><br><span class="line">    var callback1 = function()&#123;</span><br><span class="line">        alert('æäº¤');</span><br><span class="line">    &#125;;</span><br><span class="line">    var callback2 = function()&#123;</span><br><span class="line">        alert('å…³é—­');</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">const</span> m = <span class="keyword">new</span> Map();</span><br><span class="line">    m.<span class="built_in">set</span>(dom1,callback1); <span class="comment">//é”®æ˜¯dom</span></span><br><span class="line">    m.<span class="built_in">set</span>(dom2,callback2);</span><br><span class="line">    console.<span class="built_in">log</span>(m);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p><img src="http://mmbiz.qpic.cn/mmbiz_png/amhuPdMsm1nZRR0oA8QqZfcQGqUNYUJzkRiclCN5500iaJhsyUpyjt8bu7xM47zaUoDJibSN1iazVaKN9wQjLkctgw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt="ç»“æœï¼š"></p><p>ä¸€èˆ¬æ¥è¯´ï¼Œå¯¹è±¡çš„é”®åº”è¯¥æ˜¯å”¯ä¸€çš„ã€‚Objectçš„é”®å› ä¸ºæ˜¯å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥æ²¡å•¥é—®é¢˜ï¼Œä½†Mapæ—¢ç„¶æ”¾å¼€äº†ç±»å‹é™åˆ¶ï¼Œè¿™å°±å¾—æ³¨æ„äº†</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="built_in">map</span> = <span class="keyword">new</span> Map();</span><br><span class="line"><span class="built_in">map</span>.<span class="built_in">set</span>([<span class="string">'a'</span>], <span class="number">555</span>);</span><br><span class="line"><span class="built_in">map</span>.get([<span class="string">'a'</span>]) <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure><p>å› ä¸ºå¯¹è±¡æ¯”è¾ƒçš„æ˜¯å†…å­˜åœ°å€ï¼Œæ‰€ä»¥<code>[&#39;a&#39;]</code>ä½œä¸ºæ–°å¼€è¾Ÿçš„ç©ºé—´ï¼Œæ— æ³•åœ¨<code>Mapå®¹å™¨</code>ä¸­æ‰¾åˆ°ã€‚</p><p>å†æ¥çœ‹ä¸€ä¸‹Mapçš„å¢æŸ¥æ”¹åˆ ï¼Œéå¸¸ç®€å•ã€‚</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ©ç”¨äºŒç»´æ•°ç»„ï¼Œå¯ä»¥æ„å»ºMap</span></span><br><span class="line"><span class="keyword">const</span> myMap = <span class="keyword">new</span> Map([</span><br><span class="line"> ['name', 'å¼ ä¸‰'],</span><br><span class="line"> ['content', 'hello,world']</span><br><span class="line">]);</span><br><span class="line">console.<span class="built_in">log</span>(myMap);<span class="comment">//Map &#123; 'name' =&gt; 'å¼ ä¸‰', 'content' =&gt; 'hello,world' &#125;</span></span><br><span class="line">console.<span class="built_in">log</span>(myMap.size); <span class="comment">// é•¿åº¦</span></span><br><span class="line">myMap.set('age',18);//å¢åŠ å±æ€§</span><br><span class="line">console.log(myMap.get('name')); //è·å–å±æ€§</span><br><span class="line">myMap.delete('content');//åˆ é™¤å±æ€§</span><br><span class="line">console.log(myMap.has('content')); // åˆ¤æ–­æ˜¯å¦æœ‰è¿™ä¸ªå±æ€§</span><br><span class="line">console.<span class="built_in">log</span>(myMap.keys());<span class="comment">//è·å–æ‰€æœ‰çš„é”® MapIterator &#123; 'name', 'age' &#125;</span></span><br><span class="line">console.<span class="built_in">log</span>(myMap.values());<span class="comment">//è·å–æ‰€æœ‰çš„å€¼ MapIterator &#123; 'å¼ ä¸‰', 18 &#125;</span></span><br></pre></td></tr></table></figure><p>è·å–çš„keysé›†åˆæ˜¯<code>MapIterator</code>ç±»å‹çš„ï¼Œè¿™å«éå†å™¨ã€‚é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ä¸“ä¾›éå†ç”¨çš„ä¸€ç§æ•°æ®ç»“æ„</p><h1 id="Reflectæ˜¯é¢é•œå­"><a href="#Reflectæ˜¯é¢é•œå­" class="headerlink" title="Reflectæ˜¯é¢é•œå­"></a>Reflectæ˜¯é¢é•œå­</h1><p><code>Reflect</code>å°±æ˜¯åå°„çš„æ„æ€ï¼Œé‚£ç©¶ç«Ÿåå°„å•¥å‘¢ï¼Ÿ<br>å¤§å®¶çŸ¥é“é•œå­å¯ä»¥åå°„å§ï¼Ÿ<br><code>Reflect</code>å°±æ˜¯ä¸€é¢é•œå­ã€‚é‚£æ˜¯è°ç…§é•œå­å‘¢ï¼Ÿå°±æ˜¯<code>Object</code>ã€‚<br>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>Object</code>æŠŠè‡ªå·±çš„å±äºè¯­è¨€å†…éƒ¨çš„æ–¹æ³•ï¼ˆæ¯”å¦‚Object.definePropertyï¼‰ç…§åˆ°äº†<code>Reflect</code>ä¸Šã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;åˆ©ç”¨åå°„å®ç°æ•°æ®å’Œè§†å›¾è”åŠ¨&lt;/title&gt;</span><br><span class="line"></span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">&lt;div&gt;æµ‹è¯•Objectï¼š&lt;input type="text" id='userName'/&gt;&lt;/div&gt;</span><br><span class="line">&lt;div&gt;æµ‹è¯•Reflectï¼š&lt;input type="text" id='age'/&gt;&lt;/div&gt;</span><br><span class="line">&lt;div id=<span class="string">"showName"</span>&gt;&lt;/div&gt;</span><br><span class="line">&lt;div id=<span class="string">"showAge"</span>&gt;&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;ã€€ã€€ã€€</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">var userInfo = &#123;&#125;;</span><br><span class="line"><span class="comment">//Objectçš„æ–¹å¼</span></span><br><span class="line">Object.defineProperty(userInfo, <span class="string">"userName"</span>, &#123;</span><br><span class="line">get: function()&#123;</span><br><span class="line">return document.getElementById('showName').innerHTML;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="built_in">set</span>: function(name)&#123;</span><br><span class="line">document.getElementById('showName').innerHTML = name;</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Reflectæ˜¯ä¸€é¢å¤§é•œå­ï¼ŒObjectä½ æœ‰çš„æˆ‘å°±æœ‰ï¼</span></span><br><span class="line">Reflect.defineProperty(userInfo, <span class="string">"age"</span>, &#123;</span><br><span class="line">get: function()&#123;</span><br><span class="line">return document.getElementById('showAge').innerHTML;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="built_in">set</span>: function(name)&#123;</span><br><span class="line">document.getElementById('showAge').innerHTML = name;</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">document.getElementById('userName').onkeyup = function(e)&#123;</span><br><span class="line"></span><br><span class="line">userInfo.userName = <span class="keyword">this</span>.value;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">document.getElementById('age').onkeyup = function(e)&#123;</span><br><span class="line"></span><br><span class="line">userInfo.age = <span class="keyword">this</span>.value;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><blockquote><p><code>Reflect</code>ä¸€å…±æ˜¯13ä¸ªé™æ€æ–¹æ³•ï¼Œå°±æ˜¯13ç§æ­¦å™¨å“ˆï¼š<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Reflect.apply(target,thisArg,args)</span><br><span class="line">Reflect.construct(target,args)</span><br><span class="line">Reflect.get(target,name,receiver)</span><br><span class="line">Reflect.<span class="built_in">set</span>(target,name,value,receiver)</span><br><span class="line">Reflect.defineProperty(target,name,desc)</span><br><span class="line">Reflect.deleteProperty(target,name)</span><br><span class="line">Reflect.has(target,name)</span><br><span class="line">Reflect.ownKeys(target)</span><br><span class="line">Reflect.isExtensible(target)</span><br><span class="line">Reflect.preventExtensions(target)</span><br><span class="line">Reflect.getOwnPropertyDescriptor(target, name)</span><br><span class="line">Reflect.getPrototypeOf(target)</span><br><span class="line">Reflect.setPrototypeOf(target, prototype)</span><br></pre></td></tr></table></figure></p></blockquote><p>çœ‹ä¸‹å‡ ä¸ªå¸¸ç”¨çš„æ–¹æ³•ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">let obj = &#123;</span><br><span class="line">name:'jack',</span><br><span class="line">age:<span class="number">18</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//ç®€å•setæ–¹æ³•</span></span><br><span class="line">Reflect.set(obj,'name','tom');</span><br><span class="line">console.<span class="built_in">log</span>(obj.name);<span class="comment">//tom</span></span><br><span class="line"><span class="comment">//ç®€å•getæ–¹æ³•</span></span><br><span class="line">let age = Reflect.get(obj,'age');</span><br><span class="line">console.<span class="built_in">log</span>(age);<span class="comment">//18</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å¸¦æœ‰æ¥æ”¶è€…å¯¹è±¡çš„setæ–¹æ³•</span></span><br><span class="line">let receiver = &#123;</span><br><span class="line">name:'lily'</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//æ„æ€å°±æ˜¯ï¼šå‘èµ·è€…æ˜¯objï¼ŒæŠŠnameå±æ€§æ”¹ä¸ºbillï¼Œä½†è¿™ä¸ªåŠ¨ä½œçš„æ¥æ”¶è€…æ˜¯receiverã€‚</span></span><br><span class="line"><span class="comment">//æ‰€ä»¥ï¼Œobjçš„nameå±æ€§è¿˜æ˜¯tomï¼Œä½†æ¥æ”¶è€…receiverçš„nameè¢«æ”¹å˜äº†ã€‚</span></span><br><span class="line"><span class="comment">//è¿™ç§æœºåˆ¶çš„ä½œç”¨æ˜¯ï¼Œå¯ä»¥åœ¨å¯¹è±¡Aä¸­æ“ä½œå¯¹è±¡Bã€‚</span></span><br><span class="line">Reflect.set(obj,'name','bill',receiver);</span><br><span class="line"></span><br><span class="line">console.<span class="built_in">log</span>(obj.name);<span class="comment">//tom</span></span><br><span class="line">console.<span class="built_in">log</span>(receiver.name);<span class="comment">//bill</span></span><br><span class="line"><span class="comment">//åˆ¤æ–­objæ˜¯å¦æœ‰nameå±æ€§ï¼Ÿ</span></span><br><span class="line"><span class="comment">//æ—§å†™æ³•--in</span></span><br><span class="line">console.log('name' in obj);//true</span><br><span class="line"><span class="comment">//æ–°å†™æ³•--has</span></span><br><span class="line">console.log(Reflect.has(obj,'name'));//true</span><br></pre></td></tr></table></figure><p>ä»–ä¸<code>Proxy</code>ç»“åˆä½¿ç”¨æ›´åˆç†ã€‚</p><h1 id="Proxy"><a href="#Proxy" class="headerlink" title="Proxy"></a>Proxy</h1><p><code>Proxy</code>å°±æ˜¯æ‹¦æˆªå™¨ï¼Œä¹Ÿå¯ä»¥è¯‘ä¸ºä»£ç†å™¨ï¼Œè·Ÿè®¾è®¡æ¨¡å¼çš„ä»£ç†æ¨¡å¼å·®ä¸å¤šã€‚ä»–è·Ÿ<code>Reflect</code>æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚<br>åªè¦<code>Proxy</code>å¯¹è±¡æœ‰çš„æ–¹æ³•ï¼Œ<code>Reflect</code>å¯¹è±¡ä¸Šéƒ½æœ‰ã€‚å½“ç„¶å’¯ï¼Œ<code>Proxy</code>æ²¡æœ‰çš„ï¼Œ<code>Reflect</code>ä¹Ÿæœ‰ã€‚</p><p>æ‹¦æˆªå™¨æœ¬èº«ä¹Ÿæ˜¯å¯¹è±¡ï¼Œä»–çš„ä¸»è¦ä½œç”¨åœ¨äºæ‹¦æˆªã€‚çœ‹ä¸€ä¸‹è¯­æ³•å®šä¹‰ï¼š<br><code>var proxy = new Proxy(target, handler);</code></p><blockquote><p>1.targetå°±æ˜¯ç›®æ ‡å¯¹è±¡ï¼Œæˆ‘ä»¬è¦ç»™å“ªä¸ªå¯¹è±¡åŠ æ‹¦æˆªï¼Ÿ<br>2.handlerå°±æ˜¯å¤„ç†å¯¹è±¡ï¼Œä»–æ˜¯ä¸€ç³»åˆ—æ‹¦æˆªæ“ä½œçš„é›†åˆã€‚è¿™äº›æ‹¦æˆªæ“ä½œï¼Œå°±æ˜¯å¯¹åº”çš„Reflectå…·æœ‰çš„åä¸‰ç§é™æ€æ–¹æ³•ï¼ˆæ‰€è°“çš„ä¸€ä¸€å¯¹åº”å…¶å®å°±æ˜¯è¯´çš„è¿™ä¸ªï¼‰ã€‚æ³¨æ„ï¼Œåªæœ‰è¿™åä¸‰ç§æ­¦å™¨ï¼Œä¸æ”¯æŒå…¶ä»–çš„ã€‚</p></blockquote><p>æ‹¿æœ€ç®€å•çš„setæ–¹æ³•ä¸ºä¾‹:</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å½¢å‚è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment">// target:å¾…æµ‹è¯•çš„Personå®ä¾‹</span></span><br><span class="line"><span class="comment">// validator:éªŒè¯è§„åˆ™personValidators</span></span><br><span class="line"></span><br><span class="line"><span class="function">function <span class="title">createValidator</span><span class="params">(target, validator)</span> </span>&#123;</span><br><span class="line"><span class="comment">//æ‹¦æˆªå™¨ï¼Œæ‹¦æˆªèµ‹å€¼æ“ä½œï¼Œè§¦å‘setå‡½æ•°</span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> Proxy(target, &#123;</span><br><span class="line"></span><br><span class="line"> <span class="built_in">set</span>(target, key, value) &#123;</span><br><span class="line"><span class="comment">//å¦‚æœå¾…æµ‹è¯•çš„Personå¯¹è±¡ä¸­å«æœ‰è¿™ä¸ªå±æ€§ï¼Œå°±å¯ç”¨éªŒè¯è§„åˆ™ï¼Œ</span></span><br><span class="line"><span class="comment">// éªŒè¯è§„åˆ™çš„æ–¹æ³•ï¼šname(val)å’Œage(val)ï¼Œåç§°éœ€è¦è·Ÿä¼ å…¥çš„å±æ€§keyä¸€è‡´ã€‚</span></span><br><span class="line">  <span class="keyword">if</span> (target.hasOwnProperty(key)) &#123;</span><br><span class="line"></span><br><span class="line">    let rules = validator[key];<span class="comment">//rulesæ‹¿åˆ°çš„æ˜¯nameæ–¹æ³•çš„å¼•ç”¨</span></span><br><span class="line"><span class="comment">//ç›¸å½“äºè°ƒç”¨æ–¹æ³•name('hello')</span></span><br><span class="line">    <span class="keyword">if</span> (rules(value)) &#123;</span><br><span class="line"><span class="comment">//å¦‚æœéªŒè¯æ— è¯¯ï¼Œtargetçš„nameå±æ€§å¯ä»¥ä¿®æ”¹æˆåŠŸ</span></span><br><span class="line">     <span class="keyword">return</span> Reflect.<span class="built_in">set</span>(target, key, value);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//å¦åˆ™å¤±è´¥</span></span><br><span class="line">      return 'error';</span><br><span class="line">   &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     return 'error';</span><br><span class="line">  &#125; </span><br><span class="line"> &#125;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//éªŒè¯è§„åˆ™</span></span><br><span class="line"><span class="keyword">const</span> personRules = &#123;</span><br><span class="line"> name(val) &#123;</span><br><span class="line">   return typeof val === 'string';</span><br><span class="line"> &#125;,</span><br><span class="line"> age(val) &#123;</span><br><span class="line">   return typeof val === 'number' &amp;&amp; val &gt; 18;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//æµ‹è¯•ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> &#123;</span></span><br><span class="line"> constructor(name, age) &#123;</span><br><span class="line">   <span class="keyword">this</span>.name = name;</span><br><span class="line">   <span class="keyword">this</span>.age = age;</span><br><span class="line"><span class="comment">//å¼€å¯éªŒè¯ï¼Œä¼ å…¥è¿™ä¸ªç±»çš„å®ä¾‹å’ŒéªŒè¯è§„åˆ™personRules</span></span><br><span class="line">   <span class="keyword">return</span> createValidator(<span class="keyword">this</span>, personRules);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const bill = new Person('Bill', 25);</span><br><span class="line">bill.name = 'jack';//èµ‹å€¼æˆåŠŸ</span><br><span class="line">bill.age = <span class="number">10</span>;<span class="comment">//èµ‹å€¼å¤±è´¥</span></span><br><span class="line">console.<span class="built_in">log</span>(bill.name);<span class="comment">//jack</span></span><br><span class="line">console.<span class="built_in">log</span>(bill.age);<span class="comment">//25</span></span><br></pre></td></tr></table></figure><p><code>createValidator</code>è¿™ä¸ªå‡½æ•°ï¼Œè¿”å›çš„æ˜¯Proxyæ‹¦æˆªå™¨å¯¹è±¡ã€‚è¿™ä¸ªæ‹¦æˆªå™¨å¯¹è±¡ï¼Œå¯¹åŸPersonç±»çš„setæ“ä½œåšäº†ä¿®æ”¹ï¼ŒåŠ å…¥äº†ä¸€äº›éªŒè¯æ–¹æ¡ˆï¼Œå…¶å®å°±æ˜¯èµ·åˆ°äº†åŒ…è£…å¢å¼ºçš„ä½œç”¨ï¼Œè®©Personå…·æœ‰äº†å¯éªŒè¯å­—æ®µç±»å‹çš„åŠŸèƒ½ã€‚</p><p>å†æ¥çœ‹ä¸‹<code>Reflect.apply</code>çš„ç”¨æ³•ã€‚è¿™ä¸ªæ–¹æ³•çš„ä½¿ç”¨é¢‘ç‡è¿˜æ˜¯è›®é«˜çš„</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å‡å¦‚è¿™ä¸ªfooå‡½æ•°æ˜¯åŒäº‹å¼ ä¸‰å†™çš„</span></span><br><span class="line">var obj = &#123;&#125;;</span><br><span class="line"><span class="function">function <span class="title">foo</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">console.<span class="built_in">log</span>(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æå››å¼•å…¥å¹¶ä½¿ç”¨äº†è¿™ä¸ªå‡½æ•°</span></span><br><span class="line">foo.apply(obj);</span><br><span class="line"><span class="comment">//è¿™æ—¶ï¼Œå¦‚æœå¼ ä¸‰æŠŠå‡½æ•°åæ”¹æˆäº†bar,å¦‚æœæ²¡åŠæ—¶é€šçŸ¥åˆ°æå››ï¼Œé‚£ä¹ˆæå››çš„è°ƒç”¨å°±ä¼šæŠ¥é”™äº†ã€‚</span></span><br><span class="line"><span class="comment">//å¯ä»¥åœ¨ä¸ä¾èµ–å‡½æ•°åçš„æƒ…å†µä¸‹æ”¹å˜å‡½æ•°çš„ä½œç”¨åŸŸä¹ˆï¼Ÿ</span></span><br><span class="line">Function.prototype.apply.call(foo,obj);</span><br><span class="line"><span class="comment">//è¿™ç§å†™æ³•å¤ªé•¿äº†ï¼Œå¯ä»¥ä½¿ç”¨åå°„Reflectç»™æˆ‘ä»¬æä¾›çš„ç®€å•æ–¹æ³•ã€‚</span></span><br><span class="line">Reflect.apply(foo,obj,[]);<span class="comment">//è¦æ³¨æ„ï¼Œapplyæœ€åä¸€ä¸ªå‚æ•°è¦è·Ÿæ•°ç»„ï¼Œè¿™ä¸ªæ²¡æœ‰çš„è¯ä¹Ÿå¾—ä¼ []ï¼Œå¦åˆ™æŠ¥é”™</span></span><br></pre></td></tr></table></figure><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p><code>Proxy</code>æ˜¯ç”¨äºä¿®æ”¹è¯­è¨€å†…éƒ¨è¡Œä¸ºçš„æœºåˆ¶ï¼Œå› ä¸º<code>Object</code>å¯¹è±¡å†…éƒ¨çš„æ–¹æ³•å¤§å¤šå±äºè¿™ç§æƒ…å†µï¼Œæ‰€ä»¥<code>handler</code>çš„é…ç½®ï¼Œåˆè·Ÿ<code>Reflect</code>ç´§å¯†è”ç³»åœ¨ä¸€èµ·ï¼ˆå› ä¸ºReflectæ˜¯Objectçš„é•œå­å˜›ï¼‰ã€‚<br>åº”è¯¥è¯´ï¼Œ<code>Reflect</code>å’Œ<code>Proxy</code>ä¹‹é—´çš„å…³ç³»è¿˜æ˜¯ä¸å¤ªå®¹æ˜“ç†é¡ºçš„ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ES6çš„æ”¹ç‰ˆï¼Œä¸»è¦æ˜¯é€šè¿‡å¼•å…¥JAVAç­‰é™æ€è¯­è¨€çš„ä¼˜ç§€æ€æƒ³æ¥è§£å†³è€ç‰ˆæœ¬çš„ä¸€äº›ç—¼ç–¾ï¼Œå¦‚ä½œç”¨åŸŸï¼Œå›è°ƒï¼Œç»§æ‰¿å’Œå°è£…ç­‰é—®é¢˜ã€‚è¿™äº›æ”¹é©æªæ–½æ˜¯éå¸¸æˆåŠŸçš„ï¼ŒES6è®©JSçœŸæ­£å˜æˆäº†ä¸€ç§å¥½ç”¨çš„è¯­è¨€ã€‚è¿™é‡Œæ˜¯å…³äºReflectå’ŒProxyã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/es6_d.png&quot; alt=&quot;ES6æ”»ç•¥&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="ES6" scheme="https://duanruilong.github.io/categories/ES6/"/>
    
    
      <category term="Javascript" scheme="https://duanruilong.github.io/tags/Javascript/"/>
    
      <category term="ç¼–ç¨‹" scheme="https://duanruilong.github.io/tags/%E7%BC%96%E7%A8%8B/"/>
    
      <category term="ES6" scheme="https://duanruilong.github.io/tags/ES6/"/>
    
  </entry>
  
  <entry>
    <title>ES6æ”»ç•¥(ä¸‰)</title>
    <link href="https://duanruilong.github.io/2018/05/28/ES6%E6%94%BB%E7%95%A5-%E4%B8%89/"/>
    <id>https://duanruilong.github.io/2018/05/28/ES6æ”»ç•¥-ä¸‰/</id>
    <published>2018-05-28T15:54:45.000Z</published>
    <updated>2018-09-17T15:58:32.000Z</updated>
    
    <content type="html"><![CDATA[<p>ES6çš„æ”¹ç‰ˆï¼Œä¸»è¦æ˜¯é€šè¿‡å¼•å…¥JAVAç­‰é™æ€è¯­è¨€çš„ä¼˜ç§€æ€æƒ³æ¥è§£å†³è€ç‰ˆæœ¬çš„ä¸€äº›ç—¼ç–¾ï¼Œå¦‚ä½œç”¨åŸŸï¼Œå›è°ƒï¼Œç»§æ‰¿å’Œå°è£…ç­‰é—®é¢˜ã€‚è¿™äº›æ”¹é©æªæ–½æ˜¯éå¸¸æˆåŠŸçš„ï¼ŒES6è®©JSçœŸæ­£å˜æˆäº†ä¸€ç§å¥½ç”¨çš„è¯­è¨€ã€‚è¿™é‡Œæ˜¯å…³äºes7çš„async/awaitã€‚</p><p><img src="https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/es6_d.png" alt="ES6æ”»ç•¥"></p><a id="more"></a><h1 id="ES6"><a href="#ES6" class="headerlink" title="ES6"></a>ES6</h1><p><code>es6</code>çš„<code>promise</code>å†™æ³•è¿˜æ˜¯ä¸å¤Ÿä¼˜é›…ï¼Œå› ä¸ºåé¢ä¼šè·Ÿå¾ˆå¤š<code>then()</code>ã€‚åº”è¯¥è¯´ï¼Œ<code>async/await</code>æ˜¯ç›®å‰è§£å†³å›è°ƒé—®é¢˜æœ€å¥½çš„æ–¹æ¡ˆäº†ã€‚</p><blockquote><p>a:<code>async</code>å‡½æ•°æ˜¯ä»€ä¹ˆï¼Ÿ<br>b:ä¸€å¥è¯ï¼Œå®ƒå°±æ˜¯ <code>Generator</code> å‡½æ•°çš„è¯­æ³•ç³–ã€‚<br>a:è€Œ<code>Generator</code>åˆæ˜¯ç¥é©¬ï¼Ÿ<br>b:æ˜¯<code>es6</code>çš„ä¸€ä¸ªè¯­æ³•ã€‚<br>a:è¿™ä¸ªè¯­æ³•å¹²å˜›çš„ï¼Ÿ<br>b:ä¸ç”¨ç®¡å®ƒï¼Œåªéœ€è¦æŠŠasyncææ˜ç™½ã€‚</p></blockquote><p>è¦åœ¨node7ä¸‹é¢æ‰èƒ½ç©es7ï¼Œä½ç‰ˆæœ¬æ˜¯ç©ä¸äº†çš„å“ˆã€‚ç›®å‰å®˜ç½‘æœ€æ–°æµ‹è¯•ç‰ˆæœ¬æ˜¯<code>10.*</code>ï¼Œç¨³å®šç‰ˆå‡ºåˆ°<code>8.*</code>ï¼Œæ‰€ä»¥å®‰è£…å¥½å°±å¯ä»¥ä½¿ç”¨äº†ã€‚</p><p>ä½¿ç”¨<code>async/await</code>çš„ç›®çš„å°±æ˜¯å»é™¤æ‰<code>Promise</code>åé¢çš„<code>then()</code>,åœ¨å¹¶è¡Œä¸‹ä¹Ÿæ²¡æœ‰<code>then()</code>çš„ï¼Œä¸»è¦æ˜¯ä¸²è¡Œï¼Œå°±æ˜¯äº’ç›¸ä¾é çš„è¯·æ±‚æ–¹å¼ã€‚</p><ul><li>å‡è®¾æœ‰ä¸‰ä¸ªè¯·æ±‚ï¼š<br>è¯·æ±‚1ï¼šæ‹¿åˆ°useridï¼Œä¼ é€’ç»™è¯·æ±‚2ã€‚<br>è¯·æ±‚2ï¼šæ ¹æ®useridï¼ŒæŸ¥è¯¢ssoidï¼Œä¼ é€’ç»™è¯·æ±‚3ã€‚<br>è¯·æ±‚3ï¼šæ ¹æ®ssoidï¼ŒæŸ¥åˆ°æœ€ç»ˆç»“æœã€‚</li></ul><p>é‚£ä¹ˆï¼Œå¦‚æœå¯ä»¥è¿™ä¹ˆå†™å°±å¥½äº†ï¼š</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var userid = getRequest1();</span><br><span class="line">var ssoid = getRequest2(userid);</span><br><span class="line">var res = getRequest3(userid,ssoid);</span><br><span class="line"><span class="comment">//æ‰“å°æœ€ç»ˆç»“æœ</span></span><br><span class="line">res.then(function(data)&#123;console.<span class="built_in">log</span>(data);&#125;);</span><br></pre></td></tr></table></figure><p>æŠŠä¹‹å‰es6çš„å†™æ³•æ”¹ä¸€ä¸‹ï¼š</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">var request = require('request');</span><br><span class="line">var urls = [</span><br><span class="line">'http://localhost:3000/hello1',</span><br><span class="line">'http://localhost:3000/hello2',</span><br><span class="line">'http://localhost:3000/hello3'</span><br><span class="line">];</span><br><span class="line"><span class="comment">//åˆ›å»ºä»»åŠ¡å‡½æ•°ä¸å˜</span></span><br><span class="line"><span class="function">function <span class="title">createPromise</span><span class="params">(url)</span></span>&#123;</span><br><span class="line"><span class="comment">//å›è°ƒå‡½æ•°</span></span><br><span class="line"> var callback = function(resolve, reject)&#123;</span><br><span class="line"></span><br><span class="line"> request(url , function(err , response , body)&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(err)&#123;</span><br><span class="line">   reject(err);<span class="comment">//é”™è¯¯è¿”å›</span></span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">   resolve(body);<span class="comment">//æˆåŠŸè¿”å›</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"> &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//å¸ƒç½®ä»»åŠ¡</span></span><br><span class="line">var promise = <span class="keyword">new</span> Promise(callback);</span><br><span class="line"><span class="comment">//è¿”å›promiseæ‰¿è¯º</span></span><br><span class="line"> <span class="keyword">return</span> promise;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å£°æ˜asyncå‡½æ•°ï¼Œè¿”å›çš„ä¸€å®šæ˜¯promiseå¯¹è±¡</span></span><br><span class="line"><span class="function">async function <span class="title">doIt</span><span class="params">()</span></span>&#123;</span><br><span class="line"> var data_userid = await createPromise(urls[<span class="number">0</span>]);<span class="comment">//ç¬¬ä¸€ä¸ªè¯·æ±‚ä»»åŠ¡</span></span><br><span class="line"> data_userid = JSON.parse(data_userid);<span class="comment">//è§£ææˆå¯¹è±¡</span></span><br><span class="line"> var userid = data_userid.userid;<span class="comment">//è·å–userid</span></span><br><span class="line"> var data_ssoid = await createPromise(urls[<span class="number">1</span>]+<span class="string">"?userid="</span>+userid);<span class="comment">//ç¬¬äºŒä¸ªè¯·æ±‚ä»»åŠ¡</span></span><br><span class="line"> data_ssoid = JSON.parse(data_ssoid);<span class="comment">//è§£ææˆå¯¹è±¡</span></span><br><span class="line"> var ssoid = data_ssoid.ssoid;<span class="comment">//è·å–ssoid</span></span><br><span class="line"> var result = await createPromise(urls[2]+'?userid='+userid+'&amp;ssoid='+ssoid);//ç¬¬ä¸‰ä¸ªè¯·æ±‚ä»»åŠ¡</span><br><span class="line"> <span class="keyword">return</span> result;<span class="comment">//è¿”å›promiseå¯¹è±¡</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æœ€ç»ˆæ‰§è¡Œ</span></span><br><span class="line">doIt().then(function(data)&#123;</span><br><span class="line"><span class="comment">//æ‰“å°æœ€ç»ˆç»“æœ</span></span><br><span class="line">console.<span class="built_in">log</span>(data);</span><br><span class="line">&#125;).<span class="keyword">catch</span>(function(err)&#123;</span><br><span class="line"><span class="comment">//æ•è·å¼‚å¸¸</span></span><br><span class="line">console.<span class="built_in">log</span>(err);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><img src="http://mmbiz.qpic.cn/mmbiz_gif/amhuPdMsm1l8pHWF6CaJsuviaIjujRicK8ttrnjYQERA7C47wkJUtibIickCS8UwynqvOjETy7Yyz97syziaPcqDjXQ/0?wx_fmt=gif&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt="ç»“æœï¼š"></p><blockquote><p>æ³¨æ„ï¼š<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>asyncéœ€è¦æ”¾åœ¨å‡½æ•°å£°æ˜å‰ï¼Œè¡¨ç¤ºè¿™ä¸ªå‡½æ•°è¿”å›çš„ä¸€å®šæ˜¯promiseå¯¹è±¡ã€‚</span><br><span class="line"><span class="number">2.</span>awaitåé¢ä¹Ÿå¿…é¡»æ˜¯promiseå¯¹è±¡ï¼Œè¡¨ç¤ºè¿™ä¸ªä»»åŠ¡æ˜¯éœ€è¦ç­‰å¾…çš„ã€‚</span><br><span class="line"><span class="number">3.</span>æœ€åç”¨then()è·å–æ‰€æœ‰æ¥å£çš„ä¿¡æ¯ï¼Œ<span class="keyword">catch</span>()æ•è·æ‰€æœ‰å¼‚å¸¸ã€‚</span><br><span class="line"><span class="number">4.</span>è¿™ç§å†™æ³•è™½ç„¶ç±»ä¼¼åŒæ­¥ï¼Œä½†å®é™…æ˜¯promiseçš„ç®€åŒ–å†™æ³•ï¼Œä¸å¯æ··ä¸ºä¸€è°ˆï¼</span><br><span class="line"></span><br><span class="line">è¿™æ ·ï¼Œç®€å•æ•´æ´ï¼Œåªç•™ä¸€ä¸ªthenå’Œ<span class="keyword">catch</span>ã€‚</span><br></pre></td></tr></table></figure></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ES6çš„æ”¹ç‰ˆï¼Œä¸»è¦æ˜¯é€šè¿‡å¼•å…¥JAVAç­‰é™æ€è¯­è¨€çš„ä¼˜ç§€æ€æƒ³æ¥è§£å†³è€ç‰ˆæœ¬çš„ä¸€äº›ç—¼ç–¾ï¼Œå¦‚ä½œç”¨åŸŸï¼Œå›è°ƒï¼Œç»§æ‰¿å’Œå°è£…ç­‰é—®é¢˜ã€‚è¿™äº›æ”¹é©æªæ–½æ˜¯éå¸¸æˆåŠŸçš„ï¼ŒES6è®©JSçœŸæ­£å˜æˆäº†ä¸€ç§å¥½ç”¨çš„è¯­è¨€ã€‚è¿™é‡Œæ˜¯å…³äºes7çš„async/awaitã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/es6_d.png&quot; alt=&quot;ES6æ”»ç•¥&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="ES6" scheme="https://duanruilong.github.io/categories/ES6/"/>
    
    
      <category term="Javascript" scheme="https://duanruilong.github.io/tags/Javascript/"/>
    
      <category term="ç¼–ç¨‹" scheme="https://duanruilong.github.io/tags/%E7%BC%96%E7%A8%8B/"/>
    
      <category term="ES6" scheme="https://duanruilong.github.io/tags/ES6/"/>
    
  </entry>
  
</feed>

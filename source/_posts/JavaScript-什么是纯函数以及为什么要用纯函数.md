---
title: 'JavaScript: 什么是纯函数以及为什么要用纯函数'
date: 2018-11-11 17:57:25
tags: [Javascript,编程]
description: 
copyright: true
categories: Javascript
top:
---
当我第一次听到 “纯函数 (Pure Function)” 这个术语的时候我很疑惑。常规的函数做错了什么？为什么要变纯？ 为什么我需要纯的函数？

除非你已经知道什么是纯函数，否则你可能会问同样的疑惑。不过这个概念其实很简单。可以花点时间一起来看以下。

![js](https://raw.githubusercontent.com/Duanruilong/phone_drl/master/image/blog/js_d.png)

<!-- more -->

# 什么函数是纯

纯函数的定义是：

- 1、如果函数的调用参数相同，则永远返回相同的结果。它不依赖于程序执行期间函数外部任何状态或数据的变化，必须只依赖于其输入参数。

- 2、该函数不会产生任何可观察的副作用，例如网络请求，输入和输出设备或数据突变（mutation）。

这就是纯的函数。 如果一个函数符合上述 2 个要求，它就是纯函数。 你可能在过去甚至无意地情况下编写过纯函数。

在我们研究一个函数一个纯或不纯之前，让我们先讨论一下可怕的“副作用”。


# 什么是可观察的副作用

一个可以被观察的副作用是在函数内部与其外部的任意交互。这可能是在函数内修改外部的变量，或者在函数里调用另外一个函数等。

注: 如果纯函数调用纯函数，则不产生副作用依旧是纯函数。

副作用来自，但不限于：

- 进行一个 HTTP 请求

- Mutating data

- 输出数据到屏幕或者控制台

- DOM 查询/操作

- Math.random()

- 获取的当前时间

副作用本身并不是毒药，某些时候往往是必需的。 但是，对于要保持纯粹的函数，它不能包含任何副作用。当然，并非所有函数都需要是纯函数。 我将在稍后讨论这个情况。

不过首先，让我们来看一些纯的和不纯的函数对比的例子......

# 纯函数

以下是一个计算产品税后价格（英国税率是20%）的纯函数的例子：
```h
function priceAfterTax(productPrice) { return (productPrice * 0.20) + productPrice;}

```

它符合我们所说的两条纯函数的定义。`不依赖于任何外部输入，不改变任何外部数据、没有副作用`。

即使你用同样的输入运行运行这个函数 100,000,000 次它依旧产生同样的结果。


# 非纯函数

我们已经看了纯函数的例子，现在一起来看一个非纯函数（Impure function）的 JavaScript 例子:
```h
var tax = 20;

function calculateTax(productPrice) { return (productPrice * (tax/100)) + productPrice;
}
```
暂停片刻，看看你是否能看出为什么这个函数不纯。

其中函数的计算结果取决于外部 tax 变量，而纯函数不能依赖外部变量。它没有满足定义中的第一个要求，因此这个函数是不纯的。


# 为什么说纯函数在 JavaScript 很重要

纯函数在函数式编程中被大量使用。而且诸如 ReactJS 和 Redux 等优质的库都需要使用纯函数。

不过，纯函数也可以用在平常的 JavaScript 开发中使用，不一定要限死在某个编程范例中。 你可以混合纯的和不纯的函数，这完全没问题。

并非所有函数都需要是纯的。 例如，操作 DOM 的按钮按下的事件处理程序就不适合纯函数。 不过，这种事件处理函数可以调用其他纯函数来处理，以此减少项目中不纯函数的数量。

# 可测试性和重构
另一个使用纯函数的原因是测试以及重构。

使用纯函数的一个主要好处是它们可以直接测。 如果传入相同的参数，它们将始终产生相同的结果。

同时纯函数还使得维护和重构代码变得更加容易。你可以放心地重构一个纯函数，不必操心没注意到的副作用搞乱了整个应用而导致终调试地狱。（译注：如果项目中充斥着副作用，那么函数/模块之间的逻辑可能互相交织耦合，在后期新增逻辑时可能由于依赖复杂而难以重构，更常见的是开发为了应付需求而不断的引入新的副作用到原本的逻辑上从而导致代码变得越来越糟糕。）

`正确地使用纯函数可以产生更加高质量的代码。并且也是一种更加干净的编码方式。`

此外，纯函数不不是 JavaScript 的专利。想要了解更多内容可以参见 [Wiki](https://en.wikipedia.org/wiki/Pure_function)。同时也推荐阅读 [开发建议手册](https://drboolean.gitbooks.io/mostly-adequate-guide/ch3.html) 以及 [纯函数 vs. 非纯函数](https://toddmotto.com/pure-versus-impure-functions).


原文链接： medium.com